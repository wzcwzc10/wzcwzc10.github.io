<!DOCTYPE html><html lang="zh-CN" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Spring AI å­¦ä¹ æ€»ç»“ | å¾®å…‰zcçš„ç½‘ç»œå°çª</title><meta name="author" content="å¾®å…‰zc"><meta name="copyright" content="å¾®å…‰zc"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="Spring AI å­¦ä¹ æ€»ç»“">
<meta property="og:type" content="article">
<meta property="og:title" content="Spring AI å­¦ä¹ æ€»ç»“">
<meta property="og:url" content="https://wzcwzc10.github.io/2025/11/09/Spring%20AI%20%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/index.html">
<meta property="og:site_name" content="å¾®å…‰zcçš„ç½‘ç»œå°çª">
<meta property="og:description" content="Spring AI å­¦ä¹ æ€»ç»“">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://wzcwzc10.github.io/img/YH/als.jpg">
<meta property="article:published_time" content="2025-11-09T12:00:00.000Z">
<meta property="article:modified_time" content="2025-11-19T02:32:32.088Z">
<meta property="article:author" content="å¾®å…‰zc">
<meta property="article:tag" content="äººå·¥æ™ºèƒ½">
<meta property="article:tag" content="AI">
<meta property="article:tag" content="Spring AI">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://wzcwzc10.github.io/img/YH/als.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Spring AI å­¦ä¹ æ€»ç»“",
  "url": "https://wzcwzc10.github.io/2025/11/09/Spring%20AI%20%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/",
  "image": "https://wzcwzc10.github.io/img/YH/als.jpg",
  "datePublished": "2025-11-09T12:00:00.000Z",
  "dateModified": "2025-11-19T02:32:32.088Z",
  "author": [
    {
      "@type": "Person",
      "name": "å¾®å…‰zc",
      "url": "https://wzcwzc10.github.io"
    }
  ]
}</script><link rel="shortcut icon" href="/./img/loading.gif"><link rel="canonical" href="https://wzcwzc10.github.io/2025/11/09/Spring%20AI%20%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=5.5.2"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@6.1.4/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!true && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'undefined')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'undefined')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"pagination":{"enable":false,"hitsPerPage":8},"languages":{"hits_empty":"æœªæ‰¾åˆ°ç¬¦åˆæ‚¨æŸ¥è¯¢çš„å†…å®¹ï¼š${query}","hits_stats":"å…±æ‰¾åˆ° ${hits} ç¯‡æ–‡ç« "}},
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶å¤±è´¥',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'åˆšåˆš',
    min: 'åˆ†é’Ÿå‰',
    hour: 'å°æ—¶å‰',
    day: 'å¤©å‰',
    month: 'ä¸ªæœˆå‰'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.12.0/dist/infinitegrid.min.js',
    buttonText: 'åŠ è½½æ›´å¤š'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Spring AI å­¦ä¹ æ€»ç»“',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="stylesheet" href="/css/ziti.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="/css/universe.css"><!-- hexo injector head_end start -->
<link rel="stylesheet" href="/components/bilibili-card/bilibili-card.dark.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head><body><div id="web_bg" style="background-image: url(/./img/page-bg.png);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/./img/jufufu-ht.gif" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">67</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">66</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">19</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> ä¸»é¡µ</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-archive"></i><span> å½’æ¡£</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> æ—¶é—´çº¿</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> åˆ†ç±»</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> éŸ³ä¹</span></a></div><div class="menus_item"><a class="site-page" href="/movies/"><i class="fa-fw fas fa-video"></i><span> è§†é¢‘</span></a></div><div class="menus_item"><a class="site-page" href="/games/"><i class="fa-fw fas fa-gamepad"></i><span> æ¸¸æˆ</span></a></div><div class="menus_item"><a class="site-page" href="/message/"><i class="fa-fw fas fa-comments"></i><span> ç•™è¨€æ¿</span></a></div><div class="menus_item"><a class="site-page" href="/shuoshuo/"><i class="fa-fw fas fa-comments"></i><span> å¾®å…‰é—²è¯</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> å‹é“¾</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> å…³äº</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/./img/YH/als.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="/./img/yx.png" alt="Logo"><span class="site-name">å¾®å…‰zcçš„ç½‘ç»œå°çª</span></a><a class="nav-page-title" href="/"><span class="site-name">Spring AI å­¦ä¹ æ€»ç»“</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  è¿”å›é¦–é¡µ</span></span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> æœç´¢</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> ä¸»é¡µ</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-archive"></i><span> å½’æ¡£</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> æ—¶é—´çº¿</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> åˆ†ç±»</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> éŸ³ä¹</span></a></div><div class="menus_item"><a class="site-page" href="/movies/"><i class="fa-fw fas fa-video"></i><span> è§†é¢‘</span></a></div><div class="menus_item"><a class="site-page" href="/games/"><i class="fa-fw fas fa-gamepad"></i><span> æ¸¸æˆ</span></a></div><div class="menus_item"><a class="site-page" href="/message/"><i class="fa-fw fas fa-comments"></i><span> ç•™è¨€æ¿</span></a></div><div class="menus_item"><a class="site-page" href="/shuoshuo/"><i class="fa-fw fas fa-comments"></i><span> å¾®å…‰é—²è¯</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> å‹é“¾</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> å…³äº</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">Spring AI å­¦ä¹ æ€»ç»“</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2025-11-09T12:00:00.000Z" title="å‘è¡¨äº 2025-11-09 20:00:00">2025-11-09</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2025-11-19T02:32:32.088Z" title="æ›´æ–°äº 2025-11-19 10:32:32">2025-11-19</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/AI/">AI</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">æ€»å­—æ•°:</span><span class="word-count">26.8k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»æ—¶é•¿:</span><span>120åˆ†é’Ÿ</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">æµè§ˆé‡:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="å¯ç¨‹"><a href="#å¯ç¨‹" class="headerlink" title="å¯ç¨‹"></a>å¯ç¨‹</h1><p><a target="_blank" rel="noopener" href="https://springdoc.cn/spring-ai/index.html">Spring AIä¸­æ–‡æ–‡æ¡£</a></p>
<h2 id="Spring-AI-å­¦ä¹ ç¯å¢ƒ"><a href="#Spring-AI-å­¦ä¹ ç¯å¢ƒ" class="headerlink" title="Spring AI å­¦ä¹ ç¯å¢ƒ"></a>Spring AI å­¦ä¹ ç¯å¢ƒ</h2><p>å¼€å‘å·¥å…·ï¼šIntelliJ IDEA Ultimate æˆ– VSCode<br>Java ç¯å¢ƒï¼šJDK 17 æˆ–æ›´é«˜ç‰ˆæœ¬<br>æ„å»ºå·¥å…·ï¼šMaven 3.8+ æˆ– Gradle 7.0+<br>å®¹å™¨ç¯å¢ƒï¼šDocker Desktop å’Œ Kubernetes<br>AI æœåŠ¡ï¼šOpenAIã€Azure OpenAI æˆ–å…¶ä»– AI æœåŠ¡è´¦å·<br>ğŸ“– å‚è€ƒèµ„æ–™<br>å®˜æ–¹æ–‡æ¡£ï¼šSpring AI å®˜æ–¹æ–‡æ¡£å’Œ API å‚è€ƒ<br>æŠ€æœ¯åšå®¢ï¼šSpring å®˜æ–¹åšå®¢å’ŒæŠ€æœ¯æ–‡ç« <br>å¼€æºé¡¹ç›®ï¼šGitHub ä¸Šçš„ Spring AI ç¤ºä¾‹é¡¹ç›®<br>æŠ€æœ¯ç¤¾åŒºï¼šStack Overflowã€Redditã€Discord ç­‰æŠ€æœ¯ç¤¾åŒº<br>å­¦ä¹ å¹³å°ï¼šCourseraã€Udemy ç­‰åœ¨çº¿å­¦ä¹ å¹³å°çš„ AI è¯¾ç¨‹</p>
<h2 id="AIçš„ä¸»è¦åˆ†æ”¯"><a href="#AIçš„ä¸»è¦åˆ†æ”¯" class="headerlink" title="AIçš„ä¸»è¦åˆ†æ”¯"></a>AIçš„ä¸»è¦åˆ†æ”¯</h2><ol>
<li>æœºå™¨å­¦ä¹ (Machine Learning):ä½¿è®¡ç®—æœºèƒ½å¤Ÿä»æ•°æ®ä¸­å­¦ä¹ ï¼Œè€Œæ— éœ€æ˜ç¡®ç¼–ç¨‹ã€‚</li>
<li>æ·±åº¦å­¦ä¹ (Deep Learning)ï¼šåŸºäºäººå·¥ç¥ç»ç½‘ç»œçš„æœºå™¨å­¦ä¹ å­é›†ï¼Œèƒ½å¤„ç†æ›´å¤æ‚çš„æ•°æ®æ¨¡å¼ã€‚</li>
<li>è‡ªç„¶è¯­è¨€å¤„ç†(NLP)ï¼šä½¿è®¡ç®—æœºèƒ½å¤Ÿç†è§£ã€è§£é‡Šå’Œç”Ÿæˆäººç±»è¯­è¨€ã€‚</li>
<li>è®¡ç®—æœºè§†è§‰(Computer Vision):ä½¿è®¡ç®—æœºèƒ½å¤Ÿâ€çœ‹åˆ°â€å¹¶ç†è§£è§†è§‰ä¿¡æ¯ã€‚</li>
<li>æœºå™¨äººå­¦(Robotics):ç ”ç©¶è®¾è®¡ã€æ„å»ºå’Œæ“ä½œæœºå™¨äººçš„å­¦ç§‘ã€‚</li>
</ol>
<h2 id="å¤§è¯­è¨€æ¨¡å‹-LLM"><a href="#å¤§è¯­è¨€æ¨¡å‹-LLM" class="headerlink" title="å¤§è¯­è¨€æ¨¡å‹(LLM)"></a>å¤§è¯­è¨€æ¨¡å‹(LLM)</h2><p>å¤§è¯­è¨€æ¨¡å‹(Large Language Models,ç®€ç§°LLM)åŸºäºæ·±åº¦å­¦ä¹ çš„æ¨¡å‹ï¼Œé€šè¿‡åˆ†æå¤§é‡æ–‡æœ¬æ•°æ®å­¦ä¹ è¯­è¨€æ¨¡å¼å’ŒçŸ¥è¯†ã€‚<br>LLMçš„åŸºæœ¬åŸç†</p>
<ol>
<li>é¢„è®­ç»ƒ-å¾®è°ƒèŒƒå¼ï¼š<br>Â·é¢„è®­ç»ƒï¼šæ¨¡å‹åœ¨å¤§é‡é€šç”¨æ–‡æœ¬ä¸Šè¿›è¡Œè®­ç»ƒï¼Œå­¦ä¹ è¯­è¨€çš„åŸºæœ¬ç»“æ„å’ŒçŸ¥è¯†ã€‚<br>Â·å¾®è°ƒï¼šåœ¨ç‰¹å®šä»»åŠ¡çš„æ•°æ®é›†ä¸Šè¿›ä¸€æ­¥è®­ç»ƒï¼Œä½¿æ¨¡å‹é€‚åº”ç‰¹å®šé¢†åŸŸæˆ–ä»»åŠ¡ã€‚</li>
<li>Transformeræ¶æ„ï¼š<br>Â·å¤§å¤šæ•°ç°ä»£LLMåŸºäºTransformeræ¶æ„ï¼Œè¿™æ˜¯ä¸€ç§ç‰¹åˆ«é€‚åˆå¤„ç†åºåˆ—æ•°æ®çš„ç¥ç»ç½‘ç»œç»“æ„ã€‚<br>Â·Transformerçš„æ ¸å¿ƒæ˜¯è‡ªæ³¨æ„åŠ›æœºåˆ¶ï¼Œä½¿æ¨¡å‹èƒ½å¤Ÿæ•æ‰å¥å­ä¸­ä¸åŒå•è¯ä¹‹é—´çš„å…³ç³»ã€‚</li>
<li>å¤§è§„æ¨¡å‚æ•°ï¼š<br>Â·ç°ä»£LMé€šå¸¸åŒ…å«æ•°åäº¿ç”šè‡³æ•°åƒäº¿å‚æ•°ã€‚<br>Â·å‚æ•°è¶Šå¤šï¼Œæ¨¡å‹çš„èƒ½åŠ›é€šå¸¸è¶Šå¼ºï¼Œä½†è®­ç»ƒå’Œè¿è¡Œæˆæœ¬ä¹Ÿè¶Šé«˜ã€‚</li>
<li>è‡ªç›‘ç£å­¦ä¹ ï¼š<br>Â·LLMä¸»è¦é€šè¿‡é¢„æµ‹ä¸‹ä¸€ä¸ªå•è¯æˆ–å¡«è¡¥ç¼ºå¤±å•è¯ç­‰ä»»åŠ¡è¿›è¡Œè®­ç»ƒã€‚<br>Â·è¿™ç§æ–¹æ³•ä¸éœ€è¦äººå·¥æ ‡æ³¨çš„æ•°æ®ï¼Œèƒ½å¤Ÿåˆ©ç”¨äº’è”ç½‘ä¸Šæµ·é‡çš„æ–‡æœ¬èµ„æºã€‚</li>
</ol>
<h2 id="AI-æœ¯è¯­"><a href="#AI-æœ¯è¯­" class="headerlink" title="AI æœ¯è¯­"></a>AI æœ¯è¯­</h2><ul>
<li>æç¤ºè¯(Prompt)<br>æç¤ºè¯æ˜¯ç”¨æˆ·å‘AIæ¨¡å‹æä¾›çš„è¾“å…¥æ–‡æœ¬ï¼Œç”¨äºæŒ‡å¯¼æ¨¡å‹ç”ŸæˆæœŸæœ›çš„è¾“å‡ºã€‚<br>ä¸€ä¸ªå¥½çš„æç¤ºè¯å¯ä»¥æ˜¾è‘—æé«˜æ¨¡å‹è¾“å‡ºçš„è´¨é‡å’Œç›¸å…³æ€§ã€‚</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">String prompt=<span class="string">&quot;è¯·ä¸ºå‰ªåˆ‡åŠ©æ‰‹åº”ç”¨ç¼–å†™ä¸€ä¸ªç®€çŸ­çš„äº§å“æè¿°ï¼Œå¼ºè°ƒå…¶è·¨è®¾å¤‡åŒæ­¥åŠŸèƒ½ã€‚&quot;</span>ï¼›</span><br><span class="line">String response aiModel.generateText(prompt);</span><br></pre></td></tr></table></figure>

<ul>
<li><p>æ¨¡å‹(Model)<br>AIæ¨¡å‹æ˜¯ç»è¿‡è®­ç»ƒçš„ç®—æ³•ï¼Œèƒ½å¤Ÿæ‰§è¡Œç‰¹å®šä»»åŠ¡ã€‚(å¤§å‹è¯­è¨€æ¨¡å‹)</p>
</li>
<li><p>æ ‡è®°(Token)<br>æ ‡è®°æ˜¯LLMå¤„ç†æ–‡æœ¬çš„åŸºæœ¬å•ä½ã€‚ä¸€ä¸ªæ ‡è®°å¯èƒ½æ˜¯ä¸€ä¸ªå•è¯ã€å•è¯çš„ä¸€éƒ¨åˆ†æˆ–æ ‡ç‚¹ç¬¦å·ã€‚<br>ç†è§£æ ‡è®°å¯¹äºç®¡ç†æ¨¡å‹è¾“å…¥é™åˆ¶å’Œæˆæœ¬è®¡ç®—å¾ˆé‡è¦ã€‚</p>
</li>
<li><p>åµŒå…¥(Embedding)<br>åµŒå…¥æ˜¯å°†æ–‡æœ¬ã€å›¾åƒç­‰æ•°æ®è½¬æ¢ä¸ºå¯†é›†çš„æ•°å€¼å‘é‡ï¼Œä½¿A!ç³»ç»Ÿèƒ½å¤Ÿå¤„ç†å’Œç†è§£è¿™äº›æ•°æ®ã€‚<br>æ–‡æœ¬åµŒå…¥åœ¨æœç´¢ã€æ¨èç³»ç»Ÿå’Œæ–‡æœ¬åˆ†ç±»ä¸­ç‰¹åˆ«æœ‰ç”¨ã€‚</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨åµŒå…¥çš„ç®€åŒ–ç¤ºä¾‹</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TextEmbedding</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> EmbeddingModel model;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">TextEmbedding</span><span class="params">(EmbeddingModel model)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.model = model;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span>[] getEmbedding(String text) &#123;</span><br><span class="line">        <span class="comment">// å°†æ–‡æœ¬è½¬æ¢ä¸ºåµŒå…¥å‘é‡</span></span><br><span class="line">        <span class="keyword">return</span> model.embed(text);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">calculateSimilarity</span><span class="params">(String text1, String text2)</span> &#123;</span><br><span class="line">        <span class="type">double</span>[] embedding1 = getEmbedding(text1);</span><br><span class="line">        <span class="type">double</span>[] embedding2 = getEmbedding(text2);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// è®¡ç®—ä½™å¼¦ç›¸ä¼¼åº¦</span></span><br><span class="line">        <span class="keyword">return</span> cosineSimilarity(embedding1, embedding2);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> <span class="title function_">cosineSimilarity</span><span class="params">(<span class="type">double</span>[] v1, <span class="type">double</span>[] v2)</span> &#123;</span><br><span class="line">        <span class="comment">// å®ç°ä½™å¼¦ç›¸ä¼¼åº¦è®¡ç®—</span></span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">0.87</span>; <span class="comment">// ç¤ºä¾‹è¿”å›å€¼</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>æ¸©åº¦(Temperature)<br>æ¸©åº¦æ˜¯æ§åˆ¶AIç”Ÿæˆæ–‡æœ¬éšæœºæ€§çš„å‚æ•°ã€‚<br>è¾ƒä½çš„æ¸©åº¦ï¼ˆæ¥è¿‘0ï¼‰ä¼šäº§ç”Ÿæ›´ç¡®å®šæ€§ã€ä¿å®ˆçš„è¾“å‡ºï¼Œè€Œè¾ƒé«˜çš„æ¸©åº¦ï¼ˆæ¥è¿‘1æˆ–æ›´é«˜)ä¼šäº§ç”Ÿæ›´å¤šæ ·åŒ–ã€åˆ›é€ æ€§çš„è¾“å‡ºã€‚</p>
</li>
<li><p>å¾®è°ƒ(Fine-tuning)<br>å¾®è°ƒæ˜¯æŒ‡åœ¨é€šç”¨é¢„è®­ç»ƒæ¨¡å‹çš„åŸºç¡€ä¸Šï¼Œä½¿ç”¨ç‰¹å®šé¢†åŸŸçš„æ•°æ®è¿›ä¸€æ­¥è®­å·ç»ƒï¼Œä½¿æ¨¡å‹æ›´é€‚åˆç‰¹å®šä»»åŠ¡æˆ–é¢†åŸŸçš„è¿‡ç¨‹ã€‚</p>
</li>
<li><p>ä¸Šä¸‹æ–‡çª—å£(Context Window)<br>ä¸Šä¸‹æ–‡çª—å£æ˜¯æŒ‡æ¨¡å‹ä¸€æ¬¡èƒ½å¤„ç†çš„æœ€å¤§æ ‡è®°æ•°ã€‚å®ƒé™åˆ¶äº†ç”¨æˆ·å¯ä»¥æä¾›çš„è¾“å…¥é•¿åº¦å’Œæ¨¡å‹å¯ä»¥ç”Ÿæˆçš„è¾“å‡ºé•¿åº¦çš„æ€»å’Œã€‚</p>
</li>
<li><p>æ¨ç†(Inference)<br>æ¨ç†æ˜¯æŒ‡æ¨¡å‹ä½¿ç”¨å…¶å­¦åˆ°çš„æ¨¡å¼å¤„ç†æ–°è¾“å…¥å¹¶ç”Ÿæˆè¾“å‡ºçš„è¿‡ç¨‹ã€‚å¯¹äºLLM,è¿™é€šå¸¸æŒ‡çš„æ˜¯ç”Ÿæˆæ–‡æœ¬çš„è¿‡ç¨‹ã€‚</p>
</li>
<li><p>RAG(æ£€ç´¢å¢å¼ºç”Ÿæˆ)<br>RAGæ˜¯ä¸€ç§å°†æ£€ç´¢ç³»ç»Ÿä¸æ–‡æœ¬ç”Ÿæˆæ¨¡å‹ç»“åˆçš„æŠ€æœ¯ï¼Œä½¿æ¨¡å‹èƒ½å¤Ÿè®¿é—®å’Œåˆ©ç”¨å¤–éƒ¨çŸ¥è¯†æºï¼Œæé«˜ç”Ÿæˆå†…å®¹çš„å‡†ç¡®æ€§å’Œç›¸å…³æ€§ã€‚</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// RAG ç³»ç»Ÿçš„ç®€åŒ–ç¤ºä¾‹</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RAGSystem</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> DocumentStore documentStore;</span><br><span class="line">    <span class="keyword">private</span> EmbeddingModel embeddingModel;</span><br><span class="line">    <span class="keyword">private</span> LLMClient llmClient;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ„é€ å‡½æ•°å’Œå…¶ä»–æ–¹æ³•...</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">answerQuestion</span><span class="params">(String question)</span> &#123;</span><br><span class="line">        <span class="comment">// 1. å°†é—®é¢˜è½¬æ¢ä¸ºåµŒå…¥å‘é‡</span></span><br><span class="line">        <span class="type">double</span>[] questionEmbedding = embeddingModel.embed(question);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2. æ£€ç´¢ç›¸å…³æ–‡æ¡£</span></span><br><span class="line">        List&lt;Document&gt; relevantDocs = documentStore.searchSimilar(questionEmbedding, <span class="number">3</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 3. æ„å»ºåŒ…å«æ£€ç´¢åˆ°çš„ä¿¡æ¯çš„æç¤ºè¯</span></span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">contextBuilder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        <span class="keyword">for</span> (Document doc : relevantDocs) &#123;</span><br><span class="line">            contextBuilder.append(doc.getContent()).append(<span class="string">&quot;\n\n&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="type">String</span> <span class="variable">prompt</span> <span class="operator">=</span> <span class="string">&quot;åŸºäºä»¥ä¸‹ä¿¡æ¯å›ç­”é—®é¢˜ï¼š\n\n&quot;</span> + </span><br><span class="line">                        contextBuilder.toString() + </span><br><span class="line">                        <span class="string">&quot;\n\né—®é¢˜ï¼š&quot;</span> + question;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 4. ä½¿ç”¨ LLM ç”Ÿæˆç­”æ¡ˆ</span></span><br><span class="line">        <span class="keyword">return</span> llmClient.generateText(prompt);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Spring-æ¡†æ¶"><a href="#Spring-æ¡†æ¶" class="headerlink" title="Spring æ¡†æ¶"></a>Spring æ¡†æ¶</h1><p>Springæ ¸å¿ƒæ¡†æ¶æ˜¯æ•´ä¸ªSpringç”Ÿæ€ç³»ç»Ÿçš„åŸºç¡€.<br>æä¾›äº†ä¾èµ–æ³¨å…¥(DI)ã€é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼ˆAOP)ã€äº‹ä»¶æœºåˆ¶ã€èµ„æºç®¡ç†ç­‰æ ¸å¿ƒåŠŸèƒ½ã€‚</p>
<p>SpringBoot<br>SpringBootç®€åŒ–äº†Springåº”ç”¨çš„åˆå§‹æ­å»ºå’Œå¼€å‘è¿‡ç¨‹ã€‚</p>
<p>Spring Data<br>Spring Dataç®€åŒ–äº†æ•°æ®è®¿é—®å±‚çš„å¼€å‘ï¼Œæä¾›äº†ç»Ÿä¸€çš„APIæ¥è®¿é—®ä¸åŒç±»å‹çš„æ•°æ®å­˜å‚¨ã€‚</p>
<p>Spring Security<br>Spring Securityæä¾›äº†å…¨é¢çš„å®‰å…¨è§£å†³æ–¹æ¡ˆï¼ŒåŒ…æ‹¬è®¤è¯ã€æˆæƒã€é˜²æŠ¤æ”»å‡»ç­‰åŠŸèƒ½ï¼Œ<br>å¯ä»¥ä¿æŠ¤Webåº”ç”¨ã€RESTful APIä»¥åŠå¾®æœåŠ¡ã€‚</p>
<p>Spring Cloud<br>Spring Cloudæä¾›äº†ä¸€å¥—å·¥å…·ï¼Œç”¨äºåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å¿«é€Ÿæ„å»ºå¾®æœåŠ¡åº”ç”¨ã€‚<br>å®ƒåŒ…å«äº†æœåŠ¡å‘ç°ã€é…ç½®ç®¡ç†ã€æ–­è·¯å™¨ã€æ™ºèƒ½è·¯ç”±ã€è´Ÿè½½å‡è¡¡ç­‰ç»„ä»¶ã€‚</p>
<p>Spring Integration Spring Batch<br>Spring Integrationæä¾›äº†ä¼ä¸šé›†æˆæ¨¡å¼çš„å®ç°ï¼Œç”¨äºè¿æ¥ä¸åŒç³»ç»Ÿå’Œåº”ç”¨ã€‚<br>Spring Batchåˆ™ä¸“æ³¨äºæ‰¹å¤„ç†æ“ä½œï¼Œå¦‚æ•°æ®è¿ç§»ã€ETLä»»åŠ¡ç­‰ã€‚</p>
<p>æ¡†æ¶ä¸åº“(Library)çš„åŒºåˆ«åœ¨äºæ§åˆ¶æƒçš„åè½¬ï¼š<br>Â·ä½¿ç”¨åº“æ—¶ï¼Œå¼€å‘è€…çš„ä»£ç è°ƒç”¨åº“ä¸­çš„ä»£ç <br>Â·ä½¿ç”¨æ¡†æ¶æ—¶ï¼Œæ¡†æ¶çš„ä»£ç è°ƒç”¨å¼€å‘è€…çš„ä»£ç </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨åº“çš„ç¤ºä¾‹ï¼šå¼€å‘è€…ä»£ç è°ƒç”¨åº“å‡½æ•°</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">libraryExample</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// å¼€å‘è€…å†³å®šä½•æ—¶è°ƒç”¨åº“ä¸­çš„æ–¹æ³•</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">text</span> <span class="operator">=</span> <span class="string">&quot;ç¼–ç¨‹å¯¼èˆªæ¬¢è¿ä½ &quot;</span>;</span><br><span class="line">    System.out.println(StringUtils.capitalize(text)); <span class="comment">// ä½¿ç”¨ Apache Commons åº“</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨æ¡†æ¶çš„ç¤ºä¾‹ï¼šæ¡†æ¶è°ƒç”¨å¼€å‘è€…ä»£ç </span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FrameworkExample</span> &#123;</span><br><span class="line">    <span class="comment">// æ¡†æ¶å†³å®šä½•æ—¶è°ƒç”¨æ­¤æ–¹æ³•</span></span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;é¢è¯•é¸­ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="RESTful-APIåŸºç¡€"><a href="#RESTful-APIåŸºç¡€" class="headerlink" title="RESTful APIåŸºç¡€"></a>RESTful APIåŸºç¡€</h1><p>RESTful API(Representational State Transfer API)<br>æ˜¯ä¸€ç§è®¾è®¡é£æ ¼ï¼Œç”¨äºæ„å»ºåˆ†å¸ƒå¼ç³»ç»Ÿï¼Œç‰¹åˆ«æ˜¯WebæœåŠ¡ã€‚</p>
<p>RESTçš„æ ¸å¿ƒåŸåˆ™</p>
<ol>
<li>èµ„æº(Resources):ç³»ç»Ÿçš„æ ¸å¿ƒæ˜¯èµ„æºï¼Œæ¯ä¸ªèµ„æºéƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„æ ‡è¯†ç¬¦(URI)ã€‚</li>
<li>è¡¨ç¤º(Representations):èµ„æºå¯ä»¥æœ‰å¤šç§è¡¨ç¤ºå½¢å¼ï¼Œå¦‚JSONã€XMLã€HTMLç­‰ã€‚</li>
<li>çŠ¶æ€è½¬ç§»(State Transfer):é€šè¿‡HTTPæ–¹æ³•(GETã€POSTã€PUTã€DELETEç­‰)å¯¹èµ„æºæ‰§è¡Œæ“ä½œã€‚</li>
<li>æ— çŠ¶æ€(Stateless)ï¼šæœåŠ¡å™¨ä¸ä¿å­˜å®¢æˆ·ç«¯çŠ¶æ€ï¼Œæ¯ä¸ªè¯·æ±‚éƒ½åŒ…å«äº†æœåŠ¡å™¨å¤„ç†è¯¥è¯·æ±‚æ‰€éœ€çš„å…¨éƒ¨ä¿¡æ¯ã€‚</li>
<li>ç»Ÿä¸€æ¥å£(Uniform Interface):æ‰€æœ‰èµ„æºéƒ½éµå¾ªç›¸åŒçš„æ¥å£çº¦æŸã€‚</li>
</ol>
<p>RESTful APIè®¾è®¡æœ€ä½³å®è·µ</p>
<ol>
<li>ä½¿ç”¨HTTPæ–¹æ³•è¡¨ç¤ºæ“ä½œï¼š<br>Â·GET:è·å–èµ„æº<br>Â·POST:åˆ›å»ºæ–°èµ„æº<br>Â·PUT:æ›´æ–°èµ„æºï¼ˆæ•´ä½“æ›¿æ¢ï¼‰<br>Â·PATCH:éƒ¨åˆ†æ›´æ–°èµ„æº<br>Â·DELETE:åˆ é™¤èµ„æº</li>
<li>ä½¿ç”¨HTTPçŠ¶æ€ç è¡¨ç¤ºç»“æœï¼š<br>Â·2xx:æˆåŠŸï¼ˆå¦‚200OKã€201 Created)<br>Â·3Xx:é‡å®šå‘<br>Â·4xx:å®¢æˆ·ç«¯é”™è¯¯ï¼ˆå¦‚400 Bad Requestã€.404 Not Found)<br>Â·5xx:æœåŠ¡å™¨é”™è¯¯ï¼ˆå¦‚500 Internal Server Error)</li>
<li>ä½¿ç”¨åè¯å¤æ•°è¡¨ç¤ºèµ„æºé›†åˆï¼š<br>users(è€Œä¸æ˜¯user)<br>&#x2F;articles<br>&#x2F;products</li>
<li>ä½¿ç”¨å­èµ„æºè¡¨ç¤ºå…³ç³»ï¼š<br>&#x2F;users&#x2F;fid)&#x2F;orders<br>&#x2F;articles&#x2F;fid)&#x2F;comments</li>
<li>ä½¿ç”¨æŸ¥è¯¢å‚æ•°è¿›è¡Œè¿‡æ»¤ã€æ’åºå’Œåˆ†é¡µï¼š<br>&#x2F;products?category&#x3D;electronics<br>&#x2F;users?sort&#x3D;name<br>&#x2F;articles?page&#x3D;2&amp;size&#x3D;10</li>
</ol>
<p>Spring Bootä¸­å®ç°RESTful API<br>Spring Bootæä¾›äº†å¼ºå¤§çš„æ”¯æŒæ¥æ„å»ºRESTful APIã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/articles&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ArticleController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ArticleService articleService;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ArticleController</span><span class="params">(ArticleService articleService)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.articleService = articleService;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è·å–æ‰€æœ‰æ–‡ç« </span></span><br><span class="line">    <span class="meta">@GetMapping</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Article&gt; <span class="title function_">getAllArticles</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> articleService.findAll();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è·å–ç‰¹å®šæ–‡ç« </span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;Article&gt; <span class="title function_">getArticleById</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> articleService.findById(id)</span><br><span class="line">            .map(article -&gt; ResponseEntity.ok(article))</span><br><span class="line">            .orElse(ResponseEntity.notFound().build());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åˆ›å»ºæ–°æ–‡ç« </span></span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;Article&gt; <span class="title function_">createArticle</span><span class="params">(<span class="meta">@RequestBody</span> Article article)</span> &#123;</span><br><span class="line">        <span class="type">Article</span> <span class="variable">savedArticle</span> <span class="operator">=</span> articleService.save(article);</span><br><span class="line">        <span class="type">URI</span> <span class="variable">location</span> <span class="operator">=</span> ServletUriComponentsBuilder.fromCurrentRequest()</span><br><span class="line">            .path(<span class="string">&quot;/&#123;id&#125;&quot;</span>)</span><br><span class="line">            .buildAndExpand(savedArticle.getId())</span><br><span class="line">            .toUri();</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.created(location).body(savedArticle);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ›´æ–°æ–‡ç« </span></span><br><span class="line">    <span class="meta">@PutMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;Article&gt; <span class="title function_">updateArticle</span><span class="params">(<span class="meta">@PathVariable</span> Long id, <span class="meta">@RequestBody</span> Article article)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!articleService.existsById(id)) &#123;</span><br><span class="line">            <span class="keyword">return</span> ResponseEntity.notFound().build();</span><br><span class="line">        &#125;</span><br><span class="line">        article.setId(id);</span><br><span class="line">        <span class="type">Article</span> <span class="variable">updatedArticle</span> <span class="operator">=</span> articleService.save(article);</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(updatedArticle);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åˆ é™¤æ–‡ç« </span></span><br><span class="line">    <span class="meta">@DeleteMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;Void&gt; <span class="title function_">deleteArticle</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!articleService.existsById(id)) &#123;</span><br><span class="line">            <span class="keyword">return</span> ResponseEntity.notFound().build();</span><br><span class="line">        &#125;</span><br><span class="line">        articleService.deleteById(id);</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.noContent().build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¯·æ±‚å’Œå“åº”æ ¼å¼<br>åœ¨RESTful APIä¸­ï¼ŒJSONæ˜¯æœ€å¸¸ç”¨çš„æ•°æ®äº¤æ¢æ ¼å¼ã€‚<br>Spring Booté€šè¿‡Jacksonåº“è‡ªåŠ¨å¤„ç†JSONåºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚<br>è¯·æ±‚ç¤ºä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">POST /api/articles</span><br><span class="line">Content-Type: application/json</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;title&quot;</span>: <span class="string">&quot;Spring Boot å®æˆ˜&quot;</span>,</span><br><span class="line">  <span class="string">&quot;content&quot;</span>: <span class="string">&quot;Spring Boot è®© Java å¼€å‘å˜å¾—æ›´ç®€å•...&quot;</span>,</span><br><span class="line">  <span class="string">&quot;author&quot;</span>: <span class="string">&quot;ç¨‹åºå‘˜é±¼çš®&quot;</span>,</span><br><span class="line">  <span class="string">&quot;tags&quot;</span>: [<span class="string">&quot;Spring&quot;</span>, <span class="string">&quot;Java&quot;</span>, <span class="string">&quot;æ•™ç¨‹&quot;</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å“åº”ç¤ºä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">HTTP/<span class="number">1.1</span> <span class="number">201</span> Created</span><br><span class="line">Location: /api/articles/<span class="number">123</span></span><br><span class="line">Content-Type: application/json</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;id&quot;</span>: <span class="number">123</span>,</span><br><span class="line">  <span class="string">&quot;title&quot;</span>: <span class="string">&quot;Spring Boot å®æˆ˜&quot;</span>,</span><br><span class="line">  <span class="string">&quot;content&quot;</span>: <span class="string">&quot;Spring Boot è®© Java å¼€å‘å˜å¾—æ›´ç®€å•...&quot;</span>,</span><br><span class="line">  <span class="string">&quot;author&quot;</span>: <span class="string">&quot;ç¨‹åºå‘˜é±¼çš®&quot;</span>,</span><br><span class="line">  <span class="string">&quot;tags&quot;</span>: [<span class="string">&quot;Spring&quot;</span>, <span class="string">&quot;Java&quot;</span>, <span class="string">&quot;æ•™ç¨‹&quot;</span>],</span><br><span class="line">  <span class="string">&quot;createdAt&quot;</span>: <span class="string">&quot;2023-05-20T10:30:00Z&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h1 id="Spring-AI"><a href="#Spring-AI" class="headerlink" title="Spring AI"></a>Spring AI</h1><p>ç®€åŒ–äººå·¥æ™ºèƒ½å’Œæœºå™¨å­¦ä¹ åœ¨Springåº”ç”¨ä¸­çš„é›†æˆï¼Œä½¿å¼€å‘è€…èƒ½æ›´å®¹æ˜“åœ°åˆ©ç”¨AIæŠ€æœ¯æ„å»ºæ™ºèƒ½åº”ç”¨ã€‚<br>Spring Alæ¡†æ¶ä¸»è¦è§£å†³äº†ä»¥ä¸‹é—®é¢˜ï¼š</p>
<ol>
<li>å¤æ‚æ€§å°è£…ï¼šéšè—ä¸A1æœåŠ¡äº¤äº’çš„å¤æ‚æ€§ï¼Œæä¾›ç®€æ´çš„APIã€‚</li>
<li>ç»Ÿä¸€æ¥å£ï¼šä¸ºä¸åŒçš„Alæä¾›å•†ï¼ˆå¦‚OpenAlã€Anthropicã€.æœ¬åœ°æ¨¡å‹ç­‰ï¼‰æä¾›ç»Ÿä¸€çš„æ¥å£ã€‚</li>
<li>æŠ€æœ¯æ•´åˆï¼šå°†AlåŠŸèƒ½ä¸Springç”Ÿæ€ç³»ç»Ÿæ— ç¼é›†æˆã€‚</li>
<li>é™ä½é—¨æ§›ï¼šä½¿ä¼ä¸šçº§å¼€å‘è€…èƒ½å¤Ÿè½»æ¾é‡‡ç”¨A!æŠ€æœ¯ã€‚</li>
</ol>
<h2 id="æ¨¡å‹æŠ½è±¡å±‚"><a href="#æ¨¡å‹æŠ½è±¡å±‚" class="headerlink" title="æ¨¡å‹æŠ½è±¡å±‚"></a>æ¨¡å‹æŠ½è±¡å±‚</h2><p>Spring Alå®šä¹‰äº†ç»Ÿä¸€çš„æ¥å£æ¥è®¿é—®ä¸åŒçš„Alæ¨¡å‹ï¼š</p>
<ul>
<li>ChatClient:ç”¨äºä¸èŠå¤©æ¨¡å‹äº¤äº’ï¼Œå¦‚GPTã€Claudeç­‰ã€‚</li>
<li>EmbeddingClient:ç”¨äºç”Ÿæˆæ–‡æœ¬åµŒå…¥å‘é‡ã€‚</li>
<li>ImageClient:ç”¨äºå›¾åƒç”Ÿæˆå’Œå¤„ç†ã€‚</li>
</ul>
<h2 id="æç¤ºè¯ç®¡ç†"><a href="#æç¤ºè¯ç®¡ç†" class="headerlink" title="æç¤ºè¯ç®¡ç†"></a>æç¤ºè¯ç®¡ç†</h2><p>Spring Alæä¾›äº†å¼ºå¤§çš„æç¤ºè¯ç®¡ç†åŠŸèƒ½ï¼š</p>
<ul>
<li>PromptTemplate:ç”¨äºåˆ›å»ºåŠ¨æ€æç¤ºè¯æ¨¡æ¿ã€‚</li>
<li>SystemPromptTemplate:ä¸“é—¨ç”¨äºç³»ç»Ÿæ¶ˆæ¯çš„æ¨¡æ¿ã€‚</li>
<li>UserPromptTemplate:ç”¨äºç”¨æˆ·æ¶ˆæ¯çš„æ¨¡æ¿ã€‚</li>
</ul>
<h2 id="AIæ¨¡å‹æä¾›å•†"><a href="#AIæ¨¡å‹æä¾›å•†" class="headerlink" title="AIæ¨¡å‹æä¾›å•†"></a>AIæ¨¡å‹æä¾›å•†</h2><ol>
<li>OpenAI</li>
<li>Anthropic</li>
<li>Ollama<br>Spring Alè¿˜æ”¯æŒæˆ–è®¡åˆ’æ”¯æŒå…¶ä»–å¤šç§æä¾›å•†ï¼š<br>Â·Azure OpenAl:å¾®è½¯çš„ä¼ä¸šçº§OpenAIæœåŠ¡<br>Â·Hugging Face:å¼€æºæ¨¡å‹ç¤¾åŒº<br>Â·Google Vertex Al:Googleçš„AIäº‘æœåŠ¡<br>Â·æœ¬åœ°Transformersæ¨¡å‹ï¼šç›´æ¥åœ¨åº”ç”¨ä¸­è¿è¡Œå°å‹æ¨¡å‹<br>Â·AWS Bedrock:äºšé©¬é€Šçš„A!åŸºç¡€æ¨¡å‹æœåŠ¡</li>
</ol>
<h2 id="Spring-AIçš„å·¥ä½œæµç¨‹"><a href="#Spring-AIçš„å·¥ä½œæµç¨‹" class="headerlink" title="Spring AIçš„å·¥ä½œæµç¨‹"></a>Spring AIçš„å·¥ä½œæµç¨‹</h2><ol>
<li>é…ç½®AIå®¢æˆ·ç«¯ï¼šè®¾ç½®å¿…è¦çš„è®¤è¯ä¿¡æ¯å’Œé€‰é¡¹ã€‚</li>
<li>å‡†å¤‡æç¤ºè¯ï¼šæ„å»ºç”¨äºAIæ¨¡å‹çš„æç¤ºè¯ã€‚</li>
<li>è°ƒç”¨AIæœåŠ¡ï¼šå‘é€æç¤ºè¯å¹¶è·å–å“åº”ã€‚</li>
<li>å¤„ç†å“åº”ï¼šè§£æå’Œä½¿ç”¨A!ç”Ÿæˆçš„å†…å®¹ã€‚<br>å®Œæ•´ç¤ºä¾‹ä»£ç ï¼š</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/assistant&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AssistantController</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ChatClient chatClient;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">AssistantController</span><span class="params">(ChatClient chatClient)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.chatClient = chatClient;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PostMapping(&quot;/chat&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;Map&lt;String, String&gt;&gt; <span class="title function_">chat</span><span class="params">(<span class="meta">@RequestBody</span> Map&lt;String, String&gt; request)</span> &#123;</span><br><span class="line">        <span class="comment">// 1. æå–ç”¨æˆ·è¾“å…¥</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">userMessage</span> <span class="operator">=</span> request.get(<span class="string">&quot;message&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. è°ƒç”¨ AI æœåŠ¡å¹¶å¤„ç†å“åº”</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">answer</span> <span class="operator">=</span> chatClient.prompt()</span><br><span class="line">                .system(<span class="string">&quot;ä½ æ˜¯ç¼–ç¨‹å¯¼èˆªçš„ä¸“ä¸šåŠ©æ‰‹ï¼Œä¸“é—¨å¸®åŠ©ç”¨æˆ·è§£å†³ç¼–ç¨‹ç›¸å…³é—®é¢˜ã€‚è¯·æä¾›å‡†ç¡®ã€å®ç”¨çš„å»ºè®®ã€‚&quot;</span>)</span><br><span class="line">                .user(String.format(<span class="string">&quot;è¯·å›ç­”è¿™ä¸ªç¼–ç¨‹é—®é¢˜ï¼š%s&quot;</span>, userMessage))</span><br><span class="line">                .call()</span><br><span class="line">                .content();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3. è¿”å›ç»“æœ</span></span><br><span class="line">        Map&lt;String, String&gt; responseBody = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        responseBody.put(<span class="string">&quot;response&quot;</span>, answer);</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(responseBody);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¤§å‹è¯­è¨€æ¨¡å‹(LLM)<br>åµŒå…¥æ¨¡å‹<br>å¤šæ¨¡æ€æ¨¡å‹</p>
<h2 id="Spring-AIç›¸å…³é…ç½®"><a href="#Spring-AIç›¸å…³é…ç½®" class="headerlink" title="Spring AIç›¸å…³é…ç½®"></a>Spring AIç›¸å…³é…ç½®</h2><ol>
<li><p>APIå¯†é’¥ï¼š<br>OpenAl: <a target="_blank" rel="noopener" href="https://platform.openai.com/">https://platform.openai.com/</a><br>Anthropic:<a target="_blank" rel="noopener" href="https://www.anthropic.com/product">https://www.anthropic.com/product</a><br>AzureOpenAl:é€šè¿‡Azureé—¨æˆ·</p>
</li>
<li><p>å¼€å‘æ—¶æ³¨æ„äº‹é¡¹ï¼š<br>ä¸è¦å°†APIå¯†é’¥ç¡¬ç¼–ç åœ¨ä»£ç ä¸­<br>ä½¿ç”¨ç¯å¢ƒå˜é‡æˆ–é…ç½®æœåŠ¡å­˜å‚¨å¯†é’¥<br>è®¾ç½®é€‚å½“çš„è¯·æ±‚é€Ÿç‡é™åˆ¶ï¼Œé¿å…è¶…å‡ºé…é¢</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ­£ç¡®åšæ³•</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> ChatClient <span class="title function_">chatClient</span><span class="params">(OpenAiChatModel chatModel)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> ChatClient.builder(chatModel).build();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> OpenAiChatModel <span class="title function_">openAiChatModel</span><span class="params">(<span class="meta">@Value(&quot;$&#123;openai.api-key&#125;&quot;)</span> String apiKey)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> OpenAiChatModel.builder().apiKey(apiKey).build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="æœ¬åœ°å¼€å‘å·¥å…·é€‰æ‹©"><a href="#æœ¬åœ°å¼€å‘å·¥å…·é€‰æ‹©" class="headerlink" title="æœ¬åœ°å¼€å‘å·¥å…·é€‰æ‹©"></a>æœ¬åœ°å¼€å‘å·¥å…·é€‰æ‹©</h2><ol>
<li>Ollama(ç”¨äºæœ¬åœ°è¿è¡Œå¼€æºæ¨¡å‹):<br>å®‰è£…ç®€å•ï¼š<code>brew instal1ol1ama</code>(macOS)<br>Â·æ”¯æŒå¤šç§æ¨¡å‹ï¼šLlamaã€Mistralã€Falconç­‰<br>Â·é€‚åˆå¼€å‘å’Œæµ‹è¯•é˜¶æ®µä½¿ç”¨</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># å®‰è£… Ollama å¹¶ä¸‹è½½æ¨¡å‹</span><br><span class="line"># macOS/Linux</span><br><span class="line">curl -fsSL https:<span class="comment">//ollama.com/install.sh | sh</span></span><br><span class="line">ollama pull llama3</span><br><span class="line"></span><br><span class="line"># è¿è¡ŒæœåŠ¡</span><br><span class="line">ollama serve</span><br></pre></td></tr></table></figure>

<h2 id="ä½¿ç”¨Spring-Initializråˆ›å»ºSpring-AIé¡¹ç›®"><a href="#ä½¿ç”¨Spring-Initializråˆ›å»ºSpring-AIé¡¹ç›®" class="headerlink" title="ä½¿ç”¨Spring Initializråˆ›å»ºSpring AIé¡¹ç›®"></a>ä½¿ç”¨Spring Initializråˆ›å»ºSpring AIé¡¹ç›®</h2><ol>
<li>ä½¿ç”¨<a target="_blank" rel="noopener" href="https://start.spring.io/">Spring Initializr</a>åˆ›å»ºé¡¹ç›®</li>
<li><img src="/../posts_img/Initializr.png" alt="alt text"></li>
<li>æ·»åŠ Spring AIä¾èµ–</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- ç°æœ‰ä¾èµ– --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Spring AI --&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.ai<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-ai-starter-model-openai<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ol start="4">
<li>åˆ›å»ºAIæœåŠ¡</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AIAssistantService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ChatClient chatClient;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">AIAssistantService</span><span class="params">(ChatClient chatClient)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.chatClient = chatClient;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">askQuestion</span><span class="params">(String question)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> chatClient.prompt()</span><br><span class="line">            .system(<span class="string">&quot;ä½ æ˜¯ç¼–ç¨‹å¯¼èˆªçš„åŠ©æ‰‹ï¼Œæ“…é•¿å›ç­”ç¼–ç¨‹ç›¸å…³é—®é¢˜ã€‚&quot;</span>)</span><br><span class="line">            .user(question)</span><br><span class="line">            .call()</span><br><span class="line">            .content();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="å¼€å‘ç¯å¢ƒæ­å»º"><a href="#å¼€å‘ç¯å¢ƒæ­å»º" class="headerlink" title="å¼€å‘ç¯å¢ƒæ­å»º"></a>å¼€å‘ç¯å¢ƒæ­å»º</h1><h2 id="Mavenä¾èµ–é…ç½®"><a href="#Mavenä¾èµ–é…ç½®" class="headerlink" title="Mavenä¾èµ–é…ç½®"></a>Mavenä¾èµ–é…ç½®</h2><ol>
<li>æ·»åŠ Spring AI BOM(Bill of Materials)</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.ai<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-ai-bom<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>æ·»åŠ Spring AIåŸºç¡€ä¾èµ–</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Spring Boot Web --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Spring AI Core --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.ai<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-ai-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>æ·»åŠ ç‰¹å®šæä¾›å•†çš„ä¾èµ–</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- OpenAI --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.ai<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-ai-starter-model-openai<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- æˆ–è€…ä½¿ç”¨ Anthropic --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.ai<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-ai-starter-model-anthropic<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- æˆ–è€…ä½¿ç”¨ Ollama (æœ¬åœ°æ¨¡å‹) --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.ai<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-ai-starter-model-ollama<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="4">
<li>æ·»åŠ å‘é‡å­˜å‚¨æ”¯æŒï¼ˆå¦‚æœéœ€è¦RAGåŠŸèƒ½ï¼‰</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- PostgreSQL å‘é‡å­˜å‚¨ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.ai<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-ai-pgvector-store<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- æˆ–è€…ä½¿ç”¨ Redis å‘é‡å­˜å‚¨ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.ai<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-ai-redis-store<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="è·å–å¯†é’¥"><a href="#è·å–å¯†é’¥" class="headerlink" title="è·å–å¯†é’¥"></a>è·å–å¯†é’¥</h2><p>æœ¬åœ°éƒ¨ç½²</p>
<ol>
<li>ä¸‹è½½<a target="_blank" rel="noopener" href="https://ollama.com/">ollama</a></li>
<li>é€Ÿåº¦æ…¢ï¼Œå¤åˆ¶ä¸‹è½½é“¾æ¥åˆ°ä»»æ„ç½‘ç›˜è½¯ä»¶ä¸‹è½½</li>
<li>ollamaå®‰è£…è·¯å¾„æ›´æ”¹ä»£ç <code>.\download_OllamaSetup.exe /DIR=E:\Ollama</code></li>
<li>ç³»ç»Ÿç¯å¢ƒå˜é‡è®¾ç½®ï¼š<code>OLLAMA_MODELS = D:\ollamaimagers</code></li>
<li>ä¸‹è½½æ¨¡å‹ï¼š<a target="_blank" rel="noopener" href="https://modelscope.cn/models">é­”æ­å¹³å°</a> </li>
<li>é€‰æ‹©DeepSeek-R1-Distill-Qwen-7B-GGUF(å¿…é¡»æ˜¯GGUF,å¦åˆ™éœ€è¦è½¬æ¢)</li>
<li>DeepSeek-R1-Distill-Qwen-7B-F16.gguf</li>
<li>ModelFile(dsr1-7b.txt)</li>
</ol>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">FROM ./DeepSeek-R1-Distill-Qwen-7B-F16.gguf</span><br><span class="line">PARAMETER temperature 0.7                       </span><br><span class="line">PARAMETER top_p 0.95</span><br><span class="line">PARAMETER top_k 40</span><br><span class="line">PARAMETER repeat_penalty 1.1</span><br><span class="line">PARAMETER min_p 0.05</span><br><span class="line">PARAMETER num_ctx 1024                 </span><br><span class="line">PARAMETER num_thread 4                  </span><br><span class="line">PARAMETER num_gpu 8                     </span><br><span class="line"></span><br><span class="line"># è®¾ç½®å¯¹è¯ç»ˆæ­¢ç¬¦</span><br><span class="line">PARAMETER stop &quot;&lt;ï½œbeginâ–ofâ–sentenceï½œ&gt;&quot;</span><br><span class="line">PARAMETER stop &quot;&lt;ï½œendâ–ofâ–sentenceï½œ&gt;&quot;</span><br><span class="line">PARAMETER stop &quot;&lt;ï½œUserï½œ&gt;&quot;</span><br><span class="line">PARAMETER stop &quot;&lt;ï½œAssistantï½œ&gt;&quot;</span><br><span class="line"></span><br><span class="line">SYSTEM &quot;&quot;&quot;</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">TEMPLATE &quot;&quot;&quot;&#123;&#123;- if .System &#125;&#125;&#123;&#123; .System &#125;&#125;&#123;&#123; end &#125;&#125; </span><br><span class="line">&#123;&#123;- range $i, $_ := .Messages &#125;&#125; </span><br><span class="line">&#123;&#123;- $last := eq (len (slice $.Messages $i)) 1&#125;&#125;</span><br><span class="line">&#123;&#123;- if eq .Role &quot;user&quot; &#125;&#125;&lt;ï½œUserï½œ&gt;&#123;&#123; .Content &#125;&#125;</span><br><span class="line">&#123;&#123;- else if eq .Role &quot;assistant&quot; &#125;&#125;&lt;ï½œAssistantï½œ&gt;&#123;&#123; .Content &#125;&#125;&#123;&#123;- if not $last &#125;&#125;&lt;ï½œendâ–ofâ–sentenceï½œ&gt;&#123;&#123;- end &#125;&#125;</span><br><span class="line">&#123;&#123;- end &#125;&#125;</span><br><span class="line">&#123;&#123;- if and $last (ne .Role &quot;assistant&quot;) &#125;&#125;&lt;ï½œAssistantï½œ&gt;&#123;&#123;- end &#125;&#125; </span><br><span class="line">&#123;&#123;- end &#125;&#125;&quot;&quot;&quot;</span><br></pre></td></tr></table></figure>
<ol start="9">
<li>åˆ›å»ºæ¨¡å‹ï¼š<code>ollama create wgai-r1:7b -f ./dsr1-7b.txt</code><br> æ¨¡å‹åˆ—è¡¨ï¼š<code>ollama list</code><br> è¿è¡Œæ¨¡å‹ï¼š<code>ollama run wgai-r1:7b</code></li>
<li>å¯åŠ¨æœåŠ¡ï¼š<code>ollama serve</code></li>
</ol>
<h2 id="APIå¯†é’¥å®‰å…¨ç®¡ç†æœ€ä½³å®è·µ"><a href="#APIå¯†é’¥å®‰å…¨ç®¡ç†æœ€ä½³å®è·µ" class="headerlink" title="APIå¯†é’¥å®‰å…¨ç®¡ç†æœ€ä½³å®è·µ"></a>APIå¯†é’¥å®‰å…¨ç®¡ç†æœ€ä½³å®è·µ</h2><ol>
<li>ä½¿ç”¨ç¯å¢ƒå˜é‡ï¼š</li>
</ol>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># .env æ–‡ä»¶ç¤ºä¾‹</span></span><br><span class="line"><span class="attr">OPENAI_API_KEY</span>=<span class="string">sk-your-key-here</span></span><br></pre></td></tr></table></figure>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- é€šè¿‡ç¯å¢ƒå˜é‡ä¼ é€’ API å¯†é’¥</span><br><span class="line">- åœ¨æœ¬åœ°å¼€å‘ä¸­ä½¿ç”¨ `.env` æ–‡ä»¶ï¼ˆè®°å¾—å°†å…¶æ·»åŠ åˆ° .gitignoreï¼‰</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>åœ¨Spring Bootä¸­ä½¿ç”¨é…ç½®ï¼š</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># application.properties æˆ– application.yml</span><br><span class="line">spring.ai.openai.api-key=$&#123;OPENAI_API_KEY&#125;</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>ä½¿ç”¨åŠ å¯†é…ç½®ï¼š<br>ç”Ÿäº§ç¯å¢ƒä¸­è€ƒè™‘ä½¿ç”¨<a target="_blank" rel="noopener" href="https://spring.io/projects/spring-cloud-config">Spring Cloud Config</a>å’Œ<a target="_blank" rel="noopener" href="https://developer.hashicorp.com/vault">Vault</a>ç­‰æœåŠ¡</li>
<li>åº”ç”¨é€‚å½“çš„é€Ÿç‡é™åˆ¶ï¼š<br>é¿å…è¶…å‡ºAPIä½¿ç”¨é™åˆ¶<br>å®ç°é”™è¯¯é‡è¯•æœºåˆ¶</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åœ¨ Spring Boot åº”ç”¨ä¸­åŠ è½½ API å¯†é’¥çš„ç¤ºä¾‹</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AIConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;spring.ai.openai.api-key&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String apiKey;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ChatClient <span class="title function_">openAiChatClient</span><span class="params">(OpenAiChatModel chatModel)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ChatClient.builder(chatModel)</span><br><span class="line">            .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ç¬¬ä¸€æ¬¡å®è·µ"><a href="#ç¬¬ä¸€æ¬¡å®è·µ" class="headerlink" title="ç¬¬ä¸€æ¬¡å®è·µ"></a>ç¬¬ä¸€æ¬¡å®è·µ</h2><p>æ·»åŠ ä¾èµ–ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.ai<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-ai-starter-model-ollama<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>set WGAI-API-KEY=å¯†é’¥</code><br>é…ç½®æ–‡ä»¶ï¼šapplication.properties</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">spring.application.name=Spring-ai-demo</span><br><span class="line"># OpenAI</span><br><span class="line">#server.port=<span class="number">8080</span></span><br><span class="line">#spring.ai.api-key=$&#123;WGAI-API-KEY&#125;</span><br><span class="line">#spring.ai.chat.model=wgai-r1:<span class="number">1.</span>5b</span><br><span class="line"></span><br><span class="line"># Ollama</span><br><span class="line">spring.ai.ollama.base-url=http:<span class="comment">//localhost:11434</span></span><br><span class="line">spring.ai.ollama.chat.model=wgai-r1:<span class="number">1.</span>5b</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.Spring_ai_demo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.ai.chat.client.ChatClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestController</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ChatClient chatClient;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">TestController</span><span class="params">(ChatClient chatClient)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.chatClient = chatClient;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/test&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">testAI</span><span class="params">(<span class="meta">@RequestParam(defaultValue = &quot;ä½ å¥½ï¼ŒSpring AIï¼&quot;)</span> String message)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> chatClient.prompt().user(message).call().content();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.Spring_ai_demo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.ai.chat.client.ChatClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AiConfig</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ChatClient <span class="title function_">chatClient</span><span class="params">(ChatClient.Builder builder)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> builder.build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯åŠ¨æµ‹è¯•ï¼š<br><a target="_blank" rel="noopener" href="http://localhost:8080/test">http://localhost:8080/test</a></p>
<h2 id="ç»ƒä¹ "><a href="#ç»ƒä¹ " class="headerlink" title="ç»ƒä¹ "></a>ç»ƒä¹ </h2><p>ç»ƒä¹ 1ï¼šå®ç°APIå¯†é’¥è½®æ¢æœºåˆ¶<br>åˆ›å»ºä¸€ä¸ªé…ç½®ç±»ï¼Œæ”¯æŒå¤šä¸ªAPIå¯†é’¥è½®æ¢ä½¿ç”¨ï¼Œé¿å…å•ä¸ªå¯†é’¥è¶…å‡ºä½¿ç”¨é™åˆ¶ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AIClientConfig</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;api.keys&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; apiKeys;</span><br><span class="line">    <span class="comment">// åŸå­æ•´å½¢ï¼Œè‡ªåŠ¨å˜æ¢</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">AtomicInteger</span> <span class="variable">currentKeyIndex</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicInteger</span>(<span class="number">0</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ChatClient <span class="title function_">chatClient</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// å®ç°ä¸€ä¸ªç®€å•çš„è½®æ¢æœºåˆ¶</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">currentKey</span> <span class="operator">=</span> getNextApiKey();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">OpenAiChatClient</span>(currentKey);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">getNextApiKey</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> currentKeyIndex.getAndUpdate(i -&gt; (i + <span class="number">1</span>) % apiKeys.size());</span><br><span class="line">        <span class="keyword">return</span> apiKeys.get(index);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç»ƒä¹ 2ï¼šåˆ›å»ºå¼€å‘&#x2F;ç”Ÿäº§ç¯å¢ƒé…ç½®åˆ†ç¦»<br>å®ç°å¼€å‘ç¯å¢ƒä½¿ç”¨æœ¬åœ°Ollamaæ¨¡å‹ï¼Œç”Ÿäº§ç¯å¢ƒä½¿ç”¨OpenAlæ¨¡å‹çš„é…ç½®ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AIClientConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Profile(&quot;dev&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ChatClient <span class="title function_">devChatClient</span><span class="params">(OllamaChatModel chatModel)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ChatClient.builder(chatModel).build();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Profile(&quot;prod&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ChatClient <span class="title function_">prodChatClient</span><span class="params">(OpenAiChatModel chatModel)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ChatClient.builder(chatModel).build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Spring-AI-æ¨¡å‹"><a href="#Spring-AI-æ¨¡å‹" class="headerlink" title="Spring AI æ¨¡å‹"></a>Spring AI æ¨¡å‹</h1><h2 id="é¡¹ç›®ç»“æ„"><a href="#é¡¹ç›®ç»“æ„" class="headerlink" title="é¡¹ç›®ç»“æ„"></a>é¡¹ç›®ç»“æ„</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">my-spring-ai-app/</span><br><span class="line">â”œâ”€â”€ src/</span><br><span class="line">â”‚   â”œâ”€â”€ main/</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ java/</span><br><span class="line">â”‚   â”‚   â”‚   â””â”€â”€ com/example/myapp/</span><br><span class="line">â”‚   â”‚   â”‚       â”œâ”€â”€ MySpringAiApplication.java     # ä¸»åº”ç”¨ç±»</span><br><span class="line">â”‚   â”‚   â”‚       â”œâ”€â”€ config/                        # é…ç½®ç±»</span><br><span class="line">â”‚   â”‚   â”‚       â”‚   â””â”€â”€ AiConfig.java              # AI ç›¸å…³é…ç½®</span><br><span class="line">â”‚   â”‚   â”‚       â”œâ”€â”€ controller/                    # æ§åˆ¶å™¨</span><br><span class="line">â”‚   â”‚   â”‚       â”‚   â””â”€â”€ ChatController.java        # å¤„ç†èŠå¤©è¯·æ±‚</span><br><span class="line">â”‚   â”‚   â”‚       â”œâ”€â”€ service/                       # æœåŠ¡å±‚</span><br><span class="line">â”‚   â”‚   â”‚       â”‚   â””â”€â”€ AiService.java             # AI æœåŠ¡</span><br><span class="line">â”‚   â”‚   â”‚       â”œâ”€â”€ model/                         # æ•°æ®æ¨¡å‹</span><br><span class="line">â”‚   â”‚   â”‚       â”‚   â”œâ”€â”€ ChatRequest.java           # è¯·æ±‚æ¨¡å‹</span><br><span class="line">â”‚   â”‚   â”‚       â”‚   â””â”€â”€ ChatResponse.java          # å“åº”æ¨¡å‹</span><br><span class="line">â”‚   â”‚   â”‚       â””â”€â”€ exception/                     # å¼‚å¸¸å¤„ç†</span><br><span class="line">â”‚   â”‚   â”‚           â””â”€â”€ AiServiceException.java    # AI æœåŠ¡å¼‚å¸¸</span><br><span class="line">â”‚   â”‚   â””â”€â”€ resources/</span><br><span class="line">â”‚   â”‚       â”œâ”€â”€ application.properties             # åº”ç”¨é…ç½®</span><br><span class="line">â”‚   â”‚       â””â”€â”€ <span class="keyword">static</span>/                            # é™æ€èµ„æº</span><br><span class="line">â”‚   â””â”€â”€ test/                                      # æµ‹è¯•ä»£ç </span><br><span class="line">â””â”€â”€ pom.xml                                        # Maven é…ç½®</span><br></pre></td></tr></table></figure>

<p>AIé…ç½®ç±»ï¼šé…ç½®AIå®¢æˆ·ç«¯å’Œç›¸å…³è®¾ç½®ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AiConfig</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ChatClient <span class="title function_">openAiChatClient</span><span class="params">(OpenAiChatModel chatModel)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ChatClient.builder(chatModel).build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>AIæœåŠ¡ç±»ï¼šå°è£…AIåŠŸèƒ½é€»è¾‘ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AiService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ChatClient chatClient;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">AiService</span><span class="params">(ChatClient chatClient)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.chatClient = chatClient;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">generateResponse</span><span class="params">(String prompt)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> chatClient.prompt().user(prompt).call().content();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ§åˆ¶å™¨ï¼šæä¾›HTTPæ¥å£ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/chat&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ChatController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> AiService aiService;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ChatController</span><span class="params">(AiService aiService)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.aiService = aiService;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="keyword">public</span> ChatResponse <span class="title function_">chat</span><span class="params">(<span class="meta">@RequestBody</span> ChatRequest request)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">response</span> <span class="operator">=</span> aiService.generateResponse(request.getMessage());</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ChatResponse</span>(response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h2><p>é…ç½®æ–‡ä»¶(application.properties)è®¾ç½®</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"># åº”ç”¨åŸºæœ¬é…ç½®</span><br><span class="line">server.port=<span class="number">8080</span></span><br><span class="line">spring.application.name=spring-ai-demo</span><br><span class="line"></span><br><span class="line"># OpenAI é…ç½®</span><br><span class="line">spring.ai.openai.api-key=$&#123;OPENAI_API_KEY&#125;</span><br><span class="line">spring.ai.openai.chat.options.model = gpt-<span class="number">3.5</span>-turbo</span><br><span class="line">spring.ai.openai.chat.options.temperature =<span class="number">0.7</span></span><br><span class="line">spring.ai.openai.chat.options.top-p=<span class="number">1.0</span></span><br><span class="line">spring.ai.openai.chat.options.max-tokens=<span class="number">2000</span></span><br><span class="line"></span><br><span class="line"># Ollama</span><br><span class="line">spring.ai.ollama.base-url=http:<span class="comment">//localhost:11434</span></span><br><span class="line">spring.ai.ollama.chat.model=wgai-r1:<span class="number">1.</span>5b</span><br><span class="line">spring.ai.ollama.chat.options.model=wgai-r1:7b</span><br><span class="line"></span><br><span class="line"># è¶…æ—¶è®¾ç½®</span><br><span class="line">spring.ai.ollama.init.timeout = <span class="number">60000</span></span><br></pre></td></tr></table></figure>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">spring-ai-demo</span></span><br><span class="line">  </span><br><span class="line">  <span class="attr">ai:</span></span><br><span class="line">    <span class="attr">openai:</span></span><br><span class="line">      <span class="attr">api-key:</span> <span class="string">$&#123;OPENAI_API_KEY&#125;</span></span><br><span class="line">      <span class="attr">chat:</span></span><br><span class="line">        <span class="attr">model:</span> <span class="string">gpt-3.5-turbo</span></span><br><span class="line">        <span class="attr">temperature:</span> <span class="number">0.7</span></span><br><span class="line">        <span class="attr">top-p:</span> <span class="number">1.0</span></span><br><span class="line">        <span class="attr">max-tokens:</span> <span class="number">2000</span></span><br><span class="line">    </span><br><span class="line">    <span class="attr">timeout:</span></span><br><span class="line">      <span class="attr">connect:</span> <span class="number">60000</span></span><br><span class="line">      <span class="attr">read:</span> <span class="number">60000</span></span><br></pre></td></tr></table></figure>

<p>å¤šç¯å¢ƒé…ç½®</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¼€å‘ç¯å¢ƒé…ç½® (application-dev.properties)</span></span><br><span class="line"><span class="string">spring.ai.ollama.base-url=http://localhost:11434</span></span><br><span class="line"><span class="string">spring.ai.ollama.chat.options.model=wgai-r1:1.5b</span></span><br><span class="line"><span class="string">logging.level.org.springframework.ai.chat.client.advisor=DEBUG</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”Ÿäº§ç¯å¢ƒé…ç½® (application-prod.properties)</span></span><br><span class="line"><span class="string">spring.ai.openai.chat.options.model=gpt-4</span></span><br><span class="line"><span class="comment"># æŸ¥çœ‹æ—¥å¿— = DEBUG</span></span><br><span class="line"><span class="string">logging.level.org.springframework.ai.chat.client.advisor=false</span></span><br></pre></td></tr></table></figure>
<p>ç„¶ååœ¨ä¸»é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šå½“å‰æ¿€æ´»çš„é…ç½®æ–‡ä»¶ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.profiles.active=dev</span><br></pre></td></tr></table></figure>

<h2 id="åˆ›å»ºæ§åˆ¶å™¨å¤„ç†HTTPè¯·æ±‚"><a href="#åˆ›å»ºæ§åˆ¶å™¨å¤„ç†HTTPè¯·æ±‚" class="headerlink" title="åˆ›å»ºæ§åˆ¶å™¨å¤„ç†HTTPè¯·æ±‚"></a>åˆ›å»ºæ§åˆ¶å™¨å¤„ç†HTTPè¯·æ±‚</h2><p>åœ¨Webåº”ç”¨ä¸­ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºæ§åˆ¶å™¨æ¥å¤„ç†å‰ç«¯æˆ–å…¶ä»–æœåŠ¡å‘é€çš„HTTPè¯·æ±‚ã€‚<br>ä»¥ä¸‹æ˜¯ä¸€ä¸ªå®Œæ•´çš„AIèŠå¤©æ§åˆ¶å™¨ç¤ºä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/chat&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ChatController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> AiService aiService;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ChatController</span><span class="params">(AiService aiService)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.aiService = aiService;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;ChatResponse&gt; <span class="title function_">chat</span><span class="params">(<span class="meta">@RequestBody</span> ChatRequest request)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">response</span> <span class="operator">=</span> aiService.generateResponse(request.getMessage());</span><br><span class="line">            <span class="type">ChatResponse</span> <span class="variable">chatResponse</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChatResponse</span>(response);</span><br><span class="line">            <span class="keyword">return</span> ResponseEntity.ok(chatResponse);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">return</span> ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR)</span><br><span class="line">                .body(<span class="keyword">new</span> <span class="title class_">ChatResponse</span>(<span class="string">&quot;å¤„ç†è¯·æ±‚æ—¶å‡ºé”™ï¼š&quot;</span> + e.getMessage()));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PostMapping(&quot;/stream&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> SseEmitter <span class="title function_">streamChat</span><span class="params">(<span class="meta">@RequestBody</span> ChatRequest request)</span> &#123;</span><br><span class="line">        <span class="type">SseEmitter</span> <span class="variable">emitter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SseEmitter</span>(<span class="number">300000L</span>); <span class="comment">// 5åˆ†é’Ÿè¶…æ—¶</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            aiService.streamResponse(request.getMessage(), emitter);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            emitter.completeWithError(e);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> emitter;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¯·æ±‚å’Œå“åº”æ¨¡å‹</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ChatRequest</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String message;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// getters, setters, constructors</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ChatResponse</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String content;</span><br><span class="line">    <span class="keyword">private</span> LocalDateTime timestamp;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ChatResponse</span><span class="params">(String content)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.content = content;</span><br><span class="line">        <span class="built_in">this</span>.timestamp = LocalDateTime.now();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// getters, setters</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æµå¼å“åº”å¤„ç†<br>å¯¹äºæµå¼å“åº”ï¼ŒæœåŠ¡å±‚éœ€è¦ç›¸åº”çš„å®ç°ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AiService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ChatClient chatClient;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ... å…¶ä»–ä»£ç  ...</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">streamResponse</span><span class="params">(String prompt, SseEmitter emitter)</span> &#123;</span><br><span class="line">        <span class="type">Prompt</span> <span class="variable">chatPrompt</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Prompt</span>(<span class="keyword">new</span> <span class="title class_">UserMessage</span>(prompt));</span><br><span class="line">        </span><br><span class="line">        chatClient.stream(chatPrompt)</span><br><span class="line">            .subscribe(</span><br><span class="line">                <span class="comment">// å¤„ç†æ¯ä¸ªå“åº”å—</span></span><br><span class="line">                chunk -&gt; &#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        <span class="type">String</span> <span class="variable">content</span> <span class="operator">=</span> chunk.getResult().getOutput().getContent();</span><br><span class="line">                        <span class="keyword">if</span> (content != <span class="literal">null</span> &amp;&amp; !content.isEmpty()) &#123;</span><br><span class="line">                            emitter.send(SseEmitter.event().data(content));</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                        emitter.completeWithError(e);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="comment">// å¤„ç†é”™è¯¯</span></span><br><span class="line">                error -&gt; emitter.completeWithError(error),</span><br><span class="line">                <span class="comment">// å¤„ç†å®Œæˆ</span></span><br><span class="line">                () -&gt; emitter.complete()</span><br><span class="line">            );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="å®ç°ç®€å•çš„æ–‡æœ¬ç”ŸæˆåŠŸèƒ½"><a href="#å®ç°ç®€å•çš„æ–‡æœ¬ç”ŸæˆåŠŸèƒ½" class="headerlink" title="å®ç°ç®€å•çš„æ–‡æœ¬ç”ŸæˆåŠŸèƒ½"></a>å®ç°ç®€å•çš„æ–‡æœ¬ç”ŸæˆåŠŸèƒ½</h2><ol>
<li>å†…å®¹æ‘˜è¦ç”Ÿæˆå™¨</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SummaryService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ChatClient chatClient;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SummaryService</span><span class="params">(ChatClient chatClient)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.chatClient = chatClient;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">summarizeText</span><span class="params">(String text, <span class="type">int</span> maxWords)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">prompt</span> <span class="operator">=</span> String.format(</span><br><span class="line">            <span class="string">&quot;è¯·å°†ä»¥ä¸‹æ–‡æœ¬æ€»ç»“ä¸ºä¸è¶…è¿‡ %d ä¸ªå­—çš„æ‘˜è¦ï¼š\n\n%s&quot;</span>,</span><br><span class="line">            maxWords, text</span><br><span class="line">        );</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> chatClient.prompt().user(prompt).call().content();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>ä»£ç è§£é‡Šå™¨</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CodeExplainerService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ChatClient chatClient;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CodeExplainerService</span><span class="params">(ChatClient chatClient)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.chatClient = chatClient;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">explainCode</span><span class="params">(String code, String language)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">systemPrompt</span> <span class="operator">=</span> <span class="string">&quot;ä½ æ˜¯ä»£ç å°æŠ„çš„ä»£ç è§£é‡Šä¸“å®¶ï¼Œè¯·è¯¦ç»†è§£é‡Šä»¥ä¸‹ä»£ç çš„åŠŸèƒ½å’Œå…³é”®éƒ¨åˆ†&quot;</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> chatClient.prompt()</span><br><span class="line">            .system(systemPrompt)</span><br><span class="line">            .user(String.format(<span class="string">&quot;```%s\n%s\n```&quot;</span>, language, code))</span><br><span class="line">            .call()</span><br><span class="line">            .content();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>ä¸ªæ€§åŒ–é‚®ä»¶ç”Ÿæˆå™¨</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmailGeneratorService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ChatClient chatClient;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">EmailGeneratorService</span><span class="params">(ChatClient chatClient)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.chatClient = chatClient;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">generateEmail</span><span class="params">(String recipient, String subject, String keyPoints, String tone)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">prompt</span> <span class="operator">=</span> String.format(</span><br><span class="line">            <span class="string">&quot;è¯·ç”Ÿæˆä¸€å°å‘ç»™%sçš„é‚®ä»¶ï¼Œä¸»é¢˜æ˜¯&quot;</span>%s<span class="string">&quot;ã€‚\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;éœ€è¦åŒ…å«çš„è¦ç‚¹ï¼š%s\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;è¯­æ°”é£æ ¼ï¼š%s&quot;</span>,</span><br><span class="line">            recipient, subject, keyPoints, tone</span><br><span class="line">        );</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> chatClient.prompt().user(prompt).call().content();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="é”™è¯¯å¤„ç†ä¸å¼‚å¸¸ç®¡ç†"><a href="#é”™è¯¯å¤„ç†ä¸å¼‚å¸¸ç®¡ç†" class="headerlink" title="é”™è¯¯å¤„ç†ä¸å¼‚å¸¸ç®¡ç†"></a>é”™è¯¯å¤„ç†ä¸å¼‚å¸¸ç®¡ç†</h2><p>å®šä¹‰è‡ªå®šä¹‰å¼‚å¸¸</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åŸºç¡€ AI æœåŠ¡å¼‚å¸¸</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AiServiceException</span> <span class="keyword">extends</span> <span class="title class_">RuntimeException</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">AiServiceException</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(message);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">AiServiceException</span><span class="params">(String message, Throwable cause)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(message, cause);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…·ä½“å¼‚å¸¸ç±»å‹</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AiTokenLimitExceededException</span> <span class="keyword">extends</span> <span class="title class_">AiServiceException</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">AiTokenLimitExceededException</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AiTimeoutException</span> <span class="keyword">extends</span> <span class="title class_">AiServiceException</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">AiTimeoutException</span><span class="params">(String message, Throwable cause)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(message, cause);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¼‚å¸¸å¤„ç†æœåŠ¡</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AiService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ChatClient chatClient;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> maxRetries;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">AiService</span><span class="params">(ChatClient chatClient, <span class="meta">@Value(&quot;$&#123;ai.max-retries:3&#125;&quot;)</span> <span class="type">int</span> maxRetries)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.chatClient = chatClient;</span><br><span class="line">        <span class="built_in">this</span>.maxRetries = maxRetries;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">generateResponseWithRetry</span><span class="params">(String prompt)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">attempts</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span> (attempts &lt; maxRetries) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> chatClient.prompt().user(prompt).call().content();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                attempts++;</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// å¦‚æœæ˜¯æœ€åä¸€æ¬¡å°è¯•ï¼ŒæŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">                <span class="keyword">if</span> (attempts &gt;= maxRetries) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (e <span class="keyword">instanceof</span> ResourceAccessException) &#123;</span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AiTimeoutException</span>(<span class="string">&quot;AI æœåŠ¡è¯·æ±‚è¶…æ—¶&quot;</span>, e);</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AiServiceException</span>(<span class="string">&quot;è°ƒç”¨ AI æœåŠ¡å¤±è´¥&quot;</span>, e);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// å¦åˆ™ç­‰å¾…åé‡è¯•</span></span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">1000</span> * attempts); <span class="comment">// æŒ‡æ•°é€€é¿</span></span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException ie) &#123;</span><br><span class="line">                    Thread.currentThread().interrupt();</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AiServiceException</span>(<span class="string">&quot;é‡è¯•è¿‡ç¨‹è¢«ä¸­æ–­&quot;</span>, ie);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AiServiceException</span>(<span class="string">&quot;è¶…è¿‡æœ€å¤§é‡è¯•æ¬¡æ•°&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å…¨å±€å¼‚å¸¸å¤„ç†</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GlobalExceptionHandler</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(GlobalExceptionHandler.class);</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ExceptionHandler(AiServiceException.class)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;ErrorResponse&gt; <span class="title function_">handleAiServiceException</span><span class="params">(AiServiceException e)</span> &#123;</span><br><span class="line">        logger.error(<span class="string">&quot;AI æœåŠ¡å¼‚å¸¸&quot;</span>, e);</span><br><span class="line">        </span><br><span class="line">        <span class="type">ErrorResponse</span> <span class="variable">errorResponse</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ErrorResponse</span>(</span><br><span class="line">            <span class="string">&quot;AI_SERVICE_ERROR&quot;</span>,</span><br><span class="line">            e.getMessage()</span><br><span class="line">        );</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.status(HttpStatus.SERVICE_UNAVAILABLE).body(errorResponse);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ExceptionHandler(AiTokenLimitExceededException.class)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;ErrorResponse&gt; <span class="title function_">handleTokenLimitException</span><span class="params">(AiTokenLimitExceededException e)</span> &#123;</span><br><span class="line">        logger.error(<span class="string">&quot;ä»¤ç‰Œé™åˆ¶å¼‚å¸¸&quot;</span>, e);</span><br><span class="line">        </span><br><span class="line">        <span class="type">ErrorResponse</span> <span class="variable">errorResponse</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ErrorResponse</span>(</span><br><span class="line">            <span class="string">&quot;TOKEN_LIMIT_EXCEEDED&quot;</span>,</span><br><span class="line">            <span class="string">&quot;è¾“å…¥å†…å®¹è¿‡é•¿ï¼Œè¯·ç¼©çŸ­åé‡è¯•&quot;</span></span><br><span class="line">        );</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.status(HttpStatus.BAD_REQUEST).body(errorResponse);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ExceptionHandler(Exception.class)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;ErrorResponse&gt; <span class="title function_">handleGenericException</span><span class="params">(Exception e)</span> &#123;</span><br><span class="line">        logger.error(<span class="string">&quot;æœªå¤„ç†çš„å¼‚å¸¸&quot;</span>, e);</span><br><span class="line">        </span><br><span class="line">        <span class="type">ErrorResponse</span> <span class="variable">errorResponse</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ErrorResponse</span>(</span><br><span class="line">            <span class="string">&quot;INTERNAL_SERVER_ERROR&quot;</span>,</span><br><span class="line">            <span class="string">&quot;æœåŠ¡å™¨å†…éƒ¨é”™è¯¯&quot;</span></span><br><span class="line">        );</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).body(errorResponse);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é”™è¯¯å“åº”æ¨¡å‹</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ErrorResponse</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String code;</span><br><span class="line">    <span class="keyword">private</span> String message;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">LocalDateTime</span> <span class="variable">timestamp</span> <span class="operator">=</span> LocalDateTime.now();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ErrorResponse</span><span class="params">(String code, String message)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.code = code;</span><br><span class="line">        <span class="built_in">this</span>.message = message;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// getters, setters</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ç¬¬äºŒæ¬¡å®è·µ"><a href="#ç¬¬äºŒæ¬¡å®è·µ" class="headerlink" title="ç¬¬äºŒæ¬¡å®è·µ"></a>ç¬¬äºŒæ¬¡å®è·µ</h2><ol>
<li>æ„å»ºä¸€ä¸ªAIé—®ç­”åº”ç”¨<br>åŒ…å«ä»¥ä¸‹ä¾èµ–ï¼š</li>
</ol>
<ul>
<li>Spring Web</li>
<li>Spring AI</li>
<li>Lombok</li>
</ul>
<ol start="2">
<li>é…ç½®åº”ç”¨</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">server.port=<span class="number">8080</span></span><br><span class="line">spring.application.name=é¢è¯•é¸­-AIåŠ©æ‰‹</span><br><span class="line"></span><br><span class="line"># OpenAI é…ç½®</span><br><span class="line">spring.ai.openai.api-key=$&#123;OPENAI_API_KEY&#125;</span><br><span class="line">spring.ai.openai.chat.model=gpt-<span class="number">3.5</span>-turbo</span><br><span class="line">spring.ai.openai.chat.temperature=<span class="number">0.7</span></span><br><span class="line">spring.ai.openai.chat.max-tokens=<span class="number">1500</span></span><br><span class="line"></span><br><span class="line"># ä¼šè¯è®¾ç½®</span><br><span class="line">app.chat.history-size=<span class="number">10</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>åˆ›å»ºæ•°æ®æ¨¡å‹</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Message</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String role; <span class="comment">// &quot;user&quot; æˆ– &quot;assistant&quot;</span></span><br><span class="line">    <span class="keyword">private</span> String content;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">LocalDateTime</span> <span class="variable">timestamp</span> <span class="operator">=</span> LocalDateTime.now();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ChatRequest</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String message;</span><br><span class="line">    <span class="keyword">private</span> String sessionId;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ChatResponse</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String message;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Message&gt; history;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">LocalDateTime</span> <span class="variable">timestamp</span> <span class="operator">=</span> LocalDateTime.now();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>å®ç°ä¼šè¯ç®¡ç†æœåŠ¡</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ChatSessionService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;app.chat.history-size:10&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> historySize;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä½¿ç”¨å†…å­˜å­˜å‚¨ä¼šè¯ï¼ˆç”Ÿäº§ç¯å¢ƒåº”ä½¿ç”¨æŒä¹…åŒ–å­˜å‚¨ï¼‰</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, List&lt;Message&gt;&gt; chatSessions = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> List&lt;Message&gt; <span class="title function_">getSessionHistory</span><span class="params">(String sessionId)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> chatSessions.getOrDefault(sessionId, <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addMessage</span><span class="params">(String sessionId, Message message)</span> &#123;</span><br><span class="line">        List&lt;Message&gt; history = chatSessions.computeIfAbsent(</span><br><span class="line">            sessionId, k -&gt; <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;()</span><br><span class="line">        );</span><br><span class="line">        </span><br><span class="line">        history.add(message);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// é™åˆ¶å†å²è®°å½•å¤§å°</span></span><br><span class="line">        <span class="keyword">if</span> (history.size() &gt; historySize * <span class="number">2</span>) &#123; <span class="comment">// ä¿ç•™ç”¨æˆ·å’ŒåŠ©æ‰‹æ¶ˆæ¯å¯¹</span></span><br><span class="line">            history = history.subList(history.size() - historySize * <span class="number">2</span>, history.size());</span><br><span class="line">            chatSessions.put(sessionId, history);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">createNewSession</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">sessionId</span> <span class="operator">=</span> UUID.randomUUID().toString();</span><br><span class="line">        chatSessions.put(sessionId, <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;());</span><br><span class="line">        <span class="keyword">return</span> sessionId;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>å®ç°AIæœåŠ¡</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MianshiyaAiService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ChatClient chatClient;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ChatSessionService sessionService;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MianshiyaAiService</span><span class="params">(ChatClient chatClient, ChatSessionService sessionService)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.chatClient = chatClient;</span><br><span class="line">        <span class="built_in">this</span>.sessionService = sessionService;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> ChatResponse <span class="title function_">processChat</span><span class="params">(ChatRequest request)</span> &#123;</span><br><span class="line">        <span class="comment">// è·å–ä¼šè¯ IDï¼Œå¦‚æœä¸ºç©ºåˆ™åˆ›å»ºæ–°ä¼šè¯</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">sessionId</span> <span class="operator">=</span> request.getSessionId();</span><br><span class="line">        <span class="keyword">if</span> (sessionId == <span class="literal">null</span> || sessionId.isEmpty()) &#123;</span><br><span class="line">            sessionId = sessionService.createNewSession();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ä¿å­˜ç”¨æˆ·æ¶ˆæ¯</span></span><br><span class="line">        <span class="type">Message</span> <span class="variable">userMessage</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Message</span>(<span class="string">&quot;user&quot;</span>, request.getMessage());</span><br><span class="line">        sessionService.addMessage(sessionId, userMessage);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ„å»ºæç¤ºï¼ŒåŒ…å«å†å²è®°å½•</span></span><br><span class="line">        List&lt;Message&gt; history = sessionService.getSessionHistory(sessionId);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// è°ƒç”¨ AI è·å–å›ç­”</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">aiResponse</span> <span class="operator">=</span> chatClient.prompt()</span><br><span class="line">            .system(<span class="string">&quot;ä½ æ˜¯é¢è¯•é¸­å¹³å°çš„æ™ºèƒ½åŠ©æ‰‹ï¼Œä¸“é•¿äºå›ç­”ç¼–ç¨‹å’Œæ±‚èŒç›¸å…³çš„é—®é¢˜ã€‚ç»™å‡ºå‡†ç¡®ã€ç®€æ´ä¸”æœ‰å¸®åŠ©çš„å›ç­”ï¼Œå¿…è¦æ—¶æä¾›ä»£ç ç¤ºä¾‹ã€‚&quot;</span>)</span><br><span class="line">            .user(request.getMessage())</span><br><span class="line">            .call()</span><br><span class="line">            .content();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ä¿å­˜ AI å›ç­”</span></span><br><span class="line">        <span class="type">Message</span> <span class="variable">assistantMessage</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Message</span>(<span class="string">&quot;assistant&quot;</span>, aiResponse);</span><br><span class="line">        sessionService.addMessage(sessionId, assistantMessage);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ„å»ºå¹¶è¿”å›å“åº”</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ChatResponse</span>(</span><br><span class="line">            aiResponse,</span><br><span class="line">            sessionService.getSessionHistory(sessionId),</span><br><span class="line">            LocalDateTime.now()</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> List&lt;AbstractMessage&gt; <span class="title function_">buildMessages</span><span class="params">(String sessionId)</span> &#123;</span><br><span class="line">        List&lt;Message&gt; history = sessionService.getSessionHistory(sessionId);</span><br><span class="line">        List&lt;AbstractMessage&gt; messages = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ·»åŠ ç³»ç»Ÿæ¶ˆæ¯</span></span><br><span class="line">        messages.add(<span class="keyword">new</span> <span class="title class_">SystemMessage</span>(</span><br><span class="line">            <span class="string">&quot;ä½ æ˜¯é¢è¯•å¹³å°çš„æ™ºèƒ½åŠ©æ‰‹ï¼Œä¸“é•¿äºå›ç­”ç¼–ç¨‹å’Œæ±‚èŒç›¸å…³çš„é—®é¢˜ã€‚&quot;</span> +</span><br><span class="line">            <span class="string">&quot;ç»™å‡ºå‡†ç¡®ã€ç®€æ´ä¸”æœ‰å¸®åŠ©çš„å›ç­”ï¼Œå¿…è¦æ—¶æä¾›ä»£ç ç¤ºä¾‹ã€‚&quot;</span></span><br><span class="line">        ));</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ·»åŠ å†å²æ¶ˆæ¯ï¼ˆæœ€è¿‘çš„å‡ æ¡ï¼‰</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">startIndex</span> <span class="operator">=</span> Math.max(<span class="number">0</span>, history.size() - <span class="number">6</span>); <span class="comment">// æœ€å¤šä¿ç•™3è½®å¯¹è¯</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> startIndex; i &lt; history.size(); i++) &#123;</span><br><span class="line">            <span class="type">Message</span> <span class="variable">msg</span> <span class="operator">=</span> history.get(i);</span><br><span class="line">            <span class="keyword">if</span> (<span class="string">&quot;user&quot;</span>.equals(msg.getRole())) &#123;</span><br><span class="line">                messages.add(<span class="keyword">new</span> <span class="title class_">UserMessage</span>(msg.getContent()));</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&quot;assistant&quot;</span>.equals(msg.getRole())) &#123;</span><br><span class="line">                messages.add(<span class="keyword">new</span> <span class="title class_">AssistantMessage</span>(msg.getContent()));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> messages;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="6">
<li>å®ç°æ¥å£</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/chat&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ChatController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> MianshiyaAiService aiService;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ChatController</span><span class="params">(MianshiyaAiService aiService)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.aiService = aiService;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;ChatResponse&gt; <span class="title function_">chat</span><span class="params">(<span class="meta">@RequestBody</span> ChatRequest request)</span> &#123;</span><br><span class="line">        <span class="type">ChatResponse</span> <span class="variable">response</span> <span class="operator">=</span> aiService.processChat(request);</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="7">
<li>åˆ›å»ºç®€å•çš„å‰ç«¯é¡µé¢(å¯é€‰)<br>åœ¨src&#x2F;main&#x2F;resources&#x2F;staticä¸‹åˆ›å»ºindex.html:</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;zh-CN&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>å¾®å…‰zc AI åŠ©æ‰‹<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">        <span class="selector-tag">body</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">font-family</span>: <span class="string">&#x27;PingFang SC&#x27;</span>, <span class="string">&#x27;Microsoft YaHei&#x27;</span>, sans-serif;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">max-width</span>: <span class="number">800px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">margin</span>: <span class="number">0</span> auto;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">padding</span>: <span class="number">20px</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.chat-container</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#ddd</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">border-radius</span>: <span class="number">8px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">min-height</span>: <span class="number">400px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">padding</span>: <span class="number">10px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">margin-bottom</span>: <span class="number">20px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">overflow-y</span>: auto;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.message</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">margin-bottom</span>: <span class="number">10px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">padding</span>: <span class="number">8px</span> <span class="number">12px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">border-radius</span>: <span class="number">18px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">max-width</span>: <span class="number">70%</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.user-message</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">background-color</span>: <span class="number">#e3f2fd</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">margin-left</span>: auto;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.assistant-message</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">background-color</span>: <span class="number">#f1f1f1</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">margin-right</span>: auto;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">        <span class="selector-class">.input-container</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">display</span>: flex;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">gap</span>: <span class="number">10px</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">        <span class="selector-id">#messageInput</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">flex</span>: <span class="number">1</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">padding</span>: <span class="number">10px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">border-radius</span>: <span class="number">4px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#ddd</span>;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">        <span class="selector-tag">button</span> &#123;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">padding</span>: <span class="number">10px</span> <span class="number">20px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">background-color</span>: <span class="number">#4caf50</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">color</span>: white;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">border</span>: none;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">border-radius</span>: <span class="number">4px</span>;</span></span><br><span class="line"><span class="language-css">            <span class="attribute">cursor</span>: pointer;</span></span><br><span class="line"><span class="language-css">        &#125;</span></span><br><span class="line"><span class="language-css">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>å¾®å…‰zc AI åŠ©æ‰‹<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;chatContainer&quot;</span> <span class="attr">class</span>=<span class="string">&quot;chat-container&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;input-container&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;messageInput&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;è¾“å…¥ä½ çš„é—®é¢˜...&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;sendButton&quot;</span>&gt;</span>å‘é€<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">let</span> sessionId = <span class="string">&#x27;&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">        </span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;sendButton&#x27;</span>).<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, sendMessage);</span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;messageInput&#x27;</span>).<span class="title function_">addEventListener</span>(<span class="string">&#x27;keypress&#x27;</span>, <span class="keyword">function</span>(<span class="params">e</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (e.<span class="property">key</span> === <span class="string">&#x27;Enter&#x27;</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="title function_">sendMessage</span>();</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">        </span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">function</span> <span class="title function_">sendMessage</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> messageInput = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;messageInput&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> message = messageInput.<span class="property">value</span>.<span class="title function_">trim</span>();</span></span><br><span class="line"><span class="language-javascript">            </span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (message) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// æ˜¾ç¤ºç”¨æˆ·æ¶ˆæ¯</span></span></span><br><span class="line"><span class="language-javascript">                <span class="title function_">appendMessage</span>(<span class="string">&#x27;user&#x27;</span>, message);</span></span><br><span class="line"><span class="language-javascript">                messageInput.<span class="property">value</span> = <span class="string">&#x27;&#x27;</span>;</span></span><br><span class="line"><span class="language-javascript">                </span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// å‘é€åˆ°æœåŠ¡å™¨</span></span></span><br><span class="line"><span class="language-javascript">                <span class="title function_">fetch</span>(<span class="string">&#x27;/api/chat&#x27;</span>, &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">headers</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">body</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">message</span>: message,</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">sessionId</span>: sessionId</span></span><br><span class="line"><span class="language-javascript">                    &#125;)</span></span><br><span class="line"><span class="language-javascript">                &#125;)</span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> response.<span class="title function_">json</span>())</span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">then</span>(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="comment">// æ˜¾ç¤º AI å›å¤</span></span></span><br><span class="line"><span class="language-javascript">                    <span class="title function_">appendMessage</span>(<span class="string">&#x27;assistant&#x27;</span>, data.<span class="property">message</span>);</span></span><br><span class="line"><span class="language-javascript">                    <span class="comment">// ä¿å­˜ä¼šè¯ ID</span></span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">if</span> (data.<span class="property">sessionId</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                        sessionId = data.<span class="property">sessionId</span>;</span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;)</span></span><br><span class="line"><span class="language-javascript">                .<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;Error:&#x27;</span>, error);</span></span><br><span class="line"><span class="language-javascript">                    <span class="title function_">appendMessage</span>(<span class="string">&#x27;assistant&#x27;</span>, <span class="string">&#x27;æŠ±æ­‰ï¼Œå‘ç”Ÿäº†é”™è¯¯ï¼Œè¯·ç¨åé‡è¯•ã€‚&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">                &#125;);</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">        </span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">function</span> <span class="title function_">appendMessage</span>(<span class="params">role, content</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> chatContainer = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;chatContainer&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> messageDiv = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">            messageDiv.<span class="property">className</span> = <span class="string">`message <span class="subst">$&#123;role&#125;</span>-message`</span>;</span></span><br><span class="line"><span class="language-javascript">            messageDiv.<span class="property">textContent</span> = content;</span></span><br><span class="line"><span class="language-javascript">            chatContainer.<span class="title function_">appendChild</span>(messageDiv);</span></span><br><span class="line"><span class="language-javascript">            chatContainer.<span class="property">scrollTop</span> = chatContainer.<span class="property">scrollHeight</span>;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="8">
<li>å¯åŠ¨åº”ç”¨å¹¶æµ‹è¯•<br>ç¡®ä¿è®¾ç½®äº†OPENAI API KEYç¯å¢ƒå˜é‡<br>è¿è¡Œåº”ç”¨ï¼šmvn spring-boot:run<br>è®¿é—®<a target="_blank" rel="noopener" href="http://localhost:8080/">http:/localhost:8080</a>è¿›è¡Œæµ‹è¯•</li>
</ol>
<h1 id="æç¤ºè¯å·¥ç¨‹åŸºç¡€"><a href="#æç¤ºè¯å·¥ç¨‹åŸºç¡€" class="headerlink" title="æç¤ºè¯å·¥ç¨‹åŸºç¡€"></a>æç¤ºè¯å·¥ç¨‹åŸºç¡€</h1><h2 id="ä½¿ç”¨PromptTemplateåˆ›å»ºåŠ¨æ€æç¤º"><a href="#ä½¿ç”¨PromptTemplateåˆ›å»ºåŠ¨æ€æç¤º" class="headerlink" title="ä½¿ç”¨PromptTemplateåˆ›å»ºåŠ¨æ€æç¤º"></a>ä½¿ç”¨<code>PromptTemplate</code>åˆ›å»ºåŠ¨æ€æç¤º</h2><p>åŸºæœ¬ç”¨æ³•</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ArticleGeneratorService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ChatClient chatClient;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ArticleGeneratorService</span><span class="params">(ChatClient chatClient)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.chatClient = chatClient;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">generateArticle</span><span class="params">(String topic, String targetAudience, <span class="type">int</span> wordCount)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">templateString</span> <span class="operator">=</span> <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">            è¯·ä»¥ç¼–ç¨‹å¯¼èˆªåšä¸»çš„èº«ä»½ï¼Œæ’°å†™ä¸€ç¯‡å…³äº&#123;topic&#125;çš„æŠ€æœ¯æ–‡ç« ã€‚</span></span><br><span class="line"><span class="string">            ç›®æ ‡è¯»è€…ï¼š&#123;audience&#125;</span></span><br><span class="line"><span class="string">            æ–‡ç« é£æ ¼ï¼šä¸“ä¸šã€æ¸…æ™°ã€æ˜“æ‡‚</span></span><br><span class="line"><span class="string">            å­—æ•°è¦æ±‚ï¼šçº¦&#123;wordCount&#125;å­—</span></span><br><span class="line"><span class="string">            æ–‡ç« ç»“æ„åº”åŒ…å«ï¼šå¼•è¨€ã€ä¸»è¦å†…å®¹ï¼ˆ2-3ä¸ªæ ¸å¿ƒéƒ¨åˆ†ï¼‰ã€æ€»ç»“</span></span><br><span class="line"><span class="string">            &quot;&quot;&quot;</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="type">PromptTemplate</span> <span class="variable">template</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PromptTemplate</span>(templateString);</span><br><span class="line">        Map&lt;String, Object&gt; params = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        params.put(<span class="string">&quot;topic&quot;</span>, topic);</span><br><span class="line">        params.put(<span class="string">&quot;audience&quot;</span>, targetAudience);</span><br><span class="line">        params.put(<span class="string">&quot;wordCount&quot;</span>, wordCount);</span><br><span class="line">        </span><br><span class="line">        <span class="type">String</span> <span class="variable">prompt</span> <span class="operator">=</span> template.render(params);</span><br><span class="line">        <span class="keyword">return</span> chatClient.prompt().user(prompt).call().content();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¡ä»¶é€»è¾‘å’Œé«˜çº§æ¨¡æ¿<br>PromptTemplateæ”¯æŒæ¡ä»¶é€»è¾‘ï¼Œè®©ä½ å¯ä»¥æ ¹æ®å‚æ•°åŠ¨æ€è°ƒæ•´æç¤ºå†…å®¹ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CodeReviewService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ChatClient chatClient;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CodeReviewService</span><span class="params">(ChatClient chatClient)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.chatClient = chatClient;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">reviewCode</span><span class="params">(String code, String language, String level)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">templateString</span> <span class="operator">=</span> <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">            ä½œä¸ºä»£ç å°æŠ„çš„é«˜çº§&#123;language&#125;å¼€å‘ä¸“å®¶ï¼Œè¯·å¯¹ä»¥ä¸‹ä»£ç è¿›è¡Œä»£ç è¯„å®¡ï¼š </span></span><br><span class="line"><span class="string">            ``` &#123;language&#125;</span></span><br><span class="line"><span class="string">                &#123;code&#125;</span></span><br><span class="line"><span class="string">                &#123;# æ ¹æ®ä¸åŒçº§åˆ«è°ƒæ•´è¯„å®¡æ·±åº¦ &#125;</span></span><br><span class="line"><span class="string">                &#123;% if level == &#x27;åˆçº§&#x27; %&#125;</span></span><br><span class="line"><span class="string">     â€         â¡  è¯·é‡ç‚¹å…³æ³¨åŸºæœ¬â ä»£ç è§„èŒƒå’Œå¸¸è§é”™è¯¯â€ã€‚</span></span><br><span class="line"><span class="string">                &#123;% elseif level == &#x27;ä¸­çº§&#x27; %&#125;</span></span><br><span class="line"><span class="string">     â€         â¡  è¯·é‡ç‚¹å…³æ³¨ä»£ç â ç»“æ„ã€æ€§èƒ½ä¼˜åŒ–å’Œè¾¹ç•Œæƒ…â€å†µå¤„ç†ã€‚</span></span><br><span class="line"><span class="string">                &#123;% else %&#125;</span></span><br><span class="line"><span class="string">     â€         â¡  è¯·è¿›è¡Œå…¨é¢æ·±åº¦â è¯„å®¡ï¼ŒåŒ…æ‹¬æ¶æ„è®¾è®¡â€ã€æ€§èƒ½ä¼˜åŒ–ã€å®‰å…¨æ€§â€Œã€å¯æ‰©å±•æ€§å’Œæœ€ä½³å®è·µã€‚</span></span><br><span class="line"><span class="string">                &#123;% endif %&#125;</span></span><br><span class="line"><span class="string">            /```    </span></span><br><span class="line"><span class="string">            è¯·æŒ‰ä»¥ä¸‹æ ¼å¼æä¾›è¯„å®¡ç»“æœï¼š</span></span><br><span class="line"><span class="string">            1. æ€»ä½“è¯„ä»·</span></span><br><span class="line"><span class="string">            2. ä¸»è¦é—®é¢˜ï¼ˆæŒ‰ä¸¥é‡æ€§æ’åºï¼‰</span></span><br><span class="line"><span class="string">            3. æ”¹è¿›å»ºè®®</span></span><br><span class="line"><span class="string">            4. ä¼˜åŒ–åçš„ä»£ç ç¤ºä¾‹</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span>;</span><br><span class="line">        <span class="type">PromptTemplate</span> <span class="variable">template</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PromptTemplate</span>(templateString);</span><br><span class="line">        Map&lt;String, Object&gt; params = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        params.put(<span class="string">&quot;code&quot;</span>, code);</span><br><span class="line">        params.put(<span class="string">&quot;language&quot;</span>, language);</span><br><span class="line">        params.put(<span class="string">&quot;level&quot;</span>, level);</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">prompt</span> <span class="operator">=</span> template.render(params);</span><br><span class="line">        <span class="keyword">return</span> chatClient.prompt().user(prompt).call().content();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>æç¤ºæ¨¡æ¿çš„å¤ç”¨å’Œç»„åˆ<br>å¯¹å¹²å¤æ‚åº”ç”¨æˆ‘ä»¬å¯ä»¥åˆ›å»ºå¯å¤ç”¨çš„æ¨¡æ¿åº“</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PromptTemplateConfig</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> PromptTemplate <span class="title function_">codeExplanationTemplate</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PromptTemplate</span>(<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">            è¯·è§£é‡Šä»¥ä¸‹&#123;language&#125;ä»£ç çš„åŠŸèƒ½ï¼š</span></span><br><span class="line"><span class="string">            ```&#123;language&#125;</span></span><br><span class="line"><span class="string">            &#123;code&#125;</span></span><br><span class="line"><span class="string">            è§£é‡Šåº”è¯¥é¢å‘&#123;audience&#125;çº§åˆ«çš„å¼€å‘è€…ã€‚</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">                                  </span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> PromptTemplate <span class="title function_">bugFixingTemplate</span><span class="params">()</span> &#123;</span><br><span class="line">     â€   <span class="keyword">return</span>â¡ <span class="keyword">new</span> <span class="title class_">Prom</span>â ptTemplatâ€e(<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">            ä»¥ä¸‹&#123;language&#125;ä»£ç å­˜åœ¨é—®é¢˜ï¼š</span></span><br><span class="line"><span class="string">            ```&#123;language&#125;</span></span><br><span class="line"><span class="string">            &#123;code&#125;</span></span><br><span class="line"><span class="string">            /```</span></span><br><span class="line"><span class="string">            é”™è¯¯ä¿¡æ¯ï¼š&#123;error&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">            è¯·ï¼š</span></span><br><span class="line"><span class="string">            1. åˆ†æé—®é¢˜æ ¹æº</span></span><br><span class="line"><span class="string">            2. æä¾›ä¿®å¤åçš„å®Œæ•´ä»£ç </span></span><br><span class="line"><span class="string">            3. è§£é‡Šä¿®å¤çš„åŸç†</span></span><br><span class="line"><span class="string">            &quot;&quot;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ç³»ç»Ÿæ¶ˆæ¯ä¸ç”¨æˆ·æ¶ˆæ¯çš„åŒºåˆ«"><a href="#ç³»ç»Ÿæ¶ˆæ¯ä¸ç”¨æˆ·æ¶ˆæ¯çš„åŒºåˆ«" class="headerlink" title="ç³»ç»Ÿæ¶ˆæ¯ä¸ç”¨æˆ·æ¶ˆæ¯çš„åŒºåˆ«"></a>ç³»ç»Ÿæ¶ˆæ¯ä¸ç”¨æˆ·æ¶ˆæ¯çš„åŒºåˆ«</h2><p>åœ¨ä½¿ç”¨LLMæ—¶ï¼Œæ¶ˆæ¯ç±»å‹å¯¹æ¨¡å‹è¡Œä¸ºæœ‰å¾ˆå¤§çš„å½±å“ã€‚<br>Spring AIæ”¯æŒä¸åŒç±»å‹çš„æ¶ˆæ¯ï¼Œä¸»è¦åŒ…æ‹¬ç³»ç»Ÿæ¶ˆæ¯å’Œç”¨æˆ·æ¶ˆæ¯ã€‚</p>
<p>ç³»ç»Ÿæ¶ˆæ¯(SystemMessage)<br>ç”¨äºè®¾ç½®AIåŠ©æ‰‹çš„è¡Œä¸ºæŒ‡å—ã€è§’è‰²å®šä¹‰æˆ–å…¨å±€æŒ‡ä»¤ã€‚ä¸æ˜¯å¯¹è¯çš„ä¸€éƒ¨åˆ†ï¼Œè€Œæ˜¯å¯¹AIè¡Œä¸ºçš„â€å…ƒæŒ‡å¯¼â€ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SystemMessage sâ€ystemMessage = <span class="keyword">new</span> <span class="title class_">SystemMessa</span>â¡ge(</span><br><span class="line">    <span class="string">&quot;ä½ æ˜¯ç®—æ³•å¯¼èˆªçš„ä¸“ä¸šç®—æ³•è®²å¸ˆï¼Œæ“…é•¿å°†å¤æ‚çš„ç®—â æ³•æ¦‚å¿µè§£é‡Šå¾—é€šä¿—æ˜“æ‡‚ã€‚&quot;</span> +</span><br><span class="line">    <span class="string">&quot;å›ç­”æ—¶åº”åŒ…å«ç¤ºä¾‹ä»£ç â€ï¼Œå¹¶è§£é‡Šç®—æ³•çš„æ—¶é—´å’Œç©ºé—´å¤æ‚åº¦ã€‚&quot;</span> +</span><br><span class="line">    <span class="string">&quot;é£æ ¼åº”ä¿æŒâ€Œä¸“ä¸šä½†å‹å¥½ï¼Œé€‚åˆè®¡ç®—æœºç§‘å­¦æœ¬ç§‘ç”Ÿç†è§£ã€‚&quot;</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>ç”¨æˆ·æ¶ˆæ¯(UserMessage)<br>ç”¨æˆ·æ¶ˆæ¯ä»£è¡¨ç”¨æˆ·çš„å®é™…è¾“å…¥ï¼Œæ˜¯å¯¹è¯ä¸­ç”¨æˆ·å‘AIæé—®æˆ–å‘å‡ºæŒ‡ä»¤çš„éƒ¨åˆ†ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">UserMesâ€sage userMessaâ¡ge = <span class="keyword">new</span> <span class="title class_">UserM</span>â essage(</span><br><span class="line">    <span class="string">&quot;è¯·â€è§£é‡Šå¿«é€Ÿæ’åºç®—æ³•çš„å·¥ä½œåŸç†ï¼Œâ€Œå¹¶ç»™å‡º Java å®ç°ã€‚&quot;</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>æ­£ç¡®ç»„åˆä½¿ç”¨<br>ç³»ç»Ÿæ¶ˆæ¯å’Œç”¨æˆ·æ¶ˆæ¯ç»“åˆä½¿ç”¨ï¼Œå¯ä»¥è·å¾—æ›´ç²¾ç¡®çš„AIå“åº”ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AlgorithmTutorService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ChatClient chatClient;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">AlgorithmTutorService</span><span class="params">(ChatClient chatClient)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.chatClient = chatClient;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">explainAlgorithm</span><span class="params">(String algorithm)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> chatClient.prompt()</span><br><span class="line">            .systeâ€m(<span class="string">&quot;ä½ æ˜¯ç®—æ³•å¯¼èˆªçš„ä¸“ä¸šç®—æ³•è®²å¸ˆï¼Œæ“…é•¿å°†å¤æ‚çš„ç®—æ³•æ¦‚å¿µè§£é‡Šå¾—é€šä¿—æ˜“æ‡‚ã€‚&quot;</span>â¡ +</span><br><span class="line">                    <span class="string">&quot;å›ç­”æ—¶åº”åŒ…å«ç¤ºä¾‹ä»£ç ï¼Œå¹¶â è§£é‡Šç®—æ³•çš„æ—¶é—´å’Œç©ºé—´å¤æ‚åº¦ã€‚&quot;</span> +</span><br><span class="line">                  â€  <span class="string">&quot;é£æ ¼åº”ä¿æŒä¸“ä¸šä½†å‹å¥½ï¼Œé€‚åˆè®¡ç®—æœºç§‘å­¦æœ¬ç§‘ç”Ÿç†è§£â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€Œâ€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‰â€‰â€‚â€‰â€‰â€‰â€‰â€‚â€‚â€‚â€‚â€‚â€‰â€‚â€‰&quot;</span>)</span><br><span class="line">            .user(<span class="string">&quot;è¯·è§£é‡Š&quot;</span> + algorithm + <span class="string">&quot;ç®—æ³•çš„å·¥ä½œåŸç†ï¼Œå¹¶ç»™å‡º Java å®ç°ã€‚&quot;</span>)</span><br><span class="line">            .call()</span><br><span class="line">            .content();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ä¸Šä¸‹æ–‡ç®¡ç†ä¸å¯¹è¯å†å²"><a href="#ä¸Šä¸‹æ–‡ç®¡ç†ä¸å¯¹è¯å†å²" class="headerlink" title="ä¸Šä¸‹æ–‡ç®¡ç†ä¸å¯¹è¯å†å²"></a>ä¸Šä¸‹æ–‡ç®¡ç†ä¸å¯¹è¯å†å²</h2><p>Alå¯¹è¯çš„è´¨é‡å¾ˆå¤§ç¨‹åº¦ä¸Šå–å†³äºä¸Šä¸‹æ–‡ç®¡ç†ã€‚<br>Spring AIæä¾›äº†çµæ´»çš„æ–¹å¼æ¥å¤„ç†å¯¹è¯å†å²ã€‚</p>
<p>ä¿æŒå¯¹è¯ä¸Šä¸‹æ–‡<br>é€šè¿‡å°†ä¹‹å‰çš„æ¶ˆæ¯åŒ…å«åœ¨æç¤ºä¸­ï¼Œå¯ä»¥è®©AIäº†è§£å¯¹è¯å†å²ï¼Œä»è€Œç»™å‡ºæ›´è¿è´¯çš„å›ç­”ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConversationService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ChatClient chatClient;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, List&lt;AbstractMessage&gt;&gt; conversationHistory = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ConversationService</span><span class="params">(ChatClient chatClient)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.chatClient = chatClient;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">continueConversation</span><span class="params">(String userId, String newMessage)</span> &#123;</span><br><span class="line">        <span class="comment">// è·å–æˆ–åˆ›å»ºç”¨æˆ·çš„å¯¹è¯å†å²</span></span><br><span class="line">        List&lt;AbstractMessage&gt; history = conversationHistory.computeIfAbsent(</span><br><span class="line">            userId, k -&gt; <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(Arrays.asList(</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">SystemMessage</span>(<span class="string">&quot;ä½ æ˜¯é¢è¯•é¸­å¹³å°çš„é¢è¯•æ•™ç»ƒï¼Œå¸®åŠ©ç”¨æˆ·å‡†å¤‡æŠ€æœ¯é¢è¯•ã€‚&quot;</span>)</span><br><span class="line">            ))</span><br><span class="line">        );</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ·»åŠ æ–°çš„ç”¨æˆ·æ¶ˆæ¯</span></span><br><span class="line">        <span class="type">UserMessage</span> <span class="variable">userMessage</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserMessage</span>(newMessage);</span><br><span class="line">        history.add(userMessage);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å‡†å¤‡åŒ…å«å†å²è®°å½•çš„æç¤º</span></span><br><span class="line">        <span class="type">Prompt</span> <span class="variable">prompt</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Prompt</span>(history);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// è·å– AI å“åº”</span></span><br><span class="line">        <span class="type">ChatResponse</span> <span class="variable">response</span> <span class="operator">=</span> chatClient.call(prompt);</span><br><span class="line">        <span class="type">String</span> <span class="variable">responseContent</span> <span class="operator">=</span> response.getResult().getOutput().getContent();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å°† AI å“åº”æ·»åŠ åˆ°å†å²è®°å½•</span></span><br><span class="line">        history.add(<span class="keyword">new</span> <span class="title class_">AssistantMessage</span>(responseContent));</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å¦‚æœå†å²è®°å½•è¿‡é•¿ï¼Œå¯ä»¥è£å‰ª</span></span><br><span class="line">        <span class="keyword">if</span> (history.size() &gt; <span class="number">10</span>) &#123;</span><br><span class="line">            <span class="comment">// ä¿ç•™ç³»ç»Ÿæ¶ˆæ¯å’Œæœ€è¿‘çš„å¯¹è¯</span></span><br><span class="line">            List&lt;AbstractMessage&gt; trimmedHistory = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">            trimmedHistory.add(history.get(<span class="number">0</span>)); <span class="comment">// ç³»ç»Ÿæ¶ˆæ¯</span></span><br><span class="line">            trimmedHistory.addAll(history.subList(history.size() - <span class="number">9</span>, history.size()));</span><br><span class="line">            conversationHistory.put(userId, trimmedHistory);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> responseContent;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸Šä¸‹æ–‡çª—å£é™åˆ¶å¤„ç†<br>è¯­è¨€æ¨¡å‹æœ‰ä¸Šä¸‹æ–‡çª—å£é™åˆ¶ï¼Œéœ€è¦é€‚å½“ç®¡ç†å†å²è®°å½•é•¿åº¦ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TokenAwareConversationService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ChatClient chatClient;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, List&lt;AbstractMessage&gt;&gt; conversationHistory = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">maxTokens</span> <span class="operator">=</span> <span class="number">4000</span>; <span class="comment">// æ ¹æ®æ¨¡å‹é™åˆ¶è®¾ç½®</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç®€åŒ–çš„ä»¤ç‰Œè®¡ç®—é€»è¾‘ï¼ˆå®é™…ä¸­åº”ä½¿ç”¨æ›´å‡†ç¡®çš„ç®—æ³•ï¼‰</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="title function_">estimateTokenCount</span><span class="params">(String text)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> text.split(<span class="string">&quot;\\s+&quot;</span>).length;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">continueConversation</span><span class="params">(String userId, String newMessage)</span> &#123;</span><br><span class="line">        <span class="comment">// è·å–æˆ–åˆ›å»ºå¯¹è¯å†å²</span></span><br><span class="line">        List&lt;AbstractMessage&gt; history = conversationHistory.computeIfAbsent(</span><br><span class="line">            userId, k -&gt; <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(Arrays.asList(</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">SystemMessage</span>(<span class="string">&quot;ä½ æ˜¯ç¼–ç¨‹å¯¼èˆªçš„åŠ©æ•™ã€‚&quot;</span>)</span><br><span class="line">            ))</span><br><span class="line">        );</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ·»åŠ æ–°æ¶ˆæ¯</span></span><br><span class="line">        history.add(<span class="keyword">new</span> <span class="title class_">UserMessage</span>(newMessage));</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ£€æŸ¥å¹¶è£å‰ªå†å²è®°å½•ï¼Œç¡®ä¿ä¸è¶…è¿‡ä»¤ç‰Œé™åˆ¶</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">totalTokens</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        List&lt;AbstractMessage&gt; effectiveHistory = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ€»æ˜¯ä¿ç•™ç³»ç»Ÿæ¶ˆæ¯</span></span><br><span class="line">        effectiveHistory.add(history.get(<span class="number">0</span>));</span><br><span class="line">        totalTokens += estimateTokenCount(((SystemMessage)history.get(<span class="number">0</span>)).getContent());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ä»æœ€è¿‘çš„æ¶ˆæ¯å‘å‰æ·»åŠ ï¼Œç›´åˆ°æ¥è¿‘ä»¤ç‰Œé™åˆ¶</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> history.size() - <span class="number">1</span>; i &gt; <span class="number">0</span>; i--) &#123;</span><br><span class="line">            <span class="type">AbstractMessage</span> <span class="variable">message</span> <span class="operator">=</span> history.get(i);</span><br><span class="line">            <span class="type">String</span> <span class="variable">content</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (message <span class="keyword">instanceof</span> UserMessage) &#123;</span><br><span class="line">                content = ((UserMessage)message).getContent();</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (message <span class="keyword">instanceof</span> AssistantMessage) &#123;</span><br><span class="line">                content = ((AssistantMessage)message).getContent();</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="type">int</span> <span class="variable">messageTokens</span> <span class="operator">=</span> estimateTokenCount(content);</span><br><span class="line">            <span class="keyword">if</span> (totalTokens + messageTokens &lt; maxTokens) &#123;</span><br><span class="line">                effectiveHistory.add(<span class="number">0</span>, message); <span class="comment">// æ·»åŠ åˆ°åˆ—è¡¨å¼€å¤´</span></span><br><span class="line">                totalTokens += messageTokens;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// è°ƒç”¨ AI</span></span><br><span class="line">        <span class="type">Prompt</span> <span class="variable">prompt</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Prompt</span>(effectiveHistory);</span><br><span class="line">        <span class="type">String</span> <span class="variable">responseContent</span> <span class="operator">=</span> chatClient.call(prompt)</span><br><span class="line">            .getResult().getOutput().getContent();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ›´æ–°å†å²</span></span><br><span class="line">        history.add(<span class="keyword">new</span> <span class="title class_">AssistantMessage</span>(responseContent));</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> responseContent;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="å¸¸è§æç¤ºè¯æŠ€å·§ä¸æ¨¡å¼"><a href="#å¸¸è§æç¤ºè¯æŠ€å·§ä¸æ¨¡å¼" class="headerlink" title="å¸¸è§æç¤ºè¯æŠ€å·§ä¸æ¨¡å¼"></a>å¸¸è§æç¤ºè¯æŠ€å·§ä¸æ¨¡å¼</h2><p>æ€ç»´é“¾æç¤º(Chain of Thought)<br>å¼•å¯¼AIé€æ­¥æ€è€ƒé—®é¢˜ï¼Œæé«˜æ¨ç†èƒ½åŠ›</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">String â€chainOfThoughâ¡tPrompt = <span class="string">&quot;&quot;&quot;â </span></span><br><span class="line"><span class="string">è¯·åˆ†æä»¥ä¸‹ç®—æ³•é—®é¢˜å¹¶æ‰¾å‡ºâ€æœ€ä¼˜è§£ï¼š</span></span><br><span class="line"><span class="string">ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„â€Œï¼Œæ‰¾å‡ºå…¶ä¸­å’Œæœ€å¤§çš„è¿ç»­å­æ•°ç»„ã€‚</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">è¯·æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ€è€ƒï¼š</span></span><br><span class="line"><span class="string">1. é¦–å…ˆï¼Œåˆ†æé—®é¢˜çš„åŸºæœ¬ç‰¹ç‚¹å’Œè¾¹ç•Œæ¡ä»¶</span></span><br><span class="line"><span class="string">2. è€ƒè™‘å¯èƒ½çš„è§£æ³•ï¼ˆæš´åŠ›æ³•ã€åˆ†æ²»æ³•ã€åŠ¨æ€è§„åˆ’ç­‰ï¼‰</span></span><br><span class="line"><span class="string">3. æ¯”è¾ƒä¸åŒæ–¹æ³•çš„æ—¶é—´å’Œç©ºé—´å¤æ‚åº¦</span></span><br><span class="line"><span class="string">4. ç¡®å®šæœ€ä¼˜è§£æ³•</span></span><br><span class="line"><span class="string">5. ç”¨ Java å®ç°è¯¥ç®—æ³•</span></span><br><span class="line"><span class="string">6. åˆ†æç®—æ³•çš„å¤æ‚åº¦</span></span><br><span class="line"><span class="string">7. éªŒè¯ç®—æ³•åœ¨ç¤ºä¾‹ç”¨ä¾‹ä¸Šçš„æ­£ç¡®æ€§</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>é›¶æ ·æœ¬ã€å•æ ·æœ¬å’Œå¤šæ ·æœ¬æç¤º<br>æ ¹æ®ä»»åŠ¡å¤æ‚åº¦ï¼Œæä¾›ä¸åŒæ•°é‡çš„ç¤ºä¾‹ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é›¶æ ·æœ¬æç¤º</span></span><br><span class="line"><span class="type">String</span> <span class="variable">zeroShotPrompt</span> <span class="operator">=</span> <span class="string">&quot;å°†ä»¥ä¸‹å¥å­ä»ä¸­æ–‡ç¿»è¯‘æˆè‹±æ–‡ï¼š&#x27;ç¼–ç¨‹å¯¼èˆªæ˜¯ä¸€ä¸ªå¸®åŠ©ç¨‹åºå‘˜å­¦ä¹ çš„å¹³å°ã€‚&#x27;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å•æ ·æœ¬æç¤º</span></span><br><span class="line">String oneSâ€hotPrompt = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">è¯·æ ¹æ®ç¤ºä¾‹â¡ï¼Œæä¾›ç±»ä¼¼çš„è½¬æ¢ï¼š</span></span><br><span class="line"><span class="string">è¾“å…¥ï¼š&#x27;Java æ˜¯ä¸€â ç§å¹¿æ³›ä½¿ç”¨çš„ç¼–ç¨‹è¯­è¨€ã€‚&#x27;</span></span><br><span class="line"><span class="string">è¾“å‡ºï¼š&#x27;Javaâ€ is a widely used proâ€Œgramming language.&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">ç°åœ¨ï¼Œè¯·è½¬æ¢ï¼š&#x27;ç¼–ç¨‹å¯¼èˆªæ˜¯ä¸€ä¸ªå¸®åŠ©ç¨‹åºå‘˜å­¦ä¹ çš„å¹³å°ã€‚&#x27;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¤šæ ·æœ¬æç¤º</span></span><br><span class="line">String multiâ€ShotPrompt = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">è¯·æ ¹æ®ä»¥ä¸‹ç¤ºâ¡ä¾‹ï¼Œè¿›è¡Œç±»ä¼¼çš„è½¬æ¢ï¼š</span></span><br><span class="line"><span class="string">ç¤ºä¾‹ 1:</span></span><br><span class="line"><span class="string">è¾“å…¥ï¼š&#x27;Jaâ va æ˜¯ä¸€ç§å¹¿æ³›ä½¿ç”¨çš„ç¼–ç¨‹è¯­è¨€ã€‚&#x27;</span></span><br><span class="line"><span class="string">è¾“å‡ºï¼š&#x27;Jâ€ava is a widely used prâ€Œogramming language.&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">ç¤ºä¾‹ 2:</span></span><br><span class="line"><span class="string">è¾“å…¥ï¼šâ€&#x27;é¢è¯•é¸­æä¾›ç¼–ç¨‹é¢è¯•é¢˜å’Œç­”æ¡ˆã€‚&#x27;</span></span><br><span class="line"><span class="string">â¡è¾“å‡ºï¼š&#x27;Mianshiya proâ vides programmingâ€ interview questiâ€Œons and answers.&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">ç¤ºä¾‹ 3:</span></span><br><span class="line"><span class="string">è¾“å…¥ï¼šâ€&#x27;è€é±¼ç®€å†å¸®åŠ©æ±‚èŒè€…åˆ¶ä½œä¸“ä¸šç®€â¡å†ã€‚&#x27;</span></span><br><span class="line"><span class="string">è¾“å‡ºï¼š&#x27;Laoyu Resumâ e helps job seekeâ€rs create professâ€Œional resumes.&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">ç°åœ¨ï¼Œè¯·è½¬æ¢ï¼š&#x27;ç¼–ç¨‹å¯¼èˆªæ˜¯ä¸€ä¸ªå¸®åŠ©ç¨‹åºå‘˜å­¦ä¹ çš„å¹³å°ã€‚&#x27;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>ç»“æœé™åˆ¶æŠ€å·§<br>æ˜ç¡®é™åˆ¶è¾“å‡ºæ ¼å¼å’Œé•¿åº¦ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Stringâ€ constraineâ¡dPrompt = <span class="string">&quot;â &quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">è¯·æä¾› 5 ä¸ªæâ€é«˜ Java ç¼–ç¨‹æŠ€â€Œèƒ½çš„å»ºè®®ã€‚</span></span><br><span class="line"><span class="string">æ¯ä¸ªå»ºè®®å¿…é¡»ï¼š</span></span><br><span class="line"><span class="string">1. ä¸è¶…è¿‡ 20 å­—</span></span><br><span class="line"><span class="string">2. ä»¥åŠ¨è¯å¼€å¤´</span></span><br><span class="line"><span class="string">3. å¯ä»¥ç«‹å³æ‰§è¡Œ</span></span><br><span class="line"><span class="string">4. å…·ä½“æ˜ç¡®</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">å›ç­”æ ¼å¼å¿…â€é¡»æ˜¯å¸¦åºå·çš„ç®€æ´åˆ—è¡¨â¡ï¼Œä¸åŒ…å«ä»»ä½•é¢å¤–â è§£é‡Šã€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‚â€‰â€‰â€Œâ€‚â€‰â€‰â€‰â€‰â€‚â€‚â€‚â€‚â€‚â€‰â€‚â€‰</span></span><br><span class="line"><span class="string">&quot;</span><span class="string">&quot;&quot;</span>;</span><br></pre></td></tr></table></figure>

<h2 id="ç¬¬ä¸‰æ¬¡å®è·µ"><a href="#ç¬¬ä¸‰æ¬¡å®è·µ" class="headerlink" title="ç¬¬ä¸‰æ¬¡å®è·µ"></a>ç¬¬ä¸‰æ¬¡å®è·µ</h2><p>åˆ›å»ºè‡ªå®šä¹‰è§’è‰²çš„AIåŠ©æ‰‹<br>æˆ‘ä»¬è¦åˆ›å»ºä¸€ä¸ªâ€ç®—æ³•æ•™ç»ƒâ€AIåŠ©æ‰‹ï¼Œå®ƒèƒ½å¤Ÿï¼š<br>è§£é‡Šç®—æ³•æ¦‚å¿µ<br>Â·æä¾›ç®—æ³•ä¹ é¢˜<br>Â·è¯„ä¼°ç”¨æˆ·çš„è§£æ³•<br>Â·ç»™å‡ºé’ˆå¯¹æ€§çš„å­¦ä¹ å»ºè®®</p>
<ol>
<li>å®šä¹‰ç³»ç»Ÿæç¤ºæ¨¡æ¿</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AlgorithmCoachPrompts</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> PromptTemplate <span class="title function_">getSystemPromptTemplate</span><span class="params">()</span> &#123;</span><br><span class="line">     â€   <span class="keyword">return</span>â¡ <span class="keyword">new</span> <span class="title class_">Prom</span>â ptTemplatâ€e(<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">            ä½ æ˜¯ç®—æ³•å¯¼èˆªçš„èµ„æ·±ç®—æ³•æ•™ç»ƒï¼Œåä¸º&quot;ç®—æ³•å¯¼èˆªæ•™ç»ƒ&quot;ï¼Œä¸“æ³¨äºå¸®åŠ©&#123;level&#125;å¼€å‘è€…æå‡ç®—æ³•èƒ½åŠ›ã€‚</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            ä½ çš„ç‰¹ç‚¹ï¼š</span></span><br><span class="line"><span class="string">            1. æ·±å…¥æµ…å‡ºï¼šèƒ½å°†å¤æ‚ç®—æ³•æ¦‚å¿µè§£é‡Šå¾—é€šä¿—æ˜“æ‡‚</span></span><br><span class="line"><span class="string">            2. å¾ªåºæ¸è¿›ï¼šæ ¹æ®å­¦ä¹ è€…æ°´å¹³è°ƒæ•´éš¾åº¦</span></span><br><span class="line"><span class="string">            3. é¼“åŠ±æ€è€ƒï¼šä¸ç›´æ¥ç»™å‡ºå®Œæ•´ç­”æ¡ˆï¼Œè€Œæ˜¯å¼•å¯¼ç”¨æˆ·æ€è€ƒ</span></span><br><span class="line"><span class="string">            4. å®ç”¨å¯¼å‘ï¼šå¼ºè°ƒç®—æ³•åœ¨å®é™…å·¥ä½œä¸­çš„åº”ç”¨åœºæ™¯</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            å›ç­”é£æ ¼ï¼š</span></span><br><span class="line"><span class="string">            - ä½¿ç”¨æ¯”å–»å’Œç±»æ¯”è§£é‡ŠæŠ½è±¡æ¦‚å¿µ</span></span><br><span class="line"><span class="string">            - æä¾›å¯è§†åŒ–æè¿°å¸®åŠ©ç†è§£</span></span><br><span class="line"><span class="string">            - ä»£ç ç¤ºä¾‹ä½¿ç”¨ Java è¯­è¨€ï¼ŒåŒ…å«è¯¦ç»†æ³¨é‡Š</span></span><br><span class="line"><span class="string">            - å‹å¥½ä¸“ä¸šï¼Œè¯­æ°”ç§¯æé¼“åŠ±</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            ä½ ä¸æ˜¯ï¼š</span></span><br><span class="line"><span class="string">            - ä¸æ˜¯æœç´¢å¼•æ“ï¼Œä¸æä¾›ä¸ç®—æ³•æ— å…³çš„ä¿¡æ¯</span></span><br><span class="line"><span class="string">            - ä¸æ˜¯ä»£ç ç”Ÿæˆå·¥å…·ï¼Œä¸è§£å†³å®Œæ•´é¡¹ç›®é—®é¢˜</span></span><br><span class="line"><span class="string">            - ä¸æ˜¯ç«èµ›æ•™ç»ƒï¼Œä¸è¿‡åº¦å…³æ³¨ç®—æ³•ç«èµ›æŠ€å·§</span></span><br><span class="line"><span class="string">            &quot;&quot;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>å®ç°æœåŠ¡å±‚</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AlgorithmCoachService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ChatClient chatClient;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> AlgorithmCoachPrompts prompts;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, List&lt;AbstractMessage&gt;&gt; sessionHistories = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">AlgorithmCoachService</span><span class="params">(ChatClient chatClient, AlgorithmCoachPrompts prompts)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.chatClient = chatClient;</span><br><span class="line">        <span class="built_in">this</span>.prompts = prompts;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">startSession</span><span class="params">(String userId, String level)</span> &#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºç³»ç»Ÿæç¤º</span></span><br><span class="line">        Map&lt;String, Object&gt; params = Map.of(<span class="string">&quot;level&quot;</span>, level);</span><br><span class="line">        <span class="type">String</span> <span class="variable">systemPrompt</span> <span class="operator">=</span> prompts.getSystemPromptTemplate().render(params);</span><br><span class="line">        </span><br><span class="line">        List&lt;AbstractMessage&gt; messages = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        messages.add(<span class="keyword">new</span> <span class="title class_">SystemMessage</span>(systemPrompt));</span><br><span class="line">        messages.add(<span class="keyword">new</span> <span class="title class_">UserMessage</span>(<span class="string">&quot;ä½ å¥½ï¼Œæˆ‘æƒ³å­¦ä¹ ç®—æ³•ã€‚&quot;</span>));</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ä¿å­˜ä¼šè¯å†å²</span></span><br><span class="line">        sessionHistories.put(userId, messages);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// è°ƒç”¨ AI</span></span><br><span class="line">        <span class="type">Prompt</span> <span class="variable">prompt</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Prompt</span>(messages);</span><br><span class="line">        <span class="type">ChatResponse</span> <span class="variable">response</span> <span class="operator">=</span> chatClient.call(prompt);</span><br><span class="line">        <span class="type">String</span> <span class="variable">content</span> <span class="operator">=</span> response.getResult().getOutput().getContent();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ›´æ–°å†å²</span></span><br><span class="line">        messages.add(<span class="keyword">new</span> <span class="title class_">AssistantMessage</span>(content));</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> content;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">continueConversation</span><span class="params">(String userId, String message)</span> &#123;</span><br><span class="line">        <span class="comment">// è·å–å†å²è®°å½•</span></span><br><span class="line">        List&lt;AbstractMessage&gt; history = sessionHistories.get(userId);</span><br><span class="line">        <span class="keyword">if</span> (history == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// å¦‚æœæ²¡æœ‰å†å²ï¼Œåˆ›å»ºæ–°ä¼šè¯</span></span><br><span class="line">            <span class="keyword">return</span> startSession(userId, <span class="string">&quot;ä¸­çº§&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ·»åŠ æ–°æ¶ˆæ¯</span></span><br><span class="line">        history.add(<span class="keyword">new</span> <span class="title class_">UserMessage</span>(message));</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// è°ƒç”¨ AI</span></span><br><span class="line">        <span class="type">Prompt</span> <span class="variable">prompt</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Prompt</span>(history);</span><br><span class="line">        <span class="type">ChatResponse</span> <span class="variable">response</span> <span class="operator">=</span> chatClient.call(prompt);</span><br><span class="line">        <span class="type">String</span> <span class="variable">content</span> <span class="operator">=</span> response.getResult().getOutput().getContent();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ›´æ–°å†å²</span></span><br><span class="line">        history.add(<span class="keyword">new</span> <span class="title class_">AssistantMessage</span>(content));</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å¦‚æœå†å²å¤ªé•¿ï¼Œè£å‰ª</span></span><br><span class="line">        <span class="keyword">if</span> (history.size() &gt; <span class="number">15</span>) &#123;</span><br><span class="line">            List&lt;AbstractMessage&gt; trimmedHistory = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">            trimmedHistory.add(history.get(<span class="number">0</span>)); <span class="comment">// ç³»ç»Ÿæ¶ˆæ¯</span></span><br><span class="line">            trimmedHistory.addAll(history.subList(history.size() - <span class="number">10</span>, history.size()));</span><br><span class="line">            sessionHistories.put(userId, trimmedHistory);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> content;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getAlgorithmExplanation</span><span class="params">(String userId, String algorithm)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;è¯·è§£é‡Š&quot;</span> + algorithm + <span class="string">&quot;ç®—æ³•çš„å·¥ä½œåŸç†ã€æ—¶é—´å¤æ‚åº¦å’Œé€‚ç”¨åœºæ™¯ã€‚&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> continueConversation(userId, message);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getPracticeQuestion</span><span class="params">(String userId, String difficulty)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;è¯·ç»™æˆ‘ä¸€é“&quot;</span> + difficulty + <span class="string">&quot;éš¾åº¦çš„ç®—æ³•é¢˜ï¼ŒåŒ…å«é¢˜ç›®æè¿°ã€ç¤ºä¾‹è¾“å…¥è¾“å‡ºå’Œæç¤ºã€‚&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> continueConversation(userId, message);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">evaluateSolution</span><span class="params">(String userId, String problem, String solution)</span> &#123;</span><br><span class="line">     â€   String â¡message = â <span class="string">&quot;æˆ‘çš„è§£æ³•å¦‚ä¸‹ï¼Œè¯·è¯„â€ä¼°è¿™ä¸ªè§£æ³•å¹¶ç»™å‡ºæ”¹è¿›â€Œå»ºè®®ï¼š\n\né—®é¢˜ï¼š&quot;</span> + </span><br><span class="line">                          problem + <span class="string">&quot;\n\næˆ‘çš„è§£æ³•ï¼š\n```java\n&quot;</span> + solution + <span class="string">&quot;\n```&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> continueConversation(userId, message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ–°ç‰ˆæœ¬Promptæ”¹äº†</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.Spring_ai_6.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.Spring_ai_6.model.AlgorithmCoachPrompts;</span><br><span class="line"><span class="keyword">import</span> org.springframework.ai.chat.client.ChatClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.ai.chat.messages.Message;</span><br><span class="line"><span class="keyword">import</span> org.springframework.ai.chat.messages.AssistantMessage;</span><br><span class="line"><span class="keyword">import</span> org.springframework.ai.chat.messages.SystemMessage;</span><br><span class="line"><span class="keyword">import</span> org.springframework.ai.chat.messages.UserMessage;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ConcurrentHashMap;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AlgorithmCoachService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ChatClient chatClient;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> AlgorithmCoachPrompts prompts;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, List&lt;Message&gt;&gt; sessionHistories = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">AlgorithmCoachService</span><span class="params">(ChatClient chatClient, AlgorithmCoachPrompts prompts)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.chatClient = chatClient;</span><br><span class="line">        <span class="built_in">this</span>.prompts = prompts;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">startSession</span><span class="params">(String userId, String level)</span> &#123;</span><br><span class="line">        Map&lt;String, Object&gt; params = Map.of(<span class="string">&quot;level&quot;</span>, level);</span><br><span class="line">        <span class="type">String</span> <span class="variable">systemPrompt</span> <span class="operator">=</span> prompts.getSystemPromptTemplate().render(params);</span><br><span class="line"></span><br><span class="line">        List&lt;Message&gt; messages = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        messages.add(<span class="keyword">new</span> <span class="title class_">SystemMessage</span>(systemPrompt));</span><br><span class="line">        messages.add(<span class="keyword">new</span> <span class="title class_">UserMessage</span>(<span class="string">&quot;ä½ å¥½ï¼Œæˆ‘æƒ³å­¦ä¹ ç®—æ³•ã€‚&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è°ƒç”¨ AIï¼ˆæ–° APIï¼‰</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">content</span> <span class="operator">=</span> chatClient.prompt()</span><br><span class="line">                .messages(messages)</span><br><span class="line">                .call()</span><br><span class="line">                .content();</span><br><span class="line"></span><br><span class="line">        messages.add(<span class="keyword">new</span> <span class="title class_">AssistantMessage</span>(content));</span><br><span class="line">        sessionHistories.put(userId, messages);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> content;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">continueConversation</span><span class="params">(String userId, String message)</span> &#123;</span><br><span class="line">        List&lt;Message&gt; history = sessionHistories.get(userId);</span><br><span class="line">        <span class="keyword">if</span> (history == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> startSession(userId, <span class="string">&quot;ä¸­çº§&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ·»åŠ ç”¨æˆ·æ–°æ¶ˆæ¯</span></span><br><span class="line">        List&lt;Message&gt; currentMessages = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(history);</span><br><span class="line">        currentMessages.add(<span class="keyword">new</span> <span class="title class_">UserMessage</span>(message));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è°ƒç”¨ AI</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">content</span> <span class="operator">=</span> chatClient.prompt()</span><br><span class="line">                .messages(currentMessages)</span><br><span class="line">                .call()</span><br><span class="line">                .content();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ›´æ–°å†å²ï¼ˆçº¿ç¨‹å®‰å…¨è€ƒè™‘ï¼šé¿å…ç›´æ¥ä¿®æ”¹å…±äº«åˆ—è¡¨ï¼‰</span></span><br><span class="line">        List&lt;Message&gt; updatedHistory = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(currentMessages);</span><br><span class="line">        updatedHistory.add(<span class="keyword">new</span> <span class="title class_">AssistantMessage</span>(content));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è£å‰ªå†å²</span></span><br><span class="line">        <span class="keyword">if</span> (updatedHistory.size() &gt; <span class="number">15</span>) &#123;</span><br><span class="line">            List&lt;Message&gt; trimmed = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">            trimmed.add(updatedHistory.get(<span class="number">0</span>)); <span class="comment">// ç³»ç»Ÿæ¶ˆæ¯</span></span><br><span class="line">            trimmed.addAll(updatedHistory.subList(updatedHistory.size() - <span class="number">10</span>, updatedHistory.size()));</span><br><span class="line">            sessionHistories.put(userId, trimmed);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            sessionHistories.put(userId, updatedHistory);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> content;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getAlgorithmExplanation</span><span class="params">(String userId, String algorithm)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;è¯·è§£é‡Š&quot;</span> + algorithm + <span class="string">&quot;ç®—æ³•çš„å·¥ä½œåŸç†ã€æ—¶é—´å¤æ‚åº¦å’Œé€‚ç”¨åœºæ™¯ã€‚&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> continueConversation(userId, message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getPracticeQuestion</span><span class="params">(String userId, String difficulty)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;è¯·ç»™æˆ‘ä¸€é“&quot;</span> + difficulty + <span class="string">&quot;éš¾åº¦çš„ç®—æ³•é¢˜ï¼ŒåŒ…å«é¢˜ç›®æè¿°ã€ç¤ºä¾‹è¾“å…¥è¾“å‡ºå’Œæç¤ºã€‚&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> continueConversation(userId, message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">evaluateSolution</span><span class="params">(String userId, String problem, String solution)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;æˆ‘çš„è§£æ³•å¦‚ä¸‹ï¼Œè¯·è¯„ä¼°è¿™ä¸ªè§£æ³•å¹¶ç»™å‡ºæ”¹è¿›å»ºè®®ï¼š\n\né—®é¢˜ï¼š&quot;</span> +</span><br><span class="line">                problem + <span class="string">&quot;\n\næˆ‘çš„è§£æ³•ï¼š\n```java\n&quot;</span> + solution + <span class="string">&quot;\n```&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> continueConversation(userId, message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<ol start="3">
<li>åˆ›å»ºæ§åˆ¶å™¨</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/algorithm-coach&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AlgorithmCoachController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> AlgorithmCoachService coachService;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">AlgorithmCoachController</span><span class="params">(AlgorithmCoachService coachService)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.coachService = coachService;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PostMapping(&quot;/start&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;Map&lt;String, String&gt;&gt; <span class="title function_">startSession</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestBody</span> Map&lt;String, String&gt; request)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">userId</span> <span class="operator">=</span> request.get(<span class="string">&quot;userId&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">level</span> <span class="operator">=</span> request.getOrDefault(<span class="string">&quot;level&quot;</span>, <span class="string">&quot;ä¸­çº§&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="type">String</span> <span class="variable">response</span> <span class="operator">=</span> coachService.startSession(userId, level);</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(Map.of(<span class="string">&quot;response&quot;</span>, response));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PostMapping(&quot;/chat&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;Map&lt;String, String&gt;&gt; <span class="title function_">chat</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestBody</span> Map&lt;String, String&gt; request)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">userId</span> <span class="operator">=</span> request.get(<span class="string">&quot;userId&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> request.get(<span class="string">&quot;message&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="type">String</span> <span class="variable">response</span> <span class="operator">=</span> coachService.continueConversation(userId, message);</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(Map.of(<span class="string">&quot;response&quot;</span>, response));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PostMapping(&quot;/explain&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;Map&lt;String, String&gt;&gt; <span class="title function_">explainAlgorithm</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestBody</span> Map&lt;String, String&gt; request)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">userId</span> <span class="operator">=</span> request.get(<span class="string">&quot;userId&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">algorithm</span> <span class="operator">=</span> request.get(<span class="string">&quot;algorithm&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="type">String</span> <span class="variable">response</span> <span class="operator">=</span> coachService.getAlgorithmExplanation(userId, algorithm);</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(Map.of(<span class="string">&quot;response&quot;</span>, response));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PostMapping(&quot;/practice&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;Map&lt;String, String&gt;&gt; <span class="title function_">getPracticeQuestion</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestBody</span> Map&lt;String, String&gt; request)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">userId</span> <span class="operator">=</span> request.get(<span class="string">&quot;userId&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">difficulty</span> <span class="operator">=</span> request.getOrDefault(<span class="string">&quot;difficulty&quot;</span>, <span class="string">&quot;ä¸­ç­‰&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="type">String</span> <span class="variable">response</span> <span class="operator">=</span> coachService.getPracticeQuestion(userId, difficulty);</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(Map.of(<span class="string">&quot;response&quot;</span>, response));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PostMapping(&quot;/evaluate&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;Map&lt;String, String&gt;&gt; <span class="title function_">evaluateSolution</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestBody</span> Map&lt;String, String&gt; request)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">userId</span> <span class="operator">=</span> request.get(<span class="string">&quot;userId&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">problem</span> <span class="operator">=</span> request.get(<span class="string">&quot;problem&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">solution</span> <span class="operator">=</span> request.get(<span class="string">&quot;solution&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="type">String</span> <span class="variable">response</span> <span class="operator">=</span> coachService.evaluateSolution(userId, problem, solution);</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(Map.of(<span class="string">&quot;response&quot;</span>, response));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h1 id="ç»“æ„åŒ–è¾“å‡ºå¤„ç†"><a href="#ç»“æ„åŒ–è¾“å‡ºå¤„ç†" class="headerlink" title="ç»“æ„åŒ–è¾“å‡ºå¤„ç†"></a>ç»“æ„åŒ–è¾“å‡ºå¤„ç†</h1><p>åœ¨AIåº”ç”¨ä¸­ï¼Œæ¨¡å‹çš„è¾“å‡ºå¯ä»¥å¤§è‡´åˆ†ä¸ºä¸¤ç±»ï¼š</p>
<ol>
<li>éç»“æ„åŒ–å“åº”(è‡ªç„¶è¯­è¨€)</li>
<li>ç»“æ„åŒ–å“åº”(ç¼–ç¨‹è¯­è¨€)</li>
</ol>
<h2 id="ç»“æ„åŒ–è¾“å‡ºçš„åº”ç”¨åœºæ™¯"><a href="#ç»“æ„åŒ–è¾“å‡ºçš„åº”ç”¨åœºæ™¯" class="headerlink" title="ç»“æ„åŒ–è¾“å‡ºçš„åº”ç”¨åœºæ™¯"></a>ç»“æ„åŒ–è¾“å‡ºçš„åº”ç”¨åœºæ™¯</h2><ol>
<li>æ•°æ®æå–å’Œå†…å®¹åˆ†ç±»</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä»ç®€å†æ–‡æœ¬ä¸­æå–ç»“æ„åŒ–ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ResumeParser</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ChatClient chatClient;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ResumeParser</span><span class="params">(ChatClient chatClient)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.chatClient = chatClient;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> ResumeData <span class="title function_">parseResume</span><span class="params">(String resumeText)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">prompt</span> <span class="operator">=</span> <span class="string">&quot;åˆ†æä»¥ä¸‹ç®€å†æ–‡æœ¬ï¼Œæå–å…³é”®ä¿¡æ¯ï¼š\n\n&quot;</span> + resumeText;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> chatClient.call(</span><br><span class="line">            prompt,</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">ResponseParser</span>&lt;&gt;(ResumeData.class)</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç»“æ„åŒ–æ•°æ®æ¨¡å‹</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ResumeData</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> PersonalInfo personalInfo;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Education&gt; education;</span><br><span class="line">    <span class="keyword">private</span> List&lt;WorkExperience&gt; workExperience;</span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; skills;</span><br><span class="line">    <span class="comment">// getters and setters</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>å†…å®¹è½¬æ¢ä¸æ ¼å¼åŒ–</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å°†åšå®¢æ–‡ç« è½¬æ¢ä¸ºç¤¾äº¤åª’ä½“æ‘˜è¦</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ContentConverter</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ChatClient chatClient;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ContentConverter</span><span class="params">(ChatClient chatClient)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.chatClient = chatClient;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> List&lt;SocialMediaPost&gt; <span class="title function_">convertBlogToSocialMedia</span><span class="params">(String blogContent)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">prompt</span> <span class="operator">=</span> <span class="string">&quot;å°†ä»¥ä¸‹åšå®¢æ–‡ç« è½¬æ¢ä¸º3ç§ä¸åŒçš„ç¤¾äº¤åª’ä½“å¹³å°çš„å¸–å­ï¼š\n\n&quot;</span> + blogContent;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> chatClient.call(</span><br><span class="line">            prompt,</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">ResponseParser</span>&lt;&gt;(<span class="keyword">new</span> <span class="title class_">TypeReference</span>&lt;List&lt;SocialMediaPost&gt;&gt;() &#123;&#125;)</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¤¾äº¤åª’ä½“å¸–å­ç»“æ„</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SocialMediaPost</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String platform; <span class="comment">// &quot;Twitter&quot;, &quot;LinkedIn&quot;, &quot;Facebook&quot;</span></span><br><span class="line">    <span class="keyword">private</span> String content;</span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; hashtags;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> estimatedReadTime;</span><br><span class="line">    <span class="comment">// getters and setters</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<ol start="3">
<li>æ•°æ®å¢å¼ºä¸ä¸°å¯Œ</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸ºäº§å“æè¿°å¢åŠ  SEO ç›¸å…³ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SeoEnhancer</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ChatClient chatClient;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SeoEnhancer</span><span class="params">(ChatClient chatClient)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.chatClient = chatClient;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> SeoData <span class="title function_">enhanceProductDescription</span><span class="params">(Product product)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">prompt</span> <span class="operator">=</span> String.format(</span><br><span class="line">            <span class="string">&quot;ä¸ºä»¥ä¸‹äº§å“ç”Ÿæˆ SEO ä¼˜åŒ–ä¿¡æ¯ï¼š\nåç§°ï¼š%s\næè¿°ï¼š%s\nç±»åˆ«ï¼š%s&quot;</span>,</span><br><span class="line">            product.getName(), product.getDescription(), product.getCategory()</span><br><span class="line">        );</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> chatClient.call(</span><br><span class="line">            prompt,</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">ResponseParser</span>&lt;&gt;(SeoData.class)</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// SEO æ•°æ®ç»“æ„</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SeoData</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String title; <span class="comment">// SEO ä¼˜åŒ–çš„æ ‡é¢˜</span></span><br><span class="line">    <span class="keyword">private</span> String metaDescription;</span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; keywords;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, String&gt; structuredData; <span class="comment">// JSON-LD æ ¼å¼</span></span><br><span class="line">    <span class="comment">// getters and setters</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>æ™ºèƒ½è¡¨å•å¡«å……</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä»ç”¨æˆ·æè¿°ä¸­å¡«å……è¡¨å•</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FormFiller</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ChatClient chatClient;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">FormFiller</span><span class="params">(ChatClient chatClient)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.chatClient = chatClient;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> BugReport <span class="title function_">extractBugReport</span><span class="params">(String userDescription)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> chatClient</span><br><span class="line">                .prompt()</span><br><span class="line">                .user(<span class="string">&quot;ä»ä»¥ä¸‹ç”¨æˆ·æè¿°ä¸­æå–bugæŠ¥å‘Šæ‰€éœ€çš„ç»“æ„åŒ–ä¿¡æ¯ï¼š\n\n&quot;</span> + userDescription)</span><br><span class="line">                .call()</span><br><span class="line">                .entity(BugReport.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Bug æŠ¥å‘Šç»“æ„</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BugReport</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="keyword">private</span> String description;</span><br><span class="line">    <span class="keyword">private</span> String browser;</span><br><span class="line">    <span class="keyword">private</span> String operatingSystem;</span><br><span class="line">    <span class="keyword">private</span> String reproducibilitySteps;</span><br><span class="line">    <span class="keyword">private</span> String severity;</span><br><span class="line">    <span class="keyword">private</span> String priority;</span><br><span class="line">    <span class="comment">// getters and setters</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ä½¿ç”¨ChatClientè·å–ç»“æ„åŒ–å“åº”"><a href="#ä½¿ç”¨ChatClientè·å–ç»“æ„åŒ–å“åº”" class="headerlink" title="ä½¿ç”¨ChatClientè·å–ç»“æ„åŒ–å“åº”"></a>ä½¿ç”¨ChatClientè·å–ç»“æ„åŒ–å“åº”</h2><p>Spring AIæä¾›äº†ç®€æ´çš„æ–¹æ³•æ¥è·å–ç»“æ„åŒ–JSONå“åº”ã€‚ä»¥ä¸‹æ˜¯å‡ ç§å¸¸ç”¨çš„æ–¹å¼ï¼š</p>
<ol>
<li>æ˜ç¡®æŒ‡å¯¼AIç”ŸæˆJSON<br>ä¸ºäº†å¢åŠ AIç”Ÿæˆæœ‰æ•ˆJSONçš„æ¦‚ç‡ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æç¤ºä¸­æä¾›æ˜ç¡®çš„æ ¼å¼æŒ‡å¯¼å’Œç¤ºä¾‹ï¼š</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Product <span class="title function_">getProductWithFormatGuidance</span><span class="params">(String productType)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">prompt</span> <span class="operator">=</span> String.format(<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        ç”Ÿæˆä¸€ä¸ª%säº§å“çš„è¯¦ç»†ä¿¡æ¯ï¼Œå¿…é¡»ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹JSONæ ¼å¼è¿”å›ï¼š</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">        &#123;</span></span><br><span class="line"><span class="string">          &quot;name&quot;: &quot;äº§å“åç§°&quot;,</span></span><br><span class="line"><span class="string">          &quot;price&quot;: æ•°å­—ç±»å‹çš„ä»·æ ¼,</span></span><br><span class="line"><span class="string">          &quot;description&quot;: &quot;äº§å“æè¿°&quot;,</span></span><br><span class="line"><span class="string">          &quot;features&quot;: [&quot;ç‰¹ç‚¹1&quot;, &quot;ç‰¹ç‚¹2&quot;, &quot;ç‰¹ç‚¹3&quot;],</span></span><br><span class="line"><span class="string">          &quot;specifications&quot;: &#123;</span></span><br><span class="line"><span class="string">            &quot;weight&quot;: &quot;é‡é‡&quot;,</span></span><br><span class="line"><span class="string">            &quot;dimensions&quot;: &quot;å°ºå¯¸&quot;,</span></span><br><span class="line"><span class="string">            &quot;material&quot;: &quot;æè´¨&quot;</span></span><br><span class="line"><span class="string">          &#125;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        ä¸è¦æ·»åŠ ä»»ä½•é¢å¤–çš„æ–‡æœ¬ã€è§£é‡Šæˆ–Markdownæ ¼å¼ï¼Œåªè¿”å›æœ‰æ•ˆçš„JSONå¯¹è±¡ã€‚</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span>, productType);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> chatClient.prompt()</span><br><span class="line">        .user(prompt)</span><br><span class="line">        .call()</span><br><span class="line">        .entity(Product.class);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>ä½¿ç”¨ç³»ç»Ÿæ¶ˆæ¯å¼•å¯¼è¾“å‡ºæ ¼å¼<br>ç³»ç»Ÿæ¶ˆæ¯æ˜¯å¼•å¯¼AIè¡Œä¸ºçš„æœ‰æ•ˆæ–¹å¼ï¼Œå¯ç”¨äºç¡®ä¿ç»“æ„åŒ–è¾“å‡ºï¼š</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Product <span class="title function_">getProductWithSystemMessage</span><span class="params">(String productType)</span> &#123;</span><br><span class="line">    <span class="type">SystemMessage</span> <span class="variable">systemMessage</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SystemMessage</span>(</span><br><span class="line">        <span class="string">&quot;ä½ æ˜¯ä¸€ä¸ªäº§å“ä¿¡æ¯ç”ŸæˆAPIã€‚ä½ åªèƒ½è¿”å›æœ‰æ•ˆçš„JSONæ ¼å¼æ•°æ®ï¼Œä¸èƒ½åŒ…å«ä»»ä½•å…¶ä»–æ–‡æœ¬ã€‚&quot;</span></span><br><span class="line">    );</span><br><span class="line">    </span><br><span class="line">    <span class="type">UserMessage</span> <span class="variable">userMessage</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserMessage</span>(</span><br><span class="line">        String.format(<span class="string">&quot;ç”Ÿæˆä¸€ä¸ª%säº§å“çš„è¯¦ç»†ä¿¡æ¯&quot;</span>, productType)</span><br><span class="line">    );</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> chatClient.prompt()</span><br><span class="line">        .system(<span class="string">&quot;ä½ æ˜¯ä¸€ä¸ªäº§å“ä¿¡æ¯ç”ŸæˆAPIã€‚ä½ åªèƒ½è¿”å›æœ‰æ•ˆçš„JSONæ ¼å¼æ•°æ®ï¼Œä¸èƒ½åŒ…å«ä»»ä½•å…¶ä»–æ–‡å­—ã€‚&quot;</span>)</span><br><span class="line">        .user(String.format(<span class="string">&quot;ç”Ÿæˆä¸€ä¸ª%säº§å“çš„è¯¦ç»†ä¿¡æ¯&quot;</span>, productType))</span><br><span class="line">        .call()</span><br><span class="line">        .entity(Product.class);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Javaå¯¹è±¡æ˜ å°„æŠ€æœ¯"><a href="#Javaå¯¹è±¡æ˜ å°„æŠ€æœ¯" class="headerlink" title="Javaå¯¹è±¡æ˜ å°„æŠ€æœ¯"></a>Javaå¯¹è±¡æ˜ å°„æŠ€æœ¯</h2><p>Spring AIåˆ©ç”¨Jacksonåº“è¿›è¡ŒJSONå’ŒJavaå¯¹è±¡ä¹‹é—´çš„æ˜ å°„ã€‚<br>äº†è§£ä¸€äº›å¸¸ç”¨çš„Jacksonæ³¨è§£å¯ä»¥å¸®åŠ©ä½ æ›´å¥½åœ°æ§åˆ¶æ˜ å°„è¿‡ç¨‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Product</span> &#123;</span><br><span class="line">    <span class="comment">// æŒ‡å®š JSON å±æ€§å</span></span><br><span class="line">    <span class="meta">@JsonProperty(&quot;product_name&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ ¼å¼åŒ–æ•°å€¼</span></span><br><span class="line">    <span class="meta">@JsonFormat(shape = JsonFormat.Shape.NUMBER_FLOAT, pattern = &quot;#.##&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> BigDecimal price;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¿½ç•¥æŸä¸ªå­—æ®µ</span></span><br><span class="line">    <span class="meta">@JsonIgnore</span></span><br><span class="line">    <span class="keyword">private</span> String internalId;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æŒ‡å®šæ—¥æœŸæ ¼å¼</span></span><br><span class="line">    <span class="meta">@JsonFormat(shape = JsonFormat.Shape.STRING, pattern = &quot;yyyy-MM-dd&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> LocalDate releaseDate;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ§åˆ¶åºåˆ—åŒ–å’Œååºåˆ—åŒ–è¡Œä¸º</span></span><br><span class="line">    <span class="meta">@JsonInclude(JsonInclude.Include.NON_NULL)</span></span><br><span class="line">    <span class="keyword">private</span> String optionalDescription;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// getters and setters</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¤„ç†ä¸åŒ¹é…å­—æ®µ<br>æœ‰æ—¶AIç”Ÿæˆçš„JSONå¯èƒ½åŒ…å«æˆ‘ä»¬æ¨¡å‹ä¸­ä¸å­˜åœ¨çš„å­—æ®µï¼Œæˆ–è€…ç¼ºå°‘æŸäº›å¿…è¦å­—æ®µã€‚<br>å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ³¨è§£æ¥å¤„ç†è¿™äº›æƒ…å†µï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¿½ç•¥æœªçŸ¥å±æ€§ï¼Œé˜²æ­¢ååºåˆ—åŒ–å¤±è´¥</span></span><br><span class="line"><span class="meta">@JsonIgnoreProperties(ignoreUnknown = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProductReview</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String reviewer;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> rating;</span><br><span class="line">    <span class="keyword">private</span> String comment;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è®¾ç½®é»˜è®¤å€¼ï¼Œå¤„ç†ç¼ºå¤±å­—æ®µ</span></span><br><span class="line">    <span class="meta">@JsonSetter(nulls = Nulls.SKIP)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; pros = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@JsonSetter(nulls = Nulls.SKIP)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; cons = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// getters and setters</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¤„ç†å¤šæ€ç±»å‹<br>å¯¹äºéœ€è¦æ ¹æ®ç±»å‹å­—æ®µåŠ¨æ€ç¡®å®šå…·ä½“ç±»çš„æƒ…å†µï¼Œå¯ä»¥ä½¿ç”¨å¤šæ€æ³¨è§£ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@JsonTypeInfo(</span></span><br><span class="line"><span class="meta">    use = JsonTypeInfo.Id.NAME,</span></span><br><span class="line"><span class="meta">    include = JsonTypeInfo.As.PROPERTY,</span></span><br><span class="line"><span class="meta">    property = &quot;type&quot;</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="meta">@JsonSubTypes(&#123;</span></span><br><span class="line"><span class="meta">    @JsonSubTypes.Type(value = PhysicalProduct.class, name = &quot;physical&quot;),</span></span><br><span class="line"><span class="meta">    @JsonSubTypes.Type(value = DigitalProduct.class, name = &quot;digital&quot;),</span></span><br><span class="line"><span class="meta">    @JsonSubTypes.Type(value = SubscriptionProduct.class, name = &quot;subscription&quot;)</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">BaseProduct</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> BigDecimal price;</span><br><span class="line">    <span class="comment">// common properties and methods</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PhysicalProduct</span> <span class="keyword">extends</span> <span class="title class_">BaseProduct</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String dimensions;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> weight;</span><br><span class="line">    <span class="keyword">private</span> String shippingMethod;</span><br><span class="line">    <span class="comment">// physical-specific properties</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DigitalProduct</span> <span class="keyword">extends</span> <span class="title class_">BaseProduct</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String downloadUrl;</span><br><span class="line">    <span class="keyword">private</span> String fileFormat;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> fileSizeInBytes;</span><br><span class="line">    <span class="comment">// digital-specific properties</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SubscriptionProduct</span> <span class="keyword">extends</span> <span class="title class_">BaseProduct</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String billingCycle;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> autoRenew;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> trialPeriodDays;</span><br><span class="line">    <span class="comment">// subscription-specific properties</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ä½¿ç”¨-JsonClassDescriptionæ³¨è§£"><a href="#ä½¿ç”¨-JsonClassDescriptionæ³¨è§£" class="headerlink" title="ä½¿ç”¨@JsonClassDescriptionæ³¨è§£"></a>ä½¿ç”¨<code>@JsonClassDescription</code>æ³¨è§£</h2><p>å¯ä»¥ä¸ºAIæä¾›å…³äºå¦‚ä½•ç”Ÿæˆä¸Javaç±»åŒ¹é…çš„JSONç»“æ„çš„æŒ‡å¯¼ã€‚<br>è¿™ä¸ªæ³¨è§£ç‰¹åˆ«é‡è¦ï¼Œå› ä¸ºå®ƒå¸®åŠ©AIæ¨¡å‹ç†è§£ä½ æœŸæœ›çš„è¾“å‡ºæ ¼å¼å’Œå†…å®¹ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@JsonClassDescription(&quot;è¡¨ç¤ºä¸€ä¸ªäº§å“çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…å«åç§°ã€ä»·æ ¼ã€æè¿°å’Œåˆ†ç±»&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Product</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@JsonPropertyDescription(&quot;äº§å“çš„å®Œæ•´åç§°ï¼Œåº”å½“ç®€æ´æ˜äº†ä¸”å…·æœ‰æè¿°æ€§&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@JsonPropertyDescription(&quot;äº§å“ä»·æ ¼ï¼Œä»¥å…ƒä¸ºå•ä½çš„æ•°å€¼ï¼Œä¸å«è´§å¸ç¬¦å·&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> BigDecimal price;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@JsonPropertyDescription(&quot;äº§å“çš„è¯¦ç»†æè¿°ï¼Œçªå‡ºäº§å“çš„ä¸»è¦ç‰¹ç‚¹å’Œä¼˜åŠ¿&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String description;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@JsonPropertyDescription(&quot;äº§å“çš„ä¸»è¦åˆ†ç±»ï¼Œå¦‚&#x27;ç”µå­äº§å“&#x27;ã€&#x27;å®¶å±…ç”¨å“&#x27;ç­‰&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String category;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// getters and setters</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åµŒå¥—å¯¹è±¡æè¿°<br>å¯¹äºåŒ…å«åµŒå¥—å¯¹è±¡çš„å¤æ‚ç±»ï¼Œæ¯ä¸ªåµŒå¥—ç±»ä¹Ÿå¯ä»¥æ·»åŠ æè¿°æ³¨è§£ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@JsonClassDescription(&quot;ç”µå­å•†åŠ¡ç³»ç»Ÿä¸­çš„å®Œæ•´äº§å“ä¿¡æ¯&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DetailedProduct</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@JsonPropertyDescription(&quot;äº§å“çš„åŸºæœ¬ä¿¡æ¯&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> ProductBasic basicInfo;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@JsonPropertyDescription(&quot;äº§å“çš„æŠ€æœ¯è§„æ ¼åˆ—è¡¨&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Specification&gt; specifications;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@JsonPropertyDescription(&quot;äº§å“çš„ä»·æ ¼ä¿¡æ¯ï¼ŒåŒ…æ‹¬æŠ˜æ‰£&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> PriceInfo priceInfo;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// getters and setters</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@JsonClassDescription(&quot;äº§å“çš„åŸºæœ¬ä¿¡æ¯&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProductBasic</span> &#123;</span><br><span class="line">    <span class="comment">// fields with descriptions</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@JsonClassDescription(&quot;äº§å“çš„æŠ€æœ¯è§„æ ¼&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Specification</span> &#123;</span><br><span class="line">    <span class="comment">// fields with descriptions</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@JsonClassDescription(&quot;äº§å“çš„ä»·æ ¼ä¿¡æ¯&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PriceInfo</span> &#123;</span><br><span class="line">    <span class="comment">// fields with descriptions</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨æç¤ºä¸­ä½¿ç”¨ç±»æè¿°<br>ä½¿ç”¨æ³¨è§£åï¼ŒSpring AIä¼šè‡ªåŠ¨å°†è¿™äº›æè¿°ä¿¡æ¯çº³å…¥æç¤ºï¼ŒæŒ‡å¯¼AIç”Ÿæˆç¬¦åˆé¢„æœŸçš„JSON:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProductGenerationService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ChatClient chatClient;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ProductGenerationService</span><span class="params">(ChatClient chatClient)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.chatClient = chatClient;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> DetailedProduct <span class="title function_">generateDetailedProduct</span><span class="params">(String productType)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">prompt</span> <span class="operator">=</span> <span class="string">&quot;ä¸º&quot;</span> + productType + <span class="string">&quot;ç”Ÿæˆä¸€ä¸ªè¯¦ç»†çš„äº§å“ä¿¡æ¯ã€‚&quot;</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> chatClient.prompt()</span><br><span class="line">            .user(prompt)</span><br><span class="line">            .call()</span><br><span class="line">            .entity(DetailedProduct.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="å¤„ç†å¤æ‚çš„åµŒå¥—æ•°æ®ç»“æ„"><a href="#å¤„ç†å¤æ‚çš„åµŒå¥—æ•°æ®ç»“æ„" class="headerlink" title="å¤„ç†å¤æ‚çš„åµŒå¥—æ•°æ®ç»“æ„"></a>å¤„ç†å¤æ‚çš„åµŒå¥—æ•°æ®ç»“æ„</h2><p>å®é™…åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦å¤„ç†å…·æœ‰å¤šå±‚åµŒå¥—çš„å¤æ‚æ•°æ®ç»“æ„ã€‚<br>è€ŒSpringAIæä¾›äº†å¯å¤„ç†è¿™ç±»åµŒå¥—æ•°æ®ç»“æ„æƒ…å†µã€‚<br>åµŒå¥—å¯¹è±¡å’Œé›†åˆ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@JsonClassDescription(&quot;ä»£è¡¨ä¸€ä¸ªç”µå­å•†åŠ¡ç½‘ç«™çš„å®Œæ•´äº§å“ç›®å½•&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProductCatalog</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@JsonPropertyDescription(&quot;ç›®å½•çš„åç§°&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@JsonPropertyDescription(&quot;ç›®å½•çš„æœ€åæ›´æ–°æ—¶é—´ï¼Œæ ¼å¼ä¸ºISO-8601&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime lastUpdated;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@JsonPropertyDescription(&quot;äº§å“ç±»åˆ«åˆ—è¡¨ï¼ŒæŒ‰ç…§ç±»åˆ«ç»„ç»‡äº§å“&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;ProductCategory&gt; categories;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// getters and setters</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@JsonClassDescription(&quot;äº§å“ç±»åˆ«ï¼ŒåŒ…å«è¯¥ç±»åˆ«ä¸‹çš„æ‰€æœ‰äº§å“&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProductCategory</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@JsonPropertyDescription(&quot;ç±»åˆ«çš„å”¯ä¸€æ ‡è¯†ç¬¦&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@JsonPropertyDescription(&quot;ç±»åˆ«çš„æ˜¾ç¤ºåç§°&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@JsonPropertyDescription(&quot;è¯¥ç±»åˆ«çš„ç®€çŸ­æè¿°&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String description;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@JsonPropertyDescription(&quot;è¯¥ç±»åˆ«ä¸‹çš„æ‰€æœ‰äº§å“&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;DetailedProduct&gt; products;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@JsonPropertyDescription(&quot;å­ç±»åˆ«åˆ—è¡¨&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;ProductCategory&gt; subCategories;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// getters and setters</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¤„ç†åŠ¨æ€å±æ€§<br>æœ‰æ—¶æˆ‘ä»¬éœ€è¦å¤„ç†ä¸ç¡®å®šçš„å±æ€§åï¼Œä¾‹å¦‚å­˜å‚¨äº§å“çš„è‡ªå®šä¹‰å±æ€§ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomProduct</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> BigDecimal price;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä½¿ç”¨ Map å¤„ç†åŠ¨æ€å±æ€§</span></span><br><span class="line">    <span class="meta">@JsonPropertyDescription(&quot;äº§å“çš„è‡ªå®šä¹‰å±æ€§ï¼Œé”®ä¸ºå±æ€§åï¼Œå€¼ä¸ºå±æ€§å€¼&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, Object&gt; customAttributes;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// getters and setters</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¤„ç†å¤æ‚çš„å“åº”ç»“æ„<br>å¯¹äºéå¸¸å¤æ‚çš„ç»“æ„ï¼Œå¯ä»¥ä½¿ç”¨ç»„åˆè®¾è®¡æ¨¡å¼å’ŒæŠ½è±¡ç±»&#x2F;æ¥å£</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@JsonTypeInfo(use = JsonTypeInfo.Id.NAME, property = &quot;type&quot;)</span></span><br><span class="line"><span class="meta">@JsonSubTypes(&#123;</span></span><br><span class="line"><span class="meta">    @JsonSubTypes.Type(value = TextBlock.class, name = &quot;text&quot;),</span></span><br><span class="line"><span class="meta">    @JsonSubTypes.Type(value = ImageBlock.class, name = &quot;image&quot;),</span></span><br><span class="line"><span class="meta">    @JsonSubTypes.Type(value = TableBlock.class, name = &quot;table&quot;),</span></span><br><span class="line"><span class="meta">    @JsonSubTypes.Type(value = ListBlock.class, name = &quot;list&quot;)</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">ContentBlock</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line">    <span class="keyword">private</span> String type;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, Object&gt; metadata;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// common methods</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸åŒç±»å‹çš„å†…å®¹å—å®ç°...</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TextBlock</span> <span class="keyword">extends</span> <span class="title class_">ContentBlock</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String text;</span><br><span class="line">    <span class="keyword">private</span> String formatting;</span><br><span class="line">    <span class="comment">// text-specific methods</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ImageBlock</span> <span class="keyword">extends</span> <span class="title class_">ContentBlock</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String url;</span><br><span class="line">    <span class="keyword">private</span> String altText;</span><br><span class="line">    <span class="keyword">private</span> Dimensions dimensions;</span><br><span class="line">    <span class="comment">// image-specific methods</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TableBlock</span> <span class="keyword">extends</span> <span class="title class_">ContentBlock</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;List&lt;String&gt;&gt; cells;</span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; headers;</span><br><span class="line">    <span class="comment">// table-specific methods</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ListBlock</span> <span class="keyword">extends</span> <span class="title class_">ContentBlock</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; items;</span><br><span class="line">    <span class="keyword">private</span> String listType; <span class="comment">// bullet, numbered, etc.</span></span><br><span class="line">    <span class="comment">// list-specific methods</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ç¬¬å››æ¬¡å®è·µ"><a href="#ç¬¬å››æ¬¡å®è·µ" class="headerlink" title="ç¬¬å››æ¬¡å®è·µ"></a>ç¬¬å››æ¬¡å®è·µ</h2><p>å¼€å‘AIäº§å“æ¨èç³»ç»Ÿ<br>è¯¥ç³»ç»Ÿå°†æ ¹æ®ç”¨æˆ·çš„åå¥½å’Œå†å²è¡Œä¸ºï¼Œç”Ÿæˆä¸ªæ€§åŒ–çš„äº§å“æ¨èã€‚</p>
<ol>
<li>å®šä¹‰æ•°æ®æ¨¡å‹</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@JsonClassDescription(&quot;ç”¨æˆ·ä¿¡æ¯&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@JsonPropertyDescription(&quot;ç”¨æˆ·çš„å®Œæ•´å§“å&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@JsonPropertyDescription(&quot;ç”¨æˆ·çš„å¹´é¾„&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@JsonPropertyDescription(&quot;ç”¨æˆ·çš„æ€§åˆ«ï¼Œå¦‚&#x27;ç”·&#x27;ã€&#x27;å¥³&#x27;æˆ–&#x27;å…¶ä»–&#x27;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String gender;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@JsonPropertyDescription(&quot;ç”¨æˆ·çš„å…´è¶£çˆ±å¥½åˆ—è¡¨&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; interests;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// getters and setters</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@JsonClassDescription(&quot;äº§å“æ¨èè¯·æ±‚&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RecommendationRequest</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@JsonPropertyDescription(&quot;ç”¨æˆ·ä¿¡æ¯&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> User user;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@JsonPropertyDescription(&quot;è¦æ¨èçš„äº§å“ç±»åˆ«&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String category;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@JsonPropertyDescription(&quot;æ¨èäº§å“çš„æ•°é‡&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> count;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@JsonPropertyDescription(&quot;ç”¨æˆ·çš„å†å²è´­ä¹°è®°å½•&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; purchaseHistory;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// getters and setters</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@JsonClassDescription(&quot;äº§å“æ¨èç»“æœ&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RecommendationResponse</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@JsonPropertyDescription(&quot;æ¨èçš„äº§å“åˆ—è¡¨&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;RecommendedProduct&gt; recommendations;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@JsonPropertyDescription(&quot;æ¨èçš„ä¾æ®æˆ–åŸå› &quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String reasonForRecommendations;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// getters and setters</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@JsonClassDescription(&quot;æ¨èçš„äº§å“ä¿¡æ¯&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RecommendedProduct</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@JsonPropertyDescription(&quot;äº§å“çš„å”¯ä¸€æ ‡è¯†ç¬¦&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@JsonPropertyDescription(&quot;äº§å“åç§°&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@JsonPropertyDescription(&quot;äº§å“æè¿°&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String description;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@JsonPropertyDescription(&quot;äº§å“ä»·æ ¼&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> BigDecimal price;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@JsonPropertyDescription(&quot;äº§å“æ¨èç†ç”±&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String recommendationReason;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@JsonPropertyDescription(&quot;ä¸ç”¨æˆ·å…´è¶£çš„åŒ¹é…åº¦ï¼Œ1-5åˆ†&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> matchScore;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// getters and setters</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>å®ç°æ¨èæœåŠ¡</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProductRecommendationService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ChatClient chatClient;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ProductRecommendationService</span><span class="params">(ChatClient chatClient)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.chatClient = chatClient;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> RecommendationResponse <span class="title function_">getRecommendations</span><span class="params">(RecommendationRequest request)</span> &#123;</span><br><span class="line">        <span class="comment">// æ„å»ºç³»ç»Ÿæ¶ˆæ¯</span></span><br><span class="line">        <span class="type">SystemMessage</span> <span class="variable">systemMessage</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SystemMessage</span>(</span><br><span class="line">            <span class="string">&quot;ä½ æ˜¯ä»£ç å°æŠ„çš„äº§å“æ¨èä¸“å®¶ã€‚æ ¹æ®ç”¨æˆ·ä¿¡æ¯å’Œå†å²è´­ä¹°è®°å½•æä¾›ä¸ªæ€§åŒ–äº§å“æ¨èã€‚&quot;</span> +</span><br><span class="line">            <span class="string">&quot;ç¡®ä¿æ¨èç†ç”±åˆç†ä¸”ç¬¦åˆç”¨æˆ·ç‰¹å¾ã€‚è¿”å›çš„æ‰€æœ‰æ¨èéƒ½å¿…é¡»æ˜¯JSONæ ¼å¼ã€‚&quot;</span></span><br><span class="line">        );</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ„å»ºç”¨æˆ·æ¶ˆæ¯</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">userMessageContent</span> <span class="operator">=</span> String.format(</span><br><span class="line">            <span class="string">&quot;è¯·ä¸ºä»¥ä¸‹ç”¨æˆ·æ¨è%dä¸ª%sç±»åˆ«çš„äº§å“ï¼š\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;ç”¨æˆ·å: %s\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;å¹´é¾„: %d\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;æ€§åˆ«: %s\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;å…´è¶£çˆ±å¥½: %s\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;å†å²è´­ä¹°: %s&quot;</span>,</span><br><span class="line">            request.getCount(),</span><br><span class="line">            request.getCategory(),</span><br><span class="line">            request.getUser().getName(),</span><br><span class="line">            request.getUser().getAge(),</span><br><span class="line">            request.getUser().getGender(),</span><br><span class="line">            String.join(<span class="string">&quot;, &quot;</span>, request.getUser().getInterests()),</span><br><span class="line">            String.join(<span class="string">&quot;, &quot;</span>, request.getPurchaseHistory())</span><br><span class="line">        );</span><br><span class="line">        <span class="type">UserMessage</span> <span class="variable">userMessage</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserMessage</span>(userMessageContent);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ„å»ºæç¤ºå¹¶è°ƒç”¨ AI</span></span><br><span class="line">        <span class="keyword">return</span> chatClient.prompt()</span><br><span class="line">            .system(<span class="string">&quot;ä½ æ˜¯ä»£ç å°æŠ„çš„äº§å“æ¨èä¸“å®¶ã€‚æ ¹æ®ç”¨æˆ·ä¿¡æ¯å’Œå†å²è´­ä¹°è®°å½•æä¾›ä¸ªæ€§åŒ–äº§å“æ¨èã€‚&quot;</span> +</span><br><span class="line">                    <span class="string">&quot;ç¡®ä¿æ¨èç†ç”±åˆç†ä¸”ç¬¦åˆç”¨æˆ·ç‰¹å¾ã€‚è¿”å›çš„æ‰€æœ‰æ¨èéƒ½å¿…é¡»æ˜¯JSONæ ¼å¼ã€‚&quot;</span>)</span><br><span class="line">            .user(userMessageContent)</span><br><span class="line">            .call()</span><br><span class="line">            .entity(RecommendationResponse.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>åˆ›å»ºæ§åˆ¶å™¨(RESTæ§åˆ¶å™¨æš´éœ²API)</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/recommendations&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RecommendationController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ProductRecommendationService recommendationService;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">RecommendationController</span><span class="params">(ProductRecommendationService recommendationService)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.recommendationService = recommendationService;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;RecommendationResponse&gt; <span class="title function_">getRecommendations</span><span class="params">(<span class="meta">@RequestBody</span> RecommendationRequest request)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">RecommendationResponse</span> <span class="variable">response</span> <span class="operator">=</span> recommendationService.getRecommendations(request);</span><br><span class="line">            <span class="keyword">return</span> ResponseEntity.ok(response);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="comment">// é”™è¯¯å¤„ç†</span></span><br><span class="line">            <span class="keyword">return</span> ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR).build();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping(&quot;/sample&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;RecommendationRequest&gt; <span class="title function_">getSampleRequest</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºä¸€ä¸ªæ ·ä¾‹è¯·æ±‚ï¼Œç”¨äºç¤ºä¾‹</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        user.setName(<span class="string">&quot;å¾®å…‰zc&quot;</span>);</span><br><span class="line">        user.setAge(<span class="number">22</span>);</span><br><span class="line">        user.setGender(<span class="string">&quot;ç”·&quot;</span>);</span><br><span class="line">        user.setInterests(Arrays.asList(<span class="string">&quot;ç¼–ç¨‹&quot;</span>, <span class="string">&quot;æŠ€æœ¯åšå®¢&quot;</span>, <span class="string">&quot;å¼€æºé¡¹ç›®&quot;</span>, <span class="string">&quot;ç®—æ³•&quot;</span>));</span><br><span class="line">        </span><br><span class="line">        <span class="type">RecommendationRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RecommendationRequest</span>();</span><br><span class="line">        request.setUser(user);</span><br><span class="line">        request.setCategory(<span class="string">&quot;ç¼–ç¨‹å·¥å…·&quot;</span>);</span><br><span class="line">        request.setCount(<span class="number">3</span>);</span><br><span class="line">        request.setPurchaseHistory(Arrays.asList(<span class="string">&quot;Javaç¼–ç¨‹æŒ‡å—&quot;</span>, <span class="string">&quot;ç®—æ³•å¯¼è®º&quot;</span>, <span class="string">&quot;è®¾è®¡æ¨¡å¼&quot;</span>));</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(request);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>æµ‹è¯•ç³»ç»Ÿ<br>å‘&#x2F;api&#x2F;recommendationsç«¯ç‚¹å‘é€POSTè¯·æ±‚ï¼š</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;user&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;å¾®å…‰zc&quot;</span>,</span><br><span class="line">    <span class="string">&quot;age&quot;</span>: <span class="number">22</span>,</span><br><span class="line">    <span class="string">&quot;gender&quot;</span>: <span class="string">&quot;ç”·&quot;</span>,</span><br><span class="line">    <span class="string">&quot;interests&quot;</span>: [<span class="string">&quot;ç¼–ç¨‹&quot;</span>, <span class="string">&quot;æŠ€æœ¯åšå®¢&quot;</span>, <span class="string">&quot;å¼€æºé¡¹ç›®&quot;</span>, <span class="string">&quot;ç®—æ³•&quot;</span>]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;category&quot;</span>: <span class="string">&quot;ç¼–ç¨‹å·¥å…·&quot;</span>,</span><br><span class="line">  <span class="string">&quot;count&quot;</span>: <span class="number">3</span>,</span><br><span class="line">  <span class="string">&quot;purchaseHistory&quot;</span>: [<span class="string">&quot;Javaç¼–ç¨‹æŒ‡å—&quot;</span>, <span class="string">&quot;ç®—æ³•å¯¼è®º&quot;</span>, <span class="string">&quot;è®¾è®¡æ¨¡å¼&quot;</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨pythonæˆ–postmanå‘é€è¯·æ±‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://localhost:8080/api/recommendations&quot;</span></span><br><span class="line">data = &#123;</span><br><span class="line">        <span class="string">&quot;user&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;name&quot;</span>: <span class="string">&quot;å¾®å…‰zc&quot;</span>,</span><br><span class="line">            <span class="string">&quot;age&quot;</span>: <span class="number">22</span>,</span><br><span class="line">            <span class="string">&quot;gender&quot;</span>: <span class="string">&quot;ç”·&quot;</span>,</span><br><span class="line">            <span class="string">&quot;interests&quot;</span>: [<span class="string">&quot;ç¼–ç¨‹&quot;</span>, <span class="string">&quot;æŠ€æœ¯åšå®¢&quot;</span>, <span class="string">&quot;å¼€æºé¡¹ç›®&quot;</span>, <span class="string">&quot;ç®—æ³•&quot;</span>]</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;category&quot;</span>: <span class="string">&quot;ç¼–ç¨‹å·¥å…·&quot;</span>,</span><br><span class="line">        <span class="string">&quot;count&quot;</span>: <span class="number">3</span>,</span><br><span class="line">        <span class="string">&quot;purchaseHistory&quot;</span>: [<span class="string">&quot;Javaç¼–ç¨‹æŒ‡å—&quot;</span>, <span class="string">&quot;ç®—æ³•å¯¼è®º&quot;</span>, <span class="string">&quot;è®¾è®¡æ¨¡å¼&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">response = requests.post(url, json=data)</span><br><span class="line"><span class="built_in">print</span>(response.status_code)</span><br><span class="line"><span class="built_in">print</span>(response.json())</span><br></pre></td></tr></table></figure>

<p>ç³»ç»Ÿå°†è¿”å›ç±»ä¼¼ä»¥ä¸‹çš„ç»“æ„åŒ–å“åº”ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;recommendations&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;id&quot;</span>: <span class="string">&quot;tool-001&quot;</span>,</span><br><span class="line">      <span class="string">&quot;name&quot;</span>: <span class="string">&quot;IntelliJ IDEA æ——èˆ°ç‰ˆ&quot;</span>,</span><br><span class="line">      <span class="string">&quot;description&quot;</span>: <span class="string">&quot;å¼ºå¤§çš„ Java é›†æˆå¼€å‘ç¯å¢ƒï¼Œæä¾›æ™ºèƒ½ä»£ç è¡¥å…¨ã€é‡æ„å·¥å…·å’Œæ·±åº¦é™æ€åˆ†æã€‚&quot;</span>,</span><br><span class="line">      <span class="string">&quot;price&quot;</span>: <span class="number">1999.00</span>,</span><br><span class="line">      <span class="string">&quot;recommendationReason&quot;</span>: <span class="string">&quot;ä½œä¸ºä¸€åå…³æ³¨ç¼–ç¨‹å’Œå¼€æºé¡¹ç›®çš„ç¨‹åºå‘˜ï¼Œé«˜æ•ˆçš„ IDE èƒ½æ˜¾è‘—æå‡ç¼–ç æ•ˆç‡ã€‚å†å²è´­ä¹°æ˜¾ç¤ºå¯¹ Java æœ‰æµ“åšå…´è¶£ã€‚&quot;</span>,</span><br><span class="line">      <span class="string">&quot;matchScore&quot;</span>: <span class="number">5</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;id&quot;</span>: <span class="string">&quot;tool-002&quot;</span>,</span><br><span class="line">      <span class="string">&quot;name&quot;</span>: <span class="string">&quot;ç®—æ³•å¯¼èˆª Pro ä¼šå‘˜&quot;</span>,</span><br><span class="line">      <span class="string">&quot;description&quot;</span>: <span class="string">&quot;ä¸€ä¸ªä¸“æ³¨äºç®—æ³•å¯è§†åŒ–å’Œå­¦ä¹ çš„å¹³å°ï¼ŒåŒ…å«å¤§é‡äº’åŠ¨ç»ƒä¹ å’Œç«èµ›é¢˜ç›®ã€‚&quot;</span>,</span><br><span class="line">      <span class="string">&quot;price&quot;</span>: <span class="number">299.00</span>,</span><br><span class="line">      <span class="string">&quot;recommendationReason&quot;</span>: <span class="string">&quot;æ ¹æ®ç”¨æˆ·å¯¹ç®—æ³•çš„å…´è¶£å’Œè´­ä¹°å†å²ä¸­çš„ã€Šç®—æ³•å¯¼è®ºã€‹ï¼Œè¿™ä¸ªå·¥å…·å¯ä»¥å¸®åŠ©ç”¨æˆ·æ·±å…¥ç†è§£å’Œå®è·µç®—æ³•ã€‚&quot;</span>,</span><br><span class="line">      <span class="string">&quot;matchScore&quot;</span>: <span class="number">5</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;id&quot;</span>: <span class="string">&quot;tool-003&quot;</span>,</span><br><span class="line">      <span class="string">&quot;name&quot;</span>: <span class="string">&quot;ä»£ç å°æŠ„ Premium&quot;</span>,</span><br><span class="line">      <span class="string">&quot;description&quot;</span>: <span class="string">&quot;ä»£ç ç‰‡æ®µç®¡ç†å’Œåˆ†äº«å·¥å…·ï¼Œæ”¯æŒå¤šç§ç¼–ç¨‹è¯­è¨€çš„è¯­æ³•é«˜äº®å’Œç‰ˆæœ¬æ§åˆ¶ã€‚&quot;</span>,</span><br><span class="line">      <span class="string">&quot;price&quot;</span>: <span class="number">199.00</span>,</span><br><span class="line">      <span class="string">&quot;recommendationReason&quot;</span>: <span class="string">&quot;ä½œä¸ºæŠ€æœ¯åšä¸»å’Œå¼€æºé¡¹ç›®çˆ±å¥½è€…ï¼Œè¿™ä¸ªå·¥å…·å¯ä»¥å¸®åŠ©æ•´ç†å’Œåˆ†äº«ä»£ç ç‰‡æ®µï¼Œæé«˜å·¥ä½œæ•ˆç‡ã€‚&quot;</span>,</span><br><span class="line">      <span class="string">&quot;matchScore&quot;</span>: <span class="number">4</span></span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="string">&quot;reasonForRecommendations&quot;</span>: <span class="string">&quot;åŸºäºç”¨æˆ·çš„ç¼–ç¨‹èƒŒæ™¯ã€ç®—æ³•å…´è¶£å’ŒJavaå­¦ä¹ æ–¹å‘ï¼Œæ¨èäº†æå‡å¼€å‘æ•ˆç‡çš„IDEã€æ·±åŒ–ç®—æ³•å­¦ä¹ çš„å¹³å°å’Œä»£ç ç®¡ç†å·¥å…·ã€‚&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="å‘é‡æ•°æ®åº“"><a href="#å‘é‡æ•°æ®åº“" class="headerlink" title="å‘é‡æ•°æ®åº“"></a>å‘é‡æ•°æ®åº“</h1><h2 id="åµŒå…¥-Embedding-çš„æ¦‚å¿µè§£æ"><a href="#åµŒå…¥-Embedding-çš„æ¦‚å¿µè§£æ" class="headerlink" title="åµŒå…¥(Embedding)çš„æ¦‚å¿µè§£æ"></a>åµŒå…¥(Embedding)çš„æ¦‚å¿µè§£æ</h2><p>åµŒå…¥(Embedding)æ˜¯AIé¢†åŸŸçš„æ ¸å¿ƒæ¦‚å¿µ(å‘é‡æ•°æ®åº“çš„åŸºç¡€)<br>æ˜¯å°†å¤æ‚æ•°æ®ï¼ˆå¦‚æ–‡æœ¬ã€å›¾åƒã€éŸ³é¢‘ç­‰ï¼‰è½¬æ¢ä¸ºå¯†é›†çš„æ•°å€¼å‘é‡çš„è¿‡ç¨‹ã€‚<br>è¿™äº›å‘é‡èƒ½å¤Ÿæ•è·åŸå§‹æ•°æ®çš„è¯­ä¹‰ä¿¡æ¯ï¼Œä½¿å¾—è¯­ä¹‰ç›¸ä¼¼çš„å†…å®¹åœ¨å‘é‡ç©ºé—´ä¸­å½¼æ­¤é è¿‘ã€‚</p>
<p>åµŒå…¥çš„å·¥ä½œåŸç†<br>åµŒå…¥æ¨¡å‹é€šè¿‡æ·±åº¦å­¦ä¹ è®­ç»ƒå¦‚ä½•å°†è¾“å…¥æ•°æ®æ˜ å°„åˆ°ä¸€ä¸ªé«˜ç»´å‘é‡ç©ºé—´ã€‚<br>åœ¨è¿™ä¸ªç©ºé—´ä¸­ï¼š</p>
<ul>
<li>ç›¸ä¼¼çš„æ¦‚å¿µæ‹¥æœ‰ç›¸ä¼¼çš„å‘é‡è¡¨ç¤º</li>
<li>å‘é‡é—´çš„è·ç¦»ï¼ˆå¦‚æ¬§å‡ é‡Œå¾—è·ç¦»ã€ä½™å¼¦è·ç¦»ï¼‰åæ˜ äº†åŸå§‹æ•°æ®çš„è¯­ä¹‰å·®å¼‚</li>
<li>å‘é‡å¯ä»¥ç”¨äºæ•°å­¦è¿ç®—ï¼Œæ”¯æŒè¯­ä¹‰ç»„åˆå’Œæ¯”è¾ƒ</li>
</ul>
<p>ä¸åŒç±»å‹çš„åµŒå…¥</p>
<ol>
<li>æ–‡æœ¬åµŒå…¥ï¼šå°†å•è¯ã€å¥å­æˆ–æ–‡æ¡£è½¬æ¢ä¸ºå‘é‡ï¼ˆå¦‚Word2Vecã€GloVeã€BERTã€GPT)ã€‚</li>
<li>å›¾åƒåµŒå…¥ï¼šå°†å›¾åƒè½¬æ¢ä¸ºå‘é‡ï¼ˆå¦‚ResNetã€VGGã€CLIP)ã€‚</li>
<li>å¤šæ¨¡æ€åµŒå…¥ï¼šå°†ä¸åŒç±»å‹çš„æ•°æ®æ˜ å°„åˆ°åŒä¸€å‘é‡ç©ºé—´ã€‚</li>
</ol>
<p>å¸¸è§å‘é‡æ•°æ®åº“ä»‹ç»</p>
<ul>
<li>PostgreSQL + pgvector</li>
<li>Redis + RediSearch</li>
<li>Milvus(å¼€æºä¸“ç”¨)</li>
<li>Pinecone</li>
<li>Elasticsearch + KNN</li>
</ul>
<h2 id="Spring-AIä¸­çš„å‘é‡å­˜å‚¨æŠ½è±¡"><a href="#Spring-AIä¸­çš„å‘é‡å­˜å‚¨æŠ½è±¡" class="headerlink" title="Spring AIä¸­çš„å‘é‡å­˜å‚¨æŠ½è±¡"></a>Spring AIä¸­çš„å‘é‡å­˜å‚¨æŠ½è±¡</h2><p>Spring AIæä¾›äº†ä¸€ä¸ªç»Ÿä¸€çš„æŠ½è±¡å±‚ä»¥ä¸€è‡´çš„æ–¹å¼ä½¿ç”¨ä¸åŒçš„å‘é‡æ•°æ®åº“ã€‚</p>
<p>VectorStoreæ¥å£<br>VectorStoreæ˜¯Spring AIä¸­å‘é‡å­˜å‚¨çš„æ ¸å¿ƒæ¥å£ï¼Œç»§æ‰¿è‡ªDocumentWriteræ¥å£ï¼Œå®šä¹‰äº†å‘é‡æ•°æ®çš„åŸºæœ¬æ“ä½œï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">VectorStore</span> <span class="keyword">extends</span> <span class="title class_">DocumentWriter</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è·å–å‘é‡å­˜å‚¨çš„åç§°</span></span><br><span class="line">    <span class="keyword">default</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.getClass().getSimpleName();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ·»åŠ æ–‡æ¡£åˆ°å‘é‡å­˜å‚¨</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(List&lt;Document&gt; documents)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å®ç°DocumentWriteræ¥å£</span></span><br><span class="line">    <span class="keyword">default</span> <span class="keyword">void</span> <span class="title function_">accept</span><span class="params">(List&lt;Document&gt; documents)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.add(documents);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ ¹æ®IDåˆ—è¡¨åˆ é™¤å‘é‡</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">delete</span><span class="params">(List&lt;String&gt; idList)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä½¿ç”¨è¿‡æ»¤è¡¨è¾¾å¼åˆ é™¤å‘é‡</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">delete</span><span class="params">(Filter.Expression filterExpression)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä½¿ç”¨å­—ç¬¦ä¸²è¿‡æ»¤è¡¨è¾¾å¼åˆ é™¤å‘é‡</span></span><br><span class="line">    <span class="keyword">default</span> <span class="keyword">void</span> <span class="title function_">delete</span><span class="params">(String filterExpression)</span> &#123;</span><br><span class="line">        <span class="type">SearchRequest</span> <span class="variable">searchRequest</span> <span class="operator">=</span> SearchRequest.builder().filterExpression(filterExpression).build();</span><br><span class="line">        Filter.<span class="type">Expression</span> <span class="variable">textExpression</span> <span class="operator">=</span> searchRequest.getFilterExpression();</span><br><span class="line">        Assert.notNull(textExpression, <span class="string">&quot;Filter expression must not be null&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.delete(textExpression);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä½¿ç”¨æœç´¢è¯·æ±‚è¿›è¡Œç›¸ä¼¼åº¦æœç´¢</span></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    List&lt;Document&gt; <span class="title function_">similaritySearch</span><span class="params">(SearchRequest request)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä½¿ç”¨æŸ¥è¯¢å­—ç¬¦ä¸²è¿›è¡Œç›¸ä¼¼åº¦æœç´¢</span></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="keyword">default</span> List&lt;Document&gt; <span class="title function_">similaritySearch</span><span class="params">(String query)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.similaritySearch(SearchRequest.builder().query(query).build());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è·å–åŸç”Ÿå®¢æˆ·ç«¯</span></span><br><span class="line">    <span class="keyword">default</span> &lt;T&gt; Optional&lt;T&gt; <span class="title function_">getNativeClient</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Optional.empty();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ„å»ºå™¨æ¥å£</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Builder</span>&lt;T <span class="keyword">extends</span> <span class="title class_">Builder</span>&lt;T&gt;&gt; &#123;</span><br><span class="line">        T <span class="title function_">observationRegistry</span><span class="params">(ObservationRegistry observationRegistry)</span>;</span><br><span class="line">        </span><br><span class="line">        T <span class="title function_">customObservationConvention</span><span class="params">(VectorStoreObservationConvention convention)</span>;</span><br><span class="line">        </span><br><span class="line">        T <span class="title function_">batchingStrategy</span><span class="params">(BatchingStrategy batchingStrategy)</span>;</span><br><span class="line">        </span><br><span class="line">        VectorStore <span class="title function_">build</span><span class="params">()</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœç´¢è¯·æ±‚æ„å»º<br>Spring AIæä¾›äº†SearchRequestç±»ï¼Œç”¨äºæ„å»ºç›¸ä¼¼åº¦æœç´¢è¯·æ±‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">SearchRequest</span> <span class="variable">request</span> <span class="operator">=</span> SearchRequest.builder()</span><br><span class="line">    .query(<span class="string">&quot;ä»€ä¹ˆæ˜¯ç¨‹åºå‘˜é±¼çš®çš„ç¼–ç¨‹å¯¼èˆªå­¦ä¹ ç½‘ codefather.cnï¼Ÿ&quot;</span>)</span><br><span class="line">    .topK(<span class="number">5</span>)                  <span class="comment">// è¿”å›æœ€ç›¸ä¼¼çš„5ä¸ªç»“æœ</span></span><br><span class="line">    .similarityThreshold(<span class="number">0.7</span>) <span class="comment">// ç›¸ä¼¼åº¦é˜ˆå€¼ï¼Œ0.0-1.0ä¹‹é—´</span></span><br><span class="line">    .filterExpression(<span class="string">&quot;category == &#x27;web&#x27; AND date &gt; &#x27;2025-05-03&#x27;&quot;</span>)  <span class="comment">// è¿‡æ»¤è¡¨è¾¾å¼</span></span><br><span class="line">    .build();</span><br><span class="line"></span><br><span class="line">List&lt;Document&gt; results = vectorStore.similaritySearch(request);</span><br></pre></td></tr></table></figure>
<p>SearchRequestæä¾›äº†å¤šç§é…ç½®é€‰é¡¹ï¼š</p>
<ol>
<li>query:æœç´¢çš„æŸ¥è¯¢æ–‡æœ¬</li>
<li>topK:è¿”å›çš„æœ€å¤§ç»“æœæ•°ï¼Œé»˜è®¤ä¸º4</li>
<li>similarityThreshold:ç›¸ä¼¼åº¦é˜ˆå€¼ï¼Œä½äºæ­¤å€¼çš„ç»“æœä¼šè¢«è¿‡æ»¤æ‰</li>
<li>filterExpression:åŸºäºæ–‡æ¡£å…ƒæ•°æ®çš„è¿‡æ»¤è¡¨è¾¾å¼</li>
</ol>
<p>Spring AIæ”¯æŒçš„å‘é‡å­˜å‚¨å®ç°</p>
<ol>
<li>å†…å­˜å‘é‡å­˜å‚¨ï¼šé€‚ç”¨äºå¼€å‘å’Œæµ‹è¯•ï¼Œä¸éœ€è¦å¤–éƒ¨ä¾èµ–ã€‚</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> VectorStore <span class="title function_">inMemoryVectorStore</span><span class="params">(EmbeddingModel embeddingModel)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> SimpleVectorStore.builder(embeddingModel).build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>Rediså‘é‡å­˜å‚¨ï¼šä½¿ç”¨Rediså­˜å‚¨å‘é‡æ•°æ®ã€‚</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> VectorStore <span class="title function_">redisVectorStore</span><span class="params">(</span></span><br><span class="line"><span class="params">        EmbeddingModel embeddingModel,</span></span><br><span class="line"><span class="params">        RedisConnectionFactory redisConnectionFactory)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> RedisVectorStore.builder(redisConnectionFactory, embeddingModel)</span><br><span class="line">        .namespace(<span class="string">&quot;ai:embeddings&quot;</span>)</span><br><span class="line">        .build();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>PostgreSQLå‘é‡å­˜å‚¨ï¼šåŸºäºPostgreSQLå’Œpgvectoræ‰©å±•ã€‚</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> VectorStore <span class="title function_">pgVectorStore</span><span class="params">(</span></span><br><span class="line"><span class="params">        EmbeddingClient embeddingClient,</span></span><br><span class="line"><span class="params">        DataSource dataSource)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PgVectorStore</span>(embeddingClient, dataSource);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é…ç½®Spring AIçš„å‘é‡å­˜å‚¨<br>ä»¥PostgreSQLå‘é‡å­˜å‚¨ä¸ºä¾‹ï¼Œé…ç½®åŒ…æ‹¬ä»¥ä¸‹æ­¥éª¤ï¼š</p>
<ol>
<li>æ·»åŠ ä¾èµ–ï¼š</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Spring AI PGVector ä¾èµ– --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.ai<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-ai-pgvector-store<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring-ai.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- PostgreSQL é©±åŠ¨ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.postgresql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>postgresql<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;postgresql.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ol start="2">
<li>æ•°æ®åº“é…ç½®ï¼š</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># application.properties</span></span><br><span class="line"><span class="string">spring.datasource.url=jdbc:postgresql://localhost:5432/vectordb</span></span><br><span class="line"><span class="string">spring.datasource.username=postgres</span></span><br><span class="line"><span class="string">spring.datasource.password=password</span></span><br><span class="line"><span class="string">spring.datasource.driver-class-name=org.postgresql.Driver</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># pgvector è¡¨åé…ç½®</span></span><br><span class="line"><span class="string">spring.ai.vectorstore.pgvector.table-name=document_embeddings</span></span><br></pre></td></tr></table></figure>
<ol start="3">
<li>åˆå§‹åŒ–pgvector:</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- åœ¨ PostgreSQL ä¸­å¯ç”¨ pgvector æ‰©å±•</span></span><br><span class="line"><span class="keyword">CREATE</span> EXTENSION IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> vector;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- åˆ›å»ºè¡¨å­˜å‚¨æ–‡æ¡£å’ŒåµŒå…¥</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> document_embeddings (</span><br><span class="line">    id text <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    content text,</span><br><span class="line">    metadata jsonb,</span><br><span class="line">    embedding vector(<span class="number">1536</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- åˆ›å»ºå‘é‡ç´¢å¼•ï¼ˆHNSWï¼‰</span></span><br><span class="line"><span class="keyword">CREATE</span> INDEX IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> document_embeddings_embedding_idx <span class="keyword">ON</span> document_embeddings</span><br><span class="line"><span class="keyword">USING</span> hnsw (embedding vector_cosine_ops);</span><br></pre></td></tr></table></figure>


<h2 id="åŸºç¡€å‘é‡æœç´¢å®ç°"><a href="#åŸºç¡€å‘é‡æœç´¢å®ç°" class="headerlink" title="åŸºç¡€å‘é‡æœç´¢å®ç°"></a>åŸºç¡€å‘é‡æœç´¢å®ç°</h2><p>ä½¿ç”¨Spring AIçš„å‘é‡å­˜å‚¨æ¥å®ç°åŸºç¡€çš„å‘é‡æœç´¢åŠŸèƒ½ã€‚</p>
<ol>
<li>æ–‡æ¡£ç´¢å¼•æœåŠ¡</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DocumentIndexService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> VectorStore vectorStore;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> EmbeddingClient embeddingClient;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DocumentIndexService</span><span class="params">(VectorStore vectorStore, EmbeddingClient embeddingClient)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.vectorStore = vectorStore;</span><br><span class="line">        <span class="built_in">this</span>.embeddingClient = embeddingClient;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">indexDocument</span><span class="params">(String id, String content, Map&lt;String, Object&gt; metadata)</span> &#123;</span><br><span class="line">        <span class="comment">// ç”Ÿæˆå†…å®¹çš„åµŒå…¥</span></span><br><span class="line">        <span class="type">Embedding</span> <span class="variable">embedding</span> <span class="operator">=</span> embeddingClient.embed(content);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å­˜å‚¨æ–‡æ¡£åŠå…¶åµŒå…¥</span></span><br><span class="line">        vectorStore.add(id, embedding, metadata);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">batchIndexDocuments</span><span class="params">(List&lt;Document&gt; documents)</span> &#123;</span><br><span class="line">        vectorStore.add(documents);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteDocument</span><span class="params">(String id)</span> &#123;</span><br><span class="line">        vectorStore.delete(Collections.singletonList(id));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>æ–‡æ¡£æœç´¢æœåŠ¡</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DocumentSearchService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> VectorStore vectorStore;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DocumentSearchService</span><span class="params">(VectorStore vectorStore)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.vectorStore = vectorStore;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> List&lt;Document&gt; <span class="title function_">searchSimilarDocuments</span><span class="params">(String query, <span class="type">int</span> maxResults)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> vectorStore.similaritySearch(query, maxResults);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> List&lt;Document&gt; <span class="title function_">searchWithFilter</span><span class="params">(String query, <span class="type">int</span> maxResults, String category)</span> &#123;</span><br><span class="line">        List&lt;String&gt; filter = Collections.singletonList(<span class="string">&quot;metadata.category == &#x27;&quot;</span> + category + <span class="string">&quot;&#x27;&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> vectorStore.similaritySearch(query, maxResults, filter);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>æ–‡æ¡£å¤„ç†å·¥å…·ç±»</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DocumentProcessor</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å°†æ–‡æœ¬åˆ†å‰²æˆè¾ƒå°çš„å—ï¼Œä¾¿äºå‘é‡åŒ–</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Document&gt; <span class="title function_">splitTextIntoDocuments</span><span class="params">(String text, String metadata)</span> &#123;</span><br><span class="line">        List&lt;Document&gt; documents = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">// å‡è®¾æˆ‘ä»¬æŒ‰æ®µè½åˆ†å‰²</span></span><br><span class="line">        String[] paragraphs = text.split(<span class="string">&quot;\n\n&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; paragraphs.length; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (paragraphs[i].trim().length() &gt; <span class="number">10</span>) &#123; <span class="comment">// å¿½ç•¥å¤ªçŸ­çš„æ®µè½</span></span><br><span class="line">                Map&lt;String, Object&gt; meta = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">                meta.put(<span class="string">&quot;index&quot;</span>, i);</span><br><span class="line">                meta.put(<span class="string">&quot;source&quot;</span>, metadata);</span><br><span class="line">                </span><br><span class="line">                documents.add(<span class="keyword">new</span> <span class="title class_">Document</span>(</span><br><span class="line">                    UUID.randomUUID().toString(),</span><br><span class="line">                    paragraphs[i],</span><br><span class="line">                    meta</span><br><span class="line">                ));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> documents;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä»æ–‡ä»¶åˆ›å»ºæ–‡æ¡£</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Document&gt; <span class="title function_">createDocumentsFromFile</span><span class="params">(File file)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">content</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(Files.readAllBytes(file.toPath()));</span><br><span class="line">        <span class="keyword">return</span> splitTextIntoDocuments(content, file.getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="ç›¸ä¼¼åº¦è®¡ç®—ä¸åŒ¹é…åŸç†"><a href="#ç›¸ä¼¼åº¦è®¡ç®—ä¸åŒ¹é…åŸç†" class="headerlink" title="ç›¸ä¼¼åº¦è®¡ç®—ä¸åŒ¹é…åŸç†"></a>ç›¸ä¼¼åº¦è®¡ç®—ä¸åŒ¹é…åŸç†</h2><p>å‘é‡æœç´¢çš„æ ¸å¿ƒæ˜¯ç›¸ä¼¼åº¦è®¡ç®—ï¼Œå†³å®šå¦‚ä½•åº¦é‡ä¸¤ä¸ªå‘é‡ä¹‹é—´çš„â€è·ç¦»â€æˆ–â€ç›¸ä¼¼ç¨‹åº¦â€œã€‚<br>å¸¸ç”¨çš„ç›¸ä¼¼åº¦è®¡ç®—æ–¹æ³•</p>
<ol>
<li>ä½™å¼¦ç›¸ä¼¼åº¦(Cosine Similarityï¼‰:<br>è®¡ç®—ä¸¤ä¸ªå‘é‡å¤¹è§’çš„ä½™å¼¦å€¼<br>èŒƒå›´ä¸º-1åˆ°1,1è¡¨ç¤ºå®Œå…¨ç›¸åŒï¼Œ0è¡¨ç¤ºæ­£äº¤ï¼Œ-1è¡¨ç¤ºæ–¹å‘ç›¸å<br>ä¸è€ƒè™‘å‘é‡çš„å¤§å°ï¼Œåªè€ƒè™‘æ–¹å‘<br>å…¬å¼ï¼šcosine(A,B)&#x3D;(AB)&#x2F;(â€–Aâ€–Â·â€–Bâ€–)</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">double</span> <span class="title function_">cosineSimilarity</span><span class="params">(List&lt;Double&gt; v1, List&lt;Double&gt; v2)</span> &#123;</span><br><span class="line">    <span class="type">double</span> <span class="variable">dotProduct</span> <span class="operator">=</span> <span class="number">0.0</span>;</span><br><span class="line">    <span class="type">double</span> <span class="variable">norm1</span> <span class="operator">=</span> <span class="number">0.0</span>;</span><br><span class="line">    <span class="type">double</span> <span class="variable">norm2</span> <span class="operator">=</span> <span class="number">0.0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; v1.size(); i++) &#123;</span><br><span class="line">        dotProduct += v1.get(i) * v2.get(i);</span><br><span class="line">        norm1 += Math.pow(v1.get(i), <span class="number">2</span>);</span><br><span class="line">        norm2 += Math.pow(v2.get(i), <span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> dotProduct / (Math.sqrt(norm1) * Math.sqrt(norm2));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>æ¬§å‡ é‡Œå¾—è·ç¦»(Euclidean Distance):<br>è®¡ç®—ä¸¤ç‚¹åœ¨æ¬§å‡ é‡Œå¾—ç©ºé—´ä¸­çš„ç›´çº¿è·ç¦»<br>å€¼è¶Šå°è¡¨ç¤ºè¶Šç›¸ä¼¼<br>å—å‘é‡å¤§å°å½±å“<br>å…¬å¼ï¼šdistance(A,B)&#x3D;sqrt(sum((A_i-B_i)^2))</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">double</span> <span class="title function_">euclideanDistance</span><span class="params">(List&lt;Double&gt; v1, List&lt;Double&gt; v2)</span> &#123;</span><br><span class="line">    <span class="type">double</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0.0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; v1.size(); i++) &#123;</span><br><span class="line">        <span class="type">double</span> <span class="variable">diff</span> <span class="operator">=</span> v1.get(i) - v2.get(i);</span><br><span class="line">        sum += diff * diff;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> Math.sqrt(sum);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<ol start="3">
<li>ç‚¹ç§¯(Dot Product):<br>ä¸¤ä¸ªå‘é‡å¯¹åº”å…ƒç´ ç›¸ä¹˜ç„¶åæ±‚å’Œ<br>å‡è®¾å‘é‡å·²å½’ä¸€åŒ–ï¼Œå€¼è¶Šå¤§è¡¨ç¤ºè¶Šç›¸ä¼¼<br>å…¬å¼ï¼šdotProduct(A,B)&#x3D;sum(A_i*B_i)</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">double</span> <span class="title function_">dotProduct</span><span class="params">(List&lt;Double&gt; v1, List&lt;Double&gt; v2)</span> &#123;</span><br><span class="line">    <span class="type">double</span> <span class="variable">result</span> <span class="operator">=</span> <span class="number">0.0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; v1.size(); i++) &#123;</span><br><span class="line">        result += v1.get(i) * v2.get(i);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>è¿‘ä¼¼æœ€è¿‘é‚»ç®—æ³•<br>å‘é‡æ•°æ®åº“é€šå¸¸ä½¿ç”¨è¿‘ä¼¼æœ€è¿‘é‚»(ANN)ç®—æ³•æ¥åŠ é€Ÿç›¸ä¼¼å‘é‡çš„æ£€ç´¢ï¼Œå¸¸è§çš„ç®—æ³•åŒ…æ‹¬ï¼š</li>
</ol>
<ul>
<li>HNSW (Hierarchical Navigable Small World):<br>  Â·æ„å»ºå¤šå±‚å›¾ç»“æ„ï¼Œè¾ƒä½å±‚è¿æ¥å¯†é›†ï¼Œè¾ƒé«˜å±‚è¿æ¥ç¨€ç–<br>  Â·æœç´¢æ—¶ä»é¡¶å±‚å¼€å§‹ï¼Œé€å±‚å‘ä¸‹æŸ¥æ‰¾ç›¸ä¼¼ç‚¹<br>  Â·æŸ¥è¯¢é€Ÿåº¦éå¸¸å¿«ï¼Œä½†æ„å»ºç´¢å¼•éœ€è¦è¾ƒå¤šå†…å­˜</li>
<li>IVF (Inverted File Index):<br>  Â·å°†å‘é‡ç©ºé—´åˆ†å‰²æˆå¤šä¸ªé«Œ<br>  Â·æŸ¥è¯¢æ—¶å…ˆæ‰¾åˆ°æœ€è¿‘çš„ç°‡ï¼Œç„¶ååœ¨ç°‡å†…æœç´¢<br>  Â·å†…å­˜å ç”¨è¾ƒå°ï¼Œä½†æŸ¥è¯¢å‡†ç¡®æ€§å¯èƒ½ç•¥ä½</li>
<li>IVFPQ (IVF Product Quantization):<br>  Â·VFçš„æ‰©å±•ï¼Œä½¿ç”¨ä¹˜ç§¯é‡åŒ–å‹ç¼©å‘é‡<br>  Â·å¯ä»¥å¤§å¹…å‡å°å†…å­˜å ç”¨<br>  Â·é€‚åˆéå¸¸å¤§çš„å‘é‡é›†åˆ</li>
</ul>
<h1 id="æ£€ç´¢å¢å¼ºç”Ÿæˆ-RAG-å…¥é—¨"><a href="#æ£€ç´¢å¢å¼ºç”Ÿæˆ-RAG-å…¥é—¨" class="headerlink" title="æ£€ç´¢å¢å¼ºç”Ÿæˆ(RAG)å…¥é—¨"></a>æ£€ç´¢å¢å¼ºç”Ÿæˆ(RAG)å…¥é—¨</h1><h2 id="RAGçš„åŸºæœ¬æ¦‚å¿µ"><a href="#RAGçš„åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="RAGçš„åŸºæœ¬æ¦‚å¿µ"></a>RAGçš„åŸºæœ¬æ¦‚å¿µ</h2><p>æ£€ç´¢å¢å¼ºç”Ÿæˆ(Retrievalâ€“Augmented Generation,RAG)æ˜¯ä¸€ç§æ··åˆAIæ¶æ„<br>å®ƒå°†æ£€ç´¢ç³»ç»Ÿä¸ç”Ÿæˆå¼AIæ¨¡å‹ç»“åˆèµ·æ¥ã€‚<br>å·¥ä½œæµç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li>å°†çŸ¥è¯†åº“æ–‡æ¡£è½¬æ¢ä¸ºå‘é‡è¡¨ç¤ºå¹¶å­˜å‚¨</li>
<li>å½“æ”¶åˆ°ç”¨æˆ·æŸ¥è¯¢æ—¶ï¼Œæ£€ç´¢æœ€ç›¸å…³çš„æ–‡æ¡£ç‰‡æ®µ</li>
<li>å°†æ£€ç´¢åˆ°çš„æ–‡æ¡£ä½œä¸ºä¸Šä¸‹æ–‡ï¼Œè¿åŒç”¨æˆ·æŸ¥è¯¢ä¸€èµ·å‘é€ç»™AIæ¨¡å‹</li>
<li>AIæ¨¡å‹åŸºäºæ£€ç´¢åˆ°çš„ä¿¡æ¯ç”Ÿæˆå›ç­”<br>RAGçš„æ ¸å¿ƒä¼˜åŠ¿åœ¨äºå®ƒç»“åˆäº†ä¸¤ç§æŠ€æœ¯çš„ä¼˜ç‚¹ï¼šæ£€ç´¢ç³»ç»Ÿçš„å‡†ç¡®æ€§å’Œç”Ÿæˆæ¨¡å‹çš„çµæ´»æ€§ã€‚</li>
</ol>
<h2 id="æ–‡æ¡£å¤„ç†ä¸ETLç®¡é“"><a href="#æ–‡æ¡£å¤„ç†ä¸ETLç®¡é“" class="headerlink" title="æ–‡æ¡£å¤„ç†ä¸ETLç®¡é“"></a>æ–‡æ¡£å¤„ç†ä¸ETLç®¡é“</h2><p>å®ç°RAGç¬¬ä¸€æ­¥éœ€è¦å¤„ç†å’Œå‡†å¤‡æ–‡æ¡£ï¼Œå°†å…¶è½¬æ¢ä¸ºé€‚åˆæ£€ç´¢çš„æ ¼å¼ã€‚<br>Spring AIæä¾›äº†ä¸€å¥—å®Œæ•´çš„ETL(æå–-è½¬æ¢-åŠ è½½)ç»„ä»¶æ¥ç®€åŒ–è¿™ä¸€è¿‡ç¨‹ã€‚<br>ETLç®¡é“çš„ç»„æˆéƒ¨åˆ†<br>ä¸€ä¸ªå®Œæ•´çš„RAG ETLç®¡é“é€šå¸¸åŒ…æ‹¬ä»¥ä¸‹æ­¥éª¤ï¼š</p>
<ol>
<li>æå–(Extract):ä»å„ç§æ¥æºåŠ è½½æ–‡æ¡£</li>
<li>è½¬æ¢(Transform):æ¸…ç†ã€åˆ†å—å’Œå‘é‡åŒ–æ–‡æ¡£</li>
<li>åŠ è½½(Load):å°†å‘é‡åŒ–çš„æ–‡æ¡£å­˜å…¥å‘é‡æ•°æ®åº“</li>
</ol>
<p>DocumentReader:æ–‡æ¡£æå–<br>Spring AIæä¾›äº†å¤šç§DocumentReaderå®ç°ï¼Œå¯ä»¥ä»ä¸åŒæ¥æºå’Œæ ¼å¼è¯»å–æ–‡æ¡£ï¼š</p>
<ul>
<li>JsonReader:è§£æJSONæ•°æ®</li>
<li>TextReader:è¯»å–çº¯æ–‡æœ¬æ–‡ä»¶</li>
<li>MarkdownReader:è¯»å–Markdownæ–‡ä»¶</li>
<li>PDFReader:è¯»å–PDFæ–‡ä»¶</li>
<li>HtmlReader:è§£æHTMLå†…å®¹</li>
<li>TikaDocumentReader:ä½¿ç”¨Apache Tikaè¯»å–å¤šç§æ ¼å¼<br>ç¤ºä¾‹ä»£ç ï¼šä½¿ç”¨TextReaderè¯»å–æ–‡æœ¬æ–‡ä»¶ï¼š</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;Document&gt; <span class="title function_">loadDocuments</span><span class="params">(String directoryPath)</span> &#123;</span><br><span class="line">    <span class="type">TextReader</span> <span class="variable">reader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TextReader</span>();</span><br><span class="line">    reader.setRecursive(<span class="literal">true</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="type">Resource</span> <span class="variable">resource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileSystemResource</span>(directoryPath);</span><br><span class="line">    <span class="keyword">return</span> reader.get(resource);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>DocumentTransformer:æ–‡æ¡£è½¬æ¢<br>DocumentTransformerè´Ÿè´£å¤„ç†å’Œè½¬æ¢æ–‡æ¡£ï¼Œä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ ç±»ï¼š</p>
<ol>
<li>æ–‡æœ¬åˆ†å—å™¨(TextSplitter)<br>åˆ†å—å™¨è´Ÿè´£å°†é•¿æ–‡æœ¬åˆ‡åˆ†ä¸ºé€‚åˆåµŒå…¥çš„ç‰‡æ®µï¼š</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºåŸºäºTokençš„åˆ†å—å™¨</span></span><br><span class="line"><span class="type">TextSplitter</span> <span class="variable">splitter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TokenTextSplitter</span>();</span><br><span class="line">splitter.setChunkSize(<span class="number">512</span>);  <span class="comment">// è®¾ç½®å—å¤§å°</span></span><br><span class="line">splitter.setChunkOverlap(<span class="number">50</span>);  <span class="comment">// è®¾ç½®é‡å å¤§å°</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å¤„ç†æ–‡æ¡£</span></span><br><span class="line">List&lt;Document&gt; documents = loadDocuments(<span class="string">&quot;./data&quot;</span>);</span><br><span class="line">List&lt;Document&gt; splitDocuments = splitter.apply(documents);</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>å…ƒæ•°æ®å¢å¼ºå™¨(MetadataEnricher)<br>å…ƒæ•°æ®å¢å¼ºå™¨å¯ä»¥ä¸ºæ–‡æ¡£æ·»åŠ é¢å¤–çš„å…ƒæ•°æ®ä¿¡æ¯ï¼š</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºå…³é”®å­—å…ƒæ•°æ®å¢å¼ºå™¨</span></span><br><span class="line"><span class="type">KeywordMetadataEnricher</span> <span class="variable">keywordEnricher</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">KeywordMetadataEnricher</span>();</span><br><span class="line">keywordEnricher.setMetadataKey(<span class="string">&quot;keywords&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºæ‘˜è¦å…ƒæ•°æ®å¢å¼ºå™¨</span></span><br><span class="line"><span class="type">SummaryMetadataEnricher</span> <span class="variable">summaryEnricher</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SummaryMetadataEnricher</span>(chatClient);</span><br><span class="line">summaryEnricher.setMetadataKey(<span class="string">&quot;summary&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¤„ç†æ–‡æ¡£</span></span><br><span class="line">List&lt;Document&gt; enrichedDocuments = keywordEnricher.apply(splitDocuments);</span><br><span class="line">enrichedDocuments = summaryEnricher.apply(enrichedDocuments);</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>å†…å®¹æ ¼å¼åŒ–å™¨(ContentFormatter)<br>ContentFormatterå¯ä»¥é‡æ–°æ ¼å¼åŒ–æ–‡æ¡£å†…å®¹ï¼Œä¾‹å¦‚ç§»é™¤å¤šä½™çš„ç©ºç™½æˆ–HTMLæ ‡ç­¾ï¼š</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ContentFormatter</span> <span class="variable">formatter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ContentFormatter</span>();</span><br><span class="line">formatter.setFormatType(ContentFormatter.FormatType.MARKDOWN);</span><br><span class="line"></span><br><span class="line">List&lt;Document&gt; formattedDocuments = formatter.apply(enrichedDocuments);</span><br></pre></td></tr></table></figure>

<p>DocumentWriter:æ–‡æ¡£å­˜å‚¨<br>DocumentWriterè´Ÿè´£å°†å¤„ç†åçš„æ–‡æ¡£å­˜å‚¨åˆ°ç›®æ ‡ä½ç½®ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å­˜å‚¨åˆ°æ–‡ä»¶</span></span><br><span class="line"><span class="type">FileDocumentWriter</span> <span class="variable">fileWriter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileDocumentWriter</span>(<span class="string">&quot;./processed-documents&quot;</span>);</span><br><span class="line">fileWriter.accept(formattedDocuments);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å­˜å‚¨åˆ°å‘é‡æ•°æ®åº“</span></span><br><span class="line"><span class="type">VectorStoreWriter</span> <span class="variable">vectorStoreWriter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">VectorStoreWriter</span>(vectorStore);</span><br><span class="line">vectorStoreWriter.accept(formattedDocuments);</span><br></pre></td></tr></table></figure>

<h2 id="å‘é‡å­˜å‚¨ä¸æ£€ç´¢"><a href="#å‘é‡å­˜å‚¨ä¸æ£€ç´¢" class="headerlink" title="å‘é‡å­˜å‚¨ä¸æ£€ç´¢"></a>å‘é‡å­˜å‚¨ä¸æ£€ç´¢</h2><p>VectorStoreæ¥å£<br>Spring Alæä¾›äº†ç»Ÿä¸€çš„VectorStoreæ¥å£ï¼Œå®ƒæ‰©å±•äº†DocumentWriteræ¥å£ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">VectorStore</span> <span class="keyword">extends</span> <span class="title class_">DocumentWriter</span> &#123;</span><br><span class="line">    <span class="comment">// è·å–å‘é‡å­˜å‚¨çš„åç§°</span></span><br><span class="line">    <span class="keyword">default</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.getClass().getSimpleName();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æ·»åŠ æ–‡æ¡£åˆ°å‘é‡å­˜å‚¨</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(List&lt;Document&gt; documents)</span>;</span><br><span class="line">    <span class="comment">// å®ç°DocumentWriteræ¥å£</span></span><br><span class="line">    <span class="keyword">default</span> <span class="keyword">void</span> <span class="title function_">accept</span><span class="params">(List&lt;Document&gt; documents)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.add(documents);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æ ¹æ®IDåˆ—è¡¨åˆ é™¤å‘é‡</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">delete</span><span class="params">(List&lt;String&gt; idList)</span>;</span><br><span class="line">    <span class="comment">// ä½¿ç”¨è¿‡æ»¤è¡¨è¾¾å¼åˆ é™¤å‘é‡</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">delete</span><span class="params">(Filter.Expression filterExpression)</span>;</span><br><span class="line">    <span class="comment">// ä½¿ç”¨å­—ç¬¦ä¸²è¿‡æ»¤è¡¨è¾¾å¼åˆ é™¤å‘é‡</span></span><br><span class="line">    <span class="keyword">default</span> <span class="keyword">void</span> <span class="title function_">delete</span><span class="params">(String filterExpression)</span> &#123;</span><br><span class="line">        <span class="type">SearchRequest</span> <span class="variable">searchRequest</span> <span class="operator">=</span> SearchRequest.builder().filterExpression(filterExpression).build();</span><br><span class="line">        Filter.<span class="type">Expression</span> <span class="variable">textExpression</span> <span class="operator">=</span> searchRequest.getFilterExpression();</span><br><span class="line">        Assert.notNull(textExpression, <span class="string">&quot;Filter expression must not be null&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.delete(textExpression);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ä½¿ç”¨æœç´¢è¯·æ±‚è¿›è¡Œç›¸ä¼¼åº¦æœç´¢</span></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    List&lt;Document&gt; <span class="title function_">similaritySearch</span><span class="params">(SearchRequest request)</span>;</span><br><span class="line">    <span class="comment">// ä½¿ç”¨æŸ¥è¯¢å­—ç¬¦ä¸²è¿›è¡Œç›¸ä¼¼åº¦æœç´¢</span></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="keyword">default</span> List&lt;Document&gt; <span class="title function_">similaritySearch</span><span class="params">(String query)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.similaritySearch(SearchRequest.builder().query(query).build());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// è·å–åŸç”Ÿå®¢æˆ·ç«¯</span></span><br><span class="line">    <span class="keyword">default</span> &lt;T&gt; Optional&lt;T&gt; <span class="title function_">getNativeClient</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Optional.empty();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æ„å»ºå™¨æ¥å£</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Builder</span>&lt;T <span class="keyword">extends</span> <span class="title class_">Builder</span>&lt;T&gt;&gt; &#123;</span><br><span class="line">        T <span class="title function_">observationRegistry</span><span class="params">(ObservationRegistry observationRegistry)</span>;</span><br><span class="line">        T <span class="title function_">customObservationConvention</span><span class="params">(VectorStoreObservationConvention convention)</span>;</span><br><span class="line">        T <span class="title function_">batchingStrategy</span><span class="params">(BatchingStrategy batchingStrategy)</span>;</span><br><span class="line">        VectorStore <span class="title function_">build</span><span class="params">()</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>SearchRequest<br>SearchRequestæ˜¯ä¸€ä¸ªæ„å»ºå™¨ç±»ï¼Œç”¨äºåˆ›å»ºç›¸ä¼¼æ€§æœç´¢è¯·æ±‚ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">SearchRequest</span> <span class="variable">request</span> <span class="operator">=</span> SearchRequest.builder()</span><br><span class="line">    .query(<span class="string">&quot;Springæ¡†æ¶å¦‚ä½•å¤„ç†ä¾èµ–æ³¨å…¥ï¼Ÿ&quot;</span>)</span><br><span class="line">    .topK(<span class="number">5</span>)  <span class="comment">// è¿”å›å‰5ä¸ªç»“æœ</span></span><br><span class="line">    .similarityThreshold(<span class="number">0.7f</span>)  <span class="comment">// è®¾ç½®ç›¸ä¼¼åº¦é˜ˆå€¼</span></span><br><span class="line">    .filterExpression(<span class="string">&quot;metadata.category == &#x27;æŠ€æœ¯æ–‡æ¡£&#x27;&quot;</span>)  <span class="comment">// è®¾ç½®è¿‡æ»¤æ¡ä»¶</span></span><br><span class="line">    .build();</span><br><span class="line"></span><br><span class="line">List&lt;Document&gt; results = vectorStore.similaritySearch(request);</span><br></pre></td></tr></table></figure>

<p>æ”¯æŒçš„å‘é‡æ•°æ®åº“<br>Spring AIæ”¯æŒå¤šç§å‘é‡æ•°æ®åº“ï¼ŒåŒ…æ‹¬ï¼š</p>
<ol>
<li>å†…å­˜å‘é‡åº“ï¼šç”¨äºæµ‹è¯•å’Œå°å‹åº”ç”¨</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºå†…å­˜å‘é‡å­˜å‚¨</span></span><br><span class="line"><span class="type">EmbeddingModel</span> <span class="variable">embeddingModel</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OpenAiEmbeddingModel</span>(<span class="string">&quot;text-embedding-3-small&quot;</span>);</span><br><span class="line"><span class="type">InMemoryVectorStore</span> <span class="variable">vectorStore</span> <span class="operator">=</span> InMemoryVectorStore.builder()</span><br><span class="line">    .embeddingModel(embeddingModel)</span><br><span class="line">    .build();</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>Rediså‘é‡åº“ï¼šåˆ©ç”¨Redisçš„é«˜æ€§èƒ½ç‰¹æ€§</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»º Redis å‘é‡å­˜å‚¨</span></span><br><span class="line"><span class="type">RedisVectorStore</span> <span class="variable">vectorStore</span> <span class="operator">=</span> RedisVectorStore.builder()</span><br><span class="line">    .embeddingModel(embeddingModel)</span><br><span class="line">    .redisTemplate(redisTemplate)</span><br><span class="line">    .indexName(<span class="string">&quot;document-index&quot;</span>)</span><br><span class="line">    .build();</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>PostgreSQLå‘é‡åº“ï¼šä½¿ç”¨PGVectoræ‰©å±•</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»º PostgreSQL å‘é‡å­˜å‚¨</span></span><br><span class="line"><span class="type">PgVectorStore</span> <span class="variable">vectorStore</span> <span class="operator">=</span> PgVectorStore.builder()</span><br><span class="line">    .embeddingModel(embeddingModel)</span><br><span class="line">    .jdbcTemplate(jdbcTemplate)</span><br><span class="line">    .build();</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>å…¶ä»–æ”¯æŒçš„å‘é‡æ•°æ®åº“ï¼šMilvusã€Elasticsearchã€Chromaã€Pineconeã€Weaviateç­‰ã€‚</li>
</ol>
<h2 id="å®ç°RAGç³»ç»Ÿ"><a href="#å®ç°RAGç³»ç»Ÿ" class="headerlink" title="å®ç°RAGç³»ç»Ÿ"></a>å®ç°RAGç³»ç»Ÿ</h2><p>æŸ¥è¯¢å¤„ç†ä¸ä¼˜åŒ–<br>Spring AIæä¾›äº†ä¸€ç³»åˆ—ç»„ä»¶ï¼Œç”¨äºä¼˜åŒ–ç”¨æˆ·æŸ¥è¯¢ï¼Œæé«˜æ£€ç´¢è´¨é‡ï¼š</p>
<ol>
<li>æŸ¥è¯¢è½¬æ¢å™¨(QueryTransformer)<br>æŸ¥è¯¢è½¬æ¢å™¨å¯ä»¥é‡å†™æˆ–å¢å¼ºç”¨æˆ·æŸ¥è¯¢ï¼š</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æŸ¥è¯¢é‡å†™è½¬æ¢å™¨</span></span><br><span class="line"><span class="type">RewriteQueryTransformer</span> <span class="variable">rewriteTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RewriteQueryTransformer</span>(chatClient);</span><br><span class="line"><span class="type">String</span> <span class="variable">enhancedQuery</span> <span class="operator">=</span> rewriteTransformer.transform(<span class="string">&quot;æ€ä¹ˆå­¦Javaï¼Ÿ&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¿»è¯‘æŸ¥è¯¢è½¬æ¢å™¨</span></span><br><span class="line"><span class="type">TranslationQueryTransformer</span> <span class="variable">translationTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TranslationQueryTransformer</span>(chatClient, Locale.ENGLISH);</span><br><span class="line"><span class="type">String</span> <span class="variable">translatedQuery</span> <span class="operator">=</span> translationTransformer.transform(<span class="string">&quot;å¦‚ä½•å®ç°å•ä¾‹æ¨¡å¼ï¼Ÿ&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‹ç¼©æŸ¥è¯¢è½¬æ¢å™¨</span></span><br><span class="line"><span class="type">CompressionQueryTransformer</span> <span class="variable">compressionTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CompressionQueryTransformer</span>(chatClient);</span><br><span class="line"><span class="type">String</span> <span class="variable">compressedQuery</span> <span class="operator">=</span> compressionTransformer.transform(<span class="string">&quot;è¯·è¯¦ç»†è§£é‡ŠSpringæ¡†æ¶ä¸­çš„ä¾èµ–æ³¨å…¥æœºåˆ¶...&quot;</span>);</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>æŸ¥è¯¢æ‰©å±•å™¨(QueryExpander)<br>æŸ¥è¯¢æ‰©å±•å™¨å¯ä»¥ç”Ÿæˆå¤šä¸ªæŸ¥è¯¢å˜ä½“ï¼Œæé«˜æ£€ç´¢å‘½ä¸­ç‡ï¼š</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">MultiQueryExpander</span> <span class="variable">multiQueryExpander</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MultiQueryExpander</span>(chatClient);</span><br><span class="line">List&lt;String&gt; queryVariants = multiQueryExpander.expand(<span class="string">&quot;å¦‚ä½•ä¼˜åŒ–MySQLæŸ¥è¯¢ï¼Ÿ&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>æ–‡æ¡£æ£€ç´¢</p>
<ol>
<li>DocumentRetrieveræ¥å£<br>DocumentRetrieveræ˜¯æ£€ç´¢æ–‡æ¡£çš„æ ¸å¿ƒæ¥å£ï¼š</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DocumentRetriever</span> &#123;</span><br><span class="line">    List&lt;Document&gt; <span class="title function_">retrieve</span><span class="params">(String query)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸»è¦å®ç°æ˜¯VectorStoreDocumentRetriever</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºå‘é‡å­˜å‚¨æ–‡æ¡£æ£€ç´¢å™¨</span></span><br><span class="line"><span class="type">VectorStoreDocumentRetriever</span> <span class="variable">retriever</span> <span class="operator">=</span> VectorStoreDocumentRetriever.builder()</span><br><span class="line">    .vectorStore(vectorStore)</span><br><span class="line">    .k(<span class="number">5</span>)  <span class="comment">// æ£€ç´¢å‰5ä¸ªç»“æœ</span></span><br><span class="line">    .build();</span><br><span class="line"></span><br><span class="line">List&lt;Document&gt; documents = retriever.retrieve(<span class="string">&quot;Spring Bootè‡ªåŠ¨é…ç½®åŸç†&quot;</span>);</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>DocumentJoiner<br>è´Ÿè´£åˆå¹¶æ¥è‡ªå¤šä¸ªæ¥æºçš„æ–‡æ¡£ï¼š</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ConcatenationDocumentJoiner</span> <span class="variable">joiner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConcatenationDocumentJoiner</span>();</span><br><span class="line"><span class="type">Document</span> <span class="variable">combinedDocument</span> <span class="operator">=</span> joiner.join(documents);</span><br></pre></td></tr></table></figure>


<h2 id="RAG-Advisors"><a href="#RAG-Advisors" class="headerlink" title="RAG Advisors"></a>RAG Advisors</h2><p>Spring AIæä¾›äº†é«˜çº§çš„RAG Advisorç»„ä»¶ï¼Œç®€åŒ–RAGç³»ç»Ÿå®ç°ï¼š</p>
<ol>
<li>QuestionAnswerAdvisor<br>QuestionAnswerAdvisoræä¾›äº†æ£€ç´¢æ–‡æ¡£å¹¶æ„å»ºAIæç¤ºçš„åŸºæœ¬åŠŸèƒ½ï¼š</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºé—®ç­”é¡¾é—®</span></span><br><span class="line"><span class="type">QuestionAnswerAdvisor</span> <span class="variable">advisor</span> <span class="operator">=</span> QuestionAnswerAdvisor.builder()</span><br><span class="line">    .chatClient(chatClient)</span><br><span class="line">    .retriever(retriever)</span><br><span class="line">    .build();</span><br><span class="line"></span><br><span class="line"><span class="comment">// å›ç­”é—®é¢˜</span></span><br><span class="line"><span class="type">QaResponse</span> <span class="variable">response</span> <span class="operator">=</span> advisor.answer(<span class="string">&quot;Spring Bootçš„æ ¸å¿ƒç‰¹æ€§æœ‰å“ªäº›ï¼Ÿ&quot;</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;å›ç­”: &quot;</span> + response.getText());</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–æ¥æºæ–‡æ¡£</span></span><br><span class="line">List&lt;RetrievalResult&gt; retrievalResults = response.getRetrievalResults();</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>RetrievalAugmentationAdvisor<br>æä¾›äº†æ›´çµæ´»çš„RAGå®ç°ï¼Œå¯ä»¥è‡ªå®šä¹‰æŸ¥è¯¢è½¬æ¢å™¨å’Œæ–‡æ¡£æ£€ç´¢å™¨ï¼š</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºæ£€ç´¢å¢å¼ºé¡¾é—®</span></span><br><span class="line"><span class="type">RetrievalAugmentationAdvisor</span> <span class="variable">ragAdvisor</span> <span class="operator">=</span> RetrievalAugmentationAdvisor.builder()</span><br><span class="line">    .chatClient(chatClient)</span><br><span class="line">    .queryTransformer(rewriteTransformer)</span><br><span class="line">    .retriever(retriever)</span><br><span class="line">    .build();</span><br><span class="line"></span><br><span class="line"><span class="comment">// å›ç­”é—®é¢˜</span></span><br><span class="line"><span class="type">String</span> <span class="variable">answer</span> <span class="operator">=</span> ragAdvisor.retrieve(<span class="string">&quot;ä»€ä¹ˆæ˜¯å¾®æœåŠ¡æ¶æ„ï¼Ÿ&quot;</span>)</span><br><span class="line">    .thenApply(ragAdvisor::generateAnswer)</span><br><span class="line">    .getText();</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>ContextualQueryAugmenter<br>å¯ä»¥åœ¨ä¸Šä¸‹æ–‡ä¸ºç©ºæ—¶å¤„ç†è¾¹ç¼˜æƒ…å†µï¼Œå¹¶å…è®¸è‡ªå®šä¹‰é”™è¯¯æ¶ˆæ¯ï¼š</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºä¸Šä¸‹æ–‡æŸ¥è¯¢å¢å¼ºå™¨</span></span><br><span class="line"><span class="type">ContextualQueryAugmenter</span> <span class="variable">augmenter</span> <span class="operator">=</span> ContextualQueryAugmenter.builder()</span><br><span class="line">    .emptyContextPromptTemplate(<span class="string">&quot;æ‰¾ä¸åˆ°ç›¸å…³ä¿¡æ¯ï¼Œè¯·å‘Šè¯‰ç”¨æˆ·ï¼š&#123;query&#125;&quot;</span>)</span><br><span class="line">    .contextPromptTemplate(<span class="string">&quot;åŸºäºä»¥ä¸‹ä¿¡æ¯å›ç­”é—®é¢˜ï¼š\n\n&#123;context&#125;\n\né—®é¢˜ï¼š&#123;query&#125;&quot;</span>)</span><br><span class="line">    .build();</span><br><span class="line"></span><br><span class="line"><span class="type">String</span> <span class="variable">prompt</span> <span class="operator">=</span> augmenter.augment(<span class="string">&quot;Spring WebFluxæ˜¯ä»€ä¹ˆï¼Ÿ&quot;</span>, retrievalResults);</span><br></pre></td></tr></table></figure>


<h1 id="å·¥å…·è°ƒç”¨åŠŸèƒ½"><a href="#å·¥å…·è°ƒç”¨åŠŸèƒ½" class="headerlink" title="å·¥å…·è°ƒç”¨åŠŸèƒ½"></a>å·¥å…·è°ƒç”¨åŠŸèƒ½</h1><h2 id="å·¥å…·å®šä¹‰æ¨¡å¼"><a href="#å·¥å…·å®šä¹‰æ¨¡å¼" class="headerlink" title="å·¥å…·å®šä¹‰æ¨¡å¼"></a>å·¥å…·å®šä¹‰æ¨¡å¼</h2><p>Spring Alæä¾›äº†ä¸¤ç§å®šä¹‰å·¥å…·çš„æ¨¡å¼ï¼š</p>
<ol>
<li>åŸºäºMethodsæ–¹æ³•(æ¨è)</li>
<li>åŸºäºFunctionså‡½æ•°å¼ç¼–ç¨‹</li>
</ol>
<p>å®šä¹‰å·¥å…·çš„æ–¹å¼<br>Spring AIæä¾›äº†ä¸¤ç§å®šä¹‰å·¥å…·çš„å®ç°æ–¹æ³•ï¼š</p>
<ol>
<li>æ³¨è§£å¼ï¼šåªéœ€åœ¨æ™®é€šJavaæ–¹æ³•ä¸Šæ·»åŠ @Toolæ³¨è§£å³å¯å®šä¹‰å·¥å…·ï¼Œç®€å•åˆç›´è§‚ã€‚<br>ä¸ºæ¯ä¸ªå·¥å…·æ·»åŠ è¯¦ç»†æ¸…æ™°çš„æè¿°éå¸¸é‡è¦ï¼Œè¿™èƒ½å¸®åŠ©AIå‡†ç¡®åˆ¤æ–­ä½•æ—¶åº”è°ƒç”¨è¯¥å·¥å…·ã€‚<br>åŒæ—¶ï¼Œå¯ä»¥ä½¿ç”¨@Too1Paramæ³¨è§£ä¸ºå·¥å…·å‚æ•°æä¾›è¯´æ˜ã€‚</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">WeatherTools</span> &#123;</span><br><span class="line">    <span class="meta">@Tool(description = &quot;è·å–æŒ‡å®šåŸå¸‚çš„å½“å‰å¤©æ°”æƒ…å†µ&quot;)</span></span><br><span class="line">    String <span class="title function_">getWeather</span><span class="params">(<span class="meta">@ToolParam(description = &quot;åŸå¸‚åç§°&quot;)</span> String city)</span> &#123;</span><br><span class="line">        <span class="comment">// è·å–å¤©æ°”çš„å®ç°é€»è¾‘</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;åŒ—äº¬ä»Šå¤©æ™´æœ—ï¼Œæ°”æ¸©25Â°C&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>ç¼–ç¨‹å¼ï¼šå¦‚æœéœ€è¦åœ¨è¿è¡Œæ—¶åŠ¨æ€åˆ›å»ºå·¥å…·ï¼Œå¯ä»¥é€‰æ‹©æ›´çµæ´»çš„ç¼–ç¨‹å¼æ–¹æ³•ã€‚<br>é¦–å…ˆå®šä¹‰å·¥å…·ç±»ï¼š</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">WeatherTools</span> &#123;</span><br><span class="line">    String <span class="title function_">getWeather</span><span class="params">(String city)</span> &#123;</span><br><span class="line">        <span class="comment">// è·å–å¤©æ°”çš„å®ç°é€»è¾‘</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;åŒ—äº¬ä»Šå¤©æ™´æœ—ï¼Œæ°”æ¸©25Â°C&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç„¶åå°†å…¶è½¬æ¢ä¸ºToolCallbackå·¥å…·å®šä¹‰ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> ReflectionUtils.findMethod(WeatherTools.class, <span class="string">&quot;getWeather&quot;</span>, String.class);</span><br><span class="line"><span class="type">ToolCallback</span> <span class="variable">toolCallback</span> <span class="operator">=</span> MethodToolCallback.builder()</span><br><span class="line">    .toolDefinition(ToolDefinition.builder(method)</span><br><span class="line">            .description(<span class="string">&quot;è·å–æŒ‡å®šåŸå¸‚çš„å½“å‰å¤©æ°”æƒ…å†µ&quot;</span>)</span><br><span class="line">            .build())</span><br><span class="line">    .toolMethod(method)</span><br><span class="line">    .toolObject(<span class="keyword">new</span> <span class="title class_">WeatherTools</span>())</span><br><span class="line">    .build();</span><br></pre></td></tr></table></figure>

<p>åœ¨å®šä¹‰å·¥å…·æ—¶ï¼Œéœ€è¦æ³¨æ„é€‰æ‹©åˆé€‚çš„å‚æ•°å’Œè¿”å›å€¼ç±»å‹ã€‚<br>Spring AIæ”¯æŒç»å¤§å¤šæ•°å¸¸è§Javaç±»å‹ä½œä¸ºå‚æ•°å’Œè¿”å›å€¼ï¼ŒåŒ…æ‹¬åŸºæœ¬ç±»å‹ã€å¤æ‚å¯¹è±¡å’Œå„ç±»é›†åˆã€‚<br>è¿”å›å€¼å¿…é¡»å¯åºåˆ—åŒ–ï¼Œå› ä¸ºå®ƒä»¬éœ€è¦ä¼ é€ç»™AIå¤§æ¨¡å‹ã€‚<br>ä»¥ä¸‹ç±»å‹ç›®å‰ä¸æ”¯æŒä½œä¸ºå·¥å…·æ–¹æ³•çš„å‚æ•°æˆ–è¿”å›ç±»å‹ï¼š</p>
<ul>
<li>Optionalç±»å‹</li>
<li>å¼‚æ­¥ç±»å‹ï¼ˆå¦‚CompletableFuture,Future)</li>
<li>å“åº”å¼ç±»å‹ï¼ˆå¦‚Flow,Mono,Flux)</li>
<li>å‡½æ•°å¼ç±»å‹ï¼ˆå¦‚Function,Supplier,Consumer)</li>
</ul>
<h2 id="ä½¿ç”¨å·¥å…·"><a href="#ä½¿ç”¨å·¥å…·" class="headerlink" title="ä½¿ç”¨å·¥å…·"></a>ä½¿ç”¨å·¥å…·</h2><p>å®šä¹‰å¥½å·¥å…·åï¼ŒSpring AIæä¾›äº†å¤šç§çµæ´»æ–¹å¼å°†å·¥å…·æä¾›ç»™ChatClientï¼Œè®©AIèƒ½åœ¨é€‚å½“æ—¶æœºè°ƒç”¨è¿™äº›å·¥å…·ã€‚</p>
<ol>
<li>æŒ‰éœ€ä½¿ç”¨ï¼šè¿™æ˜¯æœ€ç®€æ´çš„æ–¹å¼ï¼Œç›´æ¥åœ¨æ„å»ºChatClientè¯·æ±‚æ—¶é€šè¿‡tools()æ–¹æ³•é™„åŠ æ‰€éœ€å·¥å…·ã€‚</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">response</span> <span class="operator">=</span> ChatClient.create(chatModel)</span><br><span class="line">    .prompt(<span class="string">&quot;åŒ—äº¬ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ&quot;</span>)</span><br><span class="line">    .tools(<span class="keyword">new</span> <span class="title class_">WeatherTools</span>())  <span class="comment">// åœ¨å½“å‰å¯¹è¯ä¸­æä¾›å¤©æ°”å·¥å…·</span></span><br><span class="line">    .call()</span><br><span class="line">    .content();</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>å…¨å±€ä½¿ç”¨ï¼šå¦‚æœæŸäº›å·¥å…·éœ€è¦åœ¨æ‰€æœ‰å¯¹è¯ä¸­éƒ½å¯ç”¨ï¼Œå¯ä»¥åœ¨æ„å»ºChatClientæ—¶æ³¨å†Œä¸ºé»˜è®¤å·¥å…·ã€‚</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ChatClient</span> <span class="variable">chatClient</span> <span class="operator">=</span> ChatClient.builder(chatModel)</span><br><span class="line">    .defaultTools(<span class="keyword">new</span> <span class="title class_">WeatherTools</span>(), <span class="keyword">new</span> <span class="title class_">TimeTools</span>())  <span class="comment">// æ³¨å†Œé»˜è®¤å¯ç”¨çš„å·¥å…·</span></span><br><span class="line">    .build();</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>æ›´åº•å±‚çš„ä½¿ç”¨æ–¹å¼ï¼šé™¤äº†ç»™ChatClientç»‘å®šå·¥å…·ï¼Œè¿˜å¯ä»¥ç›´æ¥ä¸ºåº•å±‚ChatModelç»‘å®šå·¥å…·ã€‚</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å…ˆè·å–å·¥å…·å¯¹è±¡</span></span><br><span class="line">ToolCallback[] weatherTools = ToolCallbacks.from(<span class="keyword">new</span> <span class="title class_">WeatherTools</span>());</span><br><span class="line"><span class="comment">// ç»‘å®šå·¥å…·åˆ°å¯¹è¯</span></span><br><span class="line"><span class="type">ChatOptions</span> <span class="variable">chatOptions</span> <span class="operator">=</span> ToolCallingChatOptions.builder()</span><br><span class="line">    .toolCallbacks(weatherTools)</span><br><span class="line">    .build();</span><br><span class="line"><span class="comment">// æ„é€  Prompt æ—¶æŒ‡å®šå¯¹è¯é€‰é¡¹</span></span><br><span class="line"><span class="type">Prompt</span> <span class="variable">prompt</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Prompt</span>(<span class="string">&quot;åŒ—äº¬ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ&quot;</span>, chatOptions);</span><br><span class="line">chatModel.call(prompt);</span><br></pre></td></tr></table></figure>
<p>åœ¨ä½¿ç”¨å·¥å…·æ—¶ï¼ŒSpring AIä¸ºæˆ‘ä»¬è‡ªåŠ¨å¤„ç†äº†æ•´ä¸ªå·¥å…·è°ƒç”¨æµç¨‹ï¼š<br>ä»AIæ¨¡å‹åˆ¤æ–­éœ€è¦è°ƒç”¨å·¥å…·â€“&gt;æ‰§è¡Œç›¸åº”çš„å·¥å…·æ–¹æ³•â€“&gt;å°†ç»“æœè¿”å›ç»™æ¨¡å‹â€“&gt;æœ€åæ¨¡å‹åŸºäºå·¥å…·æ‰§è¡Œç»“æœç”Ÿæˆæœ€ç»ˆå›ç­”ã€‚<br>è¿™æ•´ä¸ªè¿‡ç¨‹å¯¹å¼€å‘è€…æ¥è¯´æ˜¯å®Œå…¨é€æ˜çš„ï¼Œæˆ‘ä»¬åªéœ€ä¸“æ³¨äºå®ç°å·¥å…·çš„æ ¸å¿ƒä¸šåŠ¡é€»è¾‘å³å¯ã€‚</p>
<h1 id="ä½¿ç”¨-Toolæ³¨è§£åˆ›å»ºå¯è°ƒç”¨å‡½æ•°"><a href="#ä½¿ç”¨-Toolæ³¨è§£åˆ›å»ºå¯è°ƒç”¨å‡½æ•°" class="headerlink" title="ä½¿ç”¨@Toolæ³¨è§£åˆ›å»ºå¯è°ƒç”¨å‡½æ•°"></a>ä½¿ç”¨@Toolæ³¨è§£åˆ›å»ºå¯è°ƒç”¨å‡½æ•°</h1><p>@Toolæ³¨è§£æ˜¯Spring AIå·¥å…·è°ƒç”¨åŠŸèƒ½çš„æ ¸å¿ƒï¼Œå¯ç”¨äºæ ‡è®°é‚£äº›å¯ä»¥è¢«Alæ¨¡å‹è°ƒç”¨çš„æ–¹æ³•ã€‚<br>@Too1æ³¨è§£ä¸»è¦æœ‰ä»¥ä¸‹æ ¸å¿ƒå±æ€§ï¼š</p>
<ul>
<li>description:è¯¦ç»†è¯´æ˜å·¥å…·çš„åŠŸèƒ½å’Œç”¨é€”ï¼Œå¸®åŠ©AIå‡†ç¡®åˆ¤æ–­ä½•æ—¶åº”è¯¥ä½¿ç”¨è¯¥å·¥å…·</li>
<li>name:å·¥å…·çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼ˆå¯é€‰å‚æ•°ï¼Œé»˜è®¤ä¼šä½¿ç”¨æ–¹æ³•åï¼‰</li>
</ul>
<p>é¦–å…ˆï¼Œåœ¨é¡¹ç›®æ ¹åŒ…ä¸‹åˆ›å»ºtoo1såŒ…ï¼Œç”¨äºé›†ä¸­ç®¡ç†æ‰€æœ‰å·¥å…·ç±»ï¼›<br>åŒæ—¶ï¼Œä¸ºäº†ä½¿å·¥å…·ç»“æœå«ä¹‰æ›´åŠ æ˜ç¡®ï¼Œæˆ‘ä»¬å°½é‡è®©å·¥å…·è¿”å›Stringç±»å‹çš„å€¼ã€‚</p>
<ol>
<li>æ–‡ä»¶æ“ä½œå·¥å…·<br>ä¸»è¦æä¾›ä¸¤ä¸ªæ ¸å¿ƒåŠŸèƒ½ï¼šæ–‡ä»¶ä¿å­˜å’Œæ–‡ä»¶è¯»å–ã€‚<br>ç”±äºæ–‡ä»¶æ“ä½œä¼šå½±å“ç³»ç»Ÿèµ„æºï¼Œéœ€è¦å°†æ‰€æœ‰æ–‡ä»¶ç»Ÿä¸€å­˜æ”¾åœ¨ä¸€ä¸ªéš”ç¦»çš„ç›®å½•ä¸­ï¼Œå…ˆåœ¨constantåŒ…ä¸‹åˆ›å»ºæ–‡ä»¶å¸¸é‡ç±»ï¼š</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">FileConstant</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ–‡ä»¶ä¿å­˜ç›®å½•</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">FILE_SAVE_DIR</span> <span class="operator">=</span> System.getProperty(<span class="string">&quot;user.dir&quot;</span>) + <span class="string">&quot;/tmp&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç„¶åç¼–å†™æ–‡ä»¶æ“ä½œå·¥å…·ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FileOperationTool</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">FILE_DIR</span> <span class="operator">=</span> FileConstant.FILE_SAVE_DIR + <span class="string">&quot;/file&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Tool(description = &quot;è¯»å–æŒ‡å®šæ–‡ä»¶çš„å†…å®¹&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">readFile</span><span class="params">(<span class="meta">@ToolParam(description = &quot;è¦è¯»å–çš„æ–‡ä»¶åç§°&quot;)</span> String fileName)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">filePath</span> <span class="operator">=</span> FILE_DIR + <span class="string">&quot;/&quot;</span> + fileName;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> FileUtil.readUtf8String(filePath);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;è¯»å–æ–‡ä»¶å‡ºé”™: &quot;</span> + e.getMessage();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Tool(description = &quot;å°†å†…å®¹å†™å…¥åˆ°æŒ‡å®šæ–‡ä»¶&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">writeFile</span><span class="params">(</span></span><br><span class="line"><span class="params">        <span class="meta">@ToolParam(description = &quot;è¦å†™å…¥çš„æ–‡ä»¶åç§°&quot;)</span> String fileName,</span></span><br><span class="line"><span class="params">        <span class="meta">@ToolParam(description = &quot;è¦å†™å…¥çš„æ–‡ä»¶å†…å®¹&quot;)</span> String content)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">filePath</span> <span class="operator">=</span> FILE_DIR + <span class="string">&quot;/&quot;</span> + fileName;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// ç¡®ä¿ç›®å½•å­˜åœ¨</span></span><br><span class="line">            FileUtil.mkdir(FILE_DIR);</span><br><span class="line">            FileUtil.writeUtf8String(content, filePath);</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;æ–‡ä»¶æˆåŠŸå†™å…¥è‡³: &quot;</span> + filePath;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;å†™å…¥æ–‡ä»¶å‡ºé”™: &quot;</span> + e.getMessage();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>è”ç½‘æœç´¢å·¥å…·<br>æ ¹æ®ç”¨æˆ·æä¾›çš„å…³é”®è¯æœç´¢ç›¸å…³ç½‘é¡µä¿¡æ¯ã€‚<br>å¯ä»¥åˆ©ç”¨ä¸“ä¸šçš„ç½‘é¡µæœç´¢API(å¦‚Search API)æ¥å®ç°å¤šæ¸ é“çš„å†…å®¹æœç´¢ï¼š</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebSearchTool</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// SearchAPI æœç´¢æ¥å£åœ°å€</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">SEARCH_API_URL</span> <span class="operator">=</span> <span class="string">&quot;https://www.searchapi.io/api/v1/search&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String apiKey;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">WebSearchTool</span><span class="params">(String apiKey)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.apiKey = apiKey;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Tool(description = &quot;ä»ç™¾åº¦æœç´¢å¼•æ“æœç´¢ä¿¡æ¯&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">searchWeb</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@ToolParam(description = &quot;æœç´¢å…³é”®è¯&quot;)</span> String query)</span> &#123;</span><br><span class="line">        Map&lt;String, Object&gt; paramMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        paramMap.put(<span class="string">&quot;q&quot;</span>, query);</span><br><span class="line">        paramMap.put(<span class="string">&quot;api_key&quot;</span>, apiKey);</span><br><span class="line">        paramMap.put(<span class="string">&quot;engine&quot;</span>, <span class="string">&quot;baidu&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">response</span> <span class="operator">=</span> HttpUtil.get(SEARCH_API_URL, paramMap);</span><br><span class="line">            <span class="comment">// å–å‡ºè¿”å›ç»“æœçš„å‰ 5 æ¡</span></span><br><span class="line">            <span class="type">JSONObject</span> <span class="variable">jsonObject</span> <span class="operator">=</span> JSONUtil.parseObj(response);</span><br><span class="line">            <span class="comment">// æå– organic_results éƒ¨åˆ†</span></span><br><span class="line">            <span class="type">JSONArray</span> <span class="variable">organicResults</span> <span class="operator">=</span> jsonObject.getJSONArray(<span class="string">&quot;organic_results&quot;</span>);</span><br><span class="line">            List&lt;Object&gt; objects = organicResults.subList(<span class="number">0</span>, <span class="number">5</span>);</span><br><span class="line">            <span class="comment">// æ‹¼æ¥æœç´¢ç»“æœä¸ºå­—ç¬¦ä¸²</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> objects.stream().map(obj -&gt; &#123;</span><br><span class="line">                <span class="type">JSONObject</span> <span class="variable">tmpJSONObject</span> <span class="operator">=</span> (JSONObject) obj;</span><br><span class="line">                <span class="keyword">return</span> tmpJSONObject.toString();</span><br><span class="line">            &#125;).collect(Collectors.joining(<span class="string">&quot;,&quot;</span>));</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;æœç´¢å‡ºé”™: &quot;</span> + e.getMessage();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>ç½‘é¡µæŠ“å–å·¥å…·<br>ç”¨äºè·å–å’Œè§£ææŒ‡å®šç½‘å€çš„é¡µé¢å†…å®¹ã€‚<br>å€ŸåŠ©jsoupåº“å®ç°ç½‘é¡µå†…å®¹çš„æŠ“å–å’Œè§£æï¼š</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebScrapingTool</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Tool(description = &quot;ä»æŒ‡å®šURLæŠ“å–ç½‘é¡µå†…å®¹&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">scrapeWebPage</span><span class="params">(<span class="meta">@ToolParam(description = &quot;è¦æŠ“å–çš„ç½‘é¡µURL&quot;)</span> String url)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Document</span> <span class="variable">doc</span> <span class="operator">=</span> Jsoup.connect(url).get();</span><br><span class="line">            <span class="keyword">return</span> doc.html();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;æŠ“å–ç½‘é¡µå‡ºé”™: &quot;</span> + e.getMessage();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>ç»ˆç«¯æ“ä½œå·¥å…·<br>å…è®¸æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œä¾‹å¦‚è¿è¡ŒPythonè„šæœ¬æˆ–æ‰§è¡Œå…¶ä»–å‘½ä»¤è¡Œæ“ä½œã€‚<br>é€šè¿‡Javaçš„Process API,æˆ‘ä»¬å¯ä»¥å®‰å…¨åœ°æ‰§è¡Œç»ˆç«¯å‘½ä»¤ï¼š</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TerminalOperationTool</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Tool(description = &quot;åœ¨ç»ˆç«¯æ‰§è¡Œå‘½ä»¤&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">executeTerminalCommand</span><span class="params">(<span class="meta">@ToolParam(description = &quot;è¦æ‰§è¡Œçš„å‘½ä»¤&quot;)</span> String command)</span> &#123;</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">output</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">ProcessBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ProcessBuilder</span>(<span class="string">&quot;cmd.exe&quot;</span>, <span class="string">&quot;/c&quot;</span>, command);</span><br><span class="line">            <span class="type">Process</span> <span class="variable">process</span> <span class="operator">=</span> builder.start();</span><br><span class="line">            <span class="keyword">try</span> (<span class="type">BufferedReader</span> <span class="variable">reader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(process.getInputStream()))) &#123;</span><br><span class="line">                String line;</span><br><span class="line">                <span class="keyword">while</span> ((line = reader.readLine()) != <span class="literal">null</span>) &#123;</span><br><span class="line">                    output.append(line).append(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">int</span> <span class="variable">exitCode</span> <span class="operator">=</span> process.waitFor();</span><br><span class="line">            <span class="keyword">if</span> (exitCode != <span class="number">0</span>) &#123;</span><br><span class="line">                output.append(<span class="string">&quot;å‘½ä»¤æ‰§è¡Œå¤±è´¥ï¼Œé€€å‡ºç : &quot;</span>).append(exitCode);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException | InterruptedException e) &#123;</span><br><span class="line">            output.append(<span class="string">&quot;æ‰§è¡Œå‘½ä»¤å‡ºé”™: &quot;</span>).append(e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> output.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>èµ„æºä¸‹è½½å·¥å…·<br>ä»æŒ‡å®šé“¾æ¥è·å–æ–‡ä»¶å¹¶ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨ã€‚<br>åˆ©ç”¨Hutoolçš„HttpUti1.down1 oadFileæ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥ç®€åŒ–æ–‡ä»¶ä¸‹è½½è¿‡ç¨‹ï¼š</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ResourceDownloadTool</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Tool(description = &quot;ä»æŒ‡å®šURLä¸‹è½½èµ„æºåˆ°æœ¬åœ°&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">downloadResource</span><span class="params">(<span class="meta">@ToolParam(description = &quot;è¦ä¸‹è½½çš„èµ„æºURL&quot;)</span> String url, <span class="meta">@ToolParam(description = &quot;ä¿å­˜åˆ°æœ¬åœ°çš„æ–‡ä»¶å&quot;)</span> String fileName)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">fileDir</span> <span class="operator">=</span> FileConstant.FILE_SAVE_DIR + <span class="string">&quot;/download&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">filePath</span> <span class="operator">=</span> fileDir + <span class="string">&quot;/&quot;</span> + fileName;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// ç¡®ä¿ç›®å½•å­˜åœ¨</span></span><br><span class="line">            FileUtil.mkdir(fileDir);</span><br><span class="line">            <span class="comment">// ä½¿ç”¨ Hutool çš„ downloadFile æ–¹æ³•ä¸‹è½½èµ„æº</span></span><br><span class="line">            HttpUtil.downloadFile(url, <span class="keyword">new</span> <span class="title class_">File</span>(filePath));</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;èµ„æºæˆåŠŸä¸‹è½½è‡³: &quot;</span> + filePath;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;ä¸‹è½½èµ„æºå‡ºé”™: &quot;</span> + e.getMessage();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="6">
<li>PDFç”Ÿæˆå·¥å…·<br>æ ¹æ®æä¾›çš„å†…å®¹åˆ›å»ºæ ¼å¼åŒ–çš„PDFæ–‡æ¡£ã€‚<br>ä½¿ç”¨itextåº“å®ç°PDFæ–‡æ¡£çš„ç”Ÿæˆï¼š</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PDFGenerationTool</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Tool(description = &quot;æ ¹æ®å†…å®¹ç”ŸæˆPDFæ–‡ä»¶&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">generatePDF</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@ToolParam(description = &quot;è¦ä¿å­˜çš„PDFæ–‡ä»¶å&quot;)</span> String fileName,</span></span><br><span class="line"><span class="params">            <span class="meta">@ToolParam(description = &quot;PDFæ–‡ä»¶çš„å†…å®¹&quot;)</span> String content)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">fileDir</span> <span class="operator">=</span> FileConstant.FILE_SAVE_DIR + <span class="string">&quot;/pdf&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">filePath</span> <span class="operator">=</span> fileDir + <span class="string">&quot;/&quot;</span> + fileName;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// ç¡®ä¿ç›®å½•å­˜åœ¨</span></span><br><span class="line">            FileUtil.mkdir(fileDir);</span><br><span class="line">            <span class="comment">// åˆ›å»º PdfWriter å’Œ PdfDocument å¯¹è±¡</span></span><br><span class="line">            <span class="keyword">try</span> (<span class="type">PdfWriter</span> <span class="variable">writer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PdfWriter</span>(filePath);</span><br><span class="line">                 <span class="type">PdfDocument</span> <span class="variable">pdf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PdfDocument</span>(writer);</span><br><span class="line">                 <span class="type">Document</span> <span class="variable">document</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Document</span>(pdf)) &#123;</span><br><span class="line">                <span class="comment">// ä½¿ç”¨å†…ç½®ä¸­æ–‡å­—ä½“</span></span><br><span class="line">                <span class="type">PdfFont</span> <span class="variable">font</span> <span class="operator">=</span> PdfFontFactory.createFont(<span class="string">&quot;STSongStd-Light&quot;</span>, <span class="string">&quot;UniGB-UCS2-H&quot;</span>);</span><br><span class="line">                document.setFont(font);</span><br><span class="line">                <span class="comment">// åˆ›å»ºæ®µè½</span></span><br><span class="line">                <span class="type">Paragraph</span> <span class="variable">paragraph</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Paragraph</span>(content);</span><br><span class="line">                <span class="comment">// æ·»åŠ æ®µè½å¹¶å…³é—­æ–‡æ¡£</span></span><br><span class="line">                document.add(paragraph);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;PDFæ–‡ä»¶æˆåŠŸç”Ÿæˆè‡³: &quot;</span> + filePath;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;ç”ŸæˆPDFå‡ºé”™: &quot;</span> + e.getMessage();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é›†ä¸­æ³¨å†Œå·¥å…·<br>å¼€å‘å®Œæˆè¿™äº›å·¥å…·ç±»åï¼Œæ ¹æ®åº”ç”¨éœ€æ±‚ï¼Œæˆ‘ä»¬å¯ä»¥ä¸€æ¬¡æ€§å‘AIæä¾›æ‰€æœ‰å·¥å…·ï¼Œè®©å…¶è‡ªä¸»å†³å®šä½•æ—¶è°ƒç”¨å“ªä¸ªå·¥å…·ã€‚<br>ä¸ºæ­¤ï¼Œåˆ›å»ºä¸€ä¸ªå·¥å…·æ³¨å†Œç±»å¯ä»¥æ›´æ–¹ä¾¿åœ°ç»Ÿä¸€ç®¡ç†å’Œç»‘å®šæ‰€æœ‰å·¥å…·ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ToolRegistration</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;search-api.api-key&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String searchApiKey;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ToolCallback[] allTools() &#123;</span><br><span class="line">        <span class="type">FileOperationTool</span> <span class="variable">fileOperationTool</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOperationTool</span>();</span><br><span class="line">        <span class="type">WebSearchTool</span> <span class="variable">webSearchTool</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WebSearchTool</span>(searchApiKey);</span><br><span class="line">        <span class="type">WebScrapingTool</span> <span class="variable">webScrapingTool</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WebScrapingTool</span>();</span><br><span class="line">        <span class="type">ResourceDownloadTool</span> <span class="variable">resourceDownloadTool</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ResourceDownloadTool</span>();</span><br><span class="line">        <span class="type">TerminalOperationTool</span> <span class="variable">terminalOperationTool</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TerminalOperationTool</span>();</span><br><span class="line">        <span class="type">PDFGenerationTool</span> <span class="variable">pdfGenerationTool</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PDFGenerationTool</span>();</span><br><span class="line">        <span class="keyword">return</span> ToolCallbacks.from(</span><br><span class="line">            fileOperationTool,</span><br><span class="line">            webSearchTool,</span><br><span class="line">            webScrapingTool,</span><br><span class="line">            resourceDownloadTool,</span><br><span class="line">            terminalOperationTool,</span><br><span class="line">            pdfGenerationTool</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h1 id="MCP-åè®®"><a href="#MCP-åè®®" class="headerlink" title="MCP åè®®"></a>MCP åè®®</h1><p>MCP(Model Context Protocol,æ¨¡å‹ä¸Šä¸‹æ–‡åè®®)<br>æ˜¯ä¸€ç§å¼€æ”¾æ ‡å‡†ï¼Œå®ƒè®©AIèƒ½å¤Ÿä¸å¤–éƒ¨ç³»ç»Ÿäº¤äº’ã€‚å¯ä»¥å°†MCPæƒ³è±¡æˆAIåº”ç”¨çš„æ ‡å‡†æ¥å£ï¼Œå°±åƒUSBè®©ç”µè„‘å¯ä»¥è¿æ¥å„ç§è®¾å¤‡ä¸€æ ·ï¼ŒMCPè®©AIæ¨¡å‹èƒ½å¤Ÿè¿æ¥ä¸åŒçš„æ•°æ®æºå’Œå·¥å…·<br>MCPåè®®çš„ä¸‰å¤§ä½œç”¨ï¼š</p>
<ol>
<li>è½»æ¾å¢å¼ºAIçš„èƒ½åŠ›ï¼šé€šè¿‡æ¥å…¥MCPæœåŠ¡ï¼ŒAIå¯ä»¥æœç´¢ç½‘é¡µã€æŸ¥è¯¢æ•°æ®åº“ã€è°ƒç”¨ç¬¬ä¸‰æ–¹APIã€æ‰§è¡Œè®¡ç®—ç­‰</li>
<li>ç»Ÿä¸€æ ‡å‡†ï¼Œé™ä½ä½¿ç”¨æˆæœ¬ï¼šå¼€å‘è€…ä¸å¿…ä¸ºæ¯ä¸ªé¡¹ç›®é‡å¤å¼€å‘ç›¸åŒåŠŸèƒ½</li>
<li>æ‰“é€ æœåŠ¡ç”Ÿæ€ï¼šå½¢æˆMCPæœåŠ¡å¸‚åœºï¼Œè®©å¼€å‘è€…èƒ½å…±äº«å’Œä½¿ç”¨å½¼æ­¤çš„æœåŠ¡<br>MCPçš„æ ¸å¿ƒæ¶æ„æ˜¯â€å®¢æˆ·ç«¯-æœåŠ¡å™¨â€æ¨¡å¼ï¼Œå®¢æˆ·ç«¯ä¸»æœºå¯ä»¥è¿æ¥åˆ°å¤šä¸ªæœåŠ¡å™¨ã€‚<br>åœ¨å¼€å‘å±‚é¢ï¼ŒMCP SDKåˆ†ä¸ºä¸‰å±‚ï¼š</li>
<li>å®¢æˆ·ç«¯&#x2F;æœåŠ¡å™¨å±‚ï¼šå¤„ç†å„è‡ªçš„åè®®æ“ä½œ</li>
<li>ä¼šè¯å±‚ï¼šç®¡ç†é€šä¿¡æ¨¡å¼å’ŒçŠ¶æ€</li>
<li>ä¼ è¾“å±‚ï¼šå¤„ç†æ¶ˆæ¯åºåˆ—åŒ–å’Œä¼ è¾“</li>
</ol>
<p>MCPæ”¯æŒå¤šç§æ ¸å¿ƒæ¦‚å¿µï¼Œå…¶ä¸­æœ€å®ç”¨çš„æ˜¯Tools(å·¥å…·)ï¼Œè®©æœåŠ¡ç«¯å¯ä»¥å‘å®¢æˆ·ç«¯æä¾›å¯è°ƒç”¨çš„å‡½æ•°ï¼Œä½¿AIæ¨¡å‹èƒ½æ‰§è¡Œè®¡ç®—ã€æŸ¥è¯¢ä¿¡æ¯æˆ–ä¸å¤–éƒ¨ç³»ç»Ÿäº¤äº’ã€‚</p>
<p>äº‘å¹³å°ä½¿ç”¨ MCP<br>ä»¥é˜¿é‡Œäº‘ç™¾ç‚¼ä¸ºä¾‹ï¼Œå¹³å°æä¾›äº†å¤šç§é¢„ç½®çš„MCPæœåŠ¡ï¼Œæ¯”å¦‚é«˜å¾·åœ°å›¾MCPæœåŠ¡ã€‚<br>ä½¿ç”¨éå¸¸ç®€å•ï¼Œåªéœ€è¿›å…¥æ™ºèƒ½ä½“åº”ç”¨ï¼Œåœ¨å·¦ä¾§æ·»åŠ MCPæœåŠ¡ï¼Œç„¶åé€‰æ‹©æƒ³ç”¨çš„æœåŠ¡å³å¯ã€‚<br>ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥æµ‹è¯•é«˜å¾·åœ°å›¾MCP:<br><code>æç¤ºï¼šæˆ‘çš„å¦ä¸€åŠå±…ä½åœ¨ä¸Šæµ·é™å®‰åŒºï¼Œè¯·å¸®æˆ‘æ‰¾åˆ° 5 å…¬é‡Œå†…åˆé€‚çš„çº¦ä¼šåœ°ç‚¹ã€‚</code><br>AIä¼šè‡ªåŠ¨è°ƒç”¨MCPæä¾›çš„å·¥å…·ï¼Œæ¯”å¦‚å°†åœ°ç‚¹è½¬ä¸ºåæ ‡ã€æŸ¥æ‰¾é™„è¿‘åœ°ç‚¹ï¼Œç„¶åç”Ÿæˆå›å¤ã€‚</p>
<p>è½¯ä»¶å®¢æˆ·ç«¯ä½¿ç”¨MCP<br>ä»¥Cursorä¸ºä¾‹ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ol>
<li>å®‰è£…å¿…è¦å·¥å…·ï¼Œå¦‚Node.jså’ŒNPX(å¤§å¤šæ•°MCPæœåŠ¡éƒ½æ”¯æŒNPXè¿è¡Œ)</li>
<li>ç”³è¯·æ‰€éœ€çš„API Key(å¦‚é«˜å¾·åœ°å›¾API Key)</li>
<li>åœ¨Cursorè®¾ç½®ä¸­æ·»åŠ MCP Server,å¹¶ç²˜è´´é…ç½®</li>
<li>æµ‹è¯•ä½¿ç”¨ï¼ŒåŒæ ·å¯ä»¥è¯¢é—®é™„è¿‘çº¦ä¼šåœ°ç‚¹</li>
</ol>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MCP é…ç½®ç¤ºä¾‹</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;amap-maps&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;command&quot;</span><span class="punctuation">:</span> <span class="string">&quot;npx&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;args&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;-y&quot;</span><span class="punctuation">,</span> <span class="string">&quot;@amap/amap-maps-mcp-server&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;env&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;AMAP_MAPS_API_KEY&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ä½ çš„APIå¯†é’¥&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>


<p>ç¨‹åºä¸­ä½¿ç”¨MCP<br>é€šè¿‡Spring Alæ¡†æ¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨Javaç¨‹åºä¸­ä½¿ç”¨MCPã€‚</p>
<ol>
<li>å¼•å…¥ä¾èµ–ï¼š</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.ai<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-ai-mcp-client-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ol start="2">
<li>é…ç½®MCPæœåŠ¡ï¼š</li>
</ol>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// mcp-servers.json</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;mcpServers&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;amap-maps&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;command&quot;</span><span class="punctuation">:</span> <span class="string">&quot;npx&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;args&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;-y&quot;</span><span class="punctuation">,</span> <span class="string">&quot;@amap/amap-maps-mcp-server&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;env&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;AMAP_MAPS_API_KEY&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ä½ çš„APIå¯†é’¥&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<ol start="3">
<li>ä¿®æ”¹Springé…ç½®ï¼š</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">ai:</span></span><br><span class="line">    <span class="attr">mcp:</span></span><br><span class="line">      <span class="attr">client:</span></span><br><span class="line">        <span class="attr">stdio:</span></span><br><span class="line">          <span class="attr">servers-configuration:</span> <span class="string">classpath:mcp-servers.json</span></span><br></pre></td></tr></table></figure>
<ol start="4">
<li>ç¼–å†™ä»£ç ä½¿ç”¨MCP:</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Resource</span></span><br><span class="line"><span class="keyword">private</span> ToolCallbackProvider toolCallbackProvider;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">doChatWithMcp</span><span class="params">(String message, String chatId)</span> &#123;</span><br><span class="line">    <span class="type">ChatResponse</span> <span class="variable">response</span> <span class="operator">=</span> chatClient</span><br><span class="line">            .prompt()</span><br><span class="line">            .user(message)</span><br><span class="line">            .advisors(spec -&gt; spec.param(CHAT_MEMORY_CONVERSATION_ID_KEY, chatId)</span><br><span class="line">                    .param(CHAT_MEMORY_RETRIEVE_SIZE_KEY, <span class="number">10</span>))</span><br><span class="line">            .advisors(<span class="keyword">new</span> <span class="title class_">MyLoggerAdvisor</span>())</span><br><span class="line">            .tools(toolCallbackProvider)</span><br><span class="line">            .call()</span><br><span class="line">            .chatResponse();</span><br><span class="line">    <span class="type">String</span> <span class="variable">content</span> <span class="operator">=</span> response.getResult().getOutput().getText();</span><br><span class="line">    log.info(<span class="string">&quot;content: &#123;&#125;&quot;</span>, content);</span><br><span class="line">    <span class="keyword">return</span> content;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Spring AI MCPå¼€å‘æ¨¡å¼<br>MCPå®¢æˆ·ç«¯å¼€å‘<br>Spring AI æä¾›äº†ä¸ Spring Bootæ•´åˆçš„MCP å®¢æˆ·ç«¯ SDKï¼Œæ”¯æŒåŒæ­¥å’Œå¼‚æ­¥è°ƒç”¨æ¨¡å¼ã€‚</p>
<ol>
<li>å¼•å…¥ä¾èµ–ï¼š</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.ai<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-ai-mcp-client-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ol start="2">
<li>é…ç½®è¿æ¥ï¼šæ”¯æŒç›´æ¥åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®æˆ–å¼•ç”¨JSONæ–‡ä»¶</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ–¹å¼ä¸€ï¼šç›´æ¥é…ç½®</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">ai:</span></span><br><span class="line">    <span class="attr">mcp:</span></span><br><span class="line">      <span class="attr">client:</span></span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">ç¼–ç¨‹å¯¼èˆª-mcp-client</span></span><br><span class="line">        <span class="attr">version:</span> <span class="number">1.0</span><span class="number">.0</span></span><br><span class="line">        <span class="attr">request-timeout:</span> <span class="string">30s</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">SYNC</span></span><br><span class="line">        <span class="attr">sse:</span></span><br><span class="line">          <span class="attr">connections:</span></span><br><span class="line">            <span class="attr">server1:</span></span><br><span class="line">              <span class="attr">url:</span> <span class="string">http://localhost:8080</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–¹å¼äºŒï¼šå¼•ç”¨JSONæ–‡ä»¶</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">ai:</span></span><br><span class="line">    <span class="attr">mcp:</span></span><br><span class="line">      <span class="attr">client:</span></span><br><span class="line">        <span class="attr">stdio:</span></span><br><span class="line">          <span class="attr">servers-configuration:</span> <span class="string">classpath:mcp-servers.json</span></span><br></pre></td></tr></table></figure>
<ol start="3">
<li>ä½¿ç”¨æœåŠ¡ï¼šé€šè¿‡è‡ªåŠ¨æ³¨å…¥çš„Beanæ¥ä½¿ç”¨MCPæœåŠ¡</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨æ–¹å¼ä¸€ï¼šç›´æ¥æ§åˆ¶ MCP å®¢æˆ·ç«¯</span></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> List&lt;McpSyncClient&gt; mcpSyncClients;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨æ–¹å¼äºŒï¼šæ•´åˆ Spring AI å·¥å…·è°ƒç”¨</span></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> SyncMcpToolCallbackProvider toolCallbackProvider;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ¨ AI å¯¹è¯ä¸­ä½¿ç”¨ MCP å·¥å…·</span></span><br><span class="line"><span class="type">ChatResponse</span> <span class="variable">response</span> <span class="operator">=</span> chatClient</span><br><span class="line">        .prompt()</span><br><span class="line">        .user(<span class="string">&quot;è¯·æŸ¥è¯¢ä¸Šæµ·é™å®‰åŒºé™„è¿‘çš„é¤å…&quot;</span>)</span><br><span class="line">        .tools(toolCallbackProvider)</span><br><span class="line">        .call()</span><br><span class="line">        .chatResponse();</span><br></pre></td></tr></table></figure>

<p>MCPæœåŠ¡ç«¯å¼€å‘<br>SpringAIè¿˜æä¾›äº†MCPæœåŠ¡ç«¯å¼€å‘çš„æ”¯æŒï¼Œè®©æˆ‘ä»¬å¯ä»¥å¼€å‘è‡ªå·±çš„MCPæœåŠ¡ã€‚</p>
<ol>
<li>å¼•å…¥ä¾èµ–ï¼š</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.ai<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-ai-starter-mcp-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ol start="2">
<li>é…ç½®æœåŠ¡</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">ai:</span></span><br><span class="line">    <span class="attr">mcp:</span></span><br><span class="line">      <span class="attr">server:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">ç¼–ç¨‹å¯¼èˆª-mcp-server</span></span><br><span class="line">        <span class="attr">version:</span> <span class="number">1.0</span><span class="number">.0</span></span><br><span class="line">        <span class="attr">stdio:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">SYNC</span></span><br></pre></td></tr></table></figure>
<ol start="3">
<li>å¼€å‘æœåŠ¡ï¼šä½¿ç”¨@Too1æ³¨è§£æ ‡è®°æœåŠ¡ç±»ä¸­çš„æ–¹æ³•</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WeatherService</span> &#123;</span><br><span class="line">    <span class="meta">@Tool(description = &quot;è·å–æŒ‡å®šåŸå¸‚çš„å¤©æ°”ä¿¡æ¯&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getWeather</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@ToolParam(description = &quot;åŸå¸‚åç§°ï¼Œå¦‚åŒ—äº¬ã€ä¸Šæµ·&quot;)</span> String cityName)</span> &#123;</span><br><span class="line">        <span class="comment">// å®ç°å¤©æ°”æŸ¥è¯¢é€»è¾‘</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;åŸå¸‚&quot;</span> + cityName + <span class="string">&quot;çš„å¤©æ°”æ˜¯æ™´å¤©ï¼Œæ¸©åº¦22Â°C&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>æ³¨å†Œå·¥å…·</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">McpServerApplication</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ToolCallbackProvider <span class="title function_">weatherTools</span><span class="params">(WeatherService weatherService)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> MethodToolCallbackProvider.builder()</span><br><span class="line">                .toolObjects(weatherService)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ç¬¬äº”æ¬¡å®è·µ"><a href="#ç¬¬äº”æ¬¡å®è·µ" class="headerlink" title="ç¬¬äº”æ¬¡å®è·µ"></a>ç¬¬äº”æ¬¡å®è·µ</h2><p>MCPå¼€å‘å®æˆ˜ï¼šå›¾ç‰‡æœç´¢æœåŠ¡<br>æœåŠ¡ç«¯å¼€å‘</p>
<ol>
<li>åˆ›å»ºé¡¹ç›®å¹¶å¼•å…¥ä¾èµ–ï¼š</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.ai<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-ai-starter-mcp-server-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ol start="2">
<li>é…ç½®</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">yu-image-search-mcp-server</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">stdio</span></span><br><span class="line">  <span class="attr">ai:</span></span><br><span class="line">    <span class="attr">mcp:</span></span><br><span class="line">      <span class="attr">server:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">yu-image-search-mcp-server</span></span><br><span class="line">        <span class="attr">version:</span> <span class="number">0.0</span><span class="number">.1</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">SYNC</span></span><br><span class="line">        <span class="attr">stdio:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8127</span></span><br></pre></td></tr></table></figure>
<ol start="3">
<li>å¼€å‘å›¾ç‰‡æœç´¢å·¥å…·ï¼š</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ImageSearchTool</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">API_KEY</span> <span class="operator">=</span> <span class="string">&quot;ä½ çš„Pexels APIå¯†é’¥&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">API_URL</span> <span class="operator">=</span> <span class="string">&quot;https://api.pexels.com/v1/search&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Tool(description = &quot;search image from web&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">searchImage</span><span class="params">(<span class="meta">@ToolParam(description = &quot;Search query keyword&quot;)</span> String query)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> String.join(<span class="string">&quot;,&quot;</span>, searchMediumImages(query));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Error search image: &quot;</span> + e.getMessage();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;String&gt; <span class="title function_">searchMediumImages</span><span class="params">(String query)</span> &#123;</span><br><span class="line">        <span class="comment">// è®¾ç½®è¯·æ±‚å¤´</span></span><br><span class="line">        Map&lt;String, String&gt; headers = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        headers.put(<span class="string">&quot;Authorization&quot;</span>, API_KEY);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è®¾ç½®è¯·æ±‚å‚æ•°</span></span><br><span class="line">        Map&lt;String, Object&gt; params = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        params.put(<span class="string">&quot;query&quot;</span>, query);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å‘é€GETè¯·æ±‚</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">response</span> <span class="operator">=</span> HttpUtil.createGet(API_URL)</span><br><span class="line">                .addHeaders(headers)</span><br><span class="line">                .form(params)</span><br><span class="line">                .execute()</span><br><span class="line">                .body();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è§£æå“åº”JSON</span></span><br><span class="line">        <span class="keyword">return</span> JSONUtil.parseObj(response)</span><br><span class="line">                .getJSONArray(<span class="string">&quot;photos&quot;</span>)</span><br><span class="line">                .stream()</span><br><span class="line">                .map(photoObj -&gt; (JSONObject) photoObj)</span><br><span class="line">                .map(photoObj -&gt; photoObj.getJSONObject(<span class="string">&quot;src&quot;</span>))</span><br><span class="line">                .map(photo -&gt; photo.getStr(<span class="string">&quot;medium&quot;</span>))</span><br><span class="line">                .filter(StrUtil::isNotBlank)</span><br><span class="line">                .collect(Collectors.toList());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>åœ¨ä¸»ç±»ä¸­æ³¨å†Œå·¥å…·ï¼š</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">YuImageSearchMcpServerApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(YuImageSearchMcpServerApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ToolCallbackProvider <span class="title function_">imageSearchTools</span><span class="params">(ImageSearchTool imageSearchTool)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> MethodToolCallbackProvider.builder()</span><br><span class="line">                .toolObjects(imageSearchTool)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å®¢æˆ·ç«¯è°ƒç”¨</p>
<ol>
<li>é…ç½®å®¢æˆ·ç«¯ï¼š</li>
</ol>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// mcp-servers.json</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;mcpServers&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;yu-image-search-mcp-server&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;command&quot;</span><span class="punctuation">:</span> <span class="string">&quot;java&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;args&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;-Dspring.ai.mcp.server.stdio=true&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;-Dspring.main.web-application-type=none&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;-Dlogging.pattern.console=&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;-jar&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;yu-image-search-mcp-server/target/yu-image-search-mcp-server-0.0.1-SNAPSHOT.jar&quot;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;env&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<ol start="2">
<li>æµ‹è¯•</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">doChatWithMcp</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// æµ‹è¯•å›¾ç‰‡æœç´¢ MCP</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;å¸®æˆ‘æœç´¢ä¸€äº›ç¼–ç¨‹å¯¼èˆªç›¸å…³çš„å›¾ç‰‡&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">answer</span> <span class="operator">=</span> loveApp.doChatWithMcp(message, chatId);</span><br><span class="line">    Assertions.assertNotNull(answer);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>MCPéƒ¨ç½²æ–¹æ¡ˆ<br>MCPæœåŠ¡çš„éƒ¨ç½²å¯åˆ†ä¸ºæœ¬åœ°éƒ¨ç½²å’Œè¿œç¨‹éƒ¨ç½²ä¸¤ç§æ–¹å¼ï¼š</p>
<ol>
<li>æœ¬åœ°éƒ¨ç½²ï¼šé€‚ç”¨äº stdio ä¼ è¾“æ–¹å¼ï¼Œå°† MCPæœåŠ¡æ‰“åŒ…åæ”¾åœ¨å®¢æˆ·ç«¯å¯è®¿é—®çš„è·¯å¾„ä¸‹</li>
<li>è¿œç¨‹éƒ¨ç½²ï¼šé€‚ç”¨äº SSE ä¼ è¾“æ–¹å¼ï¼Œéƒ¨ç½²ä¸ºç‹¬ç«‹çš„Web æœåŠ¡</li>
<li>Serverlesséƒ¨ç½²ï¼šä½¿ç”¨äº‘å‡½æ•°ç­‰Serverlesså¹³å°éƒ¨ç½²MCPæœåŠ¡ï¼ŒæŒ‰éœ€ä»˜è´¹<br>è¿˜å¯ä»¥å°†å¼€å‘å¥½çš„ MCP æœåŠ¡æäº¤åˆ° MCP æœåŠ¡å¸‚åœºï¼Œä¾›æ›´å¤šå¼€å‘è€…ä½¿ç”¨ï¼Œæ¯”å¦‚ MCP.soã€é˜¿é‡Œäº‘ç™¾ç‚¼ MCP æœåŠ¡å¸‚åœºç­‰ã€‚</li>
</ol>
<h2 id="ç»ƒä¹ -1"><a href="#ç»ƒä¹ -1" class="headerlink" title="ç»ƒä¹ "></a>ç»ƒä¹ </h2><p>ç»ƒä¹ 1ï¼šMCPå®¢æˆ·ç«¯é…ç½®<br>è¯·ç¼–å†™ä¸€ä¸ªä½¿ç”¨SpringAIé€šè¿‡stdioæ¨¡å¼è¿æ¥å›¾ç‰‡æœç´¢MCPæœåŠ¡çš„é…ç½®æ–‡ä»¶ã€‚</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">ai:</span></span><br><span class="line">    <span class="attr">mcp:</span></span><br><span class="line">      <span class="attr">client:</span></span><br><span class="line">        <span class="attr">stdio:</span></span><br><span class="line">          <span class="attr">servers-configuration:</span> <span class="string">classpath:mcp-servers.json</span></span><br></pre></td></tr></table></figure>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// mcp-servers.json</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;mcpServers&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;image-search&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;command&quot;</span><span class="punctuation">:</span> <span class="string">&quot;java&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;args&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;-jar&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="string">&quot;path/to/image-search-mcp-server.jar&quot;</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;env&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;API_KEY&quot;</span><span class="punctuation">:</span> <span class="string">&quot;your-api-key-here&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>ç»ƒä¹ 2ï¼šåˆ›å»ºç®€å•çš„MCPå·¥å…·<br>å¼€å‘ä¸€ä¸ªè®¡ç®—å™¨MCPæœåŠ¡ï¼Œæä¾›åŠ æ³•å’Œä¹˜æ³•å·¥å…·ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CalculatorService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Tool(description = &quot;è®¡ç®—ä¸¤ä¸ªæ•°å­—çš„å’Œ&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">add</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@ToolParam(description = &quot;ç¬¬ä¸€ä¸ªæ•°å­—&quot;)</span> <span class="type">double</span> a,</span></span><br><span class="line"><span class="params">            <span class="meta">@ToolParam(description = &quot;ç¬¬äºŒä¸ªæ•°å­—&quot;)</span> <span class="type">double</span> b)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> a + b;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Tool(description = &quot;è®¡ç®—ä¸¤ä¸ªæ•°å­—çš„ä¹˜ç§¯&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">multiply</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@ToolParam(description = &quot;ç¬¬ä¸€ä¸ªæ•°å­—&quot;)</span> <span class="type">double</span> a,</span></span><br><span class="line"><span class="params">            <span class="meta">@ToolParam(description = &quot;ç¬¬äºŒä¸ªæ•°å­—&quot;)</span> <span class="type">double</span> b)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> a * b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CalculatorMcpApplication</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(CalculatorMcpApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ToolCallbackProvider <span class="title function_">calculatorTools</span><span class="params">(CalculatorService calculatorService)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> MethodToolCallbackProvider.builder()</span><br><span class="line">                .toolObjects(calculatorService)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h1 id="AIåº”ç”¨æµ‹è¯•ä¸éƒ¨ç½²"><a href="#AIåº”ç”¨æµ‹è¯•ä¸éƒ¨ç½²" class="headerlink" title="AIåº”ç”¨æµ‹è¯•ä¸éƒ¨ç½²"></a>AIåº”ç”¨æµ‹è¯•ä¸éƒ¨ç½²</h1><h2 id="å•å…ƒæµ‹è¯•ä¸é›†æˆæµ‹è¯•å®ç°"><a href="#å•å…ƒæµ‹è¯•ä¸é›†æˆæµ‹è¯•å®ç°" class="headerlink" title="å•å…ƒæµ‹è¯•ä¸é›†æˆæµ‹è¯•å®ç°"></a>å•å…ƒæµ‹è¯•ä¸é›†æˆæµ‹è¯•å®ç°</h2><p>AIç»„ä»¶çš„å•å…ƒæµ‹è¯•<br>å¯¹äºAIåº”ç”¨ï¼Œå•å…ƒæµ‹è¯•ä¸»è¦å…³æ³¨åº”ç”¨çš„éAIéƒ¨åˆ†å’Œä¸AIæœåŠ¡çš„é›†æˆæ¥å£ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="meta">@AutoConfigureMockMvc</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProductControllerIntegrationTest</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MockMvc mockMvc;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@MockBean</span></span><br><span class="line">    <span class="keyword">private</span> ChatClient chatClient;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGenerateProductDescription</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// æ¨¡æ‹Ÿ AI å“åº”</span></span><br><span class="line">        <span class="keyword">when</span>(chatClient.call(any())).thenReturn(</span><br><span class="line">            <span class="string">&quot;è¿™æ˜¯ä¸€ä¸ªAIç”Ÿæˆçš„äº§å“æè¿°ã€‚&quot;</span></span><br><span class="line">        );</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ‰§è¡Œè¯·æ±‚å¹¶éªŒè¯</span></span><br><span class="line">        mockMvc.perform(post(<span class="string">&quot;/api/products/describe&quot;</span>)</span><br><span class="line">            .contentType(MediaType.APPLICATION_JSON)</span><br><span class="line">            .content(<span class="string">&quot;&#123;\&quot;name\&quot;:\&quot;ä»£ç å°æŠ„\&quot;,\&quot;category\&quot;:\&quot;å¼€å‘å·¥å…·\&quot;&#125;&quot;</span>))</span><br><span class="line">            .andExpect(status().isOk())</span><br><span class="line">            .andExpect(jsonPath(<span class="string">&quot;$.description&quot;</span>).exists())</span><br><span class="line">            .andExpect(jsonPath(<span class="string">&quot;$.description&quot;</span>).isString());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>AIåº”ç”¨çš„é›†æˆæµ‹è¯•<br>é›†æˆæµ‹è¯•éªŒè¯æ•´ä¸ªç³»ç»Ÿçš„åŠŸèƒ½ï¼Œå¯ä»¥ä½¿ç”¨çœŸå®çš„AIæœåŠ¡æˆ–æ¨¡æ‹ŸæœåŠ¡ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="meta">@AutoConfigureMockMvc</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProductControllerIntegrationTest</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MockMvc mockMvc;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@MockBean</span></span><br><span class="line">    <span class="keyword">private</span> ChatClient chatClient;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGenerateProductDescription</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// æ¨¡æ‹Ÿ AI å“åº”</span></span><br><span class="line">        <span class="keyword">when</span>(chatClient.call(any())).thenReturn(</span><br><span class="line">            <span class="string">&quot;è¿™æ˜¯ä¸€ä¸ªAIç”Ÿæˆçš„äº§å“æè¿°ã€‚&quot;</span></span><br><span class="line">        );</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ‰§è¡Œè¯·æ±‚å¹¶éªŒè¯</span></span><br><span class="line">        mockMvc.perform(post(<span class="string">&quot;/api/products/describe&quot;</span>)</span><br><span class="line">            .contentType(MediaType.APPLICATION_JSON)</span><br><span class="line">            .content(<span class="string">&quot;&#123;\&quot;name\&quot;:\&quot;ä»£ç å°æŠ„\&quot;,\&quot;category\&quot;:\&quot;å¼€å‘å·¥å…·\&quot;&#125;&quot;</span>))</span><br><span class="line">            .andExpect(status().isOk())</span><br><span class="line">            .andExpect(jsonPath(<span class="string">&quot;$.description&quot;</span>).exists())</span><br><span class="line">            .andExpect(jsonPath(<span class="string">&quot;$.description&quot;</span>).isString());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨å›ºå®šæç¤ºå’Œå“åº”é›†<br>ä¸ºäº†å¤„ç†AIå“åº”çš„éç¡®å®šæ€§ï¼Œå¯ä»¥ä½¿ç”¨å›ºå®šçš„æµ‹è¯•æ•°æ®é›†ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testProductRecommendations</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// ä»æµ‹è¯•èµ„æºä¸­åŠ è½½å›ºå®šçš„æç¤ºå’ŒæœŸæœ›å“åº”å¯¹</span></span><br><span class="line">    List&lt;PromptResponsePair&gt; testCases = loadTestCases(<span class="string">&quot;product_recommendations_test_cases.json&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (PromptResponsePair testCase : testCases) &#123;</span><br><span class="line">        <span class="comment">// æ¨¡æ‹Ÿå›ºå®šå“åº”</span></span><br><span class="line">        <span class="keyword">when</span>(chatClient.call(testCase.getPrompt())).thenReturn(testCase.getResponse());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// éªŒè¯ç³»ç»Ÿè¡Œä¸º</span></span><br><span class="line">        <span class="type">ProductRecommendation</span> <span class="variable">recommendation</span> <span class="operator">=</span> </span><br><span class="line">            recommendationService.getRecommendation(testCase.getInput());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ–­è¨€æœŸæœ›ç»“æœ</span></span><br><span class="line">        assertThat(recommendation).isNotNull();</span><br><span class="line">        assertThat(recommendation.getProducts().size()).isGreaterThan(<span class="number">0</span>);</span><br><span class="line">        <span class="comment">// å…¶ä»–æ–­è¨€...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ä½¿ç”¨Mockå¯¹è±¡è¿›è¡Œæµ‹è¯•"><a href="#ä½¿ç”¨Mockå¯¹è±¡è¿›è¡Œæµ‹è¯•" class="headerlink" title="ä½¿ç”¨Mockå¯¹è±¡è¿›è¡Œæµ‹è¯•"></a>ä½¿ç”¨Mockå¯¹è±¡è¿›è¡Œæµ‹è¯•</h2><p>Mockå¯¹è±¡å¯¹äº AI åº”ç”¨æµ‹è¯•å°¤ä¸ºé‡è¦ï¼Œå› ä¸ºå¯ä»¥ï¼š</p>
<ul>
<li>æ¶ˆé™¤å¯¹å®é™…AIæœåŠ¡çš„ä¾èµ–</li>
<li>åˆ›å»ºå¯é‡å¤çš„æµ‹è¯•ç¯å¢ƒ</li>
<li>é¿å…APIè°ƒç”¨è´¹ç”¨</li>
<li>æ¨¡æ‹Ÿç‰¹å®šçš„å“åº”åœºæ™¯<br>åˆ›å»ºChatClientçš„Mock</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestConfig</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Primary</span></span><br><span class="line">    <span class="meta">@Profile(&quot;test&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ChatClient <span class="title function_">mockChatClient</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºä¸€ä¸ªé¢„è®¾å“åº”çš„ Mock ChatClient</span></span><br><span class="line">        Map&lt;String, String&gt; promptResponseMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        promptResponseMap.put(</span><br><span class="line">            <span class="string">&quot;æ€»ç»“è¿™ç¯‡æ–‡ç« &quot;</span>, </span><br><span class="line">            <span class="string">&quot;è¿™æ˜¯ä¸€ç¯‡å…³äºSpring AIçš„æ–‡ç« ã€‚&quot;</span></span><br><span class="line">        );</span><br><span class="line">        promptResponseMap.put(</span><br><span class="line">            <span class="string">&quot;åˆ†æè¿™æ®µä»£ç &quot;</span>, </span><br><span class="line">            <span class="string">&quot;è¿™æ®µä»£ç å®ç°äº†ä¸€ä¸ªç®€å•çš„æ’åºç®—æ³•ã€‚&quot;</span></span><br><span class="line">        );</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MockChatClient</span>(promptResponseMap);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MockChatClient</span> <span class="keyword">implements</span> <span class="title class_">ChatClient</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, String&gt; promptResponseMap;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MockChatClient</span><span class="params">(Map&lt;String, String&gt; promptResponseMap)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.promptResponseMap = promptResponseMap;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">call</span><span class="params">(String prompt)</span> &#123;</span><br><span class="line">        <span class="comment">// å°è¯•ç²¾ç¡®åŒ¹é…</span></span><br><span class="line">        <span class="keyword">if</span> (promptResponseMap.containsKey(prompt)) &#123;</span><br><span class="line">            <span class="keyword">return</span> promptResponseMap.get(prompt);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å°è¯•æ¨¡ç³ŠåŒ¹é…</span></span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, String&gt; entry : promptResponseMap.entrySet()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (prompt.contains(entry.getKey())) &#123;</span><br><span class="line">                <span class="keyword">return</span> entry.getValue();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// é»˜è®¤å“åº”</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;è¿™æ˜¯ä¸€ä¸ªæ¨¡æ‹Ÿå“åº”ã€‚&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ChatResponse <span class="title function_">call</span><span class="params">(Prompt prompt)</span> &#123;</span><br><span class="line">        <span class="comment">// å®ç°ä» Prompt å¯¹è±¡æå–æ–‡æœ¬å¹¶è¿”å›å“åº”çš„é€»è¾‘</span></span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å®ç°å…¶ä»–å¿…è¦çš„æ–¹æ³•...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ¨¡æ‹Ÿç‰¹å®šåœºæ™¯</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testErrorHandling</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºä¼šæŠ›å‡ºå¼‚å¸¸çš„ mock</span></span><br><span class="line">    <span class="type">ChatClient</span> <span class="variable">errorChatClient</span> <span class="operator">=</span> mock(ChatClient.class);</span><br><span class="line">    <span class="keyword">when</span>(errorChatClient.call(anyString())).thenThrow(<span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;API é”™è¯¯&quot;</span>));</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ³¨å…¥ mock</span></span><br><span class="line">    ReflectionTestUtils.setField(aiService, <span class="string">&quot;chatClient&quot;</span>, errorChatClient);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// éªŒè¯é”™è¯¯å¤„ç†</span></span><br><span class="line">    assertThatThrownException(() -&gt; </span><br><span class="line">        aiService.generateContent(<span class="string">&quot;ä»»ä½•æç¤ºè¯&quot;</span>)</span><br><span class="line">    ).isInstanceOf(AIServiceException.class)</span><br><span class="line">     .hasMessageContaining(<span class="string">&quot;è°ƒç”¨ AI æœåŠ¡å¤±è´¥&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="è¯„ä¼°AIå“åº”è´¨é‡çš„æ–¹æ³•"><a href="#è¯„ä¼°AIå“åº”è´¨é‡çš„æ–¹æ³•" class="headerlink" title="è¯„ä¼°AIå“åº”è´¨é‡çš„æ–¹æ³•"></a>è¯„ä¼°AIå“åº”è´¨é‡çš„æ–¹æ³•</h2><p>AIè¯„ä¼°</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ResponseEvaluationService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ChatClient evaluationChatClient;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ResponseEvaluationService</span><span class="params">(ChatClient evaluationChatClient)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.evaluationChatClient = evaluationChatClient;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> EvaluationResult <span class="title function_">evaluateResponse</span><span class="params">(String query, String response)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">evaluationPrompt</span> <span class="operator">=</span> String.format(<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">            è¯·è¯„ä¼°ä»¥ä¸‹AIå›ç­”çš„è´¨é‡ã€‚è¯„åˆ†æ ‡å‡†ï¼š</span></span><br><span class="line"><span class="string">            1. ç›¸å…³æ€§ï¼ˆ1-10ï¼‰ï¼šå›ç­”ä¸é—®é¢˜çš„ç›¸å…³ç¨‹åº¦</span></span><br><span class="line"><span class="string">            2. å‡†ç¡®æ€§ï¼ˆ1-10ï¼‰ï¼šå›ç­”ä¸­äº‹å®çš„å‡†ç¡®æ€§</span></span><br><span class="line"><span class="string">            3. å®Œæ•´æ€§ï¼ˆ1-10ï¼‰ï¼šå›ç­”æ˜¯å¦å®Œæ•´åœ°è§£å†³äº†é—®é¢˜</span></span><br><span class="line"><span class="string">            4. æ¸…æ™°åº¦ï¼ˆ1-10ï¼‰ï¼šå›ç­”çš„é€»è¾‘å’Œè¡¨è¿°æ˜¯å¦æ¸…æ™°</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            é—®é¢˜ï¼š%s</span></span><br><span class="line"><span class="string">            AIå›ç­”ï¼š%s</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">            è¯·æä¾›å››ä¸ªè¯„åˆ†å’Œæ€»ä½“è¯„ä»·ï¼Œæ ¼å¼ä¸ºJSONï¼š</span></span><br><span class="line"><span class="string">            &#123;&quot;relevance&quot;: åˆ†æ•°, &quot;accuracy&quot;: åˆ†æ•°, &quot;completeness&quot;: åˆ†æ•°, &quot;clarity&quot;: åˆ†æ•°, &quot;comments&quot;: &quot;è¯„ä»·&quot;&#125;</span></span><br><span class="line"><span class="string">            &quot;&quot;&quot;</span>, query, response);</span><br><span class="line">        </span><br><span class="line">        <span class="type">String</span> <span class="variable">evaluationJson</span> <span class="operator">=</span> evaluationChatClient.call(evaluationPrompt);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// è§£æJSONå“åº”</span></span><br><span class="line">        <span class="type">ObjectMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> mapper.readValue(evaluationJson, EvaluationResult.class);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;è§£æè¯„ä¼°ç»“æœå¤±è´¥&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">record</span> <span class="title class_">EvaluationResult</span><span class="params">(</span></span><br><span class="line"><span class="params">        <span class="type">int</span> relevance,</span></span><br><span class="line"><span class="params">        <span class="type">int</span> accuracy,</span></span><br><span class="line"><span class="params">        <span class="type">int</span> completeness,</span></span><br><span class="line"><span class="params">        <span class="type">int</span> clarity,</span></span><br><span class="line"><span class="params">        String comments</span></span><br><span class="line"><span class="params">    )</span> &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>äººå·¥è¯„ä¼°</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="meta">@Tag(&quot;HumanReview&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testContentGenerationQuality</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// ç”Ÿæˆå†…å®¹</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">prompt</span> <span class="operator">=</span> <span class="string">&quot;ä¸ºç¼–ç¨‹å¯¼èˆªç½‘ç«™å†™ä¸€ä¸ªé¦–é¡µä»‹ç»&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">generatedContent</span> <span class="operator">=</span> aiService.generateContent(prompt);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä¿å­˜åˆ°è¯„ä¼°æ–‡ä»¶</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">filename</span> <span class="operator">=</span> <span class="string">&quot;content_evaluation_&quot;</span> + System.currentTimeMillis() + <span class="string">&quot;.txt&quot;</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">Path</span> <span class="variable">filePath</span> <span class="operator">=</span> Paths.get(<span class="string">&quot;target/human-review/&quot;</span> + filename);</span><br><span class="line">        Files.createDirectories(filePath.getParent());</span><br><span class="line">        Files.write(filePath, (prompt + <span class="string">&quot;\n\n&quot;</span> + generatedContent).getBytes());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// è®°å½•å¾…è¯„ä¼°çš„å†…å®¹</span></span><br><span class="line">        System.out.println(<span class="string">&quot;éœ€è¦äººå·¥è¯„ä¼°çš„å†…å®¹å·²ä¿å­˜åˆ°: &quot;</span> + filePath);</span><br><span class="line">        <span class="comment">// åœ¨ CI ç³»ç»Ÿä¸­ï¼Œå¯ä»¥é€šè¿‡ç‰¹å®šæœºåˆ¶é€šçŸ¥è¯„å®¡äººå‘˜</span></span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        fail(<span class="string">&quot;æ— æ³•ä¿å­˜è¯„ä¼°å†…å®¹&quot;</span>, e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="SpringBootåº”ç”¨çš„éƒ¨ç½²é€‰é¡¹"><a href="#SpringBootåº”ç”¨çš„éƒ¨ç½²é€‰é¡¹" class="headerlink" title="SpringBootåº”ç”¨çš„éƒ¨ç½²é€‰é¡¹"></a>SpringBootåº”ç”¨çš„éƒ¨ç½²é€‰é¡¹</h2><p>Spring AIåº”ç”¨æœ¬è´¨ä¸Šæ˜¯SpringBootåº”ç”¨ï¼Œå¯ä»¥é‡‡ç”¨å¤šç§éƒ¨ç½²æ–¹å¼ï¼š</p>
<ol>
<li>ä¼ ç»ŸæœåŠ¡å™¨éƒ¨ç½²</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ„å»ºå¯æ‰§è¡Œ JAR</span></span><br><span class="line">mvn clean package</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿è¡Œåº”ç”¨</span></span><br><span class="line">java -jar target/spring-ai-app-1.0.0.jar</span><br></pre></td></tr></table></figure>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">Unit</span>]</span><br><span class="line"><span class="string">Description=Spring</span> <span class="string">AI</span> <span class="string">Application</span></span><br><span class="line"><span class="string">After=network.target</span></span><br><span class="line"></span><br><span class="line">[<span class="string">Service</span>]</span><br><span class="line"><span class="string">User=appuser</span></span><br><span class="line"><span class="string">WorkingDirectory=/opt/spring-ai-app</span></span><br><span class="line"><span class="string">ExecStart=/usr/bin/java</span> <span class="string">-jar</span> <span class="string">spring-ai-app-1.0.0.jar</span></span><br><span class="line"><span class="string">EnvironmentFile=/opt/spring-ai-app/config/env</span></span><br><span class="line"><span class="string">Restart=always</span></span><br><span class="line"></span><br><span class="line">[<span class="string">Install</span>]</span><br><span class="line"><span class="string">WantedBy=multi-user.target</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>Dockerå®¹å™¨åŒ–éƒ¨ç½²<br>åˆ›å»º Dockerfile:</li>
</ol>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> eclipse-temurin:<span class="number">17</span>-jdk</span><br><span class="line"></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /app</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> target/spring-ai-app-1.0.0.jar app.jar</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®å¥åº·æ£€æŸ¥</span></span><br><span class="line"><span class="keyword">HEALTHCHECK</span><span class="language-bash"> --interval=30s --<span class="built_in">timeout</span>=3s \</span></span><br><span class="line"><span class="language-bash">  CMD curl -f http://localhost:8080/actuator/health || <span class="built_in">exit</span> 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®ç¯å¢ƒå˜é‡</span></span><br><span class="line"><span class="keyword">ENV</span> SPRING_PROFILES_ACTIVE=prod</span><br><span class="line"><span class="keyword">ENV</span> SERVER_PORT=<span class="number">8080</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">8080</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="string">&quot;java&quot;</span>, <span class="string">&quot;-jar&quot;</span>, <span class="string">&quot;app.jar&quot;</span>]</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ„å»ºé•œåƒ</span></span><br><span class="line">docker build -t spring-ai-app:1.0.0 .</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿è¡Œå®¹å™¨</span></span><br><span class="line">docker run -d -p 8080:8080 \</span><br><span class="line">  -e OPENAI_API_KEY=your-api-key \</span><br><span class="line">  --name spring-ai-app \</span><br><span class="line">  spring-ai-app:1.0.0</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>Kuberneteséƒ¨ç½²<br>åˆ›å»ºKuberneteséƒ¨ç½²é…ç½®ï¼š</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">spring-ai-app</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">spring-ai-app</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">spring-ai-app</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">spring-ai-app</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">spring-ai-app:1.0.0</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">8080</span></span><br><span class="line">        <span class="attr">env:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">SPRING_PROFILES_ACTIVE</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">&quot;prod&quot;</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">OPENAI_API_KEY</span></span><br><span class="line">          <span class="attr">valueFrom:</span></span><br><span class="line">            <span class="attr">secretKeyRef:</span></span><br><span class="line">              <span class="attr">name:</span> <span class="string">ai-secrets</span></span><br><span class="line">              <span class="attr">key:</span> <span class="string">openai-api-key</span></span><br><span class="line">        <span class="attr">resources:</span></span><br><span class="line">          <span class="attr">requests:</span></span><br><span class="line">            <span class="attr">memory:</span> <span class="string">&quot;512Mi&quot;</span></span><br><span class="line">            <span class="attr">cpu:</span> <span class="string">&quot;500m&quot;</span></span><br><span class="line">          <span class="attr">limits:</span></span><br><span class="line">            <span class="attr">memory:</span> <span class="string">&quot;1Gi&quot;</span></span><br><span class="line">            <span class="attr">cpu:</span> <span class="string">&quot;1000m&quot;</span></span><br><span class="line">        <span class="attr">livenessProbe:</span></span><br><span class="line">          <span class="attr">httpGet:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/actuator/health/liveness</span></span><br><span class="line">            <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line">          <span class="attr">initialDelaySeconds:</span> <span class="number">60</span></span><br><span class="line">          <span class="attr">periodSeconds:</span> <span class="number">30</span></span><br><span class="line">        <span class="attr">readinessProbe:</span></span><br><span class="line">          <span class="attr">httpGet:</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/actuator/health/readiness</span></span><br><span class="line">            <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line">          <span class="attr">initialDelaySeconds:</span> <span class="number">30</span></span><br><span class="line">          <span class="attr">periodSeconds:</span> <span class="number">10</span></span><br></pre></td></tr></table></figure>
<p>åˆ›å»ºæœåŠ¡</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">spring-ai-app</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">spring-ai-app</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="number">8080</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">LoadBalancer</span></span><br></pre></td></tr></table></figure>

<ol start="4">
<li>äº‘å¹³å°éƒ¨ç½²<br>é’ˆå¯¹ä¸åŒäº‘å¹³å°çš„ç‰¹å®šéƒ¨ç½²æ–¹å¼ä¹Ÿå¯ä»¥åº”ç”¨äºSpringAlåº”ç”¨ï¼Œä¾‹å¦‚ï¼š<br>AWSElasticBeanstalk<br>Azure App Service<br>Google Cloud Run<br>Heroku<br>é˜¿é‡Œäº‘EDAS<br>è…¾è®¯äº‘TKE</li>
</ol>
<h2 id="ç›‘æ§ä¸æ—¥å¿—ç®¡ç†"><a href="#ç›‘æ§ä¸æ—¥å¿—ç®¡ç†" class="headerlink" title="ç›‘æ§ä¸æ—¥å¿—ç®¡ç†"></a>ç›‘æ§ä¸æ—¥å¿—ç®¡ç†</h2><p>Spring Boot Actuatoré›†æˆ<br>æ·»åŠ  Actuator ä¾èµ–ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>é…ç½®Actuator:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¯ç”¨æ‰€æœ‰ç«¯ç‚¹</span></span><br><span class="line"><span class="string">management.endpoints.web.exposure.include=*</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ˜¾ç¤ºè¯¦ç»†å¥åº·ä¿¡æ¯</span></span><br><span class="line"><span class="string">management.endpoint.health.show-details=always</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯ç”¨PrometheusæŒ‡æ ‡</span></span><br><span class="line"><span class="string">management.endpoint.metrics.enabled=true</span></span><br><span class="line"><span class="string">management.endpoint.prometheus.enabled=true</span></span><br></pre></td></tr></table></figure>

<p>è‡ªå®šä¹‰AIç‰¹å®šæŒ‡æ ‡<br>åˆ›å»ºAIæœåŠ¡ç›‘æ§æŒ‡æ ‡ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AiServiceMetrics</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> MeterRegistry registry;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">AiServiceMetrics</span><span class="params">(MeterRegistry registry)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.registry = registry;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è®°å½•è¯·æ±‚è®¡æ•°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">recordRequest</span><span class="params">(String modelName, String operationType)</span> &#123;</span><br><span class="line">        registry.counter(<span class="string">&quot;ai.request.count&quot;</span>, </span><br><span class="line">            <span class="string">&quot;model&quot;</span>, modelName, </span><br><span class="line">            <span class="string">&quot;operation&quot;</span>, operationType</span><br><span class="line">        ).increment();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è®°å½•å“åº”æ—¶é—´</span></span><br><span class="line">    <span class="keyword">public</span> Timer.Sample <span class="title function_">startTimer</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Timer.start(registry);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">stopTimer</span><span class="params">(Timer.Sample sample, String modelName, String operationType)</span> &#123;</span><br><span class="line">        sample.stop(registry.timer(<span class="string">&quot;ai.response.time&quot;</span>, </span><br><span class="line">            <span class="string">&quot;model&quot;</span>, modelName, </span><br><span class="line">            <span class="string">&quot;operation&quot;</span>, operationType</span><br><span class="line">        ));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è®°å½•ä»¤ç‰Œä½¿ç”¨é‡</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">recordTokenUsage</span><span class="params">(String modelName, <span class="type">int</span> promptTokens, <span class="type">int</span> completionTokens)</span> &#123;</span><br><span class="line">        registry.counter(<span class="string">&quot;ai.tokens.prompt&quot;</span>, <span class="string">&quot;model&quot;</span>, modelName).increment(promptTokens);</span><br><span class="line">        registry.counter(<span class="string">&quot;ai.tokens.completion&quot;</span>, <span class="string">&quot;model&quot;</span>, modelName).increment(completionTokens);</span><br><span class="line">        registry.counter(<span class="string">&quot;ai.tokens.total&quot;</span>, <span class="string">&quot;model&quot;</span>, modelName).increment(promptTokens + completionTokens);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è®°å½•é”™è¯¯</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">recordError</span><span class="params">(String modelName, String errorType)</span> &#123;</span><br><span class="line">        registry.counter(<span class="string">&quot;ai.error.count&quot;</span>, </span><br><span class="line">            <span class="string">&quot;model&quot;</span>, modelName, </span><br><span class="line">            <span class="string">&quot;error&quot;</span>, errorType</span><br><span class="line">        ).increment();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨AOPå®ç°è‡ªåŠ¨æŒ‡æ ‡æ”¶é›†</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AiServiceMonitoringAspect</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> AiServiceMetrics metrics;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">AiServiceMonitoringAspect</span><span class="params">(AiServiceMetrics metrics)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.metrics = metrics;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Around(&quot;execution(* org.springframework.ai.chat.ChatClient.call(..)) || &quot; +</span></span><br><span class="line"><span class="meta">            &quot;execution(* org.springframework.ai.image.ImageClient.generateImage(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">monitorAiCalls</span><span class="params">(ProceedingJoinPoint joinPoint)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">methodName</span> <span class="operator">=</span> joinPoint.getSignature().getName();</span><br><span class="line">        <span class="type">String</span> <span class="variable">modelName</span> <span class="operator">=</span> determineModelName(joinPoint);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// è®°å½•è¯·æ±‚</span></span><br><span class="line">        metrics.recordRequest(modelName, methodName);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å¼€å§‹è®¡æ—¶</span></span><br><span class="line">        Timer.<span class="type">Sample</span> <span class="variable">timer</span> <span class="operator">=</span> metrics.startTimer();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// æ‰§è¡Œæ–¹æ³•</span></span><br><span class="line">            <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> joinPoint.proceed();</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// è®°å½•ä»¤ç‰Œä½¿ç”¨é‡ï¼ˆå¦‚æœæœ‰æ­¤ä¿¡æ¯ï¼‰</span></span><br><span class="line">            <span class="keyword">if</span> (result <span class="keyword">instanceof</span> ChatResponse response) &#123;</span><br><span class="line">                <span class="type">Usage</span> <span class="variable">usage</span> <span class="operator">=</span> response.getUsage();</span><br><span class="line">                <span class="keyword">if</span> (usage != <span class="literal">null</span>) &#123;</span><br><span class="line">                    metrics.recordTokenUsage(</span><br><span class="line">                        modelName,</span><br><span class="line">                        usage.getPromptTokens(),</span><br><span class="line">                        usage.getCompletionTokens()</span><br><span class="line">                    );</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="comment">// è®°å½•é”™è¯¯</span></span><br><span class="line">            metrics.recordError(modelName, e.getClass().getSimpleName());</span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">// åœæ­¢è®¡æ—¶</span></span><br><span class="line">            metrics.stopTimer(timer, modelName, methodName);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">determineModelName</span><span class="params">(ProceedingJoinPoint joinPoint)</span> &#123;</span><br><span class="line">        <span class="comment">// æ ¹æ®è°ƒç”¨å‚æ•°æˆ–ç›®æ ‡å¯¹è±¡ç¡®å®šæ¨¡å‹åç§°</span></span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;default&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç»“æ„åŒ–æ—¥å¿—è®°å½•<br>ä½¿ç”¨ç»“æ„åŒ–æ—¥å¿—è®°å½•AIäº¤äº’ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoggingAiClient</span> <span class="keyword">implements</span> <span class="title class_">ChatClient</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ChatClient delegate;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LoggingAiClient</span><span class="params">(ChatClient delegate)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.delegate = delegate;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">call</span><span class="params">(String prompt)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">requestId</span> <span class="operator">=</span> UUID.randomUUID().toString();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// è®°å½•è¯·æ±‚</span></span><br><span class="line">        log.info(<span class="string">&quot;AIè¯·æ±‚å¼€å§‹ [requestId=&#123;&#125;] prompt=&#x27;&#123;&#125;&#x27;&quot;</span>, requestId, truncate(prompt, <span class="number">100</span>));</span><br><span class="line">        </span><br><span class="line">        <span class="type">long</span> <span class="variable">startTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="type">String</span> <span class="variable">response</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// è°ƒç”¨å®é™…æœåŠ¡</span></span><br><span class="line">            response = delegate.call(prompt);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// è®°å½•æˆåŠŸå“åº”</span></span><br><span class="line">            log.info(<span class="string">&quot;AIè¯·æ±‚æˆåŠŸ [requestId=&#123;&#125;, duration=&#123;&#125;ms] response=&#x27;&#123;&#125;&#x27;&quot;</span>, </span><br><span class="line">                    requestId, </span><br><span class="line">                    System.currentTimeMillis() - startTime,</span><br><span class="line">                    truncate(response, <span class="number">100</span>));</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> response;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="comment">// è®°å½•é”™è¯¯</span></span><br><span class="line">            log.error(<span class="string">&quot;AIè¯·æ±‚å¤±è´¥ [requestId=&#123;&#125;, duration=&#123;&#125;ms] error=&#x27;&#123;&#125;&#x27;&quot;</span>, </span><br><span class="line">                    requestId, </span><br><span class="line">                    System.currentTimeMillis() - startTime,</span><br><span class="line">                    e.getMessage(), e);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">truncate</span><span class="params">(String text, <span class="type">int</span> maxLength)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (text != <span class="literal">null</span> &amp;&amp; text.length() &gt; maxLength) &#123;</span><br><span class="line">            <span class="keyword">return</span> text.substring(<span class="number">0</span>, maxLength) + <span class="string">&quot;...&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> text;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å®ç°å…¶ä»–å¿…è¦æ–¹æ³•...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h1 id="AIåº”ç”¨æ€§èƒ½ä¼˜åŒ–"><a href="#AIåº”ç”¨æ€§èƒ½ä¼˜åŒ–" class="headerlink" title="AIåº”ç”¨æ€§èƒ½ä¼˜åŒ–"></a>AIåº”ç”¨æ€§èƒ½ä¼˜åŒ–</h1><h2 id="AIåº”ç”¨æ€§èƒ½çš„å…³é”®æŒ‡æ ‡"><a href="#AIåº”ç”¨æ€§èƒ½çš„å…³é”®æŒ‡æ ‡" class="headerlink" title="AIåº”ç”¨æ€§èƒ½çš„å…³é”®æŒ‡æ ‡"></a>AIåº”ç”¨æ€§èƒ½çš„å…³é”®æŒ‡æ ‡</h2><p>å“åº”æ—¶é—´æ˜¯æœ€ç›´è§‚çš„æŒ‡æ ‡ï¼ŒåŒ…æ‹¬é¦–å­—èŠ‚æ—¶é—´ï¼ˆTTFBï¼‰å’Œå®Œæ•´å“åº”æ—¶é—´ã€‚<br>ååé‡åæ˜ äº†ç³»ç»Ÿçš„å¤„ç†èƒ½åŠ›ï¼Œèµ„æºåˆ©ç”¨ç‡åˆ™å…³ç³»åˆ°æˆæœ¬æ§åˆ¶</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PerformanceMonitor</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> MeterRegistry meterRegistry;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">PerformanceMonitor</span><span class="params">(MeterRegistry meterRegistry)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.meterRegistry = meterRegistry;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è®°å½• AI è¯·æ±‚å“åº”æ—¶é—´</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">recordAiRequestTime</span><span class="params">(String modelType, <span class="type">long</span> duration)</span> &#123;</span><br><span class="line">        Timer.<span class="type">Sample</span> <span class="variable">sample</span> <span class="operator">=</span> Timer.start(meterRegistry);</span><br><span class="line">        sample.stop(Timer.builder(<span class="string">&quot;ai.request.duration&quot;</span>)</span><br><span class="line">                .tag(<span class="string">&quot;model&quot;</span>, modelType)</span><br><span class="line">                .register(meterRegistry));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è®°å½• Token ä½¿ç”¨é‡</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">recordTokenUsage</span><span class="params">(String operation, <span class="type">int</span> tokenCount)</span> &#123;</span><br><span class="line">        Counter.builder(<span class="string">&quot;ai.tokens.used&quot;</span>)</span><br><span class="line">                .tag(<span class="string">&quot;operation&quot;</span>, operation)</span><br><span class="line">                .register(meterRegistry)</span><br><span class="line">                .increment(tokenCount);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è®°å½•ç¼“å­˜å‘½ä¸­ç‡</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">recordCacheHit</span><span class="params">(String cacheType, <span class="type">boolean</span> hit)</span> &#123;</span><br><span class="line">        Counter.builder(<span class="string">&quot;ai.cache.requests&quot;</span>)</span><br><span class="line">                .tag(<span class="string">&quot;type&quot;</span>, cacheType)</span><br><span class="line">                .tag(<span class="string">&quot;result&quot;</span>, hit ? <span class="string">&quot;hit&quot;</span> : <span class="string">&quot;miss&quot;</span>)</span><br><span class="line">                .register(meterRegistry)</span><br><span class="line">                .increment();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ç¼“å­˜ç­–ç•¥ä¸å®ç°"><a href="#ç¼“å­˜ç­–ç•¥ä¸å®ç°" class="headerlink" title="ç¼“å­˜ç­–ç•¥ä¸å®ç°"></a>ç¼“å­˜ç­–ç•¥ä¸å®ç°</h2><p>ç¼“å­˜å¯ä»¥å¾ˆå¤§ç¨‹åº¦çš„æå‡AIåº”ç”¨æ€§èƒ½ã€‚<br>ç”±äºç›¸åŒæˆ–ç›¸ä¼¼çš„é—®é¢˜å¯èƒ½è¢«é‡å¤è¯¢é—®ï¼Œå› æ­¤ï¼Œè®¾è®¡åˆç†çš„ç¼“å­˜ç­–ç•¥èƒ½æœ‰æ•ˆå‡å°‘AIæ¨¡å‹è°ƒç”¨æ¬¡æ•°ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AiCacheService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> RedisTemplate&lt;String, String&gt; redisTemplate;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ChatClient chatClient;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">AiCacheService</span><span class="params">(RedisTemplate&lt;String, String&gt; redisTemplate, </span></span><br><span class="line"><span class="params">                         ChatClient chatClient)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.redisTemplate = redisTemplate;</span><br><span class="line">        <span class="built_in">this</span>.chatClient = chatClient;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åŸºäºé—®é¢˜å“ˆå¸Œçš„ç¼“å­˜ç­–ç•¥</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getCachedResponse</span><span class="params">(String question)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">cacheKey</span> <span class="operator">=</span> <span class="string">&quot;ai:response:&quot;</span> + DigestUtils.md5DigestAsHex(question.getBytes());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å°è¯•ä»ç¼“å­˜è·å–</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">cachedResponse</span> <span class="operator">=</span> redisTemplate.opsForValue().get(cacheKey);</span><br><span class="line">        <span class="keyword">if</span> (cachedResponse != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> cachedResponse;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ç¼“å­˜æœªå‘½ä¸­ï¼Œè°ƒç”¨ AI æ¨¡å‹</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">response</span> <span class="operator">=</span> chatClient.prompt().user(question).call().content();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å­˜å‚¨åˆ°ç¼“å­˜ï¼Œè®¾ç½®è¿‡æœŸæ—¶é—´</span></span><br><span class="line">        redisTemplate.opsForValue().set(cacheKey, response, Duration.ofHours(<span class="number">24</span>));</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> response;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="æ‰¹å¤„ç†ä¸å¹¶è¡Œè¯·æ±‚"><a href="#æ‰¹å¤„ç†ä¸å¹¶è¡Œè¯·æ±‚" class="headerlink" title="æ‰¹å¤„ç†ä¸å¹¶è¡Œè¯·æ±‚"></a>æ‰¹å¤„ç†ä¸å¹¶è¡Œè¯·æ±‚</h2><p>æ‰¹å¤„ç†èƒ½å¤Ÿæé«˜ç³»ç»Ÿååé‡ï¼Œè€Œå¹¶è¡Œå¤„ç†åˆ™èƒ½ç¼©çŸ­æ€»ä½“å“åº”æ—¶é—´ã€‚<br>Spring AIæ”¯æŒå¤šç§å¹¶è¡Œå¤„ç†æ¨¡å¼ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BatchProcessingService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ChatClient chatClient;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ExecutorService executorService;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BatchProcessingService</span><span class="params">(ChatClient chatClient)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.chatClient = chatClient;</span><br><span class="line">        <span class="built_in">this</span>.executorService = Executors.newFixedThreadPool(<span class="number">10</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ‰¹é‡å¤„ç†å¤šä¸ªé—®é¢˜</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;String&gt; <span class="title function_">processBatch</span><span class="params">(List&lt;String&gt; questions)</span> &#123;</span><br><span class="line">        List&lt;CompletableFuture&lt;String&gt;&gt; futures = questions.stream()</span><br><span class="line">            .map(question -&gt; CompletableFuture.supplyAsync(() -&gt; </span><br><span class="line">                chatClient.prompt().user(question).call().content(), executorService))</span><br><span class="line">            .collect(Collectors.toList());</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> futures.stream()</span><br><span class="line">            .map(CompletableFuture::join)</span><br><span class="line">            .collect(Collectors.toList());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åˆ†å—å¤„ç†å¤§é‡æ•°æ®</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">processLargeDataset</span><span class="params">(List&lt;String&gt; data, <span class="type">int</span> batchSize)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; data.size(); i += batchSize) &#123;</span><br><span class="line">            List&lt;String&gt; batch = data.subList(i, </span><br><span class="line">                Math.min(i + batchSize, data.size()));</span><br><span class="line">            </span><br><span class="line">            processBatch(batch);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// æ·»åŠ å»¶è¿Ÿä»¥é¿å… API é™æµ</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                Thread.currentThread().interrupt();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="å“åº”æµå¤„ç†æŠ€æœ¯"><a href="#å“åº”æµå¤„ç†æŠ€æœ¯" class="headerlink" title="å“åº”æµå¤„ç†æŠ€æœ¯"></a>å“åº”æµå¤„ç†æŠ€æœ¯</h2><p>æµå¼å“åº”èƒ½å¤Ÿæä¾›æ›´å¥½çš„ç”¨æˆ·ä½“éªŒï¼Œè®©ç”¨æˆ·èƒ½å¤Ÿå®æ—¶çœ‹åˆ°AIçš„å›ç­”è¿‡ç¨‹ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StreamingController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ChatClient chatClient;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">StreamingController</span><span class="params">(ChatClient chatClient)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.chatClient = chatClient;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(value = &quot;/stream-chat&quot;, produces = MediaType.TEXT_EVENT_STREAM_VALUE)</span></span><br><span class="line">    <span class="keyword">public</span> Flux&lt;String&gt; <span class="title function_">streamChat</span><span class="params">(<span class="meta">@RequestParam</span> String question)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> chatClient.prompt().user(question).stream().content()</span><br><span class="line">                .map(response -&gt; <span class="string">&quot;data: &quot;</span> + response + <span class="string">&quot;\n\n&quot;</span>)</span><br><span class="line">                .onErrorReturn(<span class="string">&quot;data: [ERROR] å¤„ç†è¯·æ±‚æ—¶å‘ç”Ÿé”™è¯¯\n\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æœåŠ¡å™¨å‘é€äº‹ä»¶ï¼ˆSSEï¼‰å®ç°</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/sse-chat&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> SseEmitter <span class="title function_">sseChat</span><span class="params">(<span class="meta">@RequestParam</span> String question)</span> &#123;</span><br><span class="line">        <span class="type">SseEmitter</span> <span class="variable">emitter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SseEmitter</span>(<span class="number">30000L</span>);</span><br><span class="line"></span><br><span class="line">        CompletableFuture.runAsync(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                chatClient.prompt().user(question).stream().content()</span><br><span class="line">                        .subscribe(</span><br><span class="line">                                chunk -&gt; &#123;</span><br><span class="line">                                    <span class="keyword">try</span> &#123;</span><br><span class="line">                                        emitter.send(SseEmitter.event()</span><br><span class="line">                                                .name(<span class="string">&quot;message&quot;</span>)</span><br><span class="line">                                                .data(chunk));</span><br><span class="line">                                    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                                        emitter.completeWithError(e);</span><br><span class="line">                                    &#125;</span><br><span class="line">                                &#125;,</span><br><span class="line">                                emitter::completeWithError,</span><br><span class="line">                                emitter::complete</span><br><span class="line">                        );</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                emitter.completeWithError(e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> emitter;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="èµ„æºä½¿ç”¨ä¼˜åŒ–"><a href="#èµ„æºä½¿ç”¨ä¼˜åŒ–" class="headerlink" title="èµ„æºä½¿ç”¨ä¼˜åŒ–"></a>èµ„æºä½¿ç”¨ä¼˜åŒ–</h2><p>åˆç†çš„èµ„æºç®¡ç†èƒ½å¤Ÿæé«˜ç³»ç»Ÿç¨³å®šæ€§å¹¶é™ä½æˆæœ¬ã€‚<br>è¿æ¥æ± ç®¡ç†ã€å†…å­˜ä¼˜åŒ–å’Œçº¿ç¨‹æ± é…ç½®éƒ½æ˜¯é‡è¦çš„ä¼˜åŒ–ç‚¹</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AiOptimizationConfig</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// é…ç½® HTTP å®¢æˆ·ç«¯è¿æ¥æ± </span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RestTemplate <span class="title function_">restTemplate</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">HttpComponentsClientHttpRequestFactory</span> <span class="variable">factory</span> <span class="operator">=</span> </span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">HttpComponentsClientHttpRequestFactory</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="type">CloseableHttpClient</span> <span class="variable">httpClient</span> <span class="operator">=</span> HttpClients.custom()</span><br><span class="line">            .setMaxConnTotal(<span class="number">100</span>)</span><br><span class="line">            .setMaxConnPerRoute(<span class="number">20</span>)</span><br><span class="line">            .setConnectionTimeToLive(<span class="number">30</span>, TimeUnit.SECONDS)</span><br><span class="line">            .build();</span><br><span class="line">            </span><br><span class="line">        factory.setHttpClient(httpClient);</span><br><span class="line">        factory.setConnectTimeout(<span class="number">5000</span>);</span><br><span class="line">        factory.setReadTimeout(<span class="number">30000</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>(factory);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// é…ç½®ä»»åŠ¡æ‰§è¡Œå™¨</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> TaskExecutor <span class="title function_">aiTaskExecutor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">ThreadPoolTaskExecutor</span> <span class="variable">executor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolTaskExecutor</span>();</span><br><span class="line">        executor.setCorePoolSize(<span class="number">5</span>);</span><br><span class="line">        executor.setMaxPoolSize(<span class="number">20</span>);</span><br><span class="line">        executor.setQueueCapacity(<span class="number">100</span>);</span><br><span class="line">        executor.setThreadNamePrefix(<span class="string">&quot;ai-task-&quot;</span>);</span><br><span class="line">        executor.setRejectedExecutionHandler(<span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>.CallerRunsPolicy());</span><br><span class="line">        executor.initialize();</span><br><span class="line">        <span class="keyword">return</span> executor;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ResourceOptimizedAiService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä½¿ç”¨å¯¹è±¡æ± å‡å°‘å¯¹è±¡åˆ›å»ºå¼€é”€</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ObjectPool&lt;StringBuilder&gt; stringBuilderPool;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ResourceOptimizedAiService</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.stringBuilderPool = <span class="keyword">new</span> <span class="title class_">GenericObjectPool</span>&lt;&gt;(</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">BasePooledObjectFactory</span>&lt;StringBuilder&gt;() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> StringBuilder <span class="title function_">create</span><span class="params">()</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> PooledObject&lt;StringBuilder&gt; <span class="title function_">wrap</span><span class="params">(StringBuilder obj)</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DefaultPooledObject</span>&lt;&gt;(obj);</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">passivateObject</span><span class="params">(PooledObject&lt;StringBuilder&gt; p)</span> &#123;</span><br><span class="line">                    p.getObject().setLength(<span class="number">0</span>); <span class="comment">// æ¸…ç©ºå†…å®¹</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">processWithOptimization</span><span class="params">(String input)</span> &#123;</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            sb = stringBuilderPool.borrowObject();</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// ä½¿ç”¨ StringBuilder è¿›è¡Œå­—ç¬¦ä¸²æ“ä½œ</span></span><br><span class="line">            sb.append(<span class="string">&quot;å¤„ç†ç¼–ç¨‹å¯¼èˆªç”¨æˆ·è¯·æ±‚: &quot;</span>).append(input);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> sb.toString();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;èµ„æºè·å–å¤±è´¥&quot;</span>, e);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (sb != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    stringBuilderPool.returnObject(sb);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    <span class="comment">// è®°å½•æ—¥å¿—ä½†ä¸æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ç¬¬å…­æ¬¡å®è·µ"><a href="#ç¬¬å…­æ¬¡å®è·µ" class="headerlink" title="ç¬¬å…­æ¬¡å®è·µ"></a>ç¬¬å…­æ¬¡å®è·µ</h2><p>ä¼˜åŒ–é«˜æµé‡AIåº”ç”¨æ€§èƒ½</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/optimized&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OptimizedAiController</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> AiCacheService cacheService;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> CostControlService costControlService;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> PerformanceMonitor performanceMonitor;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ChatClient chatClient;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PostMapping(&quot;/chat&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;?&gt; optimizedChat(<span class="meta">@RequestBody</span> ChatRequest request) &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">startTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 1. æˆæœ¬æ§åˆ¶æ£€æŸ¥</span></span><br><span class="line">            <span class="keyword">if</span> (!costControlService.checkTokenLimit(request.getUserId(), </span><br><span class="line">                    estimateTokens(request.getQuestion()))) &#123;</span><br><span class="line">                <span class="keyword">return</span> ResponseEntity.status(<span class="number">429</span>)</span><br><span class="line">                    .body(<span class="string">&quot;ä»Šæ—¥ Token ä½¿ç”¨é‡å·²è¾¾ä¸Šé™ï¼Œè¯·æ˜å¤©å†è¯•æˆ–å‡çº§ä¸ºé¢è¯•é¸­ VIP&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 2. å°è¯•ä»ç¼“å­˜è·å–</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">cachedResponse</span> <span class="operator">=</span> cacheService.getCachedResponse(request.getQuestion());</span><br><span class="line">            <span class="keyword">if</span> (cachedResponse != <span class="literal">null</span>) &#123;</span><br><span class="line">                performanceMonitor.recordCacheHit(<span class="string">&quot;semantic&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">                <span class="keyword">return</span> ResponseEntity.ok(<span class="keyword">new</span> <span class="title class_">ChatResponse</span>(cachedResponse, <span class="literal">true</span>));</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 3. é€‰æ‹©æœ€ä¼˜æ¨¡å‹</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">selectedModel</span> <span class="operator">=</span> costControlService.selectOptimalModel(</span><br><span class="line">                request.getQuestion(), request.getUserId());</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 4. è°ƒç”¨ AI æœåŠ¡</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">response</span> <span class="operator">=</span> chatClient.prompt().user(request.getQuestion()).call().content();</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 5. è®°å½•æ€§èƒ½æŒ‡æ ‡</span></span><br><span class="line">            <span class="type">long</span> <span class="variable">duration</span> <span class="operator">=</span> System.currentTimeMillis() - startTime;</span><br><span class="line">            performanceMonitor.recordAiRequestTime(selectedModel, duration);</span><br><span class="line">            performanceMonitor.recordCacheHit(<span class="string">&quot;semantic&quot;</span>, <span class="literal">false</span>);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> ResponseEntity.ok(<span class="keyword">new</span> <span class="title class_">ChatResponse</span>(response, <span class="literal">false</span>));</span><br><span class="line">            </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">return</span> ResponseEntity.status(<span class="number">500</span>)</span><br><span class="line">                .body(<span class="string">&quot;å¤„ç†è¯·æ±‚æ—¶å‘ç”Ÿé”™è¯¯: &quot;</span> + e.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="title function_">estimateTokens</span><span class="params">(String text)</span> &#123;</span><br><span class="line">        <span class="comment">// ç®€å•çš„ Token ä¼°ç®—ï¼šè‹±æ–‡çº¦ 4 å­—ç¬¦/Tokenï¼Œä¸­æ–‡çº¦ 1.5 å­—ç¬¦/Token</span></span><br><span class="line">        <span class="keyword">return</span> (<span class="type">int</span>) Math.ceil(text.length() / <span class="number">3.0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¯·æ±‚å’Œå“åº”æ¨¡å‹</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ChatRequest</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String question;</span><br><span class="line">    <span class="keyword">private</span> String userId;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// getters and setters</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getQuestion</span><span class="params">()</span> &#123; <span class="keyword">return</span> question; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setQuestion</span><span class="params">(String question)</span> &#123; <span class="built_in">this</span>.question = question; &#125;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getUserId</span><span class="params">()</span> &#123; <span class="keyword">return</span> userId; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUserId</span><span class="params">(String userId)</span> &#123; <span class="built_in">this</span>.userId = userId; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ChatResponse</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String answer;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> fromCache;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ChatResponse</span><span class="params">(String answer, <span class="type">boolean</span> fromCache)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.answer = answer;</span><br><span class="line">        <span class="built_in">this</span>.fromCache = fromCache;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// getters and setters</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getAnswer</span><span class="params">()</span> &#123; <span class="keyword">return</span> answer; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isFromCache</span><span class="params">()</span> &#123; <span class="keyword">return</span> fromCache; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>æ–‡ç« ä½œè€…: </span><span class="post-copyright-info"><a href="https://wzcwzc10.github.io">å¾®å…‰zc</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>æ–‡ç« é“¾æ¥: </span><span class="post-copyright-info"><a href="https://wzcwzc10.github.io/2025/11/09/Spring%20AI%20%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/">https://wzcwzc10.github.io/2025/11/09/Spring%20AI%20%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>ç‰ˆæƒå£°æ˜: </span><span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥æº <a href="https://wzcwzc10.github.io" target="_blank">å¾®å…‰zcçš„ç½‘ç»œå°çª</a>ï¼</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/">äººå·¥æ™ºèƒ½</a><a class="post-meta__tags" href="/tags/AI/">AI</a><a class="post-meta__tags" href="/tags/Spring-AI/">Spring AI</a></div><div class="post-share"><div class="social-share" data-image="/./img/YH/als.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>æ¥ä¸€æ¯ç‡ƒæ²¹é¥®</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" src="/img/wechat.jpg" alt="å¾®ä¿¡"/></a><div class="post-qr-code-desc">å¾®ä¿¡</div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/alipay.jpg" alt="æ”¯ä»˜å®"/></a><div class="post-qr-code-desc">æ”¯ä»˜å®</div></li></ul></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/11/09/win11%20ssh%E6%9C%8D%E5%8A%A1%E6%B5%8B%E8%AF%95%E5%91%BD%E4%BB%A4/" title="win11 sshæœåŠ¡æµ‹è¯•å‘½ä»¤"><img class="cover" src="/./img/YH/ccc.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">ä¸Šä¸€ç¯‡</div><div class="info-item-2">win11 sshæœåŠ¡æµ‹è¯•å‘½ä»¤</div></div><div class="info-2"><div class="info-item-1">SSH</div></div></div></a><a class="pagination-related" href="/2025/11/09/LangChain%20%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/" title="LangChain å­¦ä¹ æ€»ç»“"><img class="cover" src="/./img/YH/tutuv.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">ä¸‹ä¸€ç¯‡</div><div class="info-item-2">LangChain å­¦ä¹ æ€»ç»“</div></div><div class="info-2"><div class="info-item-1">LangChain å­¦ä¹ æ€»ç»“</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>ç›¸å…³æ¨è</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2025/11/09/LangChain%20%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/" title="LangChain å­¦ä¹ æ€»ç»“"><img class="cover" src="/./img/YH/tutuv.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-11-09</div><div class="info-item-2">LangChain å­¦ä¹ æ€»ç»“</div></div><div class="info-2"><div class="info-item-1">LangChain å­¦ä¹ æ€»ç»“</div></div></div></a></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> è¯„è®º</span></div></div><div class="comment-wrap"><div><div id="giscus-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/./img/jufufu-ht.gif" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">å¾®å…‰zc</div><div class="author-info-description">ä¸€ä¸ªæœ‰æƒ³æ³•çš„æå®¢</div><div class="site-data"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">67</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">66</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">19</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://space.bilibili.com/178083315"><i class="fab fa-bilibili"></i><span>å…³æ³¨æˆ‘ï¼</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>å…¬å‘Š</span></div><div class="announcement_content">ä¸–ç•Œå…¨å‰§ç»ˆï¼Œæ¬¢è¿æ¥åˆ°my blogï¼</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>ç›®å½•</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%90%AF%E7%A8%8B"><span class="toc-number">1.</span> <span class="toc-text">å¯ç¨‹</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Spring-AI-%E5%AD%A6%E4%B9%A0%E7%8E%AF%E5%A2%83"><span class="toc-number">1.1.</span> <span class="toc-text">Spring AI å­¦ä¹ ç¯å¢ƒ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#AI%E7%9A%84%E4%B8%BB%E8%A6%81%E5%88%86%E6%94%AF"><span class="toc-number">1.2.</span> <span class="toc-text">AIçš„ä¸»è¦åˆ†æ”¯</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%A7%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B-LLM"><span class="toc-number">1.3.</span> <span class="toc-text">å¤§è¯­è¨€æ¨¡å‹(LLM)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#AI-%E6%9C%AF%E8%AF%AD"><span class="toc-number">1.4.</span> <span class="toc-text">AI æœ¯è¯­</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Spring-%E6%A1%86%E6%9E%B6"><span class="toc-number">2.</span> <span class="toc-text">Spring æ¡†æ¶</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#RESTful-API%E5%9F%BA%E7%A1%80"><span class="toc-number">3.</span> <span class="toc-text">RESTful APIåŸºç¡€</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Spring-AI"><span class="toc-number">4.</span> <span class="toc-text">Spring AI</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A8%A1%E5%9E%8B%E6%8A%BD%E8%B1%A1%E5%B1%82"><span class="toc-number">4.1.</span> <span class="toc-text">æ¨¡å‹æŠ½è±¡å±‚</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8F%90%E7%A4%BA%E8%AF%8D%E7%AE%A1%E7%90%86"><span class="toc-number">4.2.</span> <span class="toc-text">æç¤ºè¯ç®¡ç†</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#AI%E6%A8%A1%E5%9E%8B%E6%8F%90%E4%BE%9B%E5%95%86"><span class="toc-number">4.3.</span> <span class="toc-text">AIæ¨¡å‹æä¾›å•†</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Spring-AI%E7%9A%84%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B"><span class="toc-number">4.4.</span> <span class="toc-text">Spring AIçš„å·¥ä½œæµç¨‹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Spring-AI%E7%9B%B8%E5%85%B3%E9%85%8D%E7%BD%AE"><span class="toc-number">4.5.</span> <span class="toc-text">Spring AIç›¸å…³é…ç½®</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%AC%E5%9C%B0%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7%E9%80%89%E6%8B%A9"><span class="toc-number">4.6.</span> <span class="toc-text">æœ¬åœ°å¼€å‘å·¥å…·é€‰æ‹©</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8Spring-Initializr%E5%88%9B%E5%BB%BASpring-AI%E9%A1%B9%E7%9B%AE"><span class="toc-number">4.7.</span> <span class="toc-text">ä½¿ç”¨Spring Initializråˆ›å»ºSpring AIé¡¹ç›®</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-number">5.</span> <span class="toc-text">å¼€å‘ç¯å¢ƒæ­å»º</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Maven%E4%BE%9D%E8%B5%96%E9%85%8D%E7%BD%AE"><span class="toc-number">5.1.</span> <span class="toc-text">Mavenä¾èµ–é…ç½®</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%AF%86%E9%92%A5"><span class="toc-number">5.2.</span> <span class="toc-text">è·å–å¯†é’¥</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#API%E5%AF%86%E9%92%A5%E5%AE%89%E5%85%A8%E7%AE%A1%E7%90%86%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="toc-number">5.3.</span> <span class="toc-text">APIå¯†é’¥å®‰å…¨ç®¡ç†æœ€ä½³å®è·µ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E6%AC%A1%E5%AE%9E%E8%B7%B5"><span class="toc-number">5.4.</span> <span class="toc-text">ç¬¬ä¸€æ¬¡å®è·µ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%83%E4%B9%A0"><span class="toc-number">5.5.</span> <span class="toc-text">ç»ƒä¹ </span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Spring-AI-%E6%A8%A1%E5%9E%8B"><span class="toc-number">6.</span> <span class="toc-text">Spring AI æ¨¡å‹</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84"><span class="toc-number">6.1.</span> <span class="toc-text">é¡¹ç›®ç»“æ„</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE"><span class="toc-number">6.2.</span> <span class="toc-text">é…ç½®</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%8E%A7%E5%88%B6%E5%99%A8%E5%A4%84%E7%90%86HTTP%E8%AF%B7%E6%B1%82"><span class="toc-number">6.3.</span> <span class="toc-text">åˆ›å»ºæ§åˆ¶å™¨å¤„ç†HTTPè¯·æ±‚</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E7%AE%80%E5%8D%95%E7%9A%84%E6%96%87%E6%9C%AC%E7%94%9F%E6%88%90%E5%8A%9F%E8%83%BD"><span class="toc-number">6.4.</span> <span class="toc-text">å®ç°ç®€å•çš„æ–‡æœ¬ç”ŸæˆåŠŸèƒ½</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E4%B8%8E%E5%BC%82%E5%B8%B8%E7%AE%A1%E7%90%86"><span class="toc-number">6.5.</span> <span class="toc-text">é”™è¯¯å¤„ç†ä¸å¼‚å¸¸ç®¡ç†</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E6%AC%A1%E5%AE%9E%E8%B7%B5"><span class="toc-number">6.6.</span> <span class="toc-text">ç¬¬äºŒæ¬¡å®è·µ</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%8F%90%E7%A4%BA%E8%AF%8D%E5%B7%A5%E7%A8%8B%E5%9F%BA%E7%A1%80"><span class="toc-number">7.</span> <span class="toc-text">æç¤ºè¯å·¥ç¨‹åŸºç¡€</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8PromptTemplate%E5%88%9B%E5%BB%BA%E5%8A%A8%E6%80%81%E6%8F%90%E7%A4%BA"><span class="toc-number">7.1.</span> <span class="toc-text">ä½¿ç”¨PromptTemplateåˆ›å»ºåŠ¨æ€æç¤º</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E6%B6%88%E6%81%AF%E4%B8%8E%E7%94%A8%E6%88%B7%E6%B6%88%E6%81%AF%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">7.2.</span> <span class="toc-text">ç³»ç»Ÿæ¶ˆæ¯ä¸ç”¨æˆ·æ¶ˆæ¯çš„åŒºåˆ«</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%8A%E4%B8%8B%E6%96%87%E7%AE%A1%E7%90%86%E4%B8%8E%E5%AF%B9%E8%AF%9D%E5%8E%86%E5%8F%B2"><span class="toc-number">7.3.</span> <span class="toc-text">ä¸Šä¸‹æ–‡ç®¡ç†ä¸å¯¹è¯å†å²</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E6%8F%90%E7%A4%BA%E8%AF%8D%E6%8A%80%E5%B7%A7%E4%B8%8E%E6%A8%A1%E5%BC%8F"><span class="toc-number">7.4.</span> <span class="toc-text">å¸¸è§æç¤ºè¯æŠ€å·§ä¸æ¨¡å¼</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E6%AC%A1%E5%AE%9E%E8%B7%B5"><span class="toc-number">7.5.</span> <span class="toc-text">ç¬¬ä¸‰æ¬¡å®è·µ</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BB%93%E6%9E%84%E5%8C%96%E8%BE%93%E5%87%BA%E5%A4%84%E7%90%86"><span class="toc-number">8.</span> <span class="toc-text">ç»“æ„åŒ–è¾“å‡ºå¤„ç†</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%93%E6%9E%84%E5%8C%96%E8%BE%93%E5%87%BA%E7%9A%84%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">8.1.</span> <span class="toc-text">ç»“æ„åŒ–è¾“å‡ºçš„åº”ç”¨åœºæ™¯</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8ChatClient%E8%8E%B7%E5%8F%96%E7%BB%93%E6%9E%84%E5%8C%96%E5%93%8D%E5%BA%94"><span class="toc-number">8.2.</span> <span class="toc-text">ä½¿ç”¨ChatClientè·å–ç»“æ„åŒ–å“åº”</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Java%E5%AF%B9%E8%B1%A1%E6%98%A0%E5%B0%84%E6%8A%80%E6%9C%AF"><span class="toc-number">8.3.</span> <span class="toc-text">Javaå¯¹è±¡æ˜ å°„æŠ€æœ¯</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-JsonClassDescription%E6%B3%A8%E8%A7%A3"><span class="toc-number">8.4.</span> <span class="toc-text">ä½¿ç”¨@JsonClassDescriptionæ³¨è§£</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%84%E7%90%86%E5%A4%8D%E6%9D%82%E7%9A%84%E5%B5%8C%E5%A5%97%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="toc-number">8.5.</span> <span class="toc-text">å¤„ç†å¤æ‚çš„åµŒå¥—æ•°æ®ç»“æ„</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E5%9B%9B%E6%AC%A1%E5%AE%9E%E8%B7%B5"><span class="toc-number">8.6.</span> <span class="toc-text">ç¬¬å››æ¬¡å®è·µ</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%90%91%E9%87%8F%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">9.</span> <span class="toc-text">å‘é‡æ•°æ®åº“</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B5%8C%E5%85%A5-Embedding-%E7%9A%84%E6%A6%82%E5%BF%B5%E8%A7%A3%E6%9E%90"><span class="toc-number">9.1.</span> <span class="toc-text">åµŒå…¥(Embedding)çš„æ¦‚å¿µè§£æ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Spring-AI%E4%B8%AD%E7%9A%84%E5%90%91%E9%87%8F%E5%AD%98%E5%82%A8%E6%8A%BD%E8%B1%A1"><span class="toc-number">9.2.</span> <span class="toc-text">Spring AIä¸­çš„å‘é‡å­˜å‚¨æŠ½è±¡</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E5%90%91%E9%87%8F%E6%90%9C%E7%B4%A2%E5%AE%9E%E7%8E%B0"><span class="toc-number">9.3.</span> <span class="toc-text">åŸºç¡€å‘é‡æœç´¢å®ç°</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%B8%E4%BC%BC%E5%BA%A6%E8%AE%A1%E7%AE%97%E4%B8%8E%E5%8C%B9%E9%85%8D%E5%8E%9F%E7%90%86"><span class="toc-number">9.4.</span> <span class="toc-text">ç›¸ä¼¼åº¦è®¡ç®—ä¸åŒ¹é…åŸç†</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%A3%80%E7%B4%A2%E5%A2%9E%E5%BC%BA%E7%94%9F%E6%88%90-RAG-%E5%85%A5%E9%97%A8"><span class="toc-number">10.</span> <span class="toc-text">æ£€ç´¢å¢å¼ºç”Ÿæˆ(RAG)å…¥é—¨</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#RAG%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="toc-number">10.1.</span> <span class="toc-text">RAGçš„åŸºæœ¬æ¦‚å¿µ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E6%A1%A3%E5%A4%84%E7%90%86%E4%B8%8EETL%E7%AE%A1%E9%81%93"><span class="toc-number">10.2.</span> <span class="toc-text">æ–‡æ¡£å¤„ç†ä¸ETLç®¡é“</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%91%E9%87%8F%E5%AD%98%E5%82%A8%E4%B8%8E%E6%A3%80%E7%B4%A2"><span class="toc-number">10.3.</span> <span class="toc-text">å‘é‡å­˜å‚¨ä¸æ£€ç´¢</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0RAG%E7%B3%BB%E7%BB%9F"><span class="toc-number">10.4.</span> <span class="toc-text">å®ç°RAGç³»ç»Ÿ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RAG-Advisors"><span class="toc-number">10.5.</span> <span class="toc-text">RAG Advisors</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%B7%A5%E5%85%B7%E8%B0%83%E7%94%A8%E5%8A%9F%E8%83%BD"><span class="toc-number">11.</span> <span class="toc-text">å·¥å…·è°ƒç”¨åŠŸèƒ½</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B7%A5%E5%85%B7%E5%AE%9A%E4%B9%89%E6%A8%A1%E5%BC%8F"><span class="toc-number">11.1.</span> <span class="toc-text">å·¥å…·å®šä¹‰æ¨¡å¼</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%B7%A5%E5%85%B7"><span class="toc-number">11.2.</span> <span class="toc-text">ä½¿ç”¨å·¥å…·</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-Tool%E6%B3%A8%E8%A7%A3%E5%88%9B%E5%BB%BA%E5%8F%AF%E8%B0%83%E7%94%A8%E5%87%BD%E6%95%B0"><span class="toc-number">12.</span> <span class="toc-text">ä½¿ç”¨@Toolæ³¨è§£åˆ›å»ºå¯è°ƒç”¨å‡½æ•°</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#MCP-%E5%8D%8F%E8%AE%AE"><span class="toc-number">13.</span> <span class="toc-text">MCP åè®®</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%BA%94%E6%AC%A1%E5%AE%9E%E8%B7%B5"><span class="toc-number">13.1.</span> <span class="toc-text">ç¬¬äº”æ¬¡å®è·µ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%83%E4%B9%A0-1"><span class="toc-number">13.2.</span> <span class="toc-text">ç»ƒä¹ </span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#AI%E5%BA%94%E7%94%A8%E6%B5%8B%E8%AF%95%E4%B8%8E%E9%83%A8%E7%BD%B2"><span class="toc-number">14.</span> <span class="toc-text">AIåº”ç”¨æµ‹è¯•ä¸éƒ¨ç½²</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E4%B8%8E%E9%9B%86%E6%88%90%E6%B5%8B%E8%AF%95%E5%AE%9E%E7%8E%B0"><span class="toc-number">14.1.</span> <span class="toc-text">å•å…ƒæµ‹è¯•ä¸é›†æˆæµ‹è¯•å®ç°</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8Mock%E5%AF%B9%E8%B1%A1%E8%BF%9B%E8%A1%8C%E6%B5%8B%E8%AF%95"><span class="toc-number">14.2.</span> <span class="toc-text">ä½¿ç”¨Mockå¯¹è±¡è¿›è¡Œæµ‹è¯•</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%84%E4%BC%B0AI%E5%93%8D%E5%BA%94%E8%B4%A8%E9%87%8F%E7%9A%84%E6%96%B9%E6%B3%95"><span class="toc-number">14.3.</span> <span class="toc-text">è¯„ä¼°AIå“åº”è´¨é‡çš„æ–¹æ³•</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SpringBoot%E5%BA%94%E7%94%A8%E7%9A%84%E9%83%A8%E7%BD%B2%E9%80%89%E9%A1%B9"><span class="toc-number">14.4.</span> <span class="toc-text">SpringBootåº”ç”¨çš„éƒ¨ç½²é€‰é¡¹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%91%E6%8E%A7%E4%B8%8E%E6%97%A5%E5%BF%97%E7%AE%A1%E7%90%86"><span class="toc-number">14.5.</span> <span class="toc-text">ç›‘æ§ä¸æ—¥å¿—ç®¡ç†</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#AI%E5%BA%94%E7%94%A8%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96"><span class="toc-number">15.</span> <span class="toc-text">AIåº”ç”¨æ€§èƒ½ä¼˜åŒ–</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#AI%E5%BA%94%E7%94%A8%E6%80%A7%E8%83%BD%E7%9A%84%E5%85%B3%E9%94%AE%E6%8C%87%E6%A0%87"><span class="toc-number">15.1.</span> <span class="toc-text">AIåº”ç”¨æ€§èƒ½çš„å…³é”®æŒ‡æ ‡</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%93%E5%AD%98%E7%AD%96%E7%95%A5%E4%B8%8E%E5%AE%9E%E7%8E%B0"><span class="toc-number">15.2.</span> <span class="toc-text">ç¼“å­˜ç­–ç•¥ä¸å®ç°</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%B9%E5%A4%84%E7%90%86%E4%B8%8E%E5%B9%B6%E8%A1%8C%E8%AF%B7%E6%B1%82"><span class="toc-number">15.3.</span> <span class="toc-text">æ‰¹å¤„ç†ä¸å¹¶è¡Œè¯·æ±‚</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%93%8D%E5%BA%94%E6%B5%81%E5%A4%84%E7%90%86%E6%8A%80%E6%9C%AF"><span class="toc-number">15.4.</span> <span class="toc-text">å“åº”æµå¤„ç†æŠ€æœ¯</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B5%84%E6%BA%90%E4%BD%BF%E7%94%A8%E4%BC%98%E5%8C%96"><span class="toc-number">15.5.</span> <span class="toc-text">èµ„æºä½¿ç”¨ä¼˜åŒ–</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E5%85%AD%E6%AC%A1%E5%AE%9E%E8%B7%B5"><span class="toc-number">15.6.</span> <span class="toc-text">ç¬¬å…­æ¬¡å®è·µ</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>æœ€æ–°æ–‡ç« </span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/12/05/%E5%BE%AE%E5%85%89%E5%90%8E%E7%AB%AF%E5%85%A8%E8%83%BD%E4%BE%A0/" title="å¾®å…‰åç«¯å…¨èƒ½ä¾ "><img src="/./img/YH/3/ailisi3.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="å¾®å…‰åç«¯å…¨èƒ½ä¾ "/></a><div class="content"><a class="title" href="/2025/12/05/%E5%BE%AE%E5%85%89%E5%90%8E%E7%AB%AF%E5%85%A8%E8%83%BD%E4%BE%A0/" title="å¾®å…‰åç«¯å…¨èƒ½ä¾ ">å¾®å…‰åç«¯å…¨èƒ½ä¾ </a><time datetime="2025-12-05T04:00:00.000Z" title="å‘è¡¨äº 2025-12-05 12:00:00">2025-12-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/12/04/API%E6%8E%A5%E5%8F%A3%E9%A1%B9%E7%9B%AE/" title="APIæ¥å£é¡¹ç›®"><img src="/./img/YH/2/anbi2.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="APIæ¥å£é¡¹ç›®"/></a><div class="content"><a class="title" href="/2025/12/04/API%E6%8E%A5%E5%8F%A3%E9%A1%B9%E7%9B%AE/" title="APIæ¥å£é¡¹ç›®">APIæ¥å£é¡¹ç›®</a><time datetime="2025-12-04T05:30:00.000Z" title="å‘è¡¨äº 2025-12-04 13:30:00">2025-12-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/12/01/%E5%9F%BA%E4%BA%8ESpring%E7%94%9F%E6%80%81%E7%9A%84%E6%99%BA%E8%83%BD%E6%96%87%E6%A1%A3%E5%88%86%E6%9E%90%E4%B8%8E%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0/" title="åŸºäºSpringç”Ÿæ€çš„æ™ºèƒ½æ–‡æ¡£åˆ†æä¸ç®¡ç†ç³»ç»Ÿè®¾è®¡ä¸å®ç°"><img src="/./img/YH/zzz.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="åŸºäºSpringç”Ÿæ€çš„æ™ºèƒ½æ–‡æ¡£åˆ†æä¸ç®¡ç†ç³»ç»Ÿè®¾è®¡ä¸å®ç°"/></a><div class="content"><a class="title" href="/2025/12/01/%E5%9F%BA%E4%BA%8ESpring%E7%94%9F%E6%80%81%E7%9A%84%E6%99%BA%E8%83%BD%E6%96%87%E6%A1%A3%E5%88%86%E6%9E%90%E4%B8%8E%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0/" title="åŸºäºSpringç”Ÿæ€çš„æ™ºèƒ½æ–‡æ¡£åˆ†æä¸ç®¡ç†ç³»ç»Ÿè®¾è®¡ä¸å®ç°">åŸºäºSpringç”Ÿæ€çš„æ™ºèƒ½æ–‡æ¡£åˆ†æä¸ç®¡ç†ç³»ç»Ÿè®¾è®¡ä¸å®ç°</a><time datetime="2025-11-30T16:00:00.000Z" title="å‘è¡¨äº 2025-12-01 00:00:00">2025-12-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/11/29/%E5%BE%AE%E5%85%89%E7%94%B5%E5%AD%90%E4%B9%A6%E5%B1%8B/" title="å¾®å…‰ç”µå­ä¹¦å±‹"><img src="/./img/YH/yyy.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="å¾®å…‰ç”µå­ä¹¦å±‹"/></a><div class="content"><a class="title" href="/2025/11/29/%E5%BE%AE%E5%85%89%E7%94%B5%E5%AD%90%E4%B9%A6%E5%B1%8B/" title="å¾®å…‰ç”µå­ä¹¦å±‹">å¾®å…‰ç”µå­ä¹¦å±‹</a><time datetime="2025-11-29T11:30:00.000Z" title="å‘è¡¨äº 2025-11-29 19:30:00">2025-11-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/11/27/JWT%20%E5%92%8C%20Session%E7%9A%84%E5%8C%BA%E5%88%AB/" title="JWT å’Œ Sessionçš„åŒºåˆ«"><img src="/./img/YH/als.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="JWT å’Œ Sessionçš„åŒºåˆ«"/></a><div class="content"><a class="title" href="/2025/11/27/JWT%20%E5%92%8C%20Session%E7%9A%84%E5%8C%BA%E5%88%AB/" title="JWT å’Œ Sessionçš„åŒºåˆ«">JWT å’Œ Sessionçš„åŒºåˆ«</a><time datetime="2025-11-27T02:00:00.000Z" title="å‘è¡¨äº 2025-11-27 10:00:00">2025-11-27</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(/./img/YH/als.jpg);"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2025 By å¾®å…‰zc</span></div><div class="footer_custom_text">ä¸–ç•Œå…¨å‰§ç»ˆï¼Œæ¬¢è¿æ¥åˆ°my blogï¼</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="æ—¥é—´å’Œå¤œé—´æ¨¡å¼åˆ‡æ¢"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="è®¾ç½®"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="å‰å¾€è¯„è®º"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=5.5.2"></script><script src="/js/main.js?v=5.5.2"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@6.1.4/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.pageType === 'shuoshuo'
  const option = null

  const getGiscusTheme = theme => theme === 'dark' ? 'dark' : 'light'

  const createScriptElement = config => {
    const ele = document.createElement('script')
    Object.entries(config).forEach(([key, value]) => {
      ele.setAttribute(key, value)
    })
    return ele
  }

  const loadGiscus = (el = document, key) => {
    const mappingConfig = isShuoshuo
      ? { 'data-mapping': 'specific', 'data-term': key }
      : { 'data-mapping': (option && option['data-mapping']) || 'pathname' }

    const giscusConfig = {
      src: 'https://giscus.app/client.js',
      'data-repo': 'wzcwzc10/wzcwzc10.github.io',
      'data-repo-id': 'R_kgDOPIIccg',
      'data-category-id': 'DIC_kwDOPIIccs4CtHqc',
      'data-theme': getGiscusTheme(document.documentElement.getAttribute('data-theme')),
      'data-reactions-enabled': '1',
      crossorigin: 'anonymous',
      async: true,
      ...option,
      ...mappingConfig
    }

    const scriptElement = createScriptElement(giscusConfig)

    el.querySelector('#giscus-wrap').appendChild(scriptElement)

    if (isShuoshuo) {
      window.shuoshuoComment.destroyGiscus = () => {
        if (el.children.length) {
          el.innerHTML = ''
          el.classList.add('no-comment')
        }
      }
    }
  }

  const changeGiscusTheme = theme => {
    const iframe = document.querySelector('#giscus-wrap iframe')
    if (iframe) {
      const message = {
        giscus: {
          setConfig: {
            theme: getGiscusTheme(theme)
          }
        }
      }
      iframe.contentWindow.postMessage(message, 'https://giscus.app')
    }
  }

  btf.addGlobalFn('themeChange', changeGiscusTheme, 'giscus')

  if (isShuoshuo) {
    'Giscus' === 'Giscus'
      ? window.shuoshuoComment = { loadComment: loadGiscus }
      : window.loadOtherComment = loadGiscus
    return
  }

  if ('Giscus' === 'Giscus' || !false) {
    if (false) btf.loadComment(document.getElementById('giscus-wrap'), loadGiscus)
    else loadGiscus()
  } else {
    window.loadOtherComment = loadGiscus
  }
})()</script></div><canvas id="universe"></canvas><script defer src="/js/universe.js"></script><script src="https://cdn.jsdelivr.net/gh/weilain/cdn-photo/js/jquery.min.js"></script><div class="aplayer no-destroy" data-id="13985424074" data-server="netease" data-type="playlist" data-fixed="true" data-autoplay="false"> </div><script id="canvas_nest" defer="defer" color="255,255,0" opacity="0.6" zIndex="-1" count="120" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/canvas-nest.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/click-show-text.min.js" data-mobile="true" data-text="å¾®å…‰zc,GitHub" data-fontsize="29px" data-random="true" async="async"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/metingjs/dist/Meting.min.js"></script><script>(() => {
  const destroyAplayer = () => {
    if (window.aplayers) {
      for (let i = 0; i < window.aplayers.length; i++) {
        if (!window.aplayers[i].options.fixed) {
          window.aplayers[i].destroy()
        }
      }
    }
  }

  const runMetingJS = () => {
    typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()
  }

  btf.addGlobalFn('pjaxSend', destroyAplayer, 'destroyAplayer')
  btf.addGlobalFn('pjaxComplete', loadMeting, 'runMetingJS')
})()</script><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js"></script><script>(() => {
  const pjaxSelectors = ["meta[property=\"og:image\"]","meta[property=\"og:title\"]","meta[property=\"og:url\"]","meta[property=\"og:description\"]","link[rel=\"canonical\"]","head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

  window.pjax = new Pjax({
    elements: 'a:not([target="_blank"]):not([href="/music/"])',
    selectors: pjaxSelectors,
    cacheBust: false,
    analytics: false,
    scrollRestoration: false
  })

  const triggerPjaxFn = (val) => {
    if (!val) return
    Object.values(val).forEach(fn => {
      try {
        fn()
      } catch (err) {
        console.debug('Pjax callback failed:', err)
      }
    })
  }

  document.addEventListener('pjax:send', () => {
    // removeEventListener
    btf.removeGlobalFnEvent('pjaxSendOnce')
    btf.removeGlobalFnEvent('themeChange')

    // reset readmode
    const $bodyClassList = document.body.classList
    if ($bodyClassList.contains('read-mode')) $bodyClassList.remove('read-mode')

    triggerPjaxFn(window.globalFn.pjaxSend)
  })

  document.addEventListener('pjax:complete', () => {
    btf.removeGlobalFnEvent('pjaxCompleteOnce')
    document.querySelectorAll('script[data-pjax]').forEach(item => {
      const newScript = document.createElement('script')
      const content = item.text || item.textContent || item.innerHTML || ""
      Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
      newScript.appendChild(document.createTextNode(content))
      item.parentNode.replaceChild(newScript, item)
    })

    triggerPjaxFn(window.globalFn.pjaxComplete)
  })

  document.addEventListener('pjax:error', e => {
    if (e.request.status === 404) {
      const usePjax = true
      false
        ? (usePjax ? pjax.loadUrl('/404.html') : window.location.href = '/404.html')
        : window.location.href = e.request.responseURL
    }
  })
})()</script><script async data-pjax src="/"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">æœç´¢</span><i class="fas fa-spinner fa-pulse" id="loading-status" hidden="hidden"></i><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  æ•°æ®åŠ è½½ä¸­</span></div><div class="local-search-input"><input placeholder="æœç´¢æ–‡ç« " type="text"/></div><hr/><div id="local-search-results"></div><div class="ais-Pagination" id="local-search-pagination" style="display:none;"><ul class="ais-Pagination-list"></ul></div><div id="local-search-stats"></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=5.5.2"></script></div></div></body></html><script type="text/javascript" src="/js/crash_cheat.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sakana-widget@2.7.1/lib/sakana.min.css"><div id="sakana-widget" style="position:fixed;bottom:5px;right:80px;"></div><script>function initSakanaWidget() {
  const jufufuht = SakanaWidget.getCharacter('chisato');
  jufufuht.image = `https://wzcwzc10.github.io/img/jufufu.png`;
  jufufuht.initialState = {
    ...jufufuht.initialState,
    i: 0.001,
    d: 1,
  };
  SakanaWidget.registerCharacter('jufufuht', jufufuht);
  new SakanaWidget({ character: 'jufufuht' }).mount('#sakana-widget');

  const jufufu = SakanaWidget.getCharacter('takina');
  jufufu.image = `https://wzcwzc10.github.io/img/jufufu-ht.gif`;
  SakanaWidget.registerCharacter('jufufu', jufufu);
  new SakanaWidget({ character: 'jufufu' }).mount('#sakana-widget');
}
nextCharacter(jufufuht);</script><script async onload="initSakanaWidget()" src="https://cdn.jsdelivr.net/npm/sakana-widget@2.7.1/lib/sakana.min.js"></script>