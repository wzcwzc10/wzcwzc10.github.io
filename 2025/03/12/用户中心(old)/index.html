<!DOCTYPE html><html lang="zh-CN" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>用户中心(old) | 微光zc的网络小窝</title><meta name="author" content="微光zc"><meta name="copyright" content="微光zc"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="鱼皮项目总结(1)">
<meta property="og:type" content="article">
<meta property="og:title" content="用户中心(old)">
<meta property="og:url" content="https://wzcwzc10.github.io/2025/03/12/%E7%94%A8%E6%88%B7%E4%B8%AD%E5%BF%83(old)/index.html">
<meta property="og:site_name" content="微光zc的网络小窝">
<meta property="og:description" content="鱼皮项目总结(1)">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://wzcwzc10.github.io/img/YH/3/anbi3.png">
<meta property="article:published_time" content="2025-03-12T01:00:00.000Z">
<meta property="article:modified_time" content="2025-11-23T09:03:56.114Z">
<meta property="article:author" content="微光zc">
<meta property="article:tag" content="java">
<meta property="article:tag" content="数据库">
<meta property="article:tag" content="后端">
<meta property="article:tag" content="前端">
<meta property="article:tag" content="总结">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://wzcwzc10.github.io/img/YH/3/anbi3.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "用户中心(old)",
  "url": "https://wzcwzc10.github.io/2025/03/12/%E7%94%A8%E6%88%B7%E4%B8%AD%E5%BF%83(old)/",
  "image": "https://wzcwzc10.github.io/img/YH/3/anbi3.png",
  "datePublished": "2025-03-12T01:00:00.000Z",
  "dateModified": "2025-11-23T09:03:56.114Z",
  "author": [
    {
      "@type": "Person",
      "name": "微光zc",
      "url": "https://wzcwzc10.github.io"
    }
  ]
}</script><link rel="shortcut icon" href="/./img/loading.gif"><link rel="canonical" href="https://wzcwzc10.github.io/2025/03/12/%E7%94%A8%E6%88%B7%E4%B8%AD%E5%BF%83(old)/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=5.5.2"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@6.1.4/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!true && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'undefined')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'undefined')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"pagination":{"enable":false,"hitsPerPage":8},"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.12.0/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '用户中心(old)',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="stylesheet" href="/css/ziti.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="/css/universe.css"><!-- hexo injector head_end start -->
<link rel="stylesheet" href="/components/bilibili-card/bilibili-card.dark.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head><body><div id="web_bg" style="background-image: url(/./img/page-bg.png);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/./img/jufufu-ht.gif" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">67</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">66</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">19</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-archive"></i><span> 归档</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间线</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></div><div class="menus_item"><a class="site-page" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 视频</span></a></div><div class="menus_item"><a class="site-page" href="/games/"><i class="fa-fw fas fa-gamepad"></i><span> 游戏</span></a></div><div class="menus_item"><a class="site-page" href="/message/"><i class="fa-fw fas fa-comments"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/shuoshuo/"><i class="fa-fw fas fa-comments"></i><span> 微光闲话</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/./img/YH/3/anbi3.png);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="/./img/yx.png" alt="Logo"><span class="site-name">微光zc的网络小窝</span></a><a class="nav-page-title" href="/"><span class="site-name">用户中心(old)</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  返回首页</span></span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-archive"></i><span> 归档</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间线</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></div><div class="menus_item"><a class="site-page" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 视频</span></a></div><div class="menus_item"><a class="site-page" href="/games/"><i class="fa-fw fas fa-gamepad"></i><span> 游戏</span></a></div><div class="menus_item"><a class="site-page" href="/message/"><i class="fa-fw fas fa-comments"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/shuoshuo/"><i class="fa-fw fas fa-comments"></i><span> 微光闲话</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">用户中心(old)</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-03-12T01:00:00.000Z" title="发表于 2025-03-12 09:00:00">2025-03-12</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-11-23T09:03:56.114Z" title="更新于 2025-11-23 17:03:56">2025-11-23</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E9%B1%BC%E7%9A%AE%E9%A1%B9%E7%9B%AE/">鱼皮项目</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">21.2k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>90分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="1项目开发流程及技术选型"><a href="#1项目开发流程及技术选型" class="headerlink" title="1项目开发流程及技术选型"></a>1项目开发流程及技术选型</h1><h2 id="流程"><a href="#流程" class="headerlink" title="流程"></a>流程</h2><p>需求分析 &#x3D;&gt; 设计(概要设计、详细设计） &#x3D;&gt; 技术选型 &#x3D;&gt;<br>初始化 &#x2F; 引入需要的技术 &#x3D;&gt; 写Demo &#x3D;&gt; 写代码（实现业务逻辑） &#x3D;&gt;<br>测试（单元测试） &#x3D;&gt; 代码提交 &#x2F; 代码评审 &#x3D;&gt; 部署 &#x3D;&gt; 发布  </p>
<p>项目流程解释</p>
<ol>
<li>需求分析<br>◦需求收集整理：将项目需要的信息进行分类、排序<br>◦需求分析验证：对需求深入分析，包括业务逻辑、约束条件和潜在风险，确认需求的准确性和完整性，确保需求都是清晰、可衡量和可实现的<br>◦需求文档化：项目执行和后期参考的依据</li>
<li>概要设计、详细设计<br>概要设计：确定总体布局<br>▪系统总体架构：定义整体结构（硬件、软件、网络等）<br>▪功能模块划分：划分模块，明确各模块的功能和职责<br>▪接口设计：定义模块之间接口，确保模块间数据交互流畅<br>▪技术选型：根据需求以及技术的发展，选择适合的技术栈和工具链<br>▪数据库逻辑设计：数据库的逻辑结构（表结构、索引、引脚等）<br>▪用户界面设计：初步设计用户界面的布局和交互方式</li>
</ol>
<p>详细设计：细化各个模块的设计<br>▪算法设计：功能模块设计具体算法，实现业务逻辑<br>▪数据结构设计：设计详细的数据结构（数据库）<br>▪接口物理定义：明确模块间接口的物理实现方式（Eg：API接口定义）<br>▪用户界面细化：详细设计用户界面的布局、样式、交互逻辑等<br>▪错误处理与安全性设计：考虑系统可能出现的异常情况，设计相应的错误处理机制和安全性措施<br>3. 技术选型<br>根据需求及技术的发展选择适合的技术栈和工具链<br>4. 初始化 &#x2F; 引入需要的技术<br>◦根据技术选型的结果，搭建开发环境，引入所需的框架、库等，并进行必要的配置<br>◦新项目：初始化<br>◦已有项目：引入需要的技术<br>5. 写Demo<br>在正式开始编码之前，编写一个简单的演示程序（Demo），验证技术选型的可行性和设计的合理性（Eg：测试组件库是否引入成功）<br>6. 写代码（实现业务逻辑）<br>根据详细设计文档，编写实现业务逻辑的代码。需要遵循编码规范，保证代码可读性、可维护性和可扩展性<br>7. 测试（单元测试）<br>编写单元测试代码，对项目的各个模块进行测试，确保它们按照预期工作<br>8. 代码提交 &#x2F; 代码评审<br>将编写好的代码提交到代码仓库，并进行代码评审。代码评审可以帮助发现潜在的问题，提高代码质量。<br>9. 部署<br>将代码部署到生产环境或测试环境，进行集成测试和性能测试<br>10. 发布<br>经过充分的测试后，将项目发布，进行实际使用以及后续进行的维护和升级</p>
<h2 id="需求分析与技术选型"><a href="#需求分析与技术选型" class="headerlink" title="需求分析与技术选型"></a>需求分析与技术选型</h2><ol>
<li>登录 &#x2F; 注册</li>
<li>用户管理（仅管理员可见）对用户的查询或者修改</li>
<li>用户校验（仅星球用户）</li>
</ol>
<p>前端：三件套 + React + 组件库 Ant Design + Umi + Ant Design Pro（现成的管理系统）<br>后端：Java + MySQL<br>•Spring （依赖注入框架，帮助你管理 Java 对象，集成一些其他的内容）<br>•SpringMVC （web 框架，提供接口访问、restful接口等能力）<br>•Mybatis （Java 操作数据库的框架，持久层框架，对 jdbc 的封装）<br>•Mybatis-plus （对 mybatis 的增强，不用写 sql 也能实现增删改查）<br>•SpringBoot （快速启动 &#x2F; 快速集成项目。不用自己管理 spring 配置，不用自己整合各种框架）<br>•Junit （单元测试库）<br>部署：服务器 &#x2F; 容器（平台）</p>
<h1 id="2前端初始化"><a href="#2前端初始化" class="headerlink" title="2前端初始化"></a>2前端初始化</h1><h2 id="Ant-Design-组件引入"><a href="#Ant-Design-组件引入" class="headerlink" title="Ant Design 组件引入"></a>Ant Design 组件引入</h2><p><a target="_blank" rel="noopener" href="https://pro.ant.design/zh-CN/">Ant Design Pro 官网</a><br><a target="_blank" rel="noopener" href="https://github.com/ant-design/ant-design-pro?tab=readme-ov-file">GitHub 项目链接</a>  </p>
<p>官网点击<a target="_blank" rel="noopener" href="https://pro.ant.design/zh-CN/docs/getting-started/">开始使用</a>，找到初始化依次执行<br><img src="https://cdn.nlark.com/yuque/0/2024/png/40385325/1727446979793-48de5c2b-d541-4fcb-a750-47455903f4fb.png">  </p>
<p>操作步骤【跟鱼皮保持一致版本3.1.0】</p>
<ol>
<li>管理员方式打开命令行 执行下面命令<br><code>npm i @ant-design/pro-cli@3.1.0 -g</code><br><code>npm i @ant-design/pro-cli -g</code></li>
</ol>
<p>查看ant-design-pro的版本号，保证是3.1.0<br><code>pro -v</code></p>
<p>下载镜像（进度条不动处理）<br><code>npm config set registry https://registry.npmmirror.com</code></p>
<p>查看是否成功<br><code>npm config get registry</code></p>
<ol start="2">
<li>进入要创建项目的文件目录下，打开命令行输入如下命令</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pro create myapp</span><br><span class="line"></span><br><span class="line">#如果安装了 nvm 使用如下命令</span><br><span class="line">npx pro create myapp</span><br></pre></td></tr></table></figure>

<blockquote>
<p>全称为 node.js version management，顾名思义是用于管理多个 nodejs 的<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6%E5%B7%A5%E5%85%B7&spm=1001.2101.3001.7020">版本控制工具</a>。<br>通过 nvm 可以安装和切换不同版本的 nodejs。<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_42065687/article/details/141320242">使用教程</a><br>选择 umi@3 、 simple   </p>
</blockquote>
<ol start="3">
<li><p>使用 WebStorm 打开项目，安装依赖</p>
<blockquote>
<p>或者采用鱼皮视频中输入命令 yarn 或 npm 的方法<br>依赖安装完成后，在 package.json 文件中点击 start &#x3D;&gt; Run start 运行项目<br>项目启动成功后，点击 <a target="_blank" rel="noopener" href="http://localhost:8000/">http://localhost:8000</a> 访问<br><code>&quot;start&quot;: &quot;cross-env UMI_ENV=dev umi dev&quot;,</code><br><code>&quot;start:dev&quot;: &quot;cross-env REACT_APP_ENV=dev MOCK=none UMI_ENV=dev umi dev&quot;,</code><br>两个启动命令的区别：start-dev 中的 MOCK &#x3D; none 是关闭模拟数据，此时没有后台数据，登录使用的数据是模拟数据，故使用 start-dev 启动项目时会登陆失败  </p>
</blockquote>
</li>
<li><p>配置umi UI，点击Teriminal，输入如下命令</p>
<blockquote>
<p>输入yarn add @umijs&#x2F;preset-ui -D会报错提示node版本不兼容<br><code>npm install --save-dev @umijs/preset-ui</code><br>再start启动项目，可以看到右下角出现这个工具（目前没显示，已忽略）</p>
</blockquote>
</li>
</ol>
<h2 id="框架瘦身"><a href="#框架瘦身" class="headerlink" title="框架瘦身"></a>框架瘦身</h2><p>每次删除一个文件，都重启项目看是否能运行  </p>
<ol>
<li><p>在 package.json 中找到 i18n-remove （移除国际化的脚本）执行</p>
</li>
<li><p>目录结构</p>
<blockquote>
<p>├── config                   # umi 配置，包含路由，构建等配置【下面的oneapi.json（定义整个项目用到的接口）删】<br>├── mock                     # 本地模拟数据<br>├── public                   # 一些静态资源（logo、图标等）<br>│   └── favicon.png          # Favicon<br>├── src<br>│   ├── assets               # 本地静态资源<br>│   ├── components           # 业务通用组件<br>│   ├── e2e                  # 集成测试用例【删】<br>│   ├── layouts              # 通用布局<br>│   ├── models               # 全局 dva model<br>│   ├── pages                # 业务页面入口和常用模板<br>│   ├── services             # 后台接口服务【下面的swagger（接口文档工具）删】<br>│   ├── utils                # 工具库<br>│   ├── locales              # 国际化资源【删】<br>│   ├── global.less          # 全局样式<br>│   └── global.ts            # 全局 JS<br>├── tests                    # 测试工具【删】<br>├── README.md<br>└── package.json<br>jest.config.ts               # 测试工具 【删】<br>playwright.config.ts         # 自动化测试工具，帮助在火狐、谷歌自动测试，不用真实打开浏览器 【删】</p>
</blockquote>
</li>
<li><p>其他文件介绍<br><img src="https://cdn.nlark.com/yuque/0/2024/png/40385325/1727448088010-e13a39e1-2a65-473e-85d6-4b4b039cacae.png"><br>app.tsx 项目全局入口文件，定义了整个项目中使用的公共数据（比如用户信息）<br>global.less 全局引用样式（尽量不动），可理解为 css<br>global.tsx 全局脚本文件，可理解为 js<br>service-worker.js 一些前端页面的缓存<br>typings.d.ts 定义了一些 ts 的类型，类似C语言中的宏定义 (#)<br>.editorconfig 编辑器的配置<br>.eslintrc.js 检查 js 语法是否规范<br>prettierrc.js 美化前端代码的工具<br>jest.config.js 测试工具【删】<br>.stylelintrc.js 检查 css 语法是否规范<br>playwright.config.ts 自动化测试工具，帮助在火狐、谷歌自动测试，不用真实打开浏览器 【删】<br>asscess.ts 控制用户的访问权限【链接】</p>
</li>
</ol>
<p>•【删除第三个config下的oneapi.json文件时  删了时候无法运行解决：】<br>•【app.tsx文件Parameter *** implicity has *** type爆红解决：】</p>
<ol start="4">
<li><a target="_blank" rel="noopener" href="https://pro.ant.design/zh-CN/docs/title-landing">修改标题和Logo</a></li>
</ol>
<h1 id="3后端初始化"><a href="#3后端初始化" class="headerlink" title="3后端初始化"></a>3后端初始化</h1><h2 id="创建项目"><a href="#创建项目" class="headerlink" title="创建项目"></a>创建项目</h2><p>安装 MySQL 数据库<br>3种方式初始化 Java 项目</p>
<ol>
<li>Github 上搜索 SpringBoot 模板，拉取（不推荐）  </li>
<li>SpringBoot <a target="_blank" rel="noopener" href="https://start.spring.io/">官方模板生成器</a>​)  </li>
<li>IDEA 生成（推荐）</li>
</ol>
<h2 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h2><ol>
<li>创建项目<br>spring.io 不支持勾选 Java 8 了 ， 可以如下图所示，点击齿轮，将初始化链接换成阿里云的<a target="_blank" rel="noopener" href="http://start.aliyun.com/">http://start.aliyun.com</a>, 就可以正常选择 Java 8<br><img src="https://cdn.nlark.com/yuque/0/2024/png/40385325/1727620682134-07b29a08-7aa6-4123-8057-6c500ebf7165.png"></li>
</ol>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/40385325/1727620733968-0e049c9a-0b66-48c6-99dc-f791a63da307.png"></p>
<ol start="2">
<li>连接数据库<br>root 123456</li>
</ol>
<h2 id="Spring-Boot-框架整合"><a href="#Spring-Boot-框架整合" class="headerlink" title="Spring Boot 框架整合"></a>Spring Boot 框架整合</h2><p>（一）创建数据库<br>（二）按照 mybatis-plus <a target="_blank" rel="noopener" href="https://baomidou.com/getting-started/">官方教程</a> 操作  </p>
<ol>
<li>建表（官方教程复制）</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">#建表</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> <span class="keyword">user</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE TABLE</span> <span class="keyword">user</span></span><br><span class="line">(</span><br><span class="line">  id <span class="type">BIGINT</span> <span class="keyword">NOT NULL</span> COMMENT <span class="string">&#x27;主键ID&#x27;</span>,</span><br><span class="line">  name <span class="type">VARCHAR</span>(<span class="number">30</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;姓名&#x27;</span>,</span><br><span class="line">  age <span class="type">INT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;年龄&#x27;</span>,</span><br><span class="line">  email <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;邮箱&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY KEY</span> (id)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">#插入假数据</span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> <span class="keyword">user</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT INTO</span> <span class="keyword">user</span> (id, name, age, email) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="number">1</span>, <span class="string">&#x27;Jone&#x27;</span>, <span class="number">18</span>, <span class="string">&#x27;test1@baomidou.com&#x27;</span>),</span><br><span class="line">(<span class="number">2</span>, <span class="string">&#x27;Jack&#x27;</span>, <span class="number">20</span>, <span class="string">&#x27;test2@baomidou.com&#x27;</span>),</span><br><span class="line">(<span class="number">3</span>, <span class="string">&#x27;Tom&#x27;</span>, <span class="number">28</span>, <span class="string">&#x27;test3@baomidou.com&#x27;</span>),</span><br><span class="line">(<span class="number">4</span>, <span class="string">&#x27;Sandy&#x27;</span>, <span class="number">21</span>, <span class="string">&#x27;test4@baomidou.com&#x27;</span>),</span><br><span class="line">(<span class="number">5</span>, <span class="string">&#x27;Billie&#x27;</span>, <span class="number">24</span>, <span class="string">&#x27;test5@baomidou.com&#x27;</span>);</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>pom.xml 文件中引入依赖<br>junit 从 <a target="_blank" rel="noopener" href="https://mvnrepository.com/artifact/junit/junit">maven 仓库</a> 中引入</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/com.baomidou/mybatis-plus-boot-starter --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/junit/junit --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.13.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>配置<br>application.properties 改成 application.yml<br><a target="_blank" rel="noopener" href="https://www.mianshiya.com/question/1797428369051222017">面试鸭 - Spring Boot 中 application.properties 和 application.yml 的区别是什么</a></li>
</ol>
<p>视频中需要更新的地方：driver-class-name: com.mysql.cj.jdbc.Driver</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">user-center</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#DataSource Config</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="comment"># 如果安装了多版本的 MySQL ，此处需要修改端口号</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/yupi</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">你的用户名</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">你的密码</span></span><br><span class="line"></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8080</span></span><br></pre></td></tr></table></figure>

<p>在 Spring Boot 启动类中添加 @MapperScan 注解，扫描 Mapper 文件夹（没有mapper，新建一个）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;com.yupi.usercenter.mapper&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserCenterApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(UserCenterApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>编码<br>编写实体类 User.java：</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>编写 Mapper 接口类 UserMapper.java：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;User&gt; &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>开始使用<br>添加测试类，进行功能测试（两种方式）</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserCenterApplicationTests</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Resource</span></span><br><span class="line"><span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">contextLoads</span><span class="params">()</span> &#123;</span><br><span class="line">   System.out.println((<span class="string">&quot;----- selectAll method test ------&quot;</span>));</span><br><span class="line">   <span class="type">List</span> <span class="variable">userList</span> <span class="operator">=</span> userMapper.selectList(<span class="literal">null</span>);</span><br><span class="line">   Assert.isTrue(<span class="number">5</span> == userList.size(), <span class="string">&quot;&quot;</span>);</span><br><span class="line">   userList.forEach(System.out::println);</span><br><span class="line">    &#125; </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SampleTest</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Resource</span></span><br><span class="line"><span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSelect</span><span class="params">()</span> &#123;</span><br><span class="line">   System.out.println((<span class="string">&quot;----- selectAll method test ------&quot;</span>));</span><br><span class="line">   <span class="type">List</span> <span class="variable">userList</span> <span class="operator">=</span> userMapper.selectList(<span class="literal">null</span>);</span><br><span class="line">    Assert.isTrue(<span class="number">5</span> == userList.size(), <span class="string">&quot;&quot;</span>);</span><br><span class="line">    userList.forEach(System.out::println); &#125; &#125; </span><br></pre></td></tr></table></figure>

<h2 id="数据库表设计"><a href="#数据库表设计" class="headerlink" title="数据库表设计"></a>数据库表设计</h2><blockquote>
<p>性别是否需要索引？<br>不需要，区分度不高的字段。只有2种取值的字段,建了索引数据库也不一定会用,只会白白增加索引维护的额外开销,因为索引也是需要存储的,所以插入和更新的写入操作,同时需要插入和更新你这个字段的索引的。<br>所以说,唯一性太差的字段不需要创建索引,即便用于where条件</p>
</blockquote>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/40385325/1727481720834-162a7e49-2461-48eb-9a79-9924b6675e86.png"></p>
<ol>
<li>删除测试 Mybatis-plus 是否引入成功时创建的 user 表，执行如下语句</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `<span class="keyword">user</span>`</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>建表，执行如下建表语句（或者使用 idea、可视化工具建表）</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> <span class="string">&#x27;user&#x27;</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> <span class="string">&#x27;user&#x27;</span> (</span><br><span class="line"></span><br><span class="line">  `username` <span class="type">varchar</span>(<span class="number">256</span>)                             <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;用户昵称&#x27;</span>,</span><br><span class="line">  `id` <span class="type">bigint</span> <span class="keyword">NOT NULL</span> AUTO_INCREMENT                 COMMENT <span class="string">&#x27;id&#x27;</span>,</span><br><span class="line">  `userAccount` <span class="type">varchar</span>(<span class="number">256</span>)                          <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;账号&#x27;</span>,</span><br><span class="line">  `avatarUrl` <span class="type">varchar</span>(<span class="number">1024</span>)                           <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;用户头像&#x27;</span>,</span><br><span class="line">  `gender` tinyint                                    <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;性别&#x27;</span>,</span><br><span class="line">  `userPassword` <span class="type">varchar</span>(<span class="number">512</span>)                         <span class="keyword">NOT NULL</span> COMMENT <span class="string">&#x27;密码&#x27;</span>,</span><br><span class="line">  `phone` <span class="type">varchar</span>(<span class="number">128</span>)                                <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;电话&#x27;</span>,</span><br><span class="line">  `email` <span class="type">varchar</span>(<span class="number">512</span>)                                <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;邮箱&#x27;</span>,</span><br><span class="line">  `userStatus` <span class="type">int</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span>                        <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;状态 0-正常&#x27;</span>,</span><br><span class="line">  `createTime` datetime <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>     <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">  `updateTime` datetime <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>     <span class="keyword">NULL</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="string">&#x27;更新时间&#x27;</span>,</span><br><span class="line">  `isDelete` tinyint  <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span>                     <span class="keyword">NOT NULL</span> COMMENT <span class="string">&#x27;是否删除&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY KEY</span> (`id`)</span><br><span class="line"></span><br><span class="line">) COMMENT<span class="operator">=</span><span class="string">&#x27;用户表&#x27;</span>;</span><br></pre></td></tr></table></figure>


<h2 id="规整项目目录"><a href="#规整项目目录" class="headerlink" title="规整项目目录"></a>规整项目目录</h2><p>新建 controller、service、utils 包<br>删除测试 Mybatis-plus 是否引入成功时创建的 User、UserMapper、SampleTest<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/huzia/article/details/124345353">【图解 Spring Boot 五层结构】</a></p>
<table>
<thead>
<tr>
<th>文件</th>
<th>说明</th>
<th>补充说明</th>
</tr>
</thead>
<tbody><tr>
<td>controller</td>
<td>请求层&#x2F;控制层<br/>（只接收请求）</td>
<td>应用程序的入口点，负责接收用户的请求并返回响应。<br/>调用Service层的方法来处理业务逻辑，并将结果返回给前端用户</td>
</tr>
<tr>
<td>service</td>
<td>业务逻辑层<br/>（专门编写业务逻辑，例如登录注册）</td>
<td>程序核心，负责处理业务逻辑。<br/>接收Controller层的请求，调用Mapper层执行数据库操作，并将处理结果返回给Controller层。<br/>还可以包含一些复杂的业务逻辑处理，如事务管理、数据校验等。</td>
</tr>
<tr>
<td>mapper &#x2F; dao</td>
<td>数据库访问层<br/>（专门从数据库中对数据进行增删改查操作）</td>
<td>负责与数据库交互，执行数据的增删改查（CRUD）操作。<br/>通常包含了一系列的接口，定义了数据库操作的方法，而具体的SQL实现则位于Mapper XML文件中</td>
</tr>
<tr>
<td>model &#x2F; entity &#x2F; pojo</td>
<td>实体层<br/>（定义了一些和数据库相关的数据模型、封装类）<br/>（可能需要分层 entity、dto、vo……）</td>
<td>定义数据模型，即数据库表的映射实体类。<br/>实体类中包含了与数据库表相对应的属性和方法（如get和set方法，toString 方法，有参无参构造函数）</td>
</tr>
<tr>
<td>utils</td>
<td>存放一些工具类<br/>（加密、格式转换、日期转换……<br/>与业务关系不太大的类）</td>
<td></td>
</tr>
<tr>
<td>static</td>
<td>写前后端不分离的项目时，放一些静态文件(html)</td>
<td></td>
</tr>
</tbody></table>
<h1 id="4后端注册登录功能"><a href="#4后端注册登录功能" class="headerlink" title="4后端注册登录功能"></a>4后端注册登录功能</h1><h2 id="后端-代码生成器Mybatis-X的使用"><a href="#后端-代码生成器Mybatis-X的使用" class="headerlink" title="后端-代码生成器Mybatis-X的使用"></a>后端-代码生成器Mybatis-X的使用</h2><p>Mybatis-X插件，自动根据数据库生成<br>•domain（实体对象）<br>•mapper（操作数据库的对象）<br>•mapper.xml（定义了mapper对象和数据库的关联，可以在里面自己写SQL）<br>•service（包含常用的增删改查）<br>	◦serviceImpl（具体实现service）  </p>
<ol>
<li>插件的使用<br>右键数据库表，点击第一行路径默认<blockquote>
<p>勾选 Comment 可以在生成的实体类添加注释<br>勾选 Actual Column 可以让生成实体类的字段名和数据库保持一致</p>
</blockquote>
</li>
</ol>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/40385325/1731837916146-ed0e9372-0e35-4a87-b8c2-197e87b9d9e1.png"><br>◦domain 放入 model 包<br>◦UserMapper 放入mapper 包<br>◦impl 和 UserService 放入 service 包<br>◦删除 generator</p>
<ol start="2">
<li>测试<br>◦鼠标放在 UserService.java 文件的 UserService 上，按住 alt + enter ，选择创建测试类<br>◦编写测试代码【安装插件 CenerateAllSetter ，可快速生成代码】<br>完整代码：</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserServiceTest</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Resource</span></span><br><span class="line"><span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testAddUser</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">    user.setUsername(<span class="string">&quot;dogYupi&quot;</span>);</span><br><span class="line">    user.setUserAccount(<span class="string">&quot;123&quot;</span>);</span><br><span class="line">    user.setAvatarUrl(<span class="string">&quot;https://profile-avatar.csdnimg.cn/aee7bf7d9b0640489ce4189664a41212_2201_75344078.jpg!1&quot;</span>);</span><br><span class="line">    user.setGender(<span class="number">0</span>);</span><br><span class="line">    user.setUserPassword(<span class="string">&quot;xxx&quot;</span>);</span><br><span class="line">    user.setPhone(<span class="string">&quot;123&quot;</span>);</span><br><span class="line">    user.setEmail(<span class="string">&quot;456&quot;</span>);</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">result</span> <span class="operator">=</span> userService.save(user);</span><br><span class="line">    System.out.println(user.getId());</span><br><span class="line">    Assertions.assertTrue(result);  <span class="comment">// 断言result为true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>执行测试，会发现报错  </p>
<ol start="3">
<li>问题解决<br>◦问题原因：MyBatisX自动开启从经典数据库列名 A_COLUMN（下划线命名） 到经典 Java 属性名 aColumn（驼峰命名） 的类似映射<br>◦问题解决：yml 文件中添加如下配置<br><a target="_blank" rel="noopener" href="https://baomidou.com/reference/#mapunderscoretocamelcase">官网描述</a>【链接已更新】</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mybatis-plus:</span><br><span class="line">  configuration:</span><br><span class="line">    map-underscore-to-camel-case: false</span><br></pre></td></tr></table></figure>
<p>再次测试  </p>
<h2 id="详细设计"><a href="#详细设计" class="headerlink" title="详细设计"></a>详细设计</h2><p>注册接口</p>
<ol>
<li>用户在前端输入账户和密码、以及校验码（todo）  </li>
<li>校验用户的账户、密码、校验密码是否符合要求<br> ◦账户不小于 4 位（自己扩展校验）<br> ◦密码不小于 8 位<br> ◦账户不能重复<br> ◦账户不包含特殊字符<br> ◦密码和校验密码相同  </li>
<li>对密码进行加密（千万不能明文存储到数据库中）</li>
<li>向数据库插入用户数据</li>
</ol>
<p>登录接口  </p>
<ol>
<li>接收参数：用户账户、密码  </li>
<li>请求类型：POST<br>请求参数很长时不建议用 GET  </li>
<li>请求体：JSON格式的数据  </li>
<li>返回值：用户信息（脱敏）</li>
</ol>
<p>逻辑  </p>
<ol>
<li>校验用户账户和密码是否合法<br> ◦非空<br> ◦账户不小于 4 位<br> ◦密码不小于 8 位<br> ◦账户不包含特殊字符  </li>
<li>校验密码是否输入正确，要和数据库中的密文密码对比  </li>
<li>用户脱敏，隐藏敏感信息，防止数据库中的字段泄露  </li>
<li>我们要记录用户的登录态（session），将其存到服务器上（用后端SpringBoot框架封装的服务器tomcat去记录）<br> ◦cookie  </li>
<li>返回安全的脱敏后的用户信息</li>
</ol>
<h2 id="后端-接口测试开发"><a href="#后端-接口测试开发" class="headerlink" title="后端-接口测试开发"></a>后端-接口测试开发</h2><blockquote>
<p>Tips: 如何快速生成注释<br>在方法上打出 &#x2F;** 回车即可</p>
</blockquote>
<ol>
<li>src&#x2F;main&#x2F;java&#x2F;fun.weiguang&#x2F;usercenter&#x2F;service&#x2F;UserService.java 编写 userRegister 方法并实现<br><img src="https://cdn.nlark.com/yuque/0/2024/png/40385325/1728476069072-274e0862-f507-48cb-8c9d-445a57c4ad0d.png"></li>
</ol>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/40385325/1728476237825-6eab9fde-c7ff-40da-b666-ab6d962fa553.png"></p>
<ol start="2">
<li>去 maven 仓库 引入 commons-lang3 依赖</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.apache.commons/commons-lang3 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.commons<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-lang3<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.12.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>UserServiceImpl 实现代码</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;UserMapper, User&gt;</span><br><span class="line">    <span class="keyword">implements</span> <span class="title class_">UserService</span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Resource</span></span><br><span class="line">   <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line">   </span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">userRegister</span><span class="params">(String userAccount, String userPassword, String checkPassword)</span> </span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">/* 1. 校验 */</span></span><br><span class="line">      <span class="keyword">if</span> (StringUtils.isAnyBlank(userAccount, userPassword, checkPassword)) &#123;</span><br><span class="line">         <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (userAccount.length() &lt; <span class="number">4</span>) &#123;</span><br><span class="line">         <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (userPassword.length() &lt; <span class="number">8</span> || checkPassword.length() &lt; <span class="number">8</span>) &#123;</span><br><span class="line">         <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      <span class="comment">//账户不能包含特殊字符</span></span><br><span class="line">      <span class="type">String</span> <span class="variable">validateRegExp</span> <span class="operator">=</span> <span class="string">&quot;\\pP|\\pS|\\s+&quot;</span>;</span><br><span class="line">      <span class="type">Matcher</span> <span class="variable">matcher</span> <span class="operator">=</span> Pattern.compile(validateRegExp).matcher(userAccount);</span><br><span class="line">      <span class="keyword">if</span> (!matcher.find()) &#123;</span><br><span class="line">         <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      <span class="comment">//校验密码是否相同</span></span><br><span class="line">      <span class="keyword">if</span> (!userPassword.equals(checkPassword)) &#123;</span><br><span class="line">         <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      <span class="comment">//账户不能重复</span></span><br><span class="line">      QueryWrapper&lt;User&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">      queryWrapper.eq(<span class="string">&quot;userAccount&quot;</span>, userAccount);</span><br><span class="line">      <span class="type">Long</span> <span class="variable">count</span> <span class="operator">=</span> userMapper.selectCount(queryWrapper);</span><br><span class="line">      <span class="keyword">if</span> (count &gt; <span class="number">0</span>) &#123;</span><br><span class="line">         <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">      &#125;</span><br><span class="line">     <span class="comment">/* 2.加密 —— 先做一个测试【如下图所示】 */</span></span><br><span class="line">      <span class="keyword">final</span> <span class="type">String</span> <span class="variable">SALT</span> <span class="operator">=</span> <span class="string">&quot;yupi&quot;</span>;</span><br><span class="line">      <span class="type">String</span> <span class="variable">encryptPassword</span> <span class="operator">=</span> DigestUtils.md5DigestAsHex((SALT + userPassword).getBytes());</span><br><span class="line">      </span><br><span class="line">      <span class="comment">/* 3.插入数据 */</span></span><br><span class="line">      <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">      user.setUserAccount(userAccount);</span><br><span class="line">      user.setUserPassword(encryptPassword);</span><br><span class="line">      <span class="type">boolean</span> <span class="variable">saveResult</span> <span class="operator">=</span> <span class="built_in">this</span>.save(user);</span><br><span class="line">      <span class="keyword">if</span> (!saveResult) &#123;</span><br><span class="line">         <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> user.getId();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>src&#x2F;test&#x2F;java&#x2F;com&#x2F;yupi&#x2F;usercenter&#x2F;UserCenterApplicationTests.java 中编写测试，执行（加密成功）<br><img src="https://cdn.nlark.com/yuque/0/2024/png/40385325/1728476980332-c71fd5d8-9b75-4f7f-b1a7-7f6b765ca604.png"></p>
<h2 id="后端-单元测试"><a href="#后端-单元测试" class="headerlink" title="后端-单元测试"></a>后端-单元测试</h2><p><img src="https://cdn.nlark.com/yuque/0/2024/png/40385325/1728478068953-39ebb0ca-eb76-4ace-b6df-31c4df8707a9.png"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">ServiceTest 测试代码生成与编写</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">userRegister</span><span class="params">()</span> &#123;</span><br><span class="line">   <span class="type">String</span> <span class="variable">userAccount</span> <span class="operator">=</span> <span class="string">&quot;yupi&quot;</span>;</span><br><span class="line">   <span class="type">String</span> <span class="variable">userPassword</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">   <span class="type">String</span> <span class="variable">checkPassword</span> <span class="operator">=</span> <span class="string">&quot;123456&quot;</span>;</span><br><span class="line">   <span class="type">long</span> <span class="variable">result</span> <span class="operator">=</span> userService.userRegister(userAccount, userPassword, checkPassword);</span><br><span class="line">   Assertions.assertEquals(-<span class="number">1</span>, result);</span><br><span class="line">   </span><br><span class="line">   userAccount = <span class="string">&quot;yu&quot;</span>;</span><br><span class="line">   result = userService.userRegister(userAccount, userPassword, checkPassword);</span><br><span class="line">   Assertions.assertEquals(-<span class="number">1</span>, result);</span><br><span class="line">   </span><br><span class="line">   userAccount = <span class="string">&quot;yupi&quot;</span>;</span><br><span class="line">   userPassword = <span class="string">&quot;123456&quot;</span>;</span><br><span class="line">   result = userService.userRegister(userAccount, userPassword, checkPassword);</span><br><span class="line">   Assertions.assertEquals(-<span class="number">1</span>, result);</span><br><span class="line">   </span><br><span class="line">   userAccount = <span class="string">&quot;yu pi&quot;</span>;</span><br><span class="line">   userPassword = <span class="string">&quot;12345678&quot;</span>;</span><br><span class="line">   result = userService.userRegister(userAccount, userPassword, checkPassword);</span><br><span class="line">   Assertions.assertEquals(-<span class="number">1</span>, result);</span><br><span class="line">   </span><br><span class="line">   checkPassword = <span class="string">&quot;123456789&quot;</span>;</span><br><span class="line">   result = userService.userRegister(userAccount, userPassword, checkPassword);</span><br><span class="line">   Assertions.assertEquals(-<span class="number">1</span>, result);</span><br><span class="line">   </span><br><span class="line">   userAccount = <span class="string">&quot;dogYupi&quot;</span>;</span><br><span class="line">   checkPassword = <span class="string">&quot;12345678&quot;</span>;</span><br><span class="line">   result = userService.userRegister(userAccount, userPassword, checkPassword);</span><br><span class="line">   Assertions.assertEquals(-<span class="number">1</span>, result);</span><br><span class="line">   </span><br><span class="line">   userAccount = <span class="string">&quot;yupi&quot;</span>;</span><br><span class="line">   result = userService.userRegister(userAccount, userPassword, checkPassword);</span><br><span class="line">   Assertions.assertTrue(result &gt; <span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>执行 报错了【电脑在 idea 更新了一些配置后这里不会报错了，依旧报错按照下面更换正则表达式】<br>•Java 过滤特殊字符的正则表达式换成<br>[&#96;~!@#$%<sup>&amp;</sup><sup><em>()+&#x3D;|{}’:;’,[].&lt;&gt;&#x2F;?~！@#￥%……&amp;</em></sup><sup>（）——+|{}【】‘；：”“’。，、？] 或者<br>[</sup>a-zA-Z0-9] (如果不行，搜索合适的正则表达式[A-Za-z0-9_-\u4e00-\u9fa5]+），<br>再次执行，报错了（是因为数据库中没有dogYupi 这个账户，设置与其返回值为 -1，所以报错）</p>
<h2 id="登录功能编写代码"><a href="#登录功能编写代码" class="headerlink" title="登录功能编写代码"></a>登录功能编写代码</h2><ol>
<li><p>UserService 编写如下代码，Alt + Enter 实现方法<br><img src="https://cdn.nlark.com/yuque/0/2024/png/40385325/1728479559107-640dcc0c-b18d-469c-919f-d235e9f5661a.png"></p>
</li>
<li><p>进入 Impl 将 Register 的逻辑复制过来，进行修改<br>◦将 final String SALT &#x3D; “yupi”; 提到前面<br>◦添加 @Slf4j 注解，使用 log 【方便后续系统出现问题，到日志中查找问题】<br>◦修改部分逻辑 【删除插入数据；账户不能重复修改成查询用户是否存在，放在加密之后】</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* <span class="doctag">@author</span> wgzc</span></span><br><span class="line"><span class="comment">* <span class="doctag">@description</span> 针对表【user(用户表)】的数据库操作Service实现</span></span><br><span class="line"><span class="comment">* <span class="doctag">@createDate</span> 2024-10-02 19:47:46</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;UserMapper, User&gt;</span><br><span class="line">        <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 盐值，混淆密码</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">SALT</span> <span class="operator">=</span> <span class="string">&quot;yupi&quot;</span>;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">userRegister</span><span class="params">(String userAccount, String userPassword, String checkPassword)</span> &#123;</span><br><span class="line">        <span class="comment">/* 1. 校验 */</span></span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isAnyBlank(userAccount, userPassword, checkPassword)) &#123;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (userAccount.length() &lt; <span class="number">4</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (userPassword.length() &lt; <span class="number">8</span> || checkPassword.length() &lt; <span class="number">8</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//账户不能包含特殊字符</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">validateRegExp</span> <span class="operator">=</span> <span class="string">&quot;[A-Za-z0-9_\\-\\u4e00-\\u9fa5]+&quot;</span>;</span><br><span class="line">        <span class="type">Matcher</span> <span class="variable">matcher</span> <span class="operator">=</span> Pattern.compile(validateRegExp).matcher(userAccount);</span><br><span class="line">        <span class="keyword">if</span> (!matcher.find()) &#123;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//校验密码是否相同</span></span><br><span class="line">        <span class="keyword">if</span> (!userPassword.equals(checkPassword)) &#123;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//账户不能重复</span></span><br><span class="line">        QueryWrapper&lt;User&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">        queryWrapper.eq(<span class="string">&quot;userAccount&quot;</span>, userAccount);</span><br><span class="line">        <span class="type">Long</span> <span class="variable">count</span> <span class="operator">=</span> userMapper.selectCount(queryWrapper);</span><br><span class="line">        <span class="keyword">if</span> (count &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/* 2.加密 —— 先做一个测试【如下图所示】 */</span></span><br><span class="line">        <span class="keyword">final</span> <span class="type">String</span> <span class="variable">SALT</span> <span class="operator">=</span> <span class="string">&quot;yupi&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">encryptPassword</span> <span class="operator">=</span> DigestUtils.md5DigestAsHex((SALT + userPassword).getBytes());</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* 3.插入数据 */</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        user.setUserAccount(userAccount);</span><br><span class="line">        user.setUserPassword(encryptPassword);</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">saveResult</span> <span class="operator">=</span> <span class="built_in">this</span>.save(user);</span><br><span class="line">        <span class="keyword">if</span> (!saveResult) &#123;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> user.getId();</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> User <span class="title function_">doLogin</span><span class="params">(String userAccount, String userPassword)</span> &#123;</span><br><span class="line">   <span class="comment">/* 1. 校验 */</span></span><br><span class="line">   <span class="keyword">if</span> (StringUtils.isAnyBlank(userAccount,userPassword)) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">if</span>(userAccount.length() &lt; <span class="number">4</span>)&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">if</span>(userPassword.length() &lt; <span class="number">8</span>)&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="comment">//账户不能包含特殊字符</span></span><br><span class="line">   <span class="type">String</span> <span class="variable">validPattern</span> <span class="operator">=</span> <span class="string">&quot;[`~!@#$%^&amp;*()+=|&#123;&#125;&#x27;:;&#x27;,\\[\\].&lt;&gt;/?~！@#￥%……&amp;*（）——+|&#123;&#125;【】‘；：”“’。，、？]&quot;</span>;</span><br><span class="line">   <span class="type">Matcher</span> <span class="variable">matcher</span> <span class="operator">=</span> Pattern.compile(validPattern).matcher(userAccount);</span><br><span class="line">   <span class="keyword">if</span> (matcher.find()) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="comment">/* 2.加密 */</span></span><br><span class="line">   <span class="type">String</span> <span class="variable">encryptPassword</span> <span class="operator">=</span> DigestUtils.md5DigestAsHex((SALT + userPassword).getBytes());</span><br><span class="line">   <span class="comment">//查询用户是否存在</span></span><br><span class="line">   QueryWrapper&lt;User&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">   queryWrapper.eq(<span class="string">&quot;userAccount&quot;</span>,userAccount);</span><br><span class="line">   queryWrapper.eq(<span class="string">&quot;userPassword&quot;</span>,encryptPassword);</span><br><span class="line">   <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userMapper.selectOne(queryWrapper);</span><br><span class="line">   <span class="keyword">if</span> (user == <span class="literal">null</span>) &#123;</span><br><span class="line">      log.info(<span class="string">&quot;user login failed,userAccount cannot match userPassword&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> user;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面查询用户是否存在的代码逻辑是存在问题的<br>如果用户的 isDelete 字段是删除状态，能否查出来呢？<br>【<a target="_blank" rel="noopener" href="https://baomidou.com/guides/logic-delete/#%E6%AD%A5%E9%AA%A4-1-%E9%85%8D%E7%BD%AE%E5%85%A8%E5%B1%80%E9%80%BB%E8%BE%91%E5%88%A0%E9%99%A4%E5%B1%9E%E6%80%A7">MyBatis-Plus 逻辑删除</a>    <a target="_blank" rel="noopener" href="https://baomidou.com/reference/annotation/#tablelogic">@TableLogic注解</a>】</p>
<p>@TableLogic<br>用于标记实体类中的逻辑删除字段。<br>逻辑删除是一种数据管理策略，它不是真正地从数据库中删除记录，而是在记录中标记该记录为已删除状态。<br>通过使用@TableLogic注解，MyBatis-Plus 可以在查询、更新和删除操作中自动处理逻辑删除字段的值。</p>
<p>当执行查询操作时，MyBatis-Plus 会自动过滤掉标记为逻辑删除的记录，只返回未删除的记录。<br>在执行更新操作时，如果更新操作会导致逻辑删除字段的值变为逻辑删除值，MyBatis-Plus 会自动将该记录标记为已删除。<br>在执行删除操作时，MyBatis-Plus 会自动将逻辑删除字段的值更新为逻辑删除值，而不是物理删除记录。<br>使用@TableLogic注解可以实现数据的逻辑删除，有助于维护数据的完整性和可追溯性，同时避免了物理删除操作可能带来的数据丢失风险。<br>开发者无需手动编写逻辑删除的代码，MyBatis-Plus 会自动处理这一过程。</p>
<blockquote>
<p>要删除一条数据时，不是真正的删除，而是将数据库中的某个字段从 0 置为 1 表示数据失效，无法查询到</p>
</blockquote>
<ol start="3">
<li>在 application.yml 中配置 MyBatis-Plus 的全局逻辑删除属性：</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line"><span class="attr">global-config:</span></span><br><span class="line"><span class="attr">db-config:</span></span><br><span class="line"><span class="attr">logic-delete-field:</span> <span class="string">isDelete</span> <span class="comment"># 全局逻辑删除字段名</span></span><br><span class="line"><span class="attr">logic-delete-value:</span> <span class="number">1</span> <span class="comment"># 逻辑已删除值</span></span><br><span class="line"><span class="attr">logic-not-delete-value:</span> <span class="number">0</span> <span class="comment"># 逻辑未删除值</span></span><br></pre></td></tr></table></figure>

<ol start="4">
<li>User 实体类中 为 isDelete 字段添加 @TableLogic 注解<blockquote>
<p>该注解用于标记实体类中的字段作为逻辑删除字段。<br>逻辑删除是一种数据管理策略，它不是真正地从数据库中删除记录，而是在记录中标记该记录为已删除状态。<br>通过使用@TableLogic注解，MyBatis-Plus 可以在查询、更新和删除操作中自动处理逻辑删除字段的值。</p>
</blockquote>
</li>
</ol>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/40385325/1728480110157-6a7f50ed-5c7b-4d8a-9518-75587a6cc68a.png"></p>
<h2 id="后端-登录态管理（Cookie-和-Session）"><a href="#后端-登录态管理（Cookie-和-Session）" class="headerlink" title="后端-登录态管理（Cookie 和 Session）"></a>后端-登录态管理（Cookie 和 Session）</h2><p>如何知道是哪个用户登陆了？（JavaWeb）  </p>
<ol>
<li>连接服务器端后，得到一个 session 状态（匿名会话），返回给前端</li>
<li>登陆成功得到登陆成功的 session 并设置一些值（比如用户信息），返回给前端一个设置 cookie 的“命令”  session ⇒ cookie  </li>
<li>前端接收到后端的命令后，设置 cookie ，保存到浏览器内  </li>
<li>前端再次请求后端的时候（相同的域名），在请求头中带上 cookie去请求  </li>
<li>后端拿到前端传来的 cookie ，找到对应的 session  </li>
<li>后端从 session 中可以取出基于该 session 存储的变量（用户的登陆信息、登录名）<br> 【<a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/2002609">Cookie &amp; Session 相关知识了解</a>】</li>
</ol>
<table>
<thead>
<tr>
<th></th>
<th>Cookie</th>
<th>Session</th>
</tr>
</thead>
<tbody><tr>
<td>定义</td>
<td>Cookie 是一种存储在用户本地计算机上的小数据片段。它由服务器发送，浏览器保存，并在后续请求中自动发送回服务器。Cookie 主要用于识别用户身份、存储用户偏好等</td>
<td>Session 是一种服务器端的技术，用于存储用户会话信息。服务器会为每个用户创建一个唯一的 Session ID，并通过 Cookie（或其他方式，如 URL 重写）将 Session ID 发送给客户端。客户端在后续请求中会携带这个 Session ID，服务器通过解析 Session ID 来获取对应的 Session 信息</td>
</tr>
<tr>
<td>特点</td>
<td>•存储在客户端   •容量有限（大多数浏览器限制每个 Cookie 的大小不超过 4KB，且每个站点最多可以创建 20 个 Cookie）   •安全性较低，因为 Cookie 存储在用户的计算机上，可以被用户看到并修改（尽管可以通过设置 HttpOnly 和 Secure 属性来提高安全性）   •发送 Cookie 会增加每次 HTTP 请求的数据量，可能影响页面加载速度</td>
<td>•存储在服务器端   •安全性较高，因为敏感信息不会直接存储在客户端。   •容量相对较大，因为受限于服务器的资源而非客户端的浏览器限制。   •依赖于客户端的 Session ID 传递</td>
</tr>
<tr>
<td>用途</td>
<td>•用户身份识别。   •存储用户偏好设置。   •跟踪用户行为（例如，记录用户的访问次数）</td>
<td>•存储用户会话信息，如登录状态、购物车内容等。   •管理用户登录状态，实现身份验证和授权</td>
</tr>
<tr>
<td>联系</td>
<td>•Session 通常依赖于 Cookie 来传递 Session ID，以维持用户会话的连续性。   •两者都可用于跟踪用户状态，但存储位置和数据量等方面有所不同</td>
<td></td>
</tr>
<tr>
<td>区别</td>
<td>•存储位置：Cookie 存储在客户端，Session 存储在服务器端。   •安全性：Session 相比 Cookie 安全性更高，因为敏感数据不直接存储在客户端。   •容量：Cookie 的容量有限，Session 的容量相对较大。   •使用场景：Cookie 更适合存储非敏感信息，如用户偏好；Session 更适合存储敏感信息，如用户登录状态</td>
<td></td>
</tr>
</tbody></table>
<p>代码编写  </p>
<ol>
<li>UserService 与 UserServiceImpl 中添加 HttpServletRequest request<br><img src="https://cdn.nlark.com/yuque/0/2024/png/40385325/1731934690743-5735cb52-c37f-41c1-aeef-260596638b75.png"></li>
</ol>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/40385325/1731934726179-d8ad1d45-ee42-4d88-b7c1-6bb9c161fa3c.png"></p>
<ol start="2">
<li>继续在 Impl 中编写代码<br>◦记录用户的登录态<br><img src="https://cdn.nlark.com/yuque/0/2024/png/40385325/1731935802447-655b0c19-f9a6-4e1f-a2a0-88d49c6d0121.png"></li>
</ol>
<p>在前面定义用户登录态键<br><img src="https://cdn.nlark.com/yuque/0/2024/png/40385325/1731935893759-69f2657d-0a9d-478d-9378-24eb62650e56.png"></p>
<p>编写记录用户登录态代码，将 user 修改为 safetyUser<br>◦用户脱敏<br><img src="https://cdn.nlark.com/yuque/0/2024/png/40385325/1731935936758-388a0353-8897-4213-98fc-ad7b785baa23.png"></p>
<p>编写生成用户脱敏代码<br><img src="https://cdn.nlark.com/yuque/0/2024/png/40385325/1731935982811-acbfc8fe-0789-4ddb-bde8-a204e7b7a005.png"><br>修改生成的代码  </p>
<ol start="3">
<li>完整代码</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> User <span class="title function_">doLogin</span><span class="params">(String userAccount, String userPassword, HttpServletRequest request)</span> &#123;​</span><br><span class="line">   <span class="comment">/* 1. 校验 */</span></span><br><span class="line">   <span class="keyword">if</span> (StringUtils.isAnyBlank(userAccount,userPassword)) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">if</span>(userAccount.length() &lt; <span class="number">4</span>)&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">if</span>(userPassword.length() &lt; <span class="number">8</span>)&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="comment">//账户不能包含特殊字符</span></span><br><span class="line">   <span class="type">String</span> <span class="variable">validPattern</span> <span class="operator">=</span> <span class="string">&quot;[`~!@#$%^&amp;()+=|&#123;&#125;&#x27;:;&#x27;,\\[\\].&lt;&gt;/?~！@#￥%……&amp;（）——+|&#123;&#125;【】‘；：”“’。，、？]&quot;</span>;​</span><br><span class="line">   <span class="type">Matcher</span> <span class="variable">matcher</span> <span class="operator">=</span> Pattern.compile(validPattern).matcher(userAccount);​</span><br><span class="line">   <span class="keyword">if</span> (matcher.find()) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="comment">/* 2.加密 */</span></span><br><span class="line">   <span class="type">String</span> <span class="variable">encryptPassword</span> <span class="operator">=</span> DigestUtils.md5DigestAsHex((SALT + userPassword).getBytes());</span><br><span class="line">   <span class="comment">//查询用户是否存在</span></span><br><span class="line">   <span class="type">QueryWrapper</span> <span class="variable">queryWrapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">   queryWrapper.eq(<span class="string">&quot;userAccount&quot;</span>,userAccount);</span><br><span class="line">   queryWrapper.eq(<span class="string">&quot;userPassword&quot;</span>,encryptPassword);    </span><br><span class="line">   <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userMapper.selectOne(queryWrapper);    <span class="comment">//用户不存在    </span></span><br><span class="line">   <span class="keyword">if</span> (user == <span class="literal">null</span>) &#123;       </span><br><span class="line">        log.info(<span class="string">&quot;user login failed,userAccount cannot match userPassword&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/* 3.用户脱敏 */</span></span><br><span class="line">   <span class="type">User</span> <span class="variable">safetyUser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">   safetyUser.setId(user.getId());</span><br><span class="line">   safetyUser.setUsername(user.getUsername());</span><br><span class="line">   safetyUser.setUserAccount(user.getUserAccount());</span><br><span class="line">   safetyUser.setAvatarUrl(user.getAvatarUrl());</span><br><span class="line">   safetyUser.setGender(user.getGender());</span><br><span class="line">   safetyUser.setPhone(user.getPhone());</span><br><span class="line">   safetyUser.setEmail(user.getEmail());</span><br><span class="line">   safetyUser.setUserStatus(user.getUserStatus());</span><br><span class="line">   safetyUser.setCreateTime(user.getCreateTime());</span><br><span class="line">   </span><br><span class="line">   <span class="comment">/*4.记录用户的登录态 */</span></span><br><span class="line">       request.getSession().setAttribute(USER_LOGIN_STATE,safetyUser);</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">return</span> safetyUser;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> fun.weiguang.usercenter.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.conditions.query.QueryWrapper;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;</span><br><span class="line"><span class="keyword">import</span> fun.weiguang.usercenter.model.domain.User;</span><br><span class="line"><span class="keyword">import</span> fun.weiguang.usercenter.mapper.UserMapper;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.DigestUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> java.util.regex.Matcher;</span><br><span class="line"><span class="keyword">import</span> java.util.regex.Pattern;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* <span class="doctag">@author</span> wgzc</span></span><br><span class="line"><span class="comment">* <span class="doctag">@description</span> 针对表【user(用户表)】的数据库操作Service实现</span></span><br><span class="line"><span class="comment">* <span class="doctag">@createDate</span> 2024-10-02 19:47:46</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;UserMapper, User&gt;</span><br><span class="line">        <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 盐值，混淆密码</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">SALT</span> <span class="operator">=</span> <span class="string">&quot;yupi&quot;</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    *  用户登录态键</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">USER_LOGIN_STATE</span> <span class="operator">=</span> <span class="string">&quot;userloginstate&quot;</span>;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">userRegister</span><span class="params">(String userAccount, String userPassword, String checkPassword)</span> &#123;</span><br><span class="line">        <span class="comment">/* 1. 校验 */</span></span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isAnyBlank(userAccount, userPassword, checkPassword)) &#123;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (userAccount.length() &lt; <span class="number">4</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (userPassword.length() &lt; <span class="number">8</span> || checkPassword.length() &lt; <span class="number">8</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//账户不能包含特殊字符</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">validateRegExp</span> <span class="operator">=</span> <span class="string">&quot;[A-Za-z0-9_\\-\\u4e00-\\u9fa5]+&quot;</span>;</span><br><span class="line">        <span class="type">Matcher</span> <span class="variable">matcher</span> <span class="operator">=</span> Pattern.compile(validateRegExp).matcher(userAccount);</span><br><span class="line">        <span class="keyword">if</span> (!matcher.find()) &#123;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//校验密码是否相同</span></span><br><span class="line">        <span class="keyword">if</span> (!userPassword.equals(checkPassword)) &#123;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//账户不能重复</span></span><br><span class="line">        QueryWrapper&lt;User&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">        queryWrapper.eq(<span class="string">&quot;userAccount&quot;</span>, userAccount);</span><br><span class="line">        <span class="type">Long</span> <span class="variable">count</span> <span class="operator">=</span> userMapper.selectCount(queryWrapper);</span><br><span class="line">        <span class="keyword">if</span> (count &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/* 2.加密 —— 先做一个测试【如下图所示】 */</span></span><br><span class="line">        <span class="keyword">final</span> <span class="type">String</span> <span class="variable">SALT</span> <span class="operator">=</span> <span class="string">&quot;yupi&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">encryptPassword</span> <span class="operator">=</span> DigestUtils.md5DigestAsHex((SALT + userPassword).getBytes());</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* 3.插入数据 */</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        user.setUserAccount(userAccount);</span><br><span class="line">        user.setUserPassword(encryptPassword);</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">saveResult</span> <span class="operator">=</span> <span class="built_in">this</span>.save(user);</span><br><span class="line">        <span class="keyword">if</span> (!saveResult) &#123;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> user.getId();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">doLogin</span><span class="params">(String userAccount, String userPassword, HttpServletRequest request)</span> &#123;</span><br><span class="line">        <span class="comment">/* 1. 校验 */</span></span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isAnyBlank(userAccount,userPassword)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(userAccount.length() &lt; <span class="number">4</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(userPassword.length() &lt; <span class="number">8</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//账户不能包含特殊字符</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">validPattern</span> <span class="operator">=</span> <span class="string">&quot;[`~!@#$%^&amp;()+=|&#123;&#125;&#x27;:;&#x27;,\\[\\].&lt;&gt;/?~！@#￥%……&amp;（）——+|&#123;&#125;【】‘；：”“’。，、？]&quot;</span>;</span><br><span class="line">        <span class="type">Matcher</span> <span class="variable">matcher</span> <span class="operator">=</span> Pattern.compile(validPattern).matcher(userAccount);</span><br><span class="line">        <span class="keyword">if</span> (matcher.find()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* 2.加密 */</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">encryptPassword</span> <span class="operator">=</span> DigestUtils.md5DigestAsHex((SALT + userPassword).getBytes());</span><br><span class="line">        <span class="comment">//查询用户是否存在</span></span><br><span class="line">        <span class="type">QueryWrapper</span> <span class="variable">queryWrapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">        queryWrapper.eq(<span class="string">&quot;userAccount&quot;</span>,userAccount);</span><br><span class="line">        queryWrapper.eq(<span class="string">&quot;userPassword&quot;</span>,encryptPassword);</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userMapper.selectOne(queryWrapper);    <span class="comment">//用户不存在</span></span><br><span class="line">        <span class="keyword">if</span> (user == <span class="literal">null</span>) &#123;</span><br><span class="line">            log.info(<span class="string">&quot;user login failed,userAccount cannot match userPassword&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* 3.用户脱敏 */</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">safetyUser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        safetyUser.setId(user.getId());</span><br><span class="line">        safetyUser.setUsername(user.getUsername());</span><br><span class="line">        safetyUser.setUserAccount(user.getUserAccount());</span><br><span class="line">        safetyUser.setAvatarUrl(user.getAvatarUrl());</span><br><span class="line">        safetyUser.setGender(user.getGender());</span><br><span class="line">        safetyUser.setPhone(user.getPhone());</span><br><span class="line">        safetyUser.setEmail(user.getEmail());</span><br><span class="line">        safetyUser.setUserStatus(user.getUserStatus());</span><br><span class="line">        safetyUser.setCreateTime(user.getCreateTime());</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*4.记录用户的登录态 */</span></span><br><span class="line">        request.getSession().setAttribute(USER_LOGIN_STATE,safetyUser);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> safetyUser;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h2 id="后端-接口开发及测试"><a href="#后端-接口开发及测试" class="headerlink" title="后端-接口开发及测试"></a>后端-接口开发及测试</h2><p>控制层Controller封装请求<br>application.yml 指定接口全局 api 【也可以可以等 代理 这块去做】</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">servlet:</span><br><span class="line">    context-path: /api</span><br></pre></td></tr></table></figure>

<p>@RestController适用于编写restful风格的api，返回值默认为json类型<br>controller 层倾向于对请求参数本身的校验，不涉及业务逻辑本身（越少越好）<br>service 层是对业务逻辑的校验（有可能被 controller 之外的类调用）</p>
<ol>
<li>Controller 包下新建 UserController.java ，<br>◦添加 @RestController 注解（这个类中所有的请求的接口返回值，相应的数据类型都是 application json<br>◦添加 @RequestMapping 注解（定义请求的路径）</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>下载插件 Auto filling Java call arguments 【自动填充 java 参数】（安装完成记得重启）  </li>
<li>UserController 中编写 register请求<br>◦编写注册请求</li>
</ol>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/40385325/1732108821967-96445b6d-eee0-4029-962a-0e9cfa507bf7.png"><br>◦封装专门用来接收请求参数的对象 model.domain 包建立一个 request 包，新建 UserRegisterRequest.java 类</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/40385325/1732108783161-b13a655b-0b7d-4fb9-9de1-1d2147ceac71.png"></p>
<p>继承 Serializable （序列化），打上注解</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/40385325/1732108800481-26cbaa6f-6bda-48d1-bcb9-635c296d0f98.png"></p>
<p>实现序列化，添加参数，打上 @lombok 注解(生成get、set方法）<br>◦回到 UserController </p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/40385325/1732108745805-1fad654e-9de8-4149-9c85-bf837d5380e7.png"></p>
<p>引用 UserRegisterRequest ；打上 @RequestBody 注解（使UserRegisterRequest与前端传来的参数能够对应）；判断是否为空  </p>
<p>◦完善代码逻辑</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/register&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Long <span class="title function_">userRegister</span><span class="params">(<span class="meta">@RequestBody</span> UserRegisterRequest userRegisterRequest)</span>&#123;</span><br><span class="line">   <span class="keyword">if</span> (userRegisterRequest == <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="type">String</span> <span class="variable">userAccount</span> <span class="operator">=</span> userRegisterRequest.getUserAccount();</span><br><span class="line">   <span class="type">String</span> <span class="variable">userPassword</span> <span class="operator">=</span> userRegisterRequest.getUserPassword();</span><br><span class="line">   <span class="type">String</span> <span class="variable">checkPassword</span> <span class="operator">=</span> userRegisterRequest.getCheckPassword();</span><br><span class="line">   <span class="keyword">if</span>(StringUtils.isAnyBlank(userAccount, userPassword, checkPassword))&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> userService.userRegister(userAccount, userPassword, checkPassword);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>UserController 中编写 login 请求<br>◦复制 register 请求，进行修改即可【重构 UserService 中的 doLogin 方法为 userLogin 方法】</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/login&quot;)</span></span><br><span class="line"><span class="keyword">public</span> User <span class="title function_">userLogin</span><span class="params">(<span class="meta">@RequestBody</span> UserLoginRequest userLoginRequest, HttpServletRequest request)</span>&#123;</span><br><span class="line">   <span class="keyword">if</span> (userLoginRequest == <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="type">String</span> <span class="variable">userAccount</span> <span class="operator">=</span> userLoginRequest.getUserAccount();</span><br><span class="line">   <span class="type">String</span> <span class="variable">userPassword</span> <span class="operator">=</span> userLoginRequest.getUserPassword();</span><br><span class="line">   <span class="keyword">if</span>(StringUtils.isAnyBlank(userAccount, userPassword))&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> userService.userLogin(userAccount, userPassword,request);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>◦model.domain 包下面的 request 包，新建 UserLoginRequest.java 类（复制粘贴 UserRegisterRequest.java 删除其中的 checkPassword 即可）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> **用户登录请求体</span></span><br><span class="line"><span class="comment"> **<span class="doctag">@Author</span> </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserLoginRequest</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> 你生成的序列号;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> String userAccount;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> String userPassword;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>测试<br>◦测试工具（两种方式打开）<br>◦删除 GET 请求，生成 POST 请求并修改<br>◦Debug 方式启动项目<br>◦打断点测试<br>◦测试完成<br>◦再测一下逻辑删除<br> ▪数据库中把 yupi 的 isDelete 字段改为 1<br> ▪启动 POST 请求，测试完成</li>
</ol>
<h1 id="5用户管理功能"><a href="#5用户管理功能" class="headerlink" title="5用户管理功能"></a>5用户管理功能</h1><p>！！！必须鉴权 ！！！<br>1.查询用户<br>	◦允许根据用户名查询<br>2.删除用户</p>
<h2 id="后端开发"><a href="#后端开发" class="headerlink" title="后端开发"></a>后端开发</h2><p>1.UserController 里编写 查询用户请求</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/search&quot;)</span></span><br><span class="line"><span class="keyword">public</span> List&lt;User&gt; <span class="title function_">searchUsers</span><span class="params">(String username)</span> &#123;</span><br><span class="line">   QueryWrapper&lt;User&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">   <span class="keyword">if</span> (StringUtils.isNotBlank(username)) &#123;</span><br><span class="line">      queryWrapper.like(<span class="string">&quot;username&quot;</span>, username);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> userService.list(queryWrapper);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>UserController 里编写 删除用户请求</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/delete&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">deleteUser</span><span class="params">(<span class="meta">@RequestBody</span> <span class="type">long</span> id)</span> &#123;</span><br><span class="line">   <span class="keyword">if</span> (id &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> userService.removeById(id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>问题：此时代码的接口是开放的，没有校验是否是管理员，任何人均可调用，不安全<br>◦解决：增加一个用户角色的字段，进行身份校验<br> ▪增加用户角色字段</li>
</ol>
<p>role 改为 userRole  </p>
<p>role 为 userRole</p>
<p>使用 MyBatisX 插件重新生成代码，替换原来的 User.java 文件【替换后记得对 isDelete 字段添加 @TableLogic 注解】；mapper.xml 文件中记得引用 mapper 修改文件路径；<br>修改 UserServiceImpl 文件中用户脱敏的代码  </p>
<p>修改 UserController 中的 getRole 为 getUserRole【下面完整代码是修改过的】  </p>
<p>▪将 UserServiceImpl 中的用户登录态键 提到 UserService 里  </p>
<ol start="4">
<li><p>回到 UserController 编写鉴权逻辑  </p>
</li>
<li><p>此时需要将 1 定义为一个常量，所以新建一个常量（新建包 constant ，constant 下建立 UserConstant 接口），将 用户登陆态键 修改到这里</p>
</li>
</ol>
<p>点击左边图片中的报错提示，修改两处错误  </p>
<ol start="6">
<li>回到 UserController 修改鉴权逻辑的代码，继续优化</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/search&quot;)</span></span><br><span class="line"><span class="keyword">public</span> List&lt;User&gt; <span class="title function_">searchUsers</span><span class="params">(String username,HttpServletRequest request)</span> &#123;</span><br><span class="line">   <span class="keyword">if</span> (!isAdmin(request))&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   QueryWrapper&lt;User&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">   <span class="keyword">if</span> (StringUtils.isNotBlank(username)) &#123;</span><br><span class="line">      queryWrapper.like(<span class="string">&quot;username&quot;</span>, username);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> userService.list(queryWrapper);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@PostMapping(&quot;/delete&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">deleteUser</span><span class="params">(<span class="meta">@RequestBody</span> <span class="type">long</span> id,HttpServletRequest request)</span> &#123;</span><br><span class="line">   <span class="keyword">if</span> (!isAdmin(request))&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">if</span> (id &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> userService.removeById(id);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 是否为管理员</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">isAdmin</span><span class="params">(HttpServletRequest request)</span>&#123;</span><br><span class="line">   <span class="comment">//仅管理员可查询</span></span><br><span class="line">   <span class="type">Object</span> <span class="variable">userObj</span> <span class="operator">=</span> request.getSession().getAttribute(USER_LOGIN_STATE);</span><br><span class="line">   <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> (User) userObj;</span><br><span class="line">   <span class="keyword">return</span> user != <span class="literal">null</span> &amp;&amp; user.getUserRole() == ADMIN_ROLE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<ol start="7">
<li><p>修改 yml 配置文件，设置 session 失效时间  </p>
</li>
<li><p>删除 target 文件，找到之前请求的历史，执行重置登录态，点击 F9 结束（或者取消断点）  </p>
</li>
<li><p>点击下面图标，执行 GET 请求  </p>
</li>
<li><p>执行成功，可以看到返回了数据库的数据，但返回的数据有点多  </p>
</li>
<li><p>修改代码进行过滤<br>① UserServiceImpl 新建 getSafetyUser 方法，将之前编写的 用户脱敏的代码剪切过去<br>② 将 user 重构为 originUser<br>③ 原来 用户脱敏 的位置调用 getSafetyUser 方法<br>④ 添加注解 @Override 将方法引入 UserService 接口，加上注释  </p>
</li>
<li><p>UserController 调用 getSafetyUser 方法修改返回数据信息</p>
</li>
</ol>
<p>简化代码【两种方法：点击黄色灯泡；return 处Alt+Enter】  </p>
<p>◦优化后的代码查询代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/search&quot;)</span></span><br><span class="line"><span class="keyword">public</span> List&lt;User&gt; <span class="title function_">searchUsers</span><span class="params">(String username,HttpServletRequest request)</span> &#123;</span><br><span class="line">   <span class="keyword">if</span> (!isAdmin(request))&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   QueryWrapper&lt;User&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">   <span class="keyword">if</span> (StringUtils.isNotBlank(username)) &#123;</span><br><span class="line">      queryWrapper.like(<span class="string">&quot;username&quot;</span>, username);</span><br><span class="line">   &#125;</span><br><span class="line">   List&lt;User&gt; userList = userService.list(queryWrapper);</span><br><span class="line">   <span class="keyword">return</span> userList.stream().map(user -&gt; userService.getSafetyUser(user)).collect(Collectors.toList());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>⚠写代码流程<br>• 先做设计<br> • 代码实现<br> • 持续优化！！！（复用代码、提取公共逻辑&#x2F;常量）</p>
<h2 id="前端-页面开发及验证"><a href="#前端-页面开发及验证" class="headerlink" title="前端-页面开发及验证"></a>前端-页面开发及验证</h2><p>ctrl + shift + - ：全部折叠代码<br>Ctrl + Shift + R :  全局替换  </p>
<ol>
<li><p>start-dev 启动（不带模拟数据）之前初始化的项目  </p>
</li>
<li><p>修改底部信息<br>◦修改 src&#x2F;components&#x2F;Footer&#x2F;index.tsx 的链接（修改自己想链接到的地址即可）</p>
</li>
</ol>
<p>◦修改后代码及样式</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">const Footer: React.FC = () =&gt; &#123;</span><br><span class="line">  <span class="type">const</span> <span class="variable">defaultMessage</span> <span class="operator">=</span> <span class="string">&#x27;鱼皮出品&#x27;</span>;</span><br><span class="line">  <span class="type">const</span> <span class="variable">currentYear</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>().getFullYear();</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;DefaultFooter</span><br><span class="line">      copyright=&#123;`$&#123;currentYear&#125; $&#123;defaultMessage&#125;`&#125;</span><br><span class="line">      links=&#123;[</span><br><span class="line">        &#123;</span><br><span class="line">          key: <span class="string">&#x27;planet&#x27;</span>,</span><br><span class="line">          title: <span class="string">&#x27;知识星球&#x27;</span>,</span><br><span class="line">          href: <span class="string">&#x27;https://docs.qq.com/doc/DUG93dVNHbVZjZXpo&#x27;</span>,</span><br><span class="line">          blankTarget: <span class="literal">true</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          key: <span class="string">&#x27;codeNav&#x27;</span>,</span><br><span class="line">          title: <span class="string">&#x27;编程导航&#x27;</span>,</span><br><span class="line">          href: <span class="string">&#x27;https://www.code-nav.cn/&#x27;</span>,</span><br><span class="line">          blankTarget: <span class="literal">true</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          key: <span class="string">&#x27;github&#x27;</span>,</span><br><span class="line">          title: &lt;&gt;&lt;GithubOutlined /&gt; 鱼皮 GitHub &lt;/&gt;,</span><br><span class="line">          href: <span class="string">&#x27;https://github.com/liyupi&#x27;</span>,</span><br><span class="line">          blankTarget: <span class="literal">true</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      ]&#125;</span><br><span class="line">    /&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>修改 Logo<br>◦编写全局常量，新建 constants 文件夹，新建 index.ts 文件，编写一下内容</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">export <span class="type">const</span> <span class="variable">SYSTEM_LOGO</span> <span class="operator">=</span> <span class="string">&#x27;https://pic.code-nav.cn/user_avatar/1610518142000300034/YeedIoq3-logo.png&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 知识星球文档地址</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">export <span class="type">const</span> <span class="variable">PLANET_LINK</span> <span class="operator">=</span> <span class="string">&#x27;https://docs.qq.com/doc/DUG93dVNHbVZjZXpo&#x27;</span></span><br></pre></td></tr></table></figure>

<p>◦修改 src&#x2F;pages&#x2F;user&#x2F;Login&#x2F;index.tsx 文件中的 logo 引用； title ；subTitle  </p>
<p>◦在 src&#x2F;components&#x2F;Footer&#x2F;index.tsx 中引用 PLANET_LINK   </p>
<p>◦修改后样式如下</p>
<p>4.删代码精简页面（src&#x2F;pages&#x2F;user&#x2F;Login&#x2F;index.tsx 文件）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> (</span><br><span class="line">  &lt;div className=&#123;styles.container&#125;&gt;</span><br><span class="line">                  <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                message.success(<span class="string">&#x27;获取验证码成功！验证码为：1234&#x27;</span>);</span><br><span class="line">              &#125;&#125;</span><br><span class="line">            /&gt;</span><br><span class="line">          &lt;/&gt;</span><br><span class="line">        )&#125;</span><br><span class="line">        &lt;div</span><br><span class="line">          style=&#123;&#123;</span><br><span class="line">            marginBottom: <span class="number">24</span>,</span><br><span class="line">          &#125;&#125;</span><br><span class="line">        &gt;</span><br><span class="line">          &lt;ProFormCheckbox noStyle name=<span class="string">&quot;autoLogin&quot;</span>&gt;</span><br><span class="line">            自动登录</span><br><span class="line">          &lt;/ProFormCheckbox&gt;</span><br><span class="line">          &lt;a</span><br><span class="line">            style=&#123;&#123;</span><br><span class="line">              <span class="type">float</span>: <span class="string">&#x27;right&#x27;</span>,</span><br><span class="line">            &#125;&#125;</span><br><span class="line">            href=&#123;PLANET_LINK&#125;</span><br><span class="line">            target=<span class="string">&quot;_blank&quot;</span> rel=<span class="string">&quot;noreferrer&quot;</span></span><br><span class="line">          &gt;</span><br><span class="line">            忘记密码请联系鱼皮</span><br><span class="line">          &lt;/a&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/LoginForm&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;Footer /&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>◦将 用户名 全局替换为 账号【ctrl + r】<br>◦精简后页面</p>
<ol start="5">
<li>查看登录的提交方式，修改【ctrl + r 重构】</li>
</ol>
<p>进入这个参数</p>
<p>修改 username 与 password 与后端字段一致</p>
<p>修改 username</p>
<p>修改 password</p>
<p>进入 login 方法</p>
<p>进入 LoginResult 方法</p>
<h2 id="前后端联调"><a href="#前后端联调" class="headerlink" title="前后端联调"></a>前后端联调</h2><p>•前端需要向后端发送请求<br>•前端 ajax 请求后端<br>•axios 封装了 ajax<br>•request 是 ant design项目又封装了一次<br>	◦追踪 request 源码：用到了 umi 的插件、requestConfig是一个配置  </p>
<p>进入 login 方法  </p>
<p>进入 request 方法  </p>
<p>进入 getRequestMethod 方法  </p>
<p>进入 plugin   </p>
<p>看到插件是 umi   </p>
<ol>
<li><p>Ant Design Pro 搜索请求  </p>
</li>
<li><p>复制上面官网搜到的代码，粘贴到 app.tsx 文件中，修改一下  </p>
</li>
<li><p>修改 api.ts 文件中的登录接口访问的地址  </p>
</li>
<li><p>进行登录测试【没有启动项目的先启动项目，start-dev 方式启动】</p>
</li>
</ol>
<p>开发人员工具：点击浏览器右上方三个点，有的会直接显示，有的需要点击更多工具，查看快捷键  </p>
<p>账号密码随便输<br>◦此时遇到了跨域问题<br>▪前端端口：localhost:8000<br>▪后端端口：localhost:8080<br>▪此时前端访问后端，端口不一样，就是跨域<br>▪解决：搭建代理、后端支持跨域【这种方法不安全】</p>
<h2 id="代理知识"><a href="#代理知识" class="headerlink" title="代理知识"></a>代理知识</h2><p>正向代理：替客户端向服务器发送请求<br>反向代理：替服务器接收请求<br>怎么搞代理？<br>•Nginx 服务器<br>•Node.js 服务器  </p>
<p>代码修改  </p>
<ol>
<li>前端<br>◦app.tsx 文件中将超时时间调长（代码来源）<br>TypeScript</li>
</ol>
<p>◦proxy.ts 文件  </p>
<p>TypeScript  </p>
<p>◦api.ts 文件中添加 &#x2F;api  </p>
<ol start="2">
<li>后端 （前面指定过不需要再次指定）<br>application.yml 文件中指定全局 api</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">server:</span><br><span class="line">  port: <span class="number">8080</span></span><br><span class="line">  servlet:</span><br><span class="line">    context-path: /api</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>测试，UserController 中这个位置打一个断点，前端再次进行登录测试</li>
</ol>
<p>打断点  </p>
<p>前端登录测试，访问地址正确  </p>
<p>后端接收到请求  </p>
<p>原本请求：<a target="_blank" rel="noopener" href="http://localhost:8000/api/user/login%E2%80%8B">http://localhost:8000/api/user/login</a><br>代理到请求：<a target="_blank" rel="noopener" href="http://localhost:8080/api/user/login">http://localhost:8080/api/user/login</a></p>
<h1 id="6前端登录注册功能"><a href="#6前端登录注册功能" class="headerlink" title="6前端登录注册功能"></a>6前端登录注册功能</h1><h3 id="前端-请求库的使用"><a href="#前端-请求库的使用" class="headerlink" title="前端-请求库的使用"></a>前端-请求库的使用</h3><p>代码修改</p>
<p>•登陆界面的 index.tsx 中 </p>
<p>◦username &#x3D;&gt; userAccount 、password &#x3D;&gt; userPassword ，与后端保持一致【ctrl + r】</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;ProFormText</span><br><span class="line">  name=<span class="string">&quot;userAccount&quot;</span></span><br><span class="line">    ……</span><br><span class="line">/&gt;</span><br><span class="line">&lt;ProFormText.Password</span><br><span class="line">  name=<span class="string">&quot;userPassword&quot;</span></span><br><span class="line">    ……</span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure>

<p>◦对密码增加校验 【Ant Design】</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>说明</th>
<th>类型</th>
</tr>
</thead>
<tbody><tr>
<td>min</td>
<td>必须设置 type：string 类型为字符串最小长度；number 类型时为最小值；array 类型时为数组最小长度</td>
<td>number</td>
</tr>
</tbody></table>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;ProFormText.Password</span><br><span class="line">  ……</span><br><span class="line">  rules=&#123;[</span><br><span class="line">    &#123;</span><br><span class="line">      required: <span class="literal">true</span>,</span><br><span class="line">      message: <span class="string">&#x27;密码是必填项！&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      min: <span class="number">8</span>,</span><br><span class="line">      type: <span class="string">&quot;string&quot;</span>,</span><br><span class="line">      message: <span class="string">&#x27;密码长度不能小于8位！&#x27;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">  ]&#125;</span><br><span class="line">/&gt;</span><br></pre></td></tr></table></figure>



<p>◦修改登录判断逻辑</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="variable">handleSubmit</span> <span class="operator">=</span> async (values: API.LoginParams) =&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// 登录</span></span><br><span class="line">    <span class="type">const</span> <span class="variable">user</span> <span class="operator">=</span> await <span class="title function_">login</span><span class="params">(&#123;</span></span><br><span class="line"><span class="params">      ...values,</span></span><br><span class="line"><span class="params">      type,</span></span><br><span class="line"><span class="params">    &#125;)</span>;</span><br><span class="line">    <span class="keyword">if</span> (user) &#123;</span><br><span class="line">      ……</span><br><span class="line">    &#125;</span><br><span class="line">    console.log(msg);</span><br><span class="line">    <span class="comment">// 如果失败去设置用户错误信息</span></span><br><span class="line">    setUserLoginState(user);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    <span class="type">const</span> <span class="variable">defaultLoginFailureMessage</span> <span class="operator">=</span> <span class="string">&#x27;登录失败，请重试！&#x27;</span>;</span><br><span class="line">    message.error(defaultLoginFailureMessage);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>◦使用已有账号进行登陆测试，可以看到登陆成功，响应有信息</p>
<h3 id="注册功能"><a href="#注册功能" class="headerlink" title="注册功能"></a>注册功能</h3><h3 id="前端-快速页面开发"><a href="#前端-快速页面开发" class="headerlink" title="前端-快速页面开发"></a>前端-快速页面开发</h3><p>MFSU：前端编译优化<br>代码修改<br>1.删除 Login&#x2F;index&#x2F;tsx 中无用的引用代码【ctrl + alt + o】（平时自己做项目的细节点）  </p>
<p>2.复制 Login 粘贴为 Register  </p>
<p>3.将下面两个位置的 Login &#x3D;&gt; Register </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">const Register: React.FC = () =&gt; &#123;</span><br><span class="line">  ……</span><br><span class="line">&#125;;</span><br><span class="line">export <span class="keyword">default</span> Register;</span><br></pre></td></tr></table></figure>



<p>4.config&#x2F;routes.ts 文件中增加 register 的路由（即地址栏中输入什么会跳转到注册页面</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">routes: [</span><br><span class="line">  &#123; name: <span class="string">&#x27;登录&#x27;</span>, path: <span class="string">&#x27;/user/login&#x27;</span>, component: <span class="string">&#x27;./user/Login&#x27;</span> &#125;,</span><br><span class="line">  &#123; name: <span class="string">&#x27;注册&#x27;</span>, path: <span class="string">&#x27;/user/register&#x27;</span>, component: <span class="string">&#x27;./user/Register&#x27;</span> &#125;,</span><br><span class="line">  &#123; component: <span class="string">&#x27;./404&#x27;</span> &#125;,</span><br><span class="line">],</span><br></pre></td></tr></table></figure>



<blockquote>
<p>此时访问 user&#x2F;register 页面会自动重定向到 user&#x2F;login 页面，无法进入 register 页面，原因：app.tsx 是项目的全局文件，里面有两个判断逻辑【Ant Design Pro 是一个后台管理系统，对每个页面进行校验，不登录不允许进入任何页面是合适的】</p>
<p>const fetchUserInfo &#x3D; async () &#x3D;&gt; {<br>  try {<br>    const msg &#x3D; await queryCurrentUser();<br>    return msg.data;<br>  } catch (error) {<br>    history.push(loginPath);<br>  }<br>  return undefined;<br>};</p>
<p>&#x2F;&#x2F; 如果没有登录，重定向到 login<br>if (!initialState?.currentUser &amp;&amp; location.pathname !&#x3D;&#x3D; loginPath) {<br>  history.push(loginPath);<br>}</p>
</blockquote>
<p>5.修改 app.tsx 中的代码逻辑  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="variable">fetchUserInfo</span> <span class="operator">=</span> async () =&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="type">const</span> <span class="variable">msg</span> <span class="operator">=</span> await <span class="title function_">queryCurrentUser</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">return</span> msg.data;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    <span class="comment">// history.push(loginPath);</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> undefined;</span><br><span class="line">&#125;;</span><br><span class="line">……</span><br><span class="line"><span class="type">const</span> <span class="variable">whiteList</span> <span class="operator">=</span> [<span class="string">&#x27;/user/register&#x27;</span>, loginPath];</span><br><span class="line"><span class="keyword">if</span>(whiteList.includes(location.pathname)) &#123;</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 如果没有登录，重定向到 login</span></span><br><span class="line"><span class="keyword">if</span> (!initialState?.currentUser) &#123;</span><br><span class="line">  history.push(loginPath);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以访问 reigster 页面  </p>
<p>6.修改前端样式（增加确认密码框、删除与 login 有关与 register 无关的一些逻辑）<br>Ctrl + R 替换</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">const Register: React.FC = () =&gt; &#123;</span><br><span class="line">  const [userLoginState, setUserLoginState] = useState&lt;API.LoginResult&gt;(&#123;&#125;);</span><br><span class="line">                  &#125;,</span><br><span class="line">                  &#123;</span><br><span class="line">                    min: <span class="number">8</span>,</span><br><span class="line">                    type: <span class="string">&#x27;string&#x27;</span>,</span><br><span class="line">                    message: <span class="string">&#x27;密码长度不能小于8位！&#x27;</span>,</span><br><span class="line">                  &#125;</span><br><span class="line">                ]&#125;</span><br><span class="line">              /&gt;</span><br><span class="line">            &lt;/&gt;</span><br><span class="line">          )&#125;</span><br><span class="line"></span><br><span class="line">          &#123;status === <span class="string">&#x27;error&#x27;</span> &amp;&amp; loginType === <span class="string">&#x27;mobile&#x27;</span> &amp;&amp; &lt;LoginMessage content=<span class="string">&quot;验证码错误&quot;</span> /&gt;&#125;</span><br><span class="line">          &lt;div</span><br><span class="line">            style=&#123;&#123;</span><br><span class="line">              marginBottom: <span class="number">24</span>,</span><br><span class="line">            &#125;&#125;</span><br><span class="line">          &gt;</span><br><span class="line">            &lt;ProFormCheckbox noStyle name=<span class="string">&quot;autoLogin&quot;</span>&gt;</span><br><span class="line">              自动登录</span><br><span class="line">            &lt;/ProFormCheckbox&gt;</span><br><span class="line">            &lt;a</span><br><span class="line">              style=&#123;&#123;</span><br><span class="line">                <span class="type">float</span>: <span class="string">&#x27;right&#x27;</span>,</span><br><span class="line">              &#125;&#125;</span><br><span class="line">              href=&#123;PLANET_LINK&#125;</span><br><span class="line">              target=<span class="string">&quot;_blank&quot;</span></span><br><span class="line">              rel=<span class="string">&quot;noreferrer&quot;</span></span><br><span class="line">            &gt;</span><br><span class="line">              忘记密码请联系鱼皮</span><br><span class="line">            &lt;/a&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">        &lt;/LoginForm&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;Footer /&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line">export <span class="keyword">default</span> Register;</span><br></pre></td></tr></table></figure>

<p>7.修改后样式  </p>
<blockquote>
<p>但此时登录按钮没有变成注册，这是因为 loginForm 组件的原因</p>
</blockquote>
<h2 id="前端-表单组件使用"><a href="#前端-表单组件使用" class="headerlink" title="前端-表单组件使用"></a>前端-表单组件使用</h2><p>Tips: 快速定位文件位置<br>•<a target="_blank" rel="noopener" href="https://ant.design/components/overview-cn">Ant Design</a> (组件库) &#x3D;&gt; <a target="_blank" rel="noopener" href="https://react.dev/">React</a><br>•<a target="_blank" rel="noopener" href="https://procomponents.ant.design/">Ant Design ProComponents</a> &#x3D;&gt; Ant Design<br>•<a target="_blank" rel="noopener" href="https://pro.ant.design/zh-CN/">Ant Design Pro</a> (后台管理系统) &#x3D;&gt; Ant Design、React、Ant Design ProComponents、其他的库</p>
<p>LoginForm【<a target="_blank" rel="noopener" href="https://procomponents.ant.design/components/login-form">组件详情</a>】  </p>
<p>代码修改<br>1.修改注册按钮<br>◦进入 LoginParams 源码【CTRL+点击】，进入到 index.d.ts 文件 (组件的类型定义)，快速定位文件位置，点击 index.js 即可看到组件源码  </p>
<p>◦回到注册页面，添加配置，可以看到修改成功</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;LoginForm</span><br><span class="line">  submitter=&#123;&#123;</span><br><span class="line">    searchConfig: &#123;</span><br><span class="line">      submitText: <span class="string">&#x27;注册&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;&#125;</span><br><span class="line">  ……</span><br><span class="line"></span><br><span class="line">&lt;/LoginForm&gt;</span><br></pre></td></tr></table></figure>

<p>2.提交逻辑<br>◦进入 LoginParams   </p>
<p>◦仿照 LoginParams 增加 RegisterParams </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">type</span> <span class="variable">RegisterParams</span> <span class="operator">=</span> &#123;</span><br><span class="line">  userAccount?: string;</span><br><span class="line">  userPassword?: string;</span><br><span class="line">  checkPassword?: string;</span><br><span class="line">  type?: string;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>◦将刚刚点击的 LoginParams 替换为 RegisterParams ，文件中全局替换 LoginParams  </p>
<p>3.修改注册逻辑<br>◦增加校验代码，进入 login</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//表单提交</span></span><br><span class="line"><span class="type">const</span> <span class="variable">handleSubmit</span> <span class="operator">=</span> async (values: API.RegisterParams) =&gt; &#123;</span><br><span class="line"></span><br><span class="line">  const &#123;userAccount,userPassword,checkPassword&#125; = values;</span><br><span class="line">  <span class="comment">//校验</span></span><br><span class="line">  <span class="keyword">if</span>(userPassword !== checkPassword)&#123;</span><br><span class="line">    message.error(<span class="string">&#x27;两次密码不一致&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// 注册</span></span><br><span class="line">    <span class="type">const</span> <span class="variable">user</span> <span class="operator">=</span> await <span class="title function_">login</span><span class="params">(userAccount,userPassword,checkPassword)</span>;</span><br><span class="line"></span><br><span class="line">    ……</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>


<p>◦ login 方法中，仿照 login 方法增加 register 方法，返回注册页面修改 login 为  register </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 登录接口 POST /api/user/login */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/** 注册接口 POST /api/user/register */</span></span><br><span class="line">export async function <span class="title function_">register</span><span class="params">(body: API.RegisterParams, options?: &#123; [key: string]: any &#125;)</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> request&lt;API.LoginResult&gt;(<span class="string">&#x27;/api/user/register&#x27;</span>, &#123;</span><br><span class="line">    method: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">    headers: &#123;</span><br><span class="line">      <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    data: body,</span><br><span class="line">    ...(options || &#123;&#125;),</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>◦进入上述 LoginResult 方法，仿照 LoginResult 增加 RegisterResult ，返回 api.ts 文件修改 LoginResult 为 RegisterResult<br><code>type RegisterResult = number;</code></p>
<p>4.回到注册页面，修改跳转页面代码逻辑，删除无用的引用【快捷键CTRL+Alt+o】</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">const LoginMessage: React.FC&lt;&#123;</span><br><span class="line">  content: string;</span><br><span class="line">&#125;&gt; = (&#123; content &#125;) =&gt; (</span><br><span class="line">  &lt;Alert</span><br><span class="line">    style=&#123;&#123;</span><br><span class="line">      marginBottom: <span class="number">24</span>,</span><br><span class="line">    &#125;&#125;</span><br><span class="line">    message=&#123;content&#125;</span><br><span class="line">    type=<span class="string">&quot;error&quot;</span></span><br><span class="line">    showIcon</span><br><span class="line">  /&gt;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">const Register: React.FC = () =&gt; &#123;</span><br><span class="line">  const [userLoginState, setUserLoginState] = useState&lt;API.LoginResult&gt;(&#123;&#125;);</span><br><span class="line">  const [type, setType] = useState&lt;string&gt;(<span class="string">&#x27;account&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//表单提交</span></span><br><span class="line">  <span class="type">const</span> <span class="variable">handleSubmit</span> <span class="operator">=</span> async (values: API.RegisterParams) =&gt; &#123;</span><br><span class="line"></span><br><span class="line">    const &#123;userPassword,checkPassword&#125; = values;</span><br><span class="line">    <span class="comment">//校验</span></span><br><span class="line">    <span class="keyword">if</span>(userPassword !== checkPassword)&#123;</span><br><span class="line">      message.error(<span class="string">&#x27;两次密码输入不一致&#x27;</span>);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="comment">// 注册</span></span><br><span class="line">      <span class="type">const</span> <span class="variable">id</span> <span class="operator">=</span> await <span class="title function_">register</span><span class="params">(values)</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (id &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="type">const</span> <span class="variable">defaultLoginSuccessMessage</span> <span class="operator">=</span> <span class="string">&#x27;注册成功！&#x27;</span>;</span><br><span class="line">        message.success(defaultLoginSuccessMessage);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/** 此方法会跳转到 redirect 参数所在的位置 */</span></span><br><span class="line">        <span class="comment">/** 即用户注册成功后跳转到登录页*/</span></span><br><span class="line">        <span class="keyword">if</span> (!history) <span class="keyword">return</span>;</span><br><span class="line">        const &#123; query &#125; = history.location;</span><br><span class="line">        const &#123; redirect &#125; = query as &#123;</span><br><span class="line">          redirect: string;</span><br><span class="line">        &#125;;</span><br><span class="line">        ……</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>


<h2 id="后端-API-接口测试"><a href="#后端-API-接口测试" class="headerlink" title="后端-API 接口测试"></a>后端-API 接口测试</h2><p>打断点测试<br>1.后端 UserController 中打断点  </p>
<p>测试一下刚刚写的代码逻辑</p>
<p>2.前端将 app.tsx 中的时间调长，测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export const request: RequestConfig = &#123;</span><br><span class="line">  timeout: <span class="number">1000000</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>注册失败，返回 -1【因为注册过，用户名重复，但没有提示，有待优化】<br>换一个用户名注册，再次测试，注册成功，跳转到登录页  </p>
<blockquote>
<p>但是此时跳转地址有些问题，用户没有 rediact 参数</p>
</blockquote>
<p>3.修改注册页面</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  <span class="comment">// 注册</span></span><br><span class="line">  <span class="type">const</span> <span class="variable">id</span> <span class="operator">=</span> await <span class="title function_">register</span><span class="params">(values)</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (id &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="type">const</span> <span class="variable">defaultLoginSuccessMessage</span> <span class="operator">=</span> <span class="string">&#x27;注册成功！&#x27;</span>;</span><br><span class="line">    message.success(defaultLoginSuccessMessage);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** 此方法会跳转到 redirect 参数所在的位置 */</span></span><br><span class="line">    <span class="comment">/** 即用户注册成功后跳转到登录页*/</span></span><br><span class="line">    <span class="keyword">if</span> (!history) <span class="keyword">return</span>;</span><br><span class="line">    const &#123; query &#125; = history.location;</span><br><span class="line">    const &#123; redirect &#125; = query as &#123;</span><br><span class="line">      redirect: string;</span><br><span class="line">    &#125;;</span><br><span class="line">    history.push(&#123;</span><br><span class="line">      pathname: <span class="string">&#x27;/user/login&#x27;</span>,</span><br><span class="line">      query,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(`register <span class="type">error</span> <span class="variable">id</span> <span class="operator">=</span> $&#123;id&#125;`);</span><br><span class="line">  &#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">  <span class="type">const</span> <span class="variable">defaultLoginFailureMessage</span> <span class="operator">=</span> <span class="string">&#x27;注册失败，请重试！&#x27;</span>;</span><br><span class="line">  message.error(defaultLoginFailureMessage);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4.修改登录页面<br><a target="_blank" rel="noopener" href="https://ant.design/components/space-cn">Space 组件</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;Space split=&#123;&lt;Divider type=<span class="string">&quot;vertical&quot;</span> /&gt;&#125;&gt;</span><br><span class="line">    &lt;ProFormCheckbox noStyle name=<span class="string">&quot;autoLogin&quot;</span>&gt;</span><br><span class="line">        自动登录</span><br><span class="line">      &lt;/ProFormCheckbox&gt;</span><br><span class="line">    &lt;Link to=<span class="string">&quot;/user/register&quot;</span> &gt;注册账户&lt;/Link&gt;</span><br><span class="line">    &lt;a</span><br><span class="line">      style=&#123;&#123;</span><br><span class="line">        <span class="type">float</span>: <span class="string">&#x27;right&#x27;</span>,</span><br><span class="line">      &#125;&#125;</span><br><span class="line">      href=&#123;PLANET_LINK&#125;</span><br><span class="line">      target=<span class="string">&quot;_blank&quot;</span></span><br><span class="line">      rel=<span class="string">&quot;noreferrer&quot;</span></span><br><span class="line">    &gt;</span><br><span class="line">      忘记密码</span><br><span class="line">    &lt;/a&gt;</span><br><span class="line">&lt;/Space&gt;</span><br></pre></td></tr></table></figure>


<p>优化解决【AI 给出方案】</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">TypeScript</span><br><span class="line">&lt;div</span><br><span class="line">  style=&#123;&#123;</span><br><span class="line">    display: <span class="string">&#x27;flex&#x27;</span>,                  <span class="comment">//将 div 设置为 flex 容器</span></span><br><span class="line">    marginBottom: <span class="number">24</span>, </span><br><span class="line">    justifyContent: <span class="string">&#x27;space-between&#x27;</span>,  <span class="comment">//将子元素（自动登录、注册账号、忘记密码）均匀分布在容器内，使它们之间的间距相等</span></span><br><span class="line">    alignItems: <span class="string">&#x27;center&#x27;</span>,             <span class="comment">//使子元素在垂直方向上居中对齐</span></span><br><span class="line">  &#125;&#125;</span><br><span class="line">&gt;</span><br><span class="line">    &lt;ProFormCheckbox noStyle name=<span class="string">&quot;autoLogin&quot;</span>&gt;</span><br><span class="line">      自动登录</span><br><span class="line">    &lt;/ProFormCheckbox&gt;</span><br><span class="line">    &lt;Link to=<span class="string">&quot;/user/register&quot;</span> &gt; 注册账号 &lt;/Link&gt;</span><br><span class="line">    &lt;a</span><br><span class="line">      style=&#123;&#123;</span><br><span class="line">        <span class="type">float</span>: <span class="string">&#x27;right&#x27;</span>,</span><br><span class="line">      &#125;&#125;</span><br><span class="line">      href=&#123;PLANET_LINK&#125;</span><br><span class="line">      target=<span class="string">&quot;_blank&quot;</span></span><br><span class="line">      rel=<span class="string">&quot;noreferrer&quot;</span></span><br><span class="line">    &gt;</span><br><span class="line">      忘记密码</span><br><span class="line">    &lt;/a&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>


<h3 id="登录功能"><a href="#登录功能" class="headerlink" title="登录功能"></a>登录功能</h3><h3 id="前端-登录态管理"><a href="#前端-登录态管理" class="headerlink" title="前端-登录态管理"></a>前端-登录态管理</h3><p>1.后端<br>◦UserController 中添加获取当前登录态、信息接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/current&quot;)</span></span><br><span class="line"><span class="keyword">public</span> User <span class="title function_">getCurrentUser</span><span class="params">(HttpServletRequest request)</span> &#123;</span><br><span class="line">   <span class="type">Object</span> <span class="variable">userObj</span> <span class="operator">=</span> request.getSession().getAttribute(USER_LOGIN_STATE);</span><br><span class="line">   <span class="type">User</span> <span class="variable">currentUSer</span> <span class="operator">=</span> (User) userObj;</span><br><span class="line">   <span class="keyword">if</span> (currentUSer == <span class="literal">null</span>)&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="type">long</span> <span class="variable">userId</span> <span class="operator">=</span> currentUSer.getId();</span><br><span class="line">   <span class="comment">//todo 校验用户是否合法</span></span><br><span class="line">   <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.getById(userId);</span><br><span class="line">   <span class="keyword">return</span> userService.getSafetyUser(user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此时还没有判断是否被封号，存在问题，后续再优化</p>
<p>◦UserServiceImpl 中的 getSafetyUser 里面加一个判断</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> User <span class="title function_">getSafetyUser</span><span class="params">(User originUser)</span>&#123;</span><br><span class="line">   <span class="keyword">if</span>(originUser == <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   ……</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<ol start="2">
<li>前端<br>◦app.tsx 中 点击 queryCurrentUser 进入 api.ts ，修改代码，点击 CurrentUser 查看其返回的数据，结合数据库字段设计修改代码</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">app.tsx</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span>  https://umijs.org/zh-CN/plugins/plugin-initial-state</span></span><br><span class="line"><span class="comment"> * */</span></span><br><span class="line">……</span><br><span class="line">  <span class="type">const</span> <span class="variable">fetchUserInfo</span> <span class="operator">=</span> async () =&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="type">const</span> <span class="variable">msg</span> <span class="operator">=</span> await <span class="title function_">queryCurrentUser</span><span class="params">()</span>;</span><br><span class="line">      <span class="keyword">return</span> msg.data;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">      <span class="comment">// history.push(loginPath);</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> undefined;</span><br><span class="line">  &#125;;</span><br><span class="line">  ……</span><br><span class="line">  </span><br><span class="line">api.ts  </span><br><span class="line"><span class="comment">/** 获取当前的用户 GET /api/user/current */</span></span><br><span class="line">export async function <span class="title function_">currentUser</span><span class="params">(options?: &#123; [key: string]: any &#125;)</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> request&lt;API.CurrentUser&gt;(<span class="string">&#x27;/api/user/current&#x27;</span>, &#123;</span><br><span class="line">    method: <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">    ...(options || &#123;&#125;),</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">typings.d.ts</span><br><span class="line">declare namespace API &#123;</span><br><span class="line">  <span class="type">type</span> <span class="variable">CurrentUser</span> <span class="operator">=</span> &#123;</span><br><span class="line">    id: number;</span><br><span class="line">    username: string;</span><br><span class="line">    userAccount: string;</span><br><span class="line">    avatarUrl?: string;</span><br><span class="line">    gender: number;</span><br><span class="line">    phone: string;</span><br><span class="line">    email: string;</span><br><span class="line">    userStatus: number;</span><br><span class="line">    userRole: number;</span><br><span class="line">    createTime: Date;</span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure>



<p>◦将 app.tsx 中之前定义的白名单的代码提到前面，修改变量名，修改引用的变量名</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="variable">isDev</span> <span class="operator">=</span> process.env.NODE_ENV === <span class="string">&#x27;development&#x27;</span>;</span><br><span class="line"><span class="type">const</span> <span class="variable">loginPath</span> <span class="operator">=</span> <span class="string">&#x27;/user/login&#x27;</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 无需用户登录态的页面</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">const</span> <span class="variable">NO_NEED_LOGIN_WHITE_LIST</span> <span class="operator">=</span> [<span class="string">&#x27;/user/register&#x27;</span>, loginPath];</span><br><span class="line"></span><br><span class="line">……</span><br><span class="line"></span><br><span class="line"><span class="comment">// ProLayout 支持的api https://procomponents.ant.design/components/layout</span></span><br><span class="line">export const layout: RunTimeLayoutConfig = (&#123; initialState, setInitialState &#125;) =&gt; &#123;</span><br><span class="line">  ……</span><br><span class="line">      <span class="keyword">if</span> (NO_NEED_LOGIN_WHITE_LIST.includes(location.pathname)) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      ……</span><br></pre></td></tr></table></figure>



<p>◦修改 app.tsx 中下面代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span>  https://umijs.org/zh-CN/plugins/plugin-initial-state</span></span><br><span class="line"><span class="comment"> * */</span></span><br><span class="line">……</span><br><span class="line">  <span class="type">const</span> <span class="variable">fetchUserInfo</span> <span class="operator">=</span> async () =&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> await <span class="title function_">queryCurrentUser</span><span class="params">()</span>;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">      history.push(loginPath);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> undefined;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="comment">// 如果是无需登录页面，不执行</span></span><br><span class="line">  <span class="keyword">if</span> (NO_NEED_LOGIN_WHITE_LIST.includes(history.location.pathname)) &#123;</span><br><span class="line">    <span class="type">const</span> <span class="variable">currentUser</span> <span class="operator">=</span> await <span class="title function_">fetchUserInfo</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="comment">//@ts-ignore</span></span><br><span class="line">      fetchUserInfo,</span><br><span class="line">      currentUser,</span><br><span class="line">      settings: defaultSettings,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="type">const</span> <span class="variable">currentUser</span> <span class="operator">=</span> await <span class="title function_">fetchUserInfo</span><span class="params">()</span>;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="comment">//@ts-ignore</span></span><br><span class="line">    fetchUserInfo,</span><br><span class="line">    currentUser,</span><br><span class="line">    settings: defaultSettings,</span><br><span class="line">  &#125;;</span><br><span class="line">  </span><br><span class="line"><span class="comment">// ProLayout 支持的api https://procomponents.ant.design/components/layout</span></span><br><span class="line">export const layout: RunTimeLayoutConfig = (&#123; initialState, setInitialState &#125;) =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    rightContentRender: () =&gt; &lt;RightContent /&gt;,</span><br><span class="line">    disableContentMargin: <span class="literal">false</span>,</span><br><span class="line">    waterMarkProps: &#123;</span><br><span class="line">      content: initialState?.currentUser?.username,</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure>







<p>◦登录测试，发现可以进入欢迎页，但用户名和头像一直加载、水印不显示</p>
<p>▪水印，到数据库添加数据，添加后上传，刷新页面，水印显示</p>
<p>▪头像，前端找到文件src&#x2F;components&#x2F;RightContent&#x2F;AvatarDropdown.tsx 修改代码，刷新网页</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">……</span><br><span class="line">  <span class="keyword">if</span> (!currentUser || !currentUser.username) &#123;</span><br><span class="line">    <span class="keyword">return</span> loading;</span><br><span class="line">  &#125;</span><br><span class="line">  ……  </span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;HeaderDropdown overlay=&#123;menuHeaderDropdown&#125;&gt;</span><br><span class="line">      &lt;span className=&#123;`$&#123;styles.action&#125; $&#123;styles.account&#125;`&#125;&gt;</span><br><span class="line">        &lt;Avatar size=<span class="string">&quot;small&quot;</span> className=&#123;styles.avatar&#125; src=&#123;currentUser.avatarUrl&#125; alt=<span class="string">&quot;avatarUrl&quot;</span> /&gt;</span><br><span class="line">        &lt;span className=&#123;`$&#123;styles.name&#125; anticon`&#125;&gt;&#123;currentUser.username&#125;&lt;/span&gt;</span><br><span class="line">      &lt;/span&gt;</span><br><span class="line">    &lt;/HeaderDropdown&gt;</span><br><span class="line">  );</span><br></pre></td></tr></table></figure>

<h1 id="7用户管理功能"><a href="#7用户管理功能" class="headerlink" title="7用户管理功能"></a>7用户管理功能</h1><p>•Ant Design Pro 框架为我们生成了一个表格页面，页面的源码在 src&#x2F;pages&#x2F;TableList&#x2F;index.tsx 由于源码复杂，所以我们自己编写  </p>
<h2 id="前端开发（一）"><a href="#前端开发（一）" class="headerlink" title="前端开发（一）"></a>前端开发（一）</h2><p>1.文件夹下 src&#x2F;pages 新建 Admin 文件夹，复制同级目录 user 文件夹下的 Register 文件粘贴到 Admin 文件夹，更名为 UserManage  </p>
<p>2.到 config&#x2F;routes.ts 文件中添加路由  </p>
<p>3.访问一下，发现无权访问【routes.ts 文件中有一个 access: ‘canAdmin’ 限制只有管理员可访问】  </p>
<p>路由组件是如何知道该账号是不是管理员呢？从某个地方全局获取<br>•首次访问页面（刷新页面），进入app.tsx ，执行 getInitialState 方法，其返回值会作为全局共享的数据<br>•access.tx 文件中判断用户的访问权限，canAdmin 的值为 true 时才允许访问（可以将 canAdmin 的值直接改为 true 试一试能不能访问）<br>•同理，我们可以在 access.tx 文件中定义 vip 可以访问页面  </p>
<p>4.修改 access.ts 文件中的判断</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> https://umijs.org/zh-CN/plugins/plugin-access</span></span><br><span class="line"><span class="comment"> * */</span></span><br><span class="line">export <span class="keyword">default</span> function <span class="title function_">access</span><span class="params">(initialState: &#123; currentUser?: API.CurrentUser &#125; | undefined)</span> &#123;</span><br><span class="line">  const &#123; currentUser &#125; = initialState ?? &#123;&#125;;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    canAdmin: currentUser &amp;&amp; currentUser.userRole === <span class="number">1</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>5.后台数据库中修改 dogYupi 为管理员，方便编写页面  </p>
<p>6.删除 config&#x2F;routes.ts 文件中二级管理页的路由</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">export <span class="keyword">default</span> [</span><br><span class="line">  ……</span><br><span class="line">  &#123; path: <span class="string">&#x27;/welcome&#x27;</span>, name: <span class="string">&#x27;欢迎&#x27;</span>, icon: <span class="string">&#x27;smile&#x27;</span>, component: <span class="string">&#x27;./Welcome&#x27;</span> &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">&#x27;/admin&#x27;</span>,</span><br><span class="line">    name: <span class="string">&#x27;管理页&#x27;</span>,</span><br><span class="line">    icon: <span class="string">&#x27;crown&#x27;</span>,</span><br><span class="line">    access: <span class="string">&#x27;canAdmin&#x27;</span>,</span><br><span class="line">    component: <span class="string">&#x27;./Admin&#x27;</span>,    <span class="comment">//我的代码中没有，所以补上，做一个二级页面的嵌套</span></span><br><span class="line">    routes: [</span><br><span class="line">      &#123; path: <span class="string">&#x27;/admin/user-manage&#x27;</span>, name: <span class="string">&#x27;用户管理&#x27;</span>, icon: <span class="string">&#x27;smile&#x27;</span>, component: <span class="string">&#x27;./Admin/UserManage&#x27;</span> &#125;,</span><br><span class="line">      &#123; path: <span class="string">&#x27;/admin/sub-page&#x27;</span>, name: <span class="string">&#x27;二级管理页&#x27;</span>, icon: <span class="string">&#x27;smile&#x27;</span>, component: <span class="string">&#x27;./Welcome&#x27;</span> &#125;,</span><br><span class="line">      &#123; component: <span class="string">&#x27;./404&#x27;</span> &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123; name: <span class="string">&#x27;查询表格&#x27;</span>, icon: <span class="string">&#x27;table&#x27;</span>, path: <span class="string">&#x27;/list&#x27;</span>, component: <span class="string">&#x27;./TableList&#x27;</span> &#125;,</span><br><span class="line">  &#123; path: <span class="string">&#x27;/&#x27;</span>, redirect: <span class="string">&#x27;/welcome&#x27;</span> &#125;,</span><br><span class="line">  &#123; component: <span class="string">&#x27;./404&#x27;</span> &#125;,</span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<p>◦此时前端页面显示如下，跟应该显示的注册页面不一致  </p>
<p>7.修改 src&#x2F;pages&#x2F;Admin.tsx 文件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;PageHeaderWrapper&#125; from <span class="string">&#x27;@ant-design/pro-components&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> React from <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line">const Admin: React.FC = (props) =&gt; &#123;</span><br><span class="line">  const &#123;children&#125; = props;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;PageHeaderWrapper&gt;</span><br><span class="line">      &#123;children&#125;</span><br><span class="line">    &lt;/PageHeaderWrapper&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line">export <span class="keyword">default</span> Admin;</span><br></pre></td></tr></table></figure>


<h2 id="前端开发（二）"><a href="#前端开发（二）" class="headerlink" title="前端开发（二）"></a>前端开发（二）</h2><p>使用 ProComponents 高级表单<br>1.通过 columns 定义表格有哪些列<br>2.columns 属性<br>	◦dataIndex 对应返回数据对象的属性<br>	◦title 表格列名<br>	◦copyable 是否允许复制<br>	◦ellipsis 是否允许缩略<br>	◦valueType 用于声明这一列的类型（dataTime、select）  </p>
<p>1.初始化 src&#x2F;pages&#x2F;Admin&#x2F;UserManage&#x2F;index.tsx 页面【删完就行】</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React from <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"></span><br><span class="line">const Register: React.FC = () =&gt; &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div id=<span class="string">&quot;userManage&quot;</span>&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line">export <span class="keyword">default</span> Register;</span><br></pre></td></tr></table></figure>

<p>2.到 ProComponents 官网 高级表格 找到合适的表格复制代码（这里复制第一个）</p>
<p>3.删除不需要组件的代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; EllipsisOutlined, PlusOutlined &#125; from <span class="string">&#x27;@ant-design/icons&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> type &#123; ActionType, ProColumns &#125; from <span class="string">&#x27;@ant-design/pro-components&#x27;</span>;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">return</span> values;</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;&#125;</span><br><span class="line">      pagination=&#123;&#123;</span><br><span class="line">        pageSize: <span class="number">5</span>,</span><br><span class="line">        onChange: (page) =&gt; console.log(page),</span><br><span class="line">      &#125;&#125;</span><br><span class="line">      dateFormatter=<span class="string">&quot;string&quot;</span></span><br><span class="line">      headerTitle=<span class="string">&quot;高级表格&quot;</span></span><br><span class="line">      toolBarRender=&#123;() =&gt; [</span><br><span class="line">      <span class="comment">/*新建与选择菜单组件*/</span></span><br><span class="line">        &lt;Button</span><br><span class="line">          key=<span class="string">&quot;button&quot;</span></span><br><span class="line">          icon=&#123;&lt;PlusOutlined /&gt;&#125;</span><br><span class="line">          onClick=&#123;() =&gt; &#123;</span><br><span class="line">            actionRef.current?.reload();</span><br><span class="line">          &#125;&#125;</span><br><span class="line">          type=<span class="string">&quot;primary&quot;</span></span><br><span class="line">        &gt;</span><br><span class="line">          新建</span><br><span class="line">        &lt;/Button&gt;,</span><br><span class="line">        &lt;Dropdown</span><br><span class="line">          key=<span class="string">&quot;menu&quot;</span></span><br><span class="line">          menu=&#123;&#123;</span><br><span class="line">            items: [</span><br><span class="line">              &#123;</span><br><span class="line">                label: <span class="string">&#x27;1st item&#x27;</span>,</span><br><span class="line">                key: <span class="string">&#x27;1&#x27;</span>,</span><br><span class="line">              &#125;,</span><br><span class="line">              &#123;</span><br><span class="line">                label: <span class="string">&#x27;2nd item&#x27;</span>,</span><br><span class="line">                key: <span class="string">&#x27;2&#x27;</span>,</span><br><span class="line">              &#125;,</span><br><span class="line">              &#123;</span><br><span class="line">                label: <span class="string">&#x27;3rd item&#x27;</span>,</span><br><span class="line">                key: <span class="string">&#x27;3&#x27;</span>,</span><br><span class="line">              &#125;,</span><br><span class="line">            ],</span><br><span class="line">          &#125;&#125;</span><br><span class="line">        &gt;</span><br><span class="line">          &lt;Button&gt;</span><br><span class="line">            &lt;EllipsisOutlined /&gt;</span><br><span class="line">          &lt;/Button&gt;</span><br><span class="line">        &lt;/Dropdown&gt;,</span><br><span class="line">      ]&#125;</span><br><span class="line">    /&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>



<p>4.api.ts 文件里定义一个 searchUsers 接口（复制 notices 接口，进行修改即可）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 搜索用户 GET /api/user/search */</span></span><br><span class="line">export async function <span class="title function_">searchUsers</span><span class="params">(options?: &#123; [key: string]: any &#125;)</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> request&lt;API.CurrentUser[]&gt;(<span class="string">&#x27;/api/user/search&#x27;</span>, &#123;</span><br><span class="line">    method: <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">    ...(options || &#123;&#125;),</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** 此处后端没有提供注释 GET /api/notices */</span></span><br><span class="line">export async function <span class="title function_">getNotices</span><span class="params">(options?: &#123; [key: string]: any &#125;)</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> request&lt;API.NoticeIconList&gt;(<span class="string">&#x27;/api/notices&#x27;</span>, &#123;</span><br><span class="line">    method: <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">    ...(options || &#123;&#125;),</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>效果如下</p>
<h2 id="8用户注销功能"><a href="#8用户注销功能" class="headerlink" title="8用户注销功能"></a>8用户注销功能</h2><h3 id="后端开发-1"><a href="#后端开发-1" class="headerlink" title="后端开发"></a>后端开发</h3><p>1.业务逻辑层<br>◦UserService 中写 userLogout 方法  </p>
<blockquote>
<p>•需要返回什么参数？<br>查看登录时的逻辑，用户登陆成功，session 中保存了用户的登录态，反之，注销，移除登录态即可</p>
</blockquote>
<p>◦UserServiceImpl 中实现方法  </p>
<p>Alt + Enter 选择 Implement methods  </p>
<p>确定  </p>
<p>生成的代码  </p>
<p>▪修改一下代码，获取 session 中的数据，鼠标指示在 removeAttribute 上，发现返回值是 void，修改一下返回值【后续注销失败抛出异常即可，不需要定义一个返回值】，UserService中也修改一下  </p>
<blockquote>
<p>可以进入 getSession &#x3D;&gt; HttpSession 中查看一下</p>
</blockquote>
<p>2.UserController 中编写接口<br>◦复制 login 接口的代码进行修改  </p>
<p>UserService 返回值修改回 int  </p>
<p>UserServiceImpl 返回值修改回 int 注销成功返回 1  </p>
<p>3.文件中修改的代码<br>◦UserService</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 用户注销</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">userLogout</span><span class="params">(HttpServletRequest request)</span>;</span><br></pre></td></tr></table></figure>

<p>◦UserServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 用户注销</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">userLogout</span><span class="params">(HttpServletRequest request)</span> &#123;</span><br><span class="line">   <span class="comment">//移除用户登录态</span></span><br><span class="line">       request.getSession().removeAttribute(USER_LOGIN_STATE);</span><br><span class="line">   <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>◦UserController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/logout&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Integer <span class="title function_">userLogout</span><span class="params">(HttpServletRequest request)</span>&#123;</span><br><span class="line">   <span class="keyword">if</span> (request == <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> userService.userLogout(request);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="前端开发"><a href="#前端开发" class="headerlink" title="前端开发"></a>前端开发</h2><p>1.启动前后端代码（后端：debug、前端：start-dev），登录一个管理员账号<br>2.修改代码实现用户注销  </p>
<p>注销按钮在导航条上，导航条是所有页面都有的组件（components），页面触发注销的位置是头像的下拉菜单（AvatarDropdown），所以我们定位到 src&#x2F;components&#x2F;RightContent&#x2F;AvatarDropdown.tsx 文件  </p>
<p>◦找到 退出登录 ，搜索 logout  ，找到并进入 loginOut 方法，进入 outLogin 方法，发现进入到 api.ts 文件，修改 outLogin 的接口和后端一致  </p>
<p>◦测试一下，点击退出登录，可以看到返回到登陆页面，响应值为 1  </p>
<p>3.文件中修改的代码<br>◦api.ts</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 退出登录接口 POST /api/user/logout */</span></span><br><span class="line">export async function <span class="title function_">outLogin</span><span class="params">(options?: &#123; [key: string]: any &#125;)</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> request&lt;Record&lt;string, any&gt;&gt;(<span class="string">&#x27;/api/user/logout&#x27;</span>, &#123;</span><br><span class="line">    method: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">    ...(options || &#123;&#125;),</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>




<h2 id="9用户校验"><a href="#9用户校验" class="headerlink" title="9用户校验"></a>9用户校验</h2><blockquote>
<p>仅适用于用户可信的情况</p>
</blockquote>
<p>先让用户自己填：2-5 位星球编号<br>•后台补充对编号的校验<br>	◦长度校验<br>	◦唯一性校验<br>•前端补充输入框，适配后端</p>
<blockquote>
<p>后期拉取星球数据，定期清理违规用户</p>
</blockquote>
<h3 id="后端"><a href="#后端" class="headerlink" title="后端"></a>后端</h3><p>1.新增 planetCode - 星球编号 字段<br>◦数据库添加字段 planetCode - 星球编号   </p>
<p>◦User.java 和 UserMapper.xml 中增加 planetCode 字段（直接添加下面代码或者使用 MyBatisX 插件再次生成，将新增字段字段粘到 User 中，修改 UserMapper.xml 文件中引用的包名）  </p>
<p>◦UserServiceImpl 中的用户脱敏逻辑也要增加这个字段，将这个字段的数据返回给前端  </p>
<p>◦给注册请求体 src&#x2F;main&#x2F;java&#x2F;com&#x2F;han&#x2F;usercenter&#x2F;model&#x2F;domain&#x2F;request&#x2F;UserRegisterRequest.java 增加这个字段的参数  </p>
<p>◦ UserController 中增加这个字段  </p>
<p>◦UserService 中增加这个字段，加上注释，点击左边的图标，进入下一层（Impl）  </p>
<p>◦UserServiceImpl 中增加这个字段，增加对 planetCode 的校验  </p>
<p>增加字段，判断 planetCode 长度不能大于 5  </p>
<p>校验星球编号不能重复  </p>
<p>插入星球编号数据  </p>
<p>◦UserServiceTest 中增加这个字段参数  </p>
<blockquote>
<p>这种方式，需要我们把调用到的地方都进行修改，比较麻烦，但可以让我们有意识的修改之前的逻辑<br>参数较多时，可以把这些对象进行封装，不用繁琐的修改</p>
</blockquote>
<p>2.打断点进行测试一下，失败（因为符合注册条件的账户都注册过了，可以自己新增测试）  </p>
<p>3.手动给管理员账号增加一个星球编号  </p>
<p>4.文件中修改的代码<br>◦User.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 星球编号</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> String planetCode;</span><br></pre></td></tr></table></figure>



<p>◦UserMapper.xml【如果选择插件重新生成代码，记得修改紫色部分】</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;mapper namespace=<span class="string">&quot;com.yupi.usercenter.mapper.UserMapper&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;resultMap id=<span class="string">&quot;BaseResultMap&quot;</span> type=<span class="string">&quot;com.yupi.usercenter.model.domain.User&quot;</span>&gt;</span><br><span class="line">            &lt;id property=<span class="string">&quot;id&quot;</span> column=<span class="string">&quot;id&quot;</span> jdbcType=<span class="string">&quot;BIGINT&quot;</span>/&gt;</span><br><span class="line">            &lt;result property=<span class="string">&quot;username&quot;</span> column=<span class="string">&quot;username&quot;</span> jdbcType=<span class="string">&quot;VARCHAR&quot;</span>/&gt;</span><br><span class="line">            &lt;result property=<span class="string">&quot;userAccount&quot;</span> column=<span class="string">&quot;userAccount&quot;</span> jdbcType=<span class="string">&quot;VARCHAR&quot;</span>/&gt;</span><br><span class="line">            &lt;result property=<span class="string">&quot;avatarUrl&quot;</span> column=<span class="string">&quot;avatarUrl&quot;</span> jdbcType=<span class="string">&quot;VARCHAR&quot;</span>/&gt;</span><br><span class="line">            &lt;result property=<span class="string">&quot;gender&quot;</span> column=<span class="string">&quot;gender&quot;</span> jdbcType=<span class="string">&quot;TINYINT&quot;</span>/&gt;</span><br><span class="line">            &lt;result property=<span class="string">&quot;userPassword&quot;</span> column=<span class="string">&quot;userPassword&quot;</span> jdbcType=<span class="string">&quot;VARCHAR&quot;</span>/&gt;</span><br><span class="line">            &lt;result property=<span class="string">&quot;phone&quot;</span> column=<span class="string">&quot;phone&quot;</span> jdbcType=<span class="string">&quot;VARCHAR&quot;</span>/&gt;</span><br><span class="line">            &lt;result property=<span class="string">&quot;email&quot;</span> column=<span class="string">&quot;email&quot;</span> jdbcType=<span class="string">&quot;VARCHAR&quot;</span>/&gt;</span><br><span class="line">            &lt;result property=<span class="string">&quot;userStatus&quot;</span> column=<span class="string">&quot;userStatus&quot;</span> jdbcType=<span class="string">&quot;INTEGER&quot;</span>/&gt;</span><br><span class="line">            &lt;result property=<span class="string">&quot;createTime&quot;</span> column=<span class="string">&quot;createTime&quot;</span> jdbcType=<span class="string">&quot;TIMESTAMP&quot;</span>/&gt;</span><br><span class="line">            &lt;result property=<span class="string">&quot;updateTime&quot;</span> column=<span class="string">&quot;updateTime&quot;</span> jdbcType=<span class="string">&quot;TIMESTAMP&quot;</span>/&gt;</span><br><span class="line">            &lt;result property=<span class="string">&quot;isDelete&quot;</span> column=<span class="string">&quot;isDelete&quot;</span> jdbcType=<span class="string">&quot;TINYINT&quot;</span>/&gt;</span><br><span class="line">            &lt;result property=<span class="string">&quot;userRole&quot;</span> column=<span class="string">&quot;userRole&quot;</span> jdbcType=<span class="string">&quot;INTEGER&quot;</span>/&gt;</span><br><span class="line">            &lt;result property=<span class="string">&quot;planetCode&quot;</span> column=<span class="string">&quot;planetCode&quot;</span> jdbcType=<span class="string">&quot;VARCHAR&quot;</span>/&gt;</span><br><span class="line">    &lt;/resultMap&gt;</span><br><span class="line"></span><br><span class="line">    &lt;sql id=<span class="string">&quot;Base_Column_List&quot;</span>&gt;</span><br><span class="line">        id,username,userAccount,</span><br><span class="line">        avatarUrl,gender,userPassword,</span><br><span class="line">        phone,email,userStatus,</span><br><span class="line">        createTime,updateTime,isDelete,</span><br><span class="line">        userRole,planetCode</span><br><span class="line">    &lt;/sql&gt;</span><br><span class="line">&lt;/mapper&gt;</span><br></pre></td></tr></table></figure>

<p>◦UserServiceIpml.java  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 用户脱敏</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> originUser</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> User <span class="title function_">getSafetyUser</span><span class="params">(User originUser)</span> &#123;</span><br><span class="line">   <span class="keyword">if</span> (originUser == <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="type">User</span> <span class="variable">safetyUser</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">   safetyUser.setId(originUser.getId());</span><br><span class="line">   safetyUser.setUsername(originUser.getUsername());</span><br><span class="line">   safetyUser.setUserAccount(originUser.getUserAccount());</span><br><span class="line">   safetyUser.setAvatarUrl(originUser.getAvatarUrl());</span><br><span class="line">   safetyUser.setGender(originUser.getGender());</span><br><span class="line">   safetyUser.setPhone(originUser.getPhone());</span><br><span class="line">   safetyUser.setEmail(originUser.getEmail());</span><br><span class="line">   safetyUser.setPlanetCode(originUser.getPlanetCode());</span><br><span class="line">   safetyUser.setUserRole(originUser.getUserRole());</span><br><span class="line">   safetyUser.setUserStatus(originUser.getUserStatus());</span><br><span class="line">   safetyUser.setCreateTime(originUser.getCreateTime());</span><br><span class="line">   <span class="keyword">return</span> safetyUser;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">userRegister</span><span class="params">(String userAccount, String userPassword, String checkPassword, String planetCode)</span> &#123;</span><br><span class="line">      <span class="comment">/* 1. 校验 */</span></span><br><span class="line">      <span class="keyword">if</span> (StringUtils.isAnyBlank(userAccount,userPassword,checkPassword,planetCode)) &#123;</span><br><span class="line">         <span class="comment">//todo 修改为自定义常量</span></span><br><span class="line">         <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span>(userAccount.length() &lt; <span class="number">4</span>)&#123;</span><br><span class="line">         <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span>(userPassword.length() &lt; <span class="number">8</span> || checkPassword.length() &lt; <span class="number">8</span>)&#123;</span><br><span class="line">         <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (planetCode.length() &gt; <span class="number">5</span>)&#123;</span><br><span class="line">         <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//账户不能包含特殊字符</span></span><br><span class="line">      ……</span><br><span class="line">      </span><br><span class="line">    <span class="comment">//密码和校验密码相同</span></span><br><span class="line">      ……</span><br><span class="line">      </span><br><span class="line">      <span class="comment">//账户不能重复</span></span><br><span class="line">      QueryWrapper&lt;User&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">      queryWrapper.eq(<span class="string">&quot;userAccount&quot;</span>,userAccount);</span><br><span class="line">      <span class="type">long</span> <span class="variable">count</span> <span class="operator">=</span> userMapper.selectCount(queryWrapper);</span><br><span class="line">      <span class="keyword">if</span> (count &gt; <span class="number">0</span>) &#123;</span><br><span class="line">         <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">      &#125;</span><br><span class="line">   </span><br><span class="line">      <span class="comment">//星球编号不能重复</span></span><br><span class="line">      queryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">      queryWrapper.eq(<span class="string">&quot;planetCode&quot;</span>,planetCode);</span><br><span class="line">      count = userMapper.selectCount(queryWrapper);</span><br><span class="line">      <span class="keyword">if</span> (count &gt; <span class="number">0</span>) &#123;</span><br><span class="line">         <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      <span class="comment">/* 2.加密 */</span></span><br><span class="line">      ……</span><br><span class="line">      <span class="comment">/* 3. 插入数据 */</span></span><br><span class="line">      <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">      user.setUserAccount(userAccount);</span><br><span class="line">      user.setUserPassword(encryptPassword);</span><br><span class="line">      user.setPlanetCode(planetCode);</span><br><span class="line">      <span class="type">boolean</span> <span class="variable">saveResult</span> <span class="operator">=</span> <span class="built_in">this</span>.save(user);</span><br><span class="line">      <span class="keyword">if</span> (!saveResult) &#123;</span><br><span class="line">         <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> user.getId();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>



<p>◦UserRegisterRequest.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">​<span class="keyword">private</span> String planetCode;</span><br></pre></td></tr></table></figure>

<p>◦UsetController.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/register&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Long <span class="title function_">userRegister</span><span class="params">(<span class="meta">@RequestBody</span> UserRegisterRequest userRegisterRequest)</span>&#123;</span><br><span class="line">   <span class="keyword">if</span> (userRegisterRequest == <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="type">String</span> <span class="variable">userAccount</span> <span class="operator">=</span> userRegisterRequest.getUserAccount();</span><br><span class="line">   <span class="type">String</span> <span class="variable">userPassword</span> <span class="operator">=</span> userRegisterRequest.getUserPassword();</span><br><span class="line">   <span class="type">String</span> <span class="variable">checkPassword</span> <span class="operator">=</span> userRegisterRequest.getCheckPassword();</span><br><span class="line">   <span class="type">String</span> <span class="variable">planetCode</span> <span class="operator">=</span> userRegisterRequest.getPlanetCode();</span><br><span class="line">   <span class="keyword">if</span>(StringUtils.isAnyBlank(userAccount, userPassword, checkPassword,planetCode))&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> userService.userRegister(userAccount, userPassword, checkPassword,planetCode);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>◦UserService.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 用户注册</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> userAccount   用户账户</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> userPassword  用户密码</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> checkPassword 校验密码</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> planetCode    星球编号</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span>              新用户 id</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">long</span> <span class="title function_">userRegister</span><span class="params">(String userAccount, String userPassword, String checkPassword, String planetCode)</span>;</span><br></pre></td></tr></table></figure>

<p>◦UserServiceTest.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">userRegister</span><span class="params">()</span> &#123;</span><br><span class="line">   <span class="type">String</span> <span class="variable">userAccount</span> <span class="operator">=</span> <span class="string">&quot;yupi&quot;</span>;</span><br><span class="line">   <span class="type">String</span> <span class="variable">userPassword</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">   <span class="type">String</span> <span class="variable">checkPassword</span> <span class="operator">=</span> <span class="string">&quot;123456&quot;</span>;</span><br><span class="line">   <span class="type">String</span> <span class="variable">planetCode</span> <span class="operator">=</span> <span class="string">&quot;1&quot;</span>;</span><br><span class="line">   <span class="type">long</span> <span class="variable">result</span> <span class="operator">=</span> userService.userRegister(userAccount, userPassword, checkPassword, planetCode);</span><br><span class="line">   Assertions.assertEquals(-<span class="number">1</span>, result);</span><br><span class="line">   </span><br><span class="line">   userAccount = <span class="string">&quot;yu&quot;</span>;</span><br><span class="line">   result = userService.userRegister(userAccount, userPassword, checkPassword, planetCode);</span><br><span class="line">   Assertions.assertEquals(-<span class="number">1</span>, result);</span><br><span class="line">   </span><br><span class="line">   userAccount = <span class="string">&quot;yupi&quot;</span>;</span><br><span class="line">   userPassword = <span class="string">&quot;123456&quot;</span>;</span><br><span class="line">   result = userService.userRegister(userAccount, userPassword, checkPassword, planetCode);</span><br><span class="line">   Assertions.assertEquals(-<span class="number">1</span>, result);</span><br><span class="line">   </span><br><span class="line">   userAccount = <span class="string">&quot;yu pi&quot;</span>;</span><br><span class="line">   userPassword = <span class="string">&quot;12345678&quot;</span>;</span><br><span class="line">   result = userService.userRegister(userAccount, userPassword, checkPassword, planetCode);</span><br><span class="line">   Assertions.assertEquals(-<span class="number">1</span>, result);</span><br><span class="line">   </span><br><span class="line">   checkPassword = <span class="string">&quot;123456789&quot;</span>;</span><br><span class="line">   result = userService.userRegister(userAccount, userPassword, checkPassword, planetCode);</span><br><span class="line">   Assertions.assertEquals(-<span class="number">1</span>, result);</span><br><span class="line">   </span><br><span class="line">   userAccount = <span class="string">&quot;dogYupi&quot;</span>;</span><br><span class="line">   checkPassword = <span class="string">&quot;12345678&quot;</span>;</span><br><span class="line">   result = userService.userRegister(userAccount, userPassword, checkPassword, planetCode);</span><br><span class="line">   Assertions.assertEquals(-<span class="number">1</span>, result);</span><br><span class="line">   </span><br><span class="line">   userAccount = <span class="string">&quot;yupi&quot;</span>;</span><br><span class="line">   result = userService.userRegister(userAccount, userPassword, checkPassword, planetCode);</span><br><span class="line">   Assertions.assertEquals(-<span class="number">1</span>, result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h3 id="前端"><a href="#前端" class="headerlink" title="前端"></a>前端</h3><ol>
<li>src&#x2F;pages&#x2F;user&#x2F;Register&#x2F;index.tsx 注册页补充一个输入框<br>◦Register&#x2F;index.ts 复制账号框粘贴到确认密码框后，修改一下</li>
</ol>
<p>◦进入 RegisterParams （src&#x2F;services&#x2F;ant-design-pro&#x2F;typings.d.ts 文件），增加 planetCode  </p>
<p>◦进入 register ，找到 CurrentUser 进入，增加 planetCode  </p>
<p>2.src&#x2F;pages&#x2F;Admin&#x2F;UserManage&#x2F;index.tsx 管理页表格中增加星球编号的列<br>◦复制 状态 列，修改一下；可以看到注册页面多了一个星球编号输入框；管理员登陆，出现 星球编号 列  </p>
<p>◦新注册一个账号，测试  </p>
<p>不填星球编号测试  </p>
<p>带星球编号测试  </p>
<p>注册成功  </p>
<p>跳转到登录页面有返回信息  </p>
<p>后端数据库接收到数据  </p>
<p>显示星球编号  </p>
<p>3.文件中修改代码<br>◦Register&#x2F;index.ts</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;ProFormText</span><br><span class="line">  name=<span class="string">&quot;planetCode&quot;</span></span><br><span class="line">  fieldProps=&#123;&#123;</span><br><span class="line">    size: <span class="string">&#x27;large&#x27;</span>,</span><br><span class="line">    prefix: &lt;UserOutlined className=&#123;styles.prefixIcon&#125; /&gt;,</span><br><span class="line">  &#125;&#125;</span><br><span class="line">  placeholder=&#123;<span class="string">&#x27;请输入星球编号&#x27;</span>&#125;</span><br><span class="line">  rules=&#123;[</span><br><span class="line">    &#123;</span><br><span class="line">      required: <span class="literal">true</span>,</span><br><span class="line">      message: <span class="string">&#x27;星球编号是必填项！&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  ]&#125;</span><br><span class="line">/&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>◦typings.d.ts</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">TypeScript</span><br><span class="line"><span class="type">type</span> <span class="variable">RegisterParams</span> <span class="operator">=</span> &#123;</span><br><span class="line">  userAccount?: string;</span><br><span class="line">  userPassword?: string;</span><br><span class="line">  checkPassword?: string;</span><br><span class="line">  planetCode?: string;</span><br><span class="line">  type?: string;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">type</span> <span class="variable">CurrentUser</span> <span class="operator">=</span> &#123;</span><br><span class="line">  id: number;</span><br><span class="line">  username: string;</span><br><span class="line">  userAccount: string;</span><br><span class="line">  avatarUrl?: string;</span><br><span class="line">  gender: number;</span><br><span class="line">  phone: string;</span><br><span class="line">  email: string;</span><br><span class="line">  userStatus: number;</span><br><span class="line">  userRole: number;</span><br><span class="line">  planetCode: string;</span><br><span class="line">  createTime: Date;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>



<p>◦UserManage&#x2F;index.tsx</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;title: <span class="string">&#x27;星球编号&#x27;</span>,</span><br><span class="line">  dataIndex: <span class="string">&#x27;planetCode&#x27;</span>,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>



<h2 id="10后端代码优化"><a href="#10后端代码优化" class="headerlink" title="10后端代码优化"></a>10后端代码优化</h2><ol>
<li>通用返回对象<br>◦目的：给对象补充一些信息，告诉前端这个请求在业务层面是成功还是失败<blockquote>
<p>后端直接返回对象给前端，如果数据出现问题、后端报错、查询不到数据，前端不知道是为什么报错</p>
</blockquote>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#125;</span><br><span class="line">    <span class="string">&quot;message&quot;</span>: <span class="string">&quot;ok&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//成功</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;code&quot;</span> : <span class="number">0</span> <span class="comment">//业务状态吗</span></span><br><span class="line">    <span class="string">&quot;data&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;yupi&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="string">&quot;message&quot;</span>: <span class="string">&quot;ok&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//失败</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;code&quot;</span> : <span class="number">50001</span> <span class="comment">//业务状态吗</span></span><br><span class="line">    <span class="string">&quot;data&quot;</span>: <span class="literal">null</span></span><br><span class="line">    <span class="string">&quot;message&quot;</span>: <span class="string">&quot;用户异常操作、xxx&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>之前所有异常返回 -1 ，但前端以及后端刚接触这个项目的人不知道 -1 代表什么<br>◦自定义错误码<br>◦返回类支持返回正常和错误</p>
</blockquote>
<ol start="2">
<li><p>封装全局异常处理<br>◦定义业务异常类<br>▪相对于 Java 的异常类，支持更多字段<br>▪自定义构造函数，更灵活 &#x2F; 快捷的设置字段<br>◦编写全局异常处理器<br>▪作用<br> •捕获代码中所有的异常，内部消化，集中处理，让前端得到更详细的业务报错 &#x2F; 信息<br> •同时屏蔽掉项目框架本身的异常（不暴露服务器内部状态）<br> •集中处理，比如：记录日志<br>▪实现<br> •Spring AOP：在调用方法前后进行额外的处理</p>
</li>
<li><p>TODO 全局请求日志和登录校验</p>
</li>
</ol>
<h2 id="通用反馈对象"><a href="#通用反馈对象" class="headerlink" title="通用反馈对象"></a>通用反馈对象</h2><ol>
<li>com.yupi.usercenter.common 下新建 common 包，在 common 包下新建 BaseResponse.java，编写代码<br>◦新建</li>
</ol>
<p>◦编写如下代码，Alt + Insert 生成 Constructor 方法，复制一份修改一下  </p>
<p>编写代码，生成 constructor 方法  </p>
<p>选择生成内容  </p>
<p>生成内容  </p>
<p>复制一份生成的代码，进行修改  </p>
<ol start="2">
<li>将之前所有的请求使用 BaseResponse 封装一下<br>register、login 接口</li>
</ol>
<p>但这样很复杂且重复工作多，先去编写一个工具类以及定制一个快捷键<br>◦common 包下新建 ResultUtils.java ，编写代码  </p>
<p>◦定制一个快捷键 File &#x3D;&gt; Settings &#x3D;&gt; Editor &#x3D;&gt; Live Templates  </p>
<p>新建 customJava  </p>
<p>在 customJava 下新建一个快捷键  </p>
<p>新建快捷键详细信息  </p>
<p>测试一下效果  </p>
<p>◦UserController 中进行封装<br>register</p>
<p>login</p>
<p>logout  </p>
<p>current</p>
<p>search</p>
<p>delete</p>
<ol start="3">
<li>文件中修改代码<br>◦新建 common.BaseResponse.java</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yupi.usercenter.common;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 通用返回类</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &lt;T&gt;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> yupi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BaseResponse</span> &lt;T&gt; <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> <span class="type">int</span> code;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">private</span> T data;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">private</span> String message;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="title function_">BaseResponse</span><span class="params">(<span class="type">int</span> code, T data, String message)</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.code = code;</span><br><span class="line">      <span class="built_in">this</span>.data = data;</span><br><span class="line">      <span class="built_in">this</span>.message = message;</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">public</span> <span class="title function_">BaseResponse</span><span class="params">(<span class="type">int</span> code, T data)</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>(code, data, <span class="string">&quot;&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>◦新建 common.ResultUtils.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yupi.usercenter.common;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 返回工具类</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> yupi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ResultUtils</span> &#123;</span><br><span class="line">   </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; BaseResponse&lt;T&gt; <span class="title function_">success</span><span class="params">(T data)</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BaseResponse</span>&lt;&gt;(<span class="number">0</span>, data, <span class="string">&quot;success&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>◦UserController.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Resource</span></span><br><span class="line">   <span class="keyword">private</span> UserService userService;</span><br><span class="line">   </span><br><span class="line">   <span class="meta">@PostMapping(&quot;/register&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> BaseResponse&lt;Long&gt; <span class="title function_">userRegister</span><span class="params">(<span class="meta">@RequestBody</span> UserRegisterRequest userRegisterRequest)</span>&#123;​</span><br><span class="line">      <span class="keyword">if</span> (userRegisterRequest == <span class="literal">null</span>) &#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="type">String</span> <span class="variable">userAccount</span> <span class="operator">=</span> userRegisterRequest.getUserAccount();</span><br><span class="line">      <span class="type">String</span> <span class="variable">userPassword</span> <span class="operator">=</span> userRegisterRequest.getUserPassword();</span><br><span class="line">      <span class="type">String</span> <span class="variable">checkPassword</span> <span class="operator">=</span> userRegisterRequest.getCheckPassword();</span><br><span class="line">      <span class="type">String</span> <span class="variable">planetCode</span> <span class="operator">=</span> userRegisterRequest.getPlanetCode();</span><br><span class="line">      <span class="keyword">if</span>(StringUtils.isAnyBlank(userAccount, userPassword, checkPassword,planetCode))&#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="type">long</span> <span class="variable">result</span> <span class="operator">=</span> userService.userRegister(userAccount, userPassword, checkPassword, planetCode);</span><br><span class="line">      <span class="keyword">return</span> ResultUtils.success(result);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@PostMapping(&quot;/login&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> BaseResponse&lt;User&gt; <span class="title function_">userLogin</span><span class="params">(<span class="meta">@RequestBody</span> UserLoginRequest userLoginRequest, HttpServletRequest request)</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (userLoginRequest == <span class="literal">null</span>) &#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="type">String</span> <span class="variable">userAccount</span> <span class="operator">=</span> userLoginRequest.getUserAccount();</span><br><span class="line">      <span class="type">String</span> <span class="variable">userPassword</span> <span class="operator">=</span> userLoginRequest.getUserPassword();</span><br><span class="line">      <span class="keyword">if</span> (StringUtils.isAnyBlank(userAccount, userPassword)) &#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.userLogin(userAccount, userPassword, request);</span><br><span class="line">      <span class="keyword">return</span> ResultUtils.success(user);</span><br><span class="line">   &#125;</span><br><span class="line">    <span class="meta">@PostMapping(&quot;/logout&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> BaseResponse&lt;Integer&gt; <span class="title function_">userLogout</span><span class="params">(HttpServletRequest request)</span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (request == <span class="literal">null</span>) &#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> userService.userLogout(request);</span><br><span class="line">      <span class="keyword">return</span> ResultUtils.success(result);</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="meta">@GetMapping(&quot;/current&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> BaseResponse&lt;User&gt; <span class="title function_">getCurrentUser</span><span class="params">(HttpServletRequest request)</span>&#123;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">userObj</span> <span class="operator">=</span> request.getSession().getAttribute(USER_LOGIN_STATE);</span><br><span class="line">        <span class="type">User</span> <span class="variable">currentUser</span> <span class="operator">=</span> (User) userObj;</span><br><span class="line">      <span class="keyword">if</span> (currentUser == <span class="literal">null</span>) &#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      <span class="comment">// todo 校验用户是否合法</span></span><br><span class="line">      <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> currentUser.getId();</span><br><span class="line">      <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span>  userService.getById(userId);</span><br><span class="line">      <span class="type">User</span> <span class="variable">safetyUser</span> <span class="operator">=</span> userService.getSafetyUser(user);</span><br><span class="line">      <span class="keyword">return</span> ResultUtils.success(safetyUser);</span><br><span class="line">   </span><br><span class="line"></span><br><span class="line">   <span class="meta">@GetMapping(&quot;/search&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> BaseResponse&lt;List&lt;User&gt;&gt; <span class="title function_">searchUsers</span><span class="params">(String username,HttpServletRequest request)</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (!isAdmin(request))&#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      QueryWrapper&lt;User&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">      <span class="keyword">if</span> (StringUtils.isNotBlank(username)) &#123;</span><br><span class="line">         queryWrapper.like(<span class="string">&quot;username&quot;</span>, username);</span><br><span class="line">      &#125;</span><br><span class="line">      List&lt;User&gt; userList = userService.list(queryWrapper);</span><br><span class="line">      List&lt;User&gt; list = userList.stream().map(user -&gt; userService.getSafetyUser(user)).collect(Collectors.toList());</span><br><span class="line">      <span class="keyword">return</span> ResultUtils.success(list);</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="meta">@PostMapping(&quot;/delete&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> BaseResponse&lt;Boolean&gt; <span class="title function_">deleteUser</span><span class="params">(<span class="meta">@RequestBody</span> <span class="type">long</span> id,HttpServletRequest request)</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (!isAdmin(request))&#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (id &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="type">boolean</span> <span class="variable">b</span> <span class="operator">=</span> userService.removeById(id);</span><br><span class="line">      <span class="keyword">return</span> ResultUtils.success(b);</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 是否为管理员</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">isAdmin</span><span class="params">(HttpServletRequest request)</span>&#123;</span><br><span class="line">      <span class="comment">//仅管理员可查询</span></span><br><span class="line">      <span class="type">Object</span> <span class="variable">userObj</span> <span class="operator">=</span> request.getSession().getAttribute(USER_LOGIN_STATE);</span><br><span class="line">      <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> (User) userObj;</span><br><span class="line">      <span class="keyword">return</span> user != <span class="literal">null</span> &amp;&amp; user.getUserRole() == ADMIN_ROLE;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="自定义异常及错误代码"><a href="#自定义异常及错误代码" class="headerlink" title="自定义异常及错误代码"></a>自定义异常及错误代码</h2><ol>
<li>common 包下新建 ErrorCode.java</li>
</ol>
<p>新建时选择 Enum  </p>
<p>新建 ErrorCode  </p>
<p>打上注释  </p>
<p>修改一下代码，Alt+Insert 生成 Get 方法  </p>
<p>生成 Get 方法  </p>
<ol start="2">
<li>修改 BaseResponse ，完善 ResultUtils</li>
</ol>
<p>修改 BaseResponse  </p>
<p>完善 ResultUtils  </p>
<p>3.修改 UserController  </p>
<p>•此时 UserController 中多个地方都需要修改，这种修改方式有提示（视觉上不舒服），每次都要调用这个错误类<br>•定义一个全局异常处理类，捕获整个业务中的异常，并且根据异常信息返回 ResultUtils.error   </p>
<ol start="4">
<li>文件中修改代码<br>◦ErrorCode.java</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yupi.usercenter.common;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">ErrorCode</span> &#123;</span><br><span class="line">   </span><br><span class="line">   SUCCESS(<span class="number">0</span>, <span class="string">&quot;success&quot;</span>, <span class="string">&quot;&quot;</span>),</span><br><span class="line">   PARAMS_ERROR(<span class="number">4000</span>, <span class="string">&quot;请求参数错误&quot;</span>, <span class="string">&quot;&quot;</span>),</span><br><span class="line">   NULL_ERROR(<span class="number">4001</span>, <span class="string">&quot;请求参数为空&quot;</span>, <span class="string">&quot;&quot;</span>),</span><br><span class="line">   NO_LOGIN(<span class="number">40100</span>, <span class="string">&quot;未登录&quot;</span>, <span class="string">&quot;&quot;</span>),</span><br><span class="line">   NO_AUTH(<span class="number">40101</span>, <span class="string">&quot;无权限&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> code;</span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 状态码信息</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">final</span> String message;</span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 状态码描述（详情）</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">final</span> String description;</span><br><span class="line">   </span><br><span class="line">   ErrorCode(<span class="type">int</span> code, String message, String description) &#123;</span><br><span class="line">      <span class="built_in">this</span>.code = code;</span><br><span class="line">      <span class="built_in">this</span>.message = message;</span><br><span class="line">      <span class="built_in">this</span>.description = description;</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getCode</span><span class="params">()</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> code;</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">public</span> String <span class="title function_">getMessage</span><span class="params">()</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> message;</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>◦BaseResponse.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BaseResponse</span> &lt;T&gt; <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> <span class="type">int</span> code;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">private</span> T data;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">private</span> String message;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">private</span> String description;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="title function_">BaseResponse</span><span class="params">(<span class="type">int</span> code, T data, String message, String description)</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.code = code;</span><br><span class="line">      <span class="built_in">this</span>.data = data;</span><br><span class="line">      <span class="built_in">this</span>.message = message;</span><br><span class="line">      <span class="built_in">this</span>.description = description;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="title function_">BaseResponse</span><span class="params">(<span class="type">int</span> code, T data, String message)</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>(code, data, message, <span class="string">&quot;&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="title function_">BaseResponse</span><span class="params">(<span class="type">int</span> code, T data)</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>(code, data, <span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">public</span> <span class="title function_">BaseResponse</span><span class="params">(ErrorCode errorCode)</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>(errorCode.getCode(), <span class="literal">null</span>, errorCode.getMessage(), errorCode.getDescription());</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>◦ResultUtils.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ResultUtils</span> &#123;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 成功</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> data</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> &lt;T&gt;</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; BaseResponse&lt;T&gt; <span class="title function_">success</span><span class="params">(T data)</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BaseResponse</span>&lt;&gt;(<span class="number">0</span>, data, <span class="string">&quot;success&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 失败</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> errorCode</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> BaseResponse <span class="title function_">error</span><span class="params">(ErrorCode errorCode)</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BaseResponse</span>&lt;&gt;(errorCode);</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>◦UserController.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/register&quot;)</span></span><br><span class="line"><span class="keyword">public</span> BaseResponse&lt;Long&gt; <span class="title function_">userRegister</span><span class="params">(<span class="meta">@RequestBody</span> UserRegisterRequest userRegisterRequest)</span>&#123;</span><br><span class="line">   <span class="keyword">if</span> (userRegisterRequest == <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> ResultUtils.error(ErrorCode.PARAMS_ERROR);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="type">String</span> <span class="variable">userAccount</span> <span class="operator">=</span> userRegisterRequest.getUserAccount();</span><br><span class="line">   <span class="type">String</span> <span class="variable">userPassword</span> <span class="operator">=</span> userRegisterRequest.getUserPassword();</span><br><span class="line">   <span class="type">String</span> <span class="variable">checkPassword</span> <span class="operator">=</span> userRegisterRequest.getCheckPassword();</span><br><span class="line">   <span class="type">String</span> <span class="variable">planetCode</span> <span class="operator">=</span> userRegisterRequest.getPlanetCode();</span><br><span class="line">   <span class="keyword">if</span>(StringUtils.isAnyBlank(userAccount, userPassword, checkPassword,planetCode))&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="type">long</span> <span class="variable">result</span> <span class="operator">=</span> userService.userRegister(userAccount, userPassword, checkPassword, planetCode);</span><br><span class="line">   <span class="keyword">return</span> ResultUtils.success(result);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@PostMapping(&quot;/login&quot;)</span></span><br><span class="line"><span class="keyword">public</span> BaseResponse&lt;User&gt; <span class="title function_">userLogin</span><span class="params">(<span class="meta">@RequestBody</span> UserLoginRequest userLoginRequest, HttpServletRequest request)</span> &#123;</span><br><span class="line">   <span class="keyword">if</span> (userLoginRequest == <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> ResultUtils.error(ErrorCode.PARAMS_ERROR);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="type">String</span> <span class="variable">userAccount</span> <span class="operator">=</span> userLoginRequest.getUserAccount();</span><br><span class="line">   <span class="type">String</span> <span class="variable">userPassword</span> <span class="operator">=</span> userLoginRequest.getUserPassword();</span><br><span class="line">   <span class="keyword">if</span> (StringUtils.isAnyBlank(userAccount, userPassword)) &#123;</span><br><span class="line">      <span class="keyword">return</span> ResultUtils.error(ErrorCode.PARAMS_ERROR);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.userLogin(userAccount, userPassword, request);</span><br><span class="line">   <span class="keyword">return</span> ResultUtils.success(user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="全局异常处理器"><a href="#全局异常处理器" class="headerlink" title="全局异常处理器"></a>全局异常处理器</h2><ol>
<li>com.yupi.usercenter 下新建 exception 包，exception 包下新建 BusinessException.java</li>
</ol>
<p>新建 BuisnessException.java，增加代码，生成 constructor  </p>
<p>复制生成的 constructor 方法，修改一下 ， 生成 Getter  </p>
<p>生成的 Get 方法  </p>
<p>增加 final  </p>
<ol start="2">
<li><p>Debug 方式启动，前端注册进行测试（将星球编号写超过 5 位）<br>◦显示注册失败，抛出 500，虽然业务抛出异常 HTTP 状态码是 500 ，但是不应该让前端出现 500 ，应该返回刚刚定义的 40000<br>◦并且返回了后端的框架结构  </p>
</li>
<li><p>定义全局异常处理器<br>◦exception 包下新建 GlobalExceptionHandler.java</p>
</li>
</ol>
<p>◦ErrorCode 中增加系统内部异常状态码  </p>
<p>◦ResultUtils 中增加三个构造函数  </p>
<p>◦GlobalExceptionHandler 中编写具体异常处理代码  </p>
<ol start="4">
<li>修改 UserController</li>
</ol>
<p>register  </p>
<p>search  </p>
<p>logout  </p>
<p>delete  </p>
<p>login  </p>
<p>current  </p>
<ol start="5">
<li>修改 UserServiceImpl</li>
</ol>
<p>还有很多返回值进行自定义处理  </p>
<ol start="6">
<li>再次 Debug 启动，进行注册测试，前端返回想要的数据和提示</li>
</ol>
<p>💡启动项目报错了<br>•报错信息：Error creating bean with name ‘handlerExceptionResolver’ defined in class path resource [org&#x2F;springframework&#x2F;boot&#x2F;autoconfigure&#x2F;web&#x2F;servlet&#x2F;WebMvcAutoConfiguration$EnableWebMvcConfiguration.class]: Bean instantiation via factory method failed;<br>•报错原因：编写 GlobalExceptionHandler 中编写具体异常处理代码 时，两个方法匹配了同一个ExceptionHandler（复制粘贴时忘记更改了，下述代码已更正）<br>•报错解决：将两个方法匹配到对应的 ExceptionHandler 即可<br>@ExceptionHandler(BusinessException.class)<br>@ExceptionHandler(RuntimeException.class)</p>
<p>7.文件中修改代码<br>◦新建 BuisnessException.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yupi.usercenter.exception;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.yupi.usercenter.common.ErrorCode;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 自定义异常</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> yupi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BusinessException</span> <span class="keyword">extends</span> <span class="title class_">RuntimeException</span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> code;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">final</span> String description;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">public</span> <span class="title function_">BusinessException</span><span class="params">(String message, <span class="type">int</span> code, String description)</span> &#123;</span><br><span class="line">      <span class="built_in">super</span>(message);</span><br><span class="line">      <span class="built_in">this</span>.code = code;</span><br><span class="line">      <span class="built_in">this</span>.description = description;</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">public</span> <span class="title function_">BusinessException</span><span class="params">(ErrorCode errorCode)</span> &#123;</span><br><span class="line">      <span class="built_in">super</span>(errorCode.getMessage());</span><br><span class="line">      <span class="built_in">this</span>.code = errorCode.getCode();</span><br><span class="line">      <span class="built_in">this</span>.description = errorCode.getDescription();</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">public</span> <span class="title function_">BusinessException</span><span class="params">(ErrorCode errorCode, String description)</span> &#123;</span><br><span class="line">      <span class="built_in">super</span>(errorCode.getMessage());</span><br><span class="line">      <span class="built_in">this</span>.code = errorCode.getCode();</span><br><span class="line">      <span class="built_in">this</span>.description = description;</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getCode</span><span class="params">()</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> code;</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">public</span> String <span class="title function_">getDescription</span><span class="params">()</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> description;</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>◦ErrorCode.java<br><code>SYSTEM_ERROR(50000, &quot;系统内部异常&quot;, &quot;&quot;);</code></p>
<p>◦ResultUtils.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 失败</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> code</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> message</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> description</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> BaseResponse <span class="title function_">error</span><span class="params">(<span class="type">int</span> code, String message, String description)</span> &#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BaseResponse</span>&lt;&gt;(code, <span class="literal">null</span>, message, description);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 失败</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> errorCode</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> message</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> description</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> BaseResponse <span class="title function_">error</span><span class="params">(ErrorCode errorCode, String message, String description)</span> &#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BaseResponse</span>(errorCode.getCode(), <span class="literal">null</span>, message, description);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 失败</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> errorCode</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> description</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> BaseResponse <span class="title function_">error</span><span class="params">(ErrorCode errorCode, String description)</span> &#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BaseResponse</span>(errorCode.getCode(), errorCode.getMessage(), description);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>


<p>◦GlobalExceptionHandler.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yupi.usercenter.exception;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.yupi.usercenter.common.BaseResponse;</span><br><span class="line"><span class="keyword">import</span> com.yupi.usercenter.common.ErrorCode;</span><br><span class="line"><span class="keyword">import</span> com.yupi.usercenter.common.ResultUtils;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ExceptionHandler;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestControllerAdvice;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 全局异常处理器</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> yupi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestControllerAdvice</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GlobalExceptionHandler</span> &#123;</span><br><span class="line">   <span class="meta">@ExceptionHandler(BusinessException.class)</span></span><br><span class="line">   <span class="keyword">public</span> BaseResponse <span class="title function_">businessExceptionHandler</span><span class="params">(BusinessException e)</span> &#123;</span><br><span class="line">      log.error(<span class="string">&quot;runtimeException&quot;</span> + e.getMessage(), e);</span><br><span class="line">      <span class="keyword">return</span> ResultUtils.error(e.getCode(), e.getMessage(), e.getDescription());</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="meta">@ExceptionHandler(RuntimeException.class)</span></span><br><span class="line">   <span class="keyword">public</span> BaseResponse <span class="title function_">runtimeExceptionHandler</span><span class="params">(Exception e)</span> &#123;</span><br><span class="line">      log.error(<span class="string">&quot;runtimeException&quot;</span>,e);</span><br><span class="line">      <span class="keyword">return</span> ResultUtils.error(ErrorCode.SYSTEM_ERROR,<span class="string">&quot;&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>◦UserController.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Resource</span></span><br><span class="line">   <span class="keyword">private</span> UserService userService;</span><br><span class="line">   </span><br><span class="line">   <span class="meta">@PostMapping(&quot;/register&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> BaseResponse&lt;Long&gt; <span class="title function_">userRegister</span><span class="params">(<span class="meta">@RequestBody</span> UserRegisterRequest userRegisterRequest)</span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (userRegisterRequest == <span class="literal">null</span>) &#123;</span><br><span class="line">         <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(ErrorCode.PARAMS_ERROR);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="type">String</span> <span class="variable">userAccount</span> <span class="operator">=</span> userRegisterRequest.getUserAccount();</span><br><span class="line">      <span class="type">String</span> <span class="variable">userPassword</span> <span class="operator">=</span> userRegisterRequest.getUserPassword();</span><br><span class="line">      <span class="type">String</span> <span class="variable">checkPassword</span> <span class="operator">=</span> userRegisterRequest.getCheckPassword();</span><br><span class="line">      <span class="type">String</span> <span class="variable">planetCode</span> <span class="operator">=</span> userRegisterRequest.getPlanetCode();</span><br><span class="line">      <span class="keyword">if</span>(StringUtils.isAnyBlank(userAccount, userPassword, checkPassword,planetCode))&#123;</span><br><span class="line">         <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(ErrorCode.PARAMS_ERROR);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="type">long</span> <span class="variable">result</span> <span class="operator">=</span> userService.userRegister(userAccount, userPassword, checkPassword, planetCode);</span><br><span class="line">      <span class="keyword">return</span> ResultUtils.success(result);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@PostMapping(&quot;/login&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> BaseResponse&lt;User&gt; <span class="title function_">userLogin</span><span class="params">(<span class="meta">@RequestBody</span> UserLoginRequest userLoginRequest, HttpServletRequest request)</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (userLoginRequest == <span class="literal">null</span>) &#123;</span><br><span class="line">         <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(ErrorCode.PARAMS_ERROR);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="type">String</span> <span class="variable">userAccount</span> <span class="operator">=</span> userLoginRequest.getUserAccount();</span><br><span class="line">      <span class="type">String</span> <span class="variable">userPassword</span> <span class="operator">=</span> userLoginRequest.getUserPassword();</span><br><span class="line">      <span class="keyword">if</span> (StringUtils.isAnyBlank(userAccount, userPassword)) &#123;</span><br><span class="line">         <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(ErrorCode.PARAMS_ERROR);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.userLogin(userAccount, userPassword, request);</span><br><span class="line">      <span class="keyword">return</span> ResultUtils.success(user);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@PostMapping(&quot;/logout&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> BaseResponse&lt;Integer&gt; <span class="title function_">userLogout</span><span class="params">(HttpServletRequest request)</span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (request == <span class="literal">null</span>) &#123;</span><br><span class="line">         <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(ErrorCode.PARAMS_ERROR);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> userService.userLogout(request);</span><br><span class="line">      <span class="keyword">return</span> ResultUtils.success(result);</span><br><span class="line">   &#125;</span><br><span class="line"><span class="type">String</span> <span class="variable">userPassword</span> <span class="operator">=</span> userRegisterRequest.getUserPassword();</span><br><span class="line">      <span class="type">String</span> <span class="variable">checkPassword</span> <span class="operator">=</span> userRegisterRequest.getCheckPassword();</span><br><span class="line">      <span class="type">String</span> <span class="variable">planetCode</span> <span class="operator">=</span> userRegisterRequest.getPlanetCode();</span><br><span class="line">      <span class="keyword">if</span>(StringUtils.isAnyBlank(userAccount, userPassword, checkPassword,planetCode))&#123;</span><br><span class="line">         <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(ErrorCode.PARAMS_ERROR);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="type">long</span> <span class="variable">result</span> <span class="operator">=</span> userService.userRegister(userAccount, userPassword, checkPassword, planetCode);</span><br><span class="line">      <span class="keyword">return</span> ResultUtils.success(result);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@PostMapping(&quot;/logout&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> BaseResponse&lt;Integer&gt; <span class="title function_">userLogout</span><span class="params">(HttpServletRequest request)</span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (request == <span class="literal">null</span>) &#123;</span><br><span class="line">         <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(ErrorCode.PARAMS_ERROR);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> userService.userLogout(request);</span><br><span class="line">      <span class="keyword">return</span> ResultUtils.success(result);</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="meta">@GetMapping(&quot;/current&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> BaseResponse&lt;User&gt; <span class="title function_">getCurrentUser</span><span class="params">(HttpServletRequest request)</span>&#123;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">userObj</span> <span class="operator">=</span> request.getSession().getAttribute(USER_LOGIN_STATE);</span><br><span class="line">        <span class="type">User</span> <span class="variable">currentUser</span> <span class="operator">=</span> (User) userObj;</span><br><span class="line">      <span class="keyword">if</span> (currentUser == <span class="literal">null</span>) &#123;</span><br><span class="line">         <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(ErrorCode.NO_LOGIN);</span><br><span class="line">        &#125;</span><br><span class="line">      <span class="comment">// todo 校验用户是否合法</span></span><br><span class="line">      <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> currentUser.getId();</span><br><span class="line">      <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span>  userService.getById(userId);</span><br><span class="line">      <span class="type">User</span> <span class="variable">safetyUser</span> <span class="operator">=</span> userService.getSafetyUser(user);</span><br><span class="line">      <span class="keyword">return</span> ResultUtils.success(safetyUser);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(&quot;/search&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> BaseResponse&lt;List&lt;User&gt;&gt; <span class="title function_">searchUsers</span><span class="params">(String username,HttpServletRequest request)</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (!isAdmin(request))&#123;</span><br><span class="line">         <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(ErrorCode.PARAMS_ERROR);</span><br><span class="line">      &#125;</span><br><span class="line">      QueryWrapper&lt;User&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">      <span class="keyword">if</span> (StringUtils.isNotBlank(username)) &#123;</span><br><span class="line">         queryWrapper.like(<span class="string">&quot;username&quot;</span>, username);</span><br><span class="line">      &#125;</span><br><span class="line">      List&lt;User&gt; userList = userService.list(queryWrapper);</span><br><span class="line">      List&lt;User&gt; list = userList.stream().map(user -&gt; userService.getSafetyUser(user)).collect(Collectors.toList());</span><br><span class="line">      <span class="keyword">return</span> ResultUtils.success(list);</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="meta">@PostMapping(&quot;/delete&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> BaseResponse&lt;Boolean&gt; <span class="title function_">deleteUser</span><span class="params">(<span class="meta">@RequestBody</span> <span class="type">long</span> id,HttpServletRequest request)</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (!isAdmin(request))&#123;</span><br><span class="line">         <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(ErrorCode.NO_AUTH);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (id &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">         <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(ErrorCode.PARAMS_ERROR);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="type">boolean</span> <span class="variable">b</span> <span class="operator">=</span> userService.removeById(id);</span><br><span class="line">      <span class="keyword">return</span> ResultUtils.success(b);</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 是否为管理员</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">isAdmin</span><span class="params">(HttpServletRequest request)</span>&#123;</span><br><span class="line">      <span class="comment">//仅管理员可查询</span></span><br><span class="line">      <span class="type">Object</span> <span class="variable">userObj</span> <span class="operator">=</span> request.getSession().getAttribute(USER_LOGIN_STATE);</span><br><span class="line">      <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> (User) userObj;</span><br><span class="line">      <span class="keyword">return</span> user != <span class="literal">null</span> &amp;&amp; user.getUserRole() == ADMIN_ROLE;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>◦UserServiceImpl.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">long</span> <span class="title function_">userRegister</span><span class="params">(String userAccount, String userPassword, String checkPassword, String planetCode)</span> &#123;</span><br><span class="line">   <span class="comment">/* 1. 校验 */</span></span><br><span class="line">   <span class="keyword">if</span> (StringUtils.isAnyBlank(userAccount,userPassword,checkPassword,planetCode)) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(ErrorCode.PARAMS_ERROR, <span class="string">&quot;参数为空&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">if</span>(userAccount.length() &lt; <span class="number">4</span>)&#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(ErrorCode.PARAMS_ERROR, <span class="string">&quot;用户账号过短&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">if</span>(userPassword.length() &lt; <span class="number">8</span> || checkPassword.length() &lt; <span class="number">8</span>)&#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(ErrorCode.PARAMS_ERROR, <span class="string">&quot;密码长度过短&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">if</span> (planetCode.length() &gt; <span class="number">5</span>)&#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(ErrorCode.PARAMS_ERROR, <span class="string">&quot;星球编号过长&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">……</span><br><span class="line"></span><br><span class="line"><span class="comment">//账户不能重复</span></span><br><span class="line">QueryWrapper&lt;User&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">queryWrapper.eq(<span class="string">&quot;userAccount&quot;</span>,userAccount);</span><br><span class="line"><span class="type">long</span> <span class="variable">count</span> <span class="operator">=</span> userMapper.selectCount(queryWrapper);</span><br><span class="line"><span class="keyword">if</span> (count &gt; <span class="number">0</span>) &#123;</span><br><span class="line">   <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(ErrorCode.PARAMS_ERROR, <span class="string">&quot;用户账号重复&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//星球编号不能重复</span></span><br><span class="line">queryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">queryWrapper.eq(<span class="string">&quot;planetCode&quot;</span>,planetCode);</span><br><span class="line">count = userMapper.selectCount(queryWrapper);</span><br><span class="line"><span class="keyword">if</span> (count &gt; <span class="number">0</span>) &#123;</span><br><span class="line">   <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(ErrorCode.PARAMS_ERROR, <span class="string">&quot;星球编号重复&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h1 id="11前端优化"><a href="#11前端优化" class="headerlink" title="11前端优化"></a>11前端优化</h1><p>•对接后端的返回值，取 data<br>•全局响应处理：<a target="_blank" rel="noopener" href="https://blog.csdn.net/huantai3334/article/details/116780020">https://blog.csdn.net/huantai3334/article/details/116780020</a></p>
<p>◦应用场景：我们需要对接口的 通用响应 进行统一处理，比如从 response 中取出 data ；或者根据 code 去集中处理错误，比如用户未登录、没权限之类的<br>◦优势：不用在每个接口请求中都去写相同的逻辑<br>◦实现：参考使用的封装工具的官方文档，比如 umi-request ，如果使用 axios，参考 axios 的文档。创建新的文件，在该文件中配置一个全局请求类。在发送请求时，使用自己全局请求类</p>
<h2 id="全局请求响应拦截器封装（一）"><a href="#全局请求响应拦截器封装（一）" class="headerlink" title="全局请求响应拦截器封装（一）"></a>全局请求响应拦截器封装（一）</h2><ol>
<li><p>定义通用返回对象<br>为了前后端做适配<br>◦src&#x2F;services&#x2F;ant-design-pro&#x2F;typings.d.ts 文件中定义通用返回类<br>◦src&#x2F;services&#x2F;ant-design-pro&#x2F;api.ts 文件中给 Register 的响应类型封装一下<br>◦src&#x2F;pages&#x2F;user&#x2F;Register&#x2F;index.tsx 文件中修改一下注册判断<br>◦再次注册，可以看到有后端定义的 星球编号过长 的报错提示<br>◦更改一些其他 API<br>current<br>logout<br>login<br>search  </p>
</li>
<li><p>前端写一个全局响应拦截器<br>◦点击 request ，编写代码，测试一下，返回后端传递的真实参数<br>◦将所有接口中响应的 data 取出来，继续编写代码</p>
</li>
</ol>
<p>3.文件中修改代码<br>◦typings.d.ts</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 通用返回类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">type BaseResponse&lt;T&gt; = &#123;</span><br><span class="line">  code: number,</span><br><span class="line">  data: T,</span><br><span class="line">  message: string,</span><br><span class="line">  description: string,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>◦api.ts</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 获取当前的用户 GET /api/current */</span></span><br><span class="line">export async function <span class="title function_">currentUser</span><span class="params">(options?: &#123; [key: string]: any &#125;)</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> request&lt;API.BaseResponse&lt;API.CurrentUser&gt;&gt;(<span class="string">&#x27;/api/user/current&#x27;</span>, &#123;</span><br><span class="line">    method: <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">    ...(options || &#123;&#125;),</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** 退出登录接口 POST /api/user/logout */</span></span><br><span class="line">export async function <span class="title function_">outLogin</span><span class="params">(options?: &#123; [key: string]: any &#125;)</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> request&lt;API.BaseResponse&lt;number&gt;&gt;(<span class="string">&#x27;/api/user/logout&#x27;</span>, &#123;</span><br><span class="line">    method: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">    ...(options || &#123;&#125;),</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** 登录接口 POST /api/user/login */</span></span><br><span class="line">export async function <span class="title function_">login</span><span class="params">(body: API.LoginParams, options?: &#123; [key: string]: any &#125;)</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> request&lt;API.BaseResponse&lt;API.LoginResult&gt;&gt;(<span class="string">&#x27;/api/user/login&#x27;</span>, &#123;</span><br><span class="line">    method: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">    headers: &#123;</span><br><span class="line">      <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    data: body,</span><br><span class="line">    ...(options || &#123;&#125;),</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** 注册接口 POST /api/user/register */</span></span><br><span class="line">export async function <span class="title function_">register</span><span class="params">(body: API.RegisterParams, options?: &#123; [key: string]: any &#125;)</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> request&lt;API.BaseResponse&lt;API.RegisterResult&gt;&gt;(<span class="string">&#x27;/api/user/register&#x27;</span>, &#123;</span><br><span class="line">    method: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">    headers: &#123;</span><br><span class="line">      <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    data: body,</span><br><span class="line">    ...(options || &#123;&#125;),</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** 搜索用户 GET /api/user/search */</span></span><br><span class="line">export async function <span class="title function_">searchUsers</span><span class="params">(options?: &#123; [key: string]: any &#125;)</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> request&lt;API.BaseResponse&lt;API.CurrentUser[]&gt;&gt;(<span class="string">&#x27;/api/user/search&#x27;</span>, &#123;</span><br><span class="line">    method: <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">    ...(options || &#123;&#125;),</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>◦index.tsx</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  <span class="comment">// 注册</span></span><br><span class="line">  <span class="type">const</span> <span class="variable">res</span> <span class="operator">=</span> await <span class="title function_">register</span><span class="params">(values)</span>;</span><br><span class="line">  <span class="keyword">if</span> (res.code === <span class="number">0</span> &amp;&amp; res.data &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="type">const</span> <span class="variable">defaultLoginSuccessMessage</span> <span class="operator">=</span> <span class="string">&#x27;注册成功！&#x27;</span>;</span><br><span class="line">    message.success(defaultLoginSuccessMessage);</span><br><span class="line">    <span class="comment">/** 此方法会跳转到 redirect 参数所在的位置 */</span></span><br><span class="line">    <span class="keyword">if</span> (!history) <span class="keyword">return</span>;</span><br><span class="line">    const &#123; query &#125; = history.location;</span><br><span class="line">    history.push(&#123;</span><br><span class="line">      pathname: <span class="string">&#x27;/user/login&#x27;</span>,</span><br><span class="line">      query,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(res.description);</span><br><span class="line">  &#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> (error: any) &#123;</span><br><span class="line">  <span class="type">const</span> <span class="variable">defaultLoginFailureMessage</span> <span class="operator">=</span> <span class="string">&#x27;注册失败，请重试！&#x27;</span>;</span><br><span class="line">  message.error(error.message ?? defaultLoginFailureMessage);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 第二次修改 */</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  <span class="comment">// 注册</span></span><br><span class="line">  <span class="type">const</span> <span class="variable">id</span> <span class="operator">=</span> await <span class="title function_">register</span><span class="params">(values)</span>;</span><br><span class="line">  <span class="keyword">if</span> (id) &#123;</span><br><span class="line">    <span class="type">const</span> <span class="variable">defaultLoginSuccessMessage</span> <span class="operator">=</span> <span class="string">&#x27;注册成功！&#x27;</span>;</span><br><span class="line">    message.success(defaultLoginSuccessMessage);</span><br><span class="line">    <span class="comment">/** 此方法会跳转到 redirect 参数所在的位置 */</span></span><br><span class="line">    <span class="keyword">if</span> (!history) <span class="keyword">return</span>;</span><br><span class="line">    const &#123; query &#125; = history.location;</span><br><span class="line">    history.push(&#123;</span><br><span class="line">      pathname: <span class="string">&#x27;/user/login&#x27;</span>,</span><br><span class="line">      query,</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  message.error(defaultLoginFailureMessage);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>◦request.ts</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">requestConfig.responseInterceptors = [</span><br><span class="line">  async <span class="title function_">function</span> <span class="params">(response: Response, options: RequestOptionsInit)</span>: Response | Promise&lt;Response&gt; &#123;</span><br><span class="line">    <span class="type">const</span> <span class="variable">data</span> <span class="operator">=</span> await response.clone().json();</span><br><span class="line">    <span class="keyword">if</span> ()</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>



<h2 id="全局请求响应拦截器封装（二）"><a href="#全局请求响应拦截器封装（二）" class="headerlink" title="全局请求响应拦截器封装（二）"></a>全局请求响应拦截器封装（二）</h2><p>•request.ts 属于 .umi ，是框架自动生成的，会被覆盖掉，在 .gitignore 添加 .umi ，让编辑器帮我们识别它是项目自动生成的文件<br>•找回代码</p>
<ol>
<li>新建请求类，覆盖默认的 request 方法<br>◦src 文件夹下新建一个 plugins 文件夹，plugins 文件夹下新建 globalRequests.ts ，<br>◦将 这篇博客 的代码复制进来，删除不需要的代码</li>
</ol>
<p>◦修改代码<br>▪定义一下请求拦截器，比如每次发送请求时在控制台打印一下日志<br>▪编辑所有响应拦截器，前端接收到响应后，先获取响应的 data ，然后从这个 data 中判断一下</p>
<p>▪api.ts 中引入自己写的 request<br>◦注册测试一下，正常提示报错信息<br>◦登录测试一下，登陆成功<br>◦退出登录，直接访问登录成功后的用户管理页面，可以看到有 请先登录 的提示信息，返回 40100 状态码，重定向到登录页面。完成✌</p>
<p>用户管理页面链接: <a target="_blank" rel="noopener" href="http://localhost:8000/admin/user-manage?current=1&pageSize=5">http://localhost:8000/admin/user-manage?current=1&amp;pageSize=5</a> </p>
<h1 id="12项目部署"><a href="#12项目部署" class="headerlink" title="12项目部署"></a>12项目部署</h1><h2 id="多环境理论及实战（一）"><a href="#多环境理论及实战（一）" class="headerlink" title="多环境理论及实战（一）"></a>多环境理论及实战（一）</h2><blockquote>
<p>多环境参考文章：<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_41701290/article/details/120173283">https://blog.csdn.net/weixin_41701290&#x2F;article&#x2F;details&#x2F;120173283</a><br>本地开发：localhost (127.0.0.1)</p>
</blockquote>
<p>•多环境：一个项目部署在不同环境上进行调整配置<br>•为什么需要？<br>◦为了环境互不影响<br>◦区分不同的阶段：开发 &#x2F; 测试 &#x2F; 生产<br>◦对项目进行优化：<br>▪本地日志级别<br>▪精简依赖，节省项目体积<br>▪项目的 环境&#x2F;参数 可以调整，比如 JVM 参数</p>
<p>•多环境分类<br>◦本地环境：localhost，标识 local<br>◦开发环境：（远程开发）连同一机器，开发方便 dev<br>◦测试环境：（测试） 开发&#x2F;测试&#x2F;产品 使用； 单元测试&#x2F;性能测试&#x2F;功能测试&#x2F;系统集成测试；独立的数据库、独立的服务器 test<br>◦预发布环境：（体验服）和正式环境一致，正式数据库，更严谨，查出更多问题 pre<br>◦正式环境：（上线）尽量不改动保证代码“完美”运行 prod<br>◦沙箱环境：（实验环境）：为了做实验<br><font style="color:rgb(79, 79, 79);">遵循 3 个步骤：抽象配置类 + 配置文件化 + 注入环境参数</font></p>
<h2 id="多环境理论及实战（二）-前端"><a href="#多环境理论及实战（二）-前端" class="headerlink" title="多环境理论及实战（二）- 前端"></a>多环境理论及实战（二）- 前端</h2><blockquote>
<p>请求一个网页时，是先把网页的文件拿到自己的浏览器中，之后网页需要哪个文件再发出请求，localhost 请求自己的电脑，之后部署上线，不能让自己的电脑一直运行，所以我们要修改一下 localhost：8000</p>
</blockquote>
<ol>
<li>请求地址<br>◦开发环境：localhost:8000<br>◦线上环境：user-backend.code-nav.cn (鱼皮备案过的域名)</li>
</ol>
<p>启动方式<br>◦开发环境：npm run start（本地启动、监听端口、自动更新）<br>◦线上环境：npm run build（项目构建打包），可以使用 serve 工具启动（npm i -g serve）</p>
<blockquote>
<p>serve 安装：管理员方式打开命令行， 输入 npm i -g serve 命令，等待安装，安装后输入 serve -v 查看版本</p>
</blockquote>
<p>本地运行一下这个项目<br>▪右键 dist 文件夹，选择 Open in ，选择 Terminal<br>▪输入 serve 命令，访问第一个网址，网页弹出 production<br>使用 serve 启动相当于在自己电脑上运行了线上环境，自己的电脑就相当于是服务器（别人无法访问）</p>
<p>为什么输出 production？<br>在 package.json 中执行 build 命令时，umi 框架帮我们把 NODE_ENV &#x3D; production 传进来了</p>
<p>问题：<br><img src="https://cdn.nlark.com/yuque/0/2024/png/40385325/1731857692870-893b8926-93d0-4bc6-9793-0b0affda2892.png"></p>
<blockquote>
<p>这里 serve 出现安装成功但无法使用情况</p>
<ol>
<li><p>原因：之前安装 node 根据网上的教程设置了 npm config set prefix 和 npm config set cache 配置，之后使用 nvm 安装 node，没有将配置更改回默认</p>
</li>
<li><p>解决：<br>◦删除 .npmrc 文件中上述两个配置 或者直接删除文件然后重新配置一下镜像源【查找该文件的位置 cmd 命令行输入如下命令 npm config ls 】，执行 serve 全局安装命令即可<br>◦或者试试将之前 prefix 配置的位置增加到环境变量 PATH 中</p>
</li>
</ol>
</blockquote>
<p>线上的环境请求线上的后端<br>▪找到 src&#x2F;plugins&#x2F;globalRequests.ts 全局请求类，对 umi-request 做额外的配置，执行 build，刷新页面<br><img src="https://cdn.nlark.com/yuque/0/2024/png/40385325/1731857922713-2a16fc62-8fd8-4ceb-9152-05d43379a59d.png"></p>
<p><code>prefix: process.env.NODE_ENV === &#39;production&#39; ? &#39;[http://user-backend.code-nav.cn&#39;](http://user-backend.code-nav.cn&#39;) : undefined</code></p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/40385325/1731857855911-1d55e0de-9d83-4e6a-afbf-5b2cf192df7c.png"><br>start 启动访问地址是 8000</p>
<p><img src="https://cdn.nlark.com/yuque/0/2024/png/40385325/1731857872258-148765bc-0cf0-441c-ab28-7c3d61167143.png"><br>重新 build ，访问地址是 刚才配置的后端地址</p>
<blockquote>
<p>简单了解静态化<br>静态网页后缀一般为.html或者是.HTM<br>动态网页不是真实存在的页面，需要执行 ASP，php，asp.net 这样的外语言所生成的一个虚拟的网页，是以.asp、.jsp、.php、.perl、.cgi等形式为后缀，并且在动态网页网址中有一个标志性的符号—“?”</p>
<p>静态化<br>•根据页面路由，将每个路由都生成一个 index.html 静态文件<br>•优点：◦网页打开速度快◦相对比较稳定</p>
</blockquote>
<p>3.项目的配置<br>◦不同的项目（框架）都有不同的配置文件，umi 的配置文件是 config可以在配置文件后添加对应的环境名称后缀来区分开发环境和生产环境<br>▪开发环境：config.dev.ts<br>▪生产环境：config.pro.ts<br>▪公共配置：config.ts 不带后缀<br>Umi 部署文档：<a target="_blank" rel="noopener" href="https://v3.umijs.org/zh-CN/docs/deployment">https://v3.umijs.org/zh-CN/docs/deployment</a></p>
<h2 id="多环境理论及实战（三）-后端"><a href="#多环境理论及实战（三）-后端" class="headerlink" title="多环境理论及实战（三）- 后端"></a>多环境理论及实战（三）- 后端</h2><blockquote>
<p>主要是改<br>•依赖的环境地址<br>◦数据库地址<br>◦缓存地址<br>◦消息队列地址<br>◦项目端口号<br>•服务器配置</p>
</blockquote>
<p>SpringBoot 项目，通过 application.yml 添加不同的后缀来区分配置文件【可以在项目启动时传入环境变量】<br>application.yml 是公共配置，任何环境都会加载这个配置，通用的配置（例如 mybatis-plus 的配置），只写在公共配置即可</p>
<p>找到数据表，右键 &#x3D;&gt; Navigation &#x3D;&gt; Go to DDL，新建 sql 文件夹，sql 文件夹下新建 create_table.sql ，将 DDL 中的建表语句粘贴到新建的 .sql 文件中【如果这个数据表不能开源给其他人看，记得不要给出这个 sql 文件】</p>
<h2 id="线上数据库搭建"><a href="#线上数据库搭建" class="headerlink" title="线上数据库搭建"></a>线上数据库搭建</h2><p>Idea 测试连接<br>远程服务器公网 IP 工作台 &#x3D;&gt; 实例与镜像 &#x3D;&gt; 实例 &#x3D;&gt; 实例详情 &#x3D;&gt; 配置信息 &#x3D;&gt; 公网 IP<br><img src="https://cdn.nlark.com/yuque/0/2024/png/40385325/1731911635452-d641eba3-7f1c-42ec-a645-5baf3ddfe549.png"></p>
<p>线上数据库连接成功后配置<br>◦进入线上数据库控制台，创建数据库、数据表<br>◦修改 application-prod.yml 数据库配置信息<br>◦测试本地运行生产环境的项目</p>
<h2 id="原始-Nginx-SpringBoot"><a href="#原始-Nginx-SpringBoot" class="headerlink" title="原始 Nginx + SpringBoot"></a>原始 Nginx + SpringBoot</h2><p>参考文章：<a target="_blank" rel="noopener" href="https://www.bilibili.com/read/cv16179200">https://www.bilibili.com/read/cv16179200</a> -by 鱼皮<br>需要 Linux 服务器（建议用 CentOS 8+&#x2F;7.6 以上）<br>原始部署：什么都自己装</p>
<h2 id="前端-1"><a href="#前端-1" class="headerlink" title="前端"></a>前端</h2><p>阿里云在线可视化工具：<a target="_blank" rel="noopener" href="https://ecs-workbench.aliyun.com/">https://ecs-workbench.aliyun.com/</a><br>需要 web 服务器：nginx、apache、tomcat</p>
<ol>
<li>安装 nginx 服务器<br>•用系统自带带软件包管理器快速安装，比如 centos 的 yum<br>•自己到官网安装【参考文章 nginx 下载】</li>
</ol>
<p>依次执行下列命令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看当前所在目录</span></span><br><span class="line">pwd</span><br><span class="line">/root</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建 services 目录，存放项目的依赖和安装包</span></span><br><span class="line">mkdir services</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">进入 services 目录</span></span><br><span class="line">cd services</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">列出当前目录所含文件</span></span><br><span class="line">ls</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">nginx 1.26.2 安装链接</span></span><br><span class="line">https://nginx.org/download/nginx-1.26.2.tar.gz</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">安装 nginx 命令</span></span><br><span class="line">curl -o nginx-1.26.2.tar.gz https://nginx.org/download/nginx-1.26.2.tar.gz</span><br><span class="line">ls</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">解压 nginx 安装包</span></span><br><span class="line">tar -zxvf nginx-1.26.2.tar.gz</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">进入 nginx 目录</span></span><br><span class="line">cd nginx-1.26.2</span><br><span class="line">ls</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">删除 nginx 安装包——附加不执行</span></span><br><span class="line">rm -rf nginx-1.26.2</span><br><span class="line">rm -rf nginx-1.26.2.tar.gz nginx-1.26.2.tar.gz</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">检查 nginx 依赖环境是否正常</span></span><br><span class="line">./configure</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">安装依赖</span></span><br><span class="line">yum install pcre pcre-devel -y</span><br><span class="line">yum install openssl openssl-devel -y</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">设置系统配置参数</span></span><br><span class="line">./configure --with-http_ssl_module --with-http_v2_module --with-stream</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">再次检查 nginx 依赖环境是否正常</span></span><br><span class="line">./configure</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">开始编译</span></span><br><span class="line">make</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">安装</span></span><br><span class="line">make install</span><br><span class="line">ls</span><br><span class="line">ls /usr/local/nginx/sbin/nginx</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">history</span> 命令可以得到所有执行过的命令</span></span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">配置环境变量</span></span><br><span class="line">vim /etc/profile</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">shift</span> + g 跳至最后一行 按 o，最后一行插入</span></span><br><span class="line">export PATH=$PATH:/usr/local/nginx/sbin</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">按下 esc ，输入 :wq 回车，保存并退出</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">使文件生效</span></span><br><span class="line">source /etc/profile</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">执行</span></span><br><span class="line">nginx</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看启动情况，可以看到 80 端口已被 nginx 占用</span></span><br><span class="line">netstat -ntlp</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">进入 conf 文件</span></span><br><span class="line">cd conf</span><br><span class="line">ls</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">复制 nginx.conf 文件为 nginx.default.conf</span></span><br><span class="line">cp nginx.conf nginx.default.conf</span><br><span class="line">ls</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看原始配置文件</span></span><br><span class="line">cat nginx.conf</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">回到 services 目录</span></span><br><span class="line">cd ..</span><br><span class="line">cd ..</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">或者 <span class="built_in">cd</span> /root/services</span></span><br></pre></td></tr></table></figure>
<p>build 前端项目，将 dist 文件夹直接拖过来，失败了<br>将 dist 文件夹下的所有文件移动到 user-center-front 文件夹下，删除 dist 文件夹<br>再次访问，403 了</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看 nignx 进程启动人</span></span><br><span class="line">ps -ef | grep nginx</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">修改 nginx 启动人为 root</span></span><br><span class="line">vim nginx.conf</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">按 i 进入编辑模式，修改如下，修改完成按 esc ，输入 :wq ，回车</span></span><br><span class="line">    user  root;</span><br><span class="line">    worker_processes  1;</span><br><span class="line">    </span><br><span class="line">    #error_log  logs/error.log;</span><br><span class="line">    #error_log  logs/error.log  notice;</span><br><span class="line">    #error_log  logs/error.log  info;</span><br><span class="line">    </span><br><span class="line">    #pid        logs/nginx.pid;</span><br><span class="line">    </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">更新配置</span></span><br><span class="line">nginx -s reload</span><br></pre></td></tr></table></figure>
<p>再次访问，访问成功，结束</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://wzcwzc10.github.io">微光zc</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://wzcwzc10.github.io/2025/03/12/%E7%94%A8%E6%88%B7%E4%B8%AD%E5%BF%83(old)/">https://wzcwzc10.github.io/2025/03/12/%E7%94%A8%E6%88%B7%E4%B8%AD%E5%BF%83(old)/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://wzcwzc10.github.io" target="_blank">微光zc的网络小窝</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/java/">java</a><a class="post-meta__tags" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a><a class="post-meta__tags" href="/tags/%E5%90%8E%E7%AB%AF/">后端</a><a class="post-meta__tags" href="/tags/%E5%89%8D%E7%AB%AF/">前端</a><a class="post-meta__tags" href="/tags/%E6%80%BB%E7%BB%93/">总结</a></div><div class="post-share"><div class="social-share" data-image="/./img/YH/3/anbi3.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>来一杯燃油饮</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" src="/img/wechat.jpg" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/alipay.jpg" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/03/12/%E7%94%A8%E6%88%B7%E4%B8%AD%E5%BF%83(new)/" title="用户中心(new)"><img class="cover" src="/./img/YH/als.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">用户中心(new)</div></div><div class="info-2"><div class="info-item-1">鱼皮项目总结(1)</div></div></div></a><a class="pagination-related" href="/2025/03/25/IP%20%E5%9C%B0%E5%9D%80%E6%9F%A5%E8%AF%A2%E8%B0%83%E7%94%A8%E7%BD%91%E7%AB%99/" title="IP 地址查询调用网站"><img class="cover" src="/./img/YH/yhy.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">IP 地址查询调用网站</div></div><div class="info-2"><div class="info-item-1">IP 地址查询调用网站</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2025/03/12/%E7%94%A8%E6%88%B7%E4%B8%AD%E5%BF%83(new)/" title="用户中心(new)"><img class="cover" src="/./img/YH/als.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-03-12</div><div class="info-item-2">用户中心(new)</div></div><div class="info-2"><div class="info-item-1">鱼皮项目总结(1)</div></div></div></a><a class="pagination-related" href="/2025/11/24/%E4%BC%99%E4%BC%B4%E5%8C%B9%E9%85%8D/" title="伙伴匹配"><img class="cover" src="/./img/YH/hebian.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-11-24</div><div class="info-item-2">伙伴匹配</div></div><div class="info-2"><div class="info-item-1">鱼皮项目总结(2)</div></div></div></a><a class="pagination-related" href="/2025/12/04/API%E6%8E%A5%E5%8F%A3%E9%A1%B9%E7%9B%AE/" title="API接口项目"><img class="cover" src="/./img/YH/2/anbi2.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-12-04</div><div class="info-item-2">API接口项目</div></div><div class="info-2"><div class="info-item-1">API接口项目</div></div></div></a></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="giscus-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/./img/jufufu-ht.gif" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">微光zc</div><div class="author-info-description">一个有想法的极客</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">67</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">66</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">19</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://space.bilibili.com/178083315"><i class="fab fa-bilibili"></i><span>关注我！</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">世界全剧终，欢迎来到my blog！</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B%E5%8F%8A%E6%8A%80%E6%9C%AF%E9%80%89%E5%9E%8B"><span class="toc-number">1.</span> <span class="toc-text">1项目开发流程及技术选型</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B5%81%E7%A8%8B"><span class="toc-number">1.1.</span> <span class="toc-text">流程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90%E4%B8%8E%E6%8A%80%E6%9C%AF%E9%80%89%E5%9E%8B"><span class="toc-number">1.2.</span> <span class="toc-text">需求分析与技术选型</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2%E5%89%8D%E7%AB%AF%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-number">2.</span> <span class="toc-text">2前端初始化</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Ant-Design-%E7%BB%84%E4%BB%B6%E5%BC%95%E5%85%A5"><span class="toc-number">2.1.</span> <span class="toc-text">Ant Design 组件引入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A1%86%E6%9E%B6%E7%98%A6%E8%BA%AB"><span class="toc-number">2.2.</span> <span class="toc-text">框架瘦身</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3%E5%90%8E%E7%AB%AF%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-number">3.</span> <span class="toc-text">3后端初始化</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE"><span class="toc-number">3.1.</span> <span class="toc-text">创建项目</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-number">3.2.</span> <span class="toc-text">环境搭建</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Spring-Boot-%E6%A1%86%E6%9E%B6%E6%95%B4%E5%90%88"><span class="toc-number">3.3.</span> <span class="toc-text">Spring Boot 框架整合</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A1%A8%E8%AE%BE%E8%AE%A1"><span class="toc-number">3.4.</span> <span class="toc-text">数据库表设计</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%84%E6%95%B4%E9%A1%B9%E7%9B%AE%E7%9B%AE%E5%BD%95"><span class="toc-number">3.5.</span> <span class="toc-text">规整项目目录</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4%E5%90%8E%E7%AB%AF%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95%E5%8A%9F%E8%83%BD"><span class="toc-number">4.</span> <span class="toc-text">4后端注册登录功能</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E4%BB%A3%E7%A0%81%E7%94%9F%E6%88%90%E5%99%A8Mybatis-X%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">4.1.</span> <span class="toc-text">后端-代码生成器Mybatis-X的使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1"><span class="toc-number">4.2.</span> <span class="toc-text">详细设计</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8E%A5%E5%8F%A3%E6%B5%8B%E8%AF%95%E5%BC%80%E5%8F%91"><span class="toc-number">4.3.</span> <span class="toc-text">后端-接口测试开发</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95"><span class="toc-number">4.4.</span> <span class="toc-text">后端-单元测试</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%99%BB%E5%BD%95%E5%8A%9F%E8%83%BD%E7%BC%96%E5%86%99%E4%BB%A3%E7%A0%81"><span class="toc-number">4.5.</span> <span class="toc-text">登录功能编写代码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E7%99%BB%E5%BD%95%E6%80%81%E7%AE%A1%E7%90%86%EF%BC%88Cookie-%E5%92%8C-Session%EF%BC%89"><span class="toc-number">4.6.</span> <span class="toc-text">后端-登录态管理（Cookie 和 Session）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-%E6%8E%A5%E5%8F%A3%E5%BC%80%E5%8F%91%E5%8F%8A%E6%B5%8B%E8%AF%95"><span class="toc-number">4.7.</span> <span class="toc-text">后端-接口开发及测试</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86%E5%8A%9F%E8%83%BD"><span class="toc-number">5.</span> <span class="toc-text">5用户管理功能</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91"><span class="toc-number">5.1.</span> <span class="toc-text">后端开发</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF-%E9%A1%B5%E9%9D%A2%E5%BC%80%E5%8F%91%E5%8F%8A%E9%AA%8C%E8%AF%81"><span class="toc-number">5.2.</span> <span class="toc-text">前端-页面开发及验证</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E5%90%8E%E7%AB%AF%E8%81%94%E8%B0%83"><span class="toc-number">5.3.</span> <span class="toc-text">前后端联调</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A3%E7%90%86%E7%9F%A5%E8%AF%86"><span class="toc-number">5.4.</span> <span class="toc-text">代理知识</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#6%E5%89%8D%E7%AB%AF%E7%99%BB%E5%BD%95%E6%B3%A8%E5%86%8C%E5%8A%9F%E8%83%BD"><span class="toc-number">6.</span> <span class="toc-text">6前端登录注册功能</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF-%E8%AF%B7%E6%B1%82%E5%BA%93%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">6.0.1.</span> <span class="toc-text">前端-请求库的使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E5%86%8C%E5%8A%9F%E8%83%BD"><span class="toc-number">6.0.2.</span> <span class="toc-text">注册功能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF-%E5%BF%AB%E9%80%9F%E9%A1%B5%E9%9D%A2%E5%BC%80%E5%8F%91"><span class="toc-number">6.0.3.</span> <span class="toc-text">前端-快速页面开发</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF-%E8%A1%A8%E5%8D%95%E7%BB%84%E4%BB%B6%E4%BD%BF%E7%94%A8"><span class="toc-number">6.1.</span> <span class="toc-text">前端-表单组件使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF-API-%E6%8E%A5%E5%8F%A3%E6%B5%8B%E8%AF%95"><span class="toc-number">6.2.</span> <span class="toc-text">后端-API 接口测试</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%99%BB%E5%BD%95%E5%8A%9F%E8%83%BD"><span class="toc-number">6.2.1.</span> <span class="toc-text">登录功能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF-%E7%99%BB%E5%BD%95%E6%80%81%E7%AE%A1%E7%90%86"><span class="toc-number">6.2.2.</span> <span class="toc-text">前端-登录态管理</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#7%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86%E5%8A%9F%E8%83%BD"><span class="toc-number">7.</span> <span class="toc-text">7用户管理功能</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91%EF%BC%88%E4%B8%80%EF%BC%89"><span class="toc-number">7.1.</span> <span class="toc-text">前端开发（一）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91%EF%BC%88%E4%BA%8C%EF%BC%89"><span class="toc-number">7.2.</span> <span class="toc-text">前端开发（二）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8%E7%94%A8%E6%88%B7%E6%B3%A8%E9%94%80%E5%8A%9F%E8%83%BD"><span class="toc-number">7.3.</span> <span class="toc-text">8用户注销功能</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91-1"><span class="toc-number">7.3.1.</span> <span class="toc-text">后端开发</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91"><span class="toc-number">7.4.</span> <span class="toc-text">前端开发</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9%E7%94%A8%E6%88%B7%E6%A0%A1%E9%AA%8C"><span class="toc-number">7.5.</span> <span class="toc-text">9用户校验</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF"><span class="toc-number">7.5.1.</span> <span class="toc-text">后端</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF"><span class="toc-number">7.5.2.</span> <span class="toc-text">前端</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10%E5%90%8E%E7%AB%AF%E4%BB%A3%E7%A0%81%E4%BC%98%E5%8C%96"><span class="toc-number">7.6.</span> <span class="toc-text">10后端代码优化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%9A%E7%94%A8%E5%8F%8D%E9%A6%88%E5%AF%B9%E8%B1%A1"><span class="toc-number">7.7.</span> <span class="toc-text">通用反馈对象</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%BC%82%E5%B8%B8%E5%8F%8A%E9%94%99%E8%AF%AF%E4%BB%A3%E7%A0%81"><span class="toc-number">7.8.</span> <span class="toc-text">自定义异常及错误代码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%A8%E5%B1%80%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E5%99%A8"><span class="toc-number">7.9.</span> <span class="toc-text">全局异常处理器</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#11%E5%89%8D%E7%AB%AF%E4%BC%98%E5%8C%96"><span class="toc-number">8.</span> <span class="toc-text">11前端优化</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%A8%E5%B1%80%E8%AF%B7%E6%B1%82%E5%93%8D%E5%BA%94%E6%8B%A6%E6%88%AA%E5%99%A8%E5%B0%81%E8%A3%85%EF%BC%88%E4%B8%80%EF%BC%89"><span class="toc-number">8.1.</span> <span class="toc-text">全局请求响应拦截器封装（一）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%A8%E5%B1%80%E8%AF%B7%E6%B1%82%E5%93%8D%E5%BA%94%E6%8B%A6%E6%88%AA%E5%99%A8%E5%B0%81%E8%A3%85%EF%BC%88%E4%BA%8C%EF%BC%89"><span class="toc-number">8.2.</span> <span class="toc-text">全局请求响应拦截器封装（二）</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#12%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2"><span class="toc-number">9.</span> <span class="toc-text">12项目部署</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%9A%E7%8E%AF%E5%A2%83%E7%90%86%E8%AE%BA%E5%8F%8A%E5%AE%9E%E6%88%98%EF%BC%88%E4%B8%80%EF%BC%89"><span class="toc-number">9.1.</span> <span class="toc-text">多环境理论及实战（一）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%9A%E7%8E%AF%E5%A2%83%E7%90%86%E8%AE%BA%E5%8F%8A%E5%AE%9E%E6%88%98%EF%BC%88%E4%BA%8C%EF%BC%89-%E5%89%8D%E7%AB%AF"><span class="toc-number">9.2.</span> <span class="toc-text">多环境理论及实战（二）- 前端</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%9A%E7%8E%AF%E5%A2%83%E7%90%86%E8%AE%BA%E5%8F%8A%E5%AE%9E%E6%88%98%EF%BC%88%E4%B8%89%EF%BC%89-%E5%90%8E%E7%AB%AF"><span class="toc-number">9.3.</span> <span class="toc-text">多环境理论及实战（三）- 后端</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BA%BF%E4%B8%8A%E6%95%B0%E6%8D%AE%E5%BA%93%E6%90%AD%E5%BB%BA"><span class="toc-number">9.4.</span> <span class="toc-text">线上数据库搭建</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%9F%E5%A7%8B-Nginx-SpringBoot"><span class="toc-number">9.5.</span> <span class="toc-text">原始 Nginx + SpringBoot</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF-1"><span class="toc-number">9.6.</span> <span class="toc-text">前端</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/12/05/%E5%BE%AE%E5%85%89%E5%90%8E%E7%AB%AF%E5%85%A8%E8%83%BD%E4%BE%A0/" title="微光后端全能侠"><img src="/./img/YH/3/ailisi3.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="微光后端全能侠"/></a><div class="content"><a class="title" href="/2025/12/05/%E5%BE%AE%E5%85%89%E5%90%8E%E7%AB%AF%E5%85%A8%E8%83%BD%E4%BE%A0/" title="微光后端全能侠">微光后端全能侠</a><time datetime="2025-12-05T04:00:00.000Z" title="发表于 2025-12-05 12:00:00">2025-12-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/12/04/API%E6%8E%A5%E5%8F%A3%E9%A1%B9%E7%9B%AE/" title="API接口项目"><img src="/./img/YH/2/anbi2.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="API接口项目"/></a><div class="content"><a class="title" href="/2025/12/04/API%E6%8E%A5%E5%8F%A3%E9%A1%B9%E7%9B%AE/" title="API接口项目">API接口项目</a><time datetime="2025-12-04T05:30:00.000Z" title="发表于 2025-12-04 13:30:00">2025-12-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/12/01/%E5%9F%BA%E4%BA%8ESpring%E7%94%9F%E6%80%81%E7%9A%84%E6%99%BA%E8%83%BD%E6%96%87%E6%A1%A3%E5%88%86%E6%9E%90%E4%B8%8E%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0/" title="基于Spring生态的智能文档分析与管理系统设计与实现"><img src="/./img/YH/zzz.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="基于Spring生态的智能文档分析与管理系统设计与实现"/></a><div class="content"><a class="title" href="/2025/12/01/%E5%9F%BA%E4%BA%8ESpring%E7%94%9F%E6%80%81%E7%9A%84%E6%99%BA%E8%83%BD%E6%96%87%E6%A1%A3%E5%88%86%E6%9E%90%E4%B8%8E%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0/" title="基于Spring生态的智能文档分析与管理系统设计与实现">基于Spring生态的智能文档分析与管理系统设计与实现</a><time datetime="2025-11-30T16:00:00.000Z" title="发表于 2025-12-01 00:00:00">2025-12-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/11/29/%E5%BE%AE%E5%85%89%E7%94%B5%E5%AD%90%E4%B9%A6%E5%B1%8B/" title="微光电子书屋"><img src="/./img/YH/yyy.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="微光电子书屋"/></a><div class="content"><a class="title" href="/2025/11/29/%E5%BE%AE%E5%85%89%E7%94%B5%E5%AD%90%E4%B9%A6%E5%B1%8B/" title="微光电子书屋">微光电子书屋</a><time datetime="2025-11-29T11:30:00.000Z" title="发表于 2025-11-29 19:30:00">2025-11-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/11/27/JWT%20%E5%92%8C%20Session%E7%9A%84%E5%8C%BA%E5%88%AB/" title="JWT 和 Session的区别"><img src="/./img/YH/als.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="JWT 和 Session的区别"/></a><div class="content"><a class="title" href="/2025/11/27/JWT%20%E5%92%8C%20Session%E7%9A%84%E5%8C%BA%E5%88%AB/" title="JWT 和 Session的区别">JWT 和 Session的区别</a><time datetime="2025-11-27T02:00:00.000Z" title="发表于 2025-11-27 10:00:00">2025-11-27</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(/./img/YH/3/anbi3.png);"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2025 By 微光zc</span></div><div class="footer_custom_text">世界全剧终，欢迎来到my blog！</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=5.5.2"></script><script src="/js/main.js?v=5.5.2"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@6.1.4/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.pageType === 'shuoshuo'
  const option = null

  const getGiscusTheme = theme => theme === 'dark' ? 'dark' : 'light'

  const createScriptElement = config => {
    const ele = document.createElement('script')
    Object.entries(config).forEach(([key, value]) => {
      ele.setAttribute(key, value)
    })
    return ele
  }

  const loadGiscus = (el = document, key) => {
    const mappingConfig = isShuoshuo
      ? { 'data-mapping': 'specific', 'data-term': key }
      : { 'data-mapping': (option && option['data-mapping']) || 'pathname' }

    const giscusConfig = {
      src: 'https://giscus.app/client.js',
      'data-repo': 'wzcwzc10/wzcwzc10.github.io',
      'data-repo-id': 'R_kgDOPIIccg',
      'data-category-id': 'DIC_kwDOPIIccs4CtHqc',
      'data-theme': getGiscusTheme(document.documentElement.getAttribute('data-theme')),
      'data-reactions-enabled': '1',
      crossorigin: 'anonymous',
      async: true,
      ...option,
      ...mappingConfig
    }

    const scriptElement = createScriptElement(giscusConfig)

    el.querySelector('#giscus-wrap').appendChild(scriptElement)

    if (isShuoshuo) {
      window.shuoshuoComment.destroyGiscus = () => {
        if (el.children.length) {
          el.innerHTML = ''
          el.classList.add('no-comment')
        }
      }
    }
  }

  const changeGiscusTheme = theme => {
    const iframe = document.querySelector('#giscus-wrap iframe')
    if (iframe) {
      const message = {
        giscus: {
          setConfig: {
            theme: getGiscusTheme(theme)
          }
        }
      }
      iframe.contentWindow.postMessage(message, 'https://giscus.app')
    }
  }

  btf.addGlobalFn('themeChange', changeGiscusTheme, 'giscus')

  if (isShuoshuo) {
    'Giscus' === 'Giscus'
      ? window.shuoshuoComment = { loadComment: loadGiscus }
      : window.loadOtherComment = loadGiscus
    return
  }

  if ('Giscus' === 'Giscus' || !false) {
    if (false) btf.loadComment(document.getElementById('giscus-wrap'), loadGiscus)
    else loadGiscus()
  } else {
    window.loadOtherComment = loadGiscus
  }
})()</script></div><canvas id="universe"></canvas><script defer src="/js/universe.js"></script><script src="https://cdn.jsdelivr.net/gh/weilain/cdn-photo/js/jquery.min.js"></script><div class="aplayer no-destroy" data-id="13985424074" data-server="netease" data-type="playlist" data-fixed="true" data-autoplay="false"> </div><script id="canvas_nest" defer="defer" color="255,255,0" opacity="0.6" zIndex="-1" count="120" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/canvas-nest.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/dist/click-show-text.min.js" data-mobile="true" data-text="微光zc,GitHub" data-fontsize="29px" data-random="true" async="async"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/metingjs/dist/Meting.min.js"></script><script>(() => {
  const destroyAplayer = () => {
    if (window.aplayers) {
      for (let i = 0; i < window.aplayers.length; i++) {
        if (!window.aplayers[i].options.fixed) {
          window.aplayers[i].destroy()
        }
      }
    }
  }

  const runMetingJS = () => {
    typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()
  }

  btf.addGlobalFn('pjaxSend', destroyAplayer, 'destroyAplayer')
  btf.addGlobalFn('pjaxComplete', loadMeting, 'runMetingJS')
})()</script><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js"></script><script>(() => {
  const pjaxSelectors = ["meta[property=\"og:image\"]","meta[property=\"og:title\"]","meta[property=\"og:url\"]","meta[property=\"og:description\"]","link[rel=\"canonical\"]","head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

  window.pjax = new Pjax({
    elements: 'a:not([target="_blank"]):not([href="/music/"])',
    selectors: pjaxSelectors,
    cacheBust: false,
    analytics: false,
    scrollRestoration: false
  })

  const triggerPjaxFn = (val) => {
    if (!val) return
    Object.values(val).forEach(fn => {
      try {
        fn()
      } catch (err) {
        console.debug('Pjax callback failed:', err)
      }
    })
  }

  document.addEventListener('pjax:send', () => {
    // removeEventListener
    btf.removeGlobalFnEvent('pjaxSendOnce')
    btf.removeGlobalFnEvent('themeChange')

    // reset readmode
    const $bodyClassList = document.body.classList
    if ($bodyClassList.contains('read-mode')) $bodyClassList.remove('read-mode')

    triggerPjaxFn(window.globalFn.pjaxSend)
  })

  document.addEventListener('pjax:complete', () => {
    btf.removeGlobalFnEvent('pjaxCompleteOnce')
    document.querySelectorAll('script[data-pjax]').forEach(item => {
      const newScript = document.createElement('script')
      const content = item.text || item.textContent || item.innerHTML || ""
      Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
      newScript.appendChild(document.createTextNode(content))
      item.parentNode.replaceChild(newScript, item)
    })

    triggerPjaxFn(window.globalFn.pjaxComplete)
  })

  document.addEventListener('pjax:error', e => {
    if (e.request.status === 404) {
      const usePjax = true
      false
        ? (usePjax ? pjax.loadUrl('/404.html') : window.location.href = '/404.html')
        : window.location.href = e.request.responseURL
    }
  })
})()</script><script async data-pjax src="/"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><i class="fas fa-spinner fa-pulse" id="loading-status" hidden="hidden"></i><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="local-search-input"><input placeholder="搜索文章" type="text"/></div><hr/><div id="local-search-results"></div><div class="ais-Pagination" id="local-search-pagination" style="display:none;"><ul class="ais-Pagination-list"></ul></div><div id="local-search-stats"></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=5.5.2"></script></div></div></body></html><script type="text/javascript" src="/js/crash_cheat.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sakana-widget@2.7.1/lib/sakana.min.css"><div id="sakana-widget" style="position:fixed;bottom:5px;right:80px;"></div><script>function initSakanaWidget() {
  const jufufuht = SakanaWidget.getCharacter('chisato');
  jufufuht.image = `https://wzcwzc10.github.io/img/jufufu.png`;
  jufufuht.initialState = {
    ...jufufuht.initialState,
    i: 0.001,
    d: 1,
  };
  SakanaWidget.registerCharacter('jufufuht', jufufuht);
  new SakanaWidget({ character: 'jufufuht' }).mount('#sakana-widget');

  const jufufu = SakanaWidget.getCharacter('takina');
  jufufu.image = `https://wzcwzc10.github.io/img/jufufu-ht.gif`;
  SakanaWidget.registerCharacter('jufufu', jufufu);
  new SakanaWidget({ character: 'jufufu' }).mount('#sakana-widget');
}
nextCharacter(jufufuht);</script><script async onload="initSakanaWidget()" src="https://cdn.jsdelivr.net/npm/sakana-widget@2.7.1/lib/sakana.min.js"></script>